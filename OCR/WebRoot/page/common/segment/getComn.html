<meta charset="UTF-8"><div id="comn_modal" class="modal fade in" tabindex="-1" role="dialog" aria-labelledby="full-width-modalLabel" aria-hidden="true" style="display:none"><div class="modal-dialog"><div class="modal-content"><div class="modal-header"><div class="quotation-nav"><div class="row"><div class="quotation-nav-left"><b id="comn_text" style="margin-left:20px">提取佣金</b></div><div class="quotation-nav-right"><button type="button" class="close-modal btn-success" data-dismiss="modal" aria-hidden="true"><i class="glyphicon glyphicon-remove" style="padding:0"></i></button></div></div></div></div><div class="modal-body"><div class="row container"><div class="col-sm-12"><div class="row"><div class="form-horizontal"><table class="table table-bordered" id="comn_table"><tbody><tr><th class="text-797979" style="width:3%"><input type="checkbox" class="selectAll"></th><th class="text-797979" style="width:32%">购买金额</th><th class="text-797979" style="width:32%">应提佣金</th><th class="text-797979" style="width:33%">本次提取</th></tr></tbody></table><table class="table table-bordered hide" id="comn_tableView"><tbody><tr><th class="text-797979" style="width:25%">审批时间</th><th class="text-797979" style="width:25%">审批人</th><th class="text-797979" style="width:25%">审批结果</th><th class="text-797979" style="width:25%">备注</th></tr></tbody></table></div></div><div class="row" style="padding-bottom:5px;padding-left:10%"><div class="form-horizontal"><div class="form-group"><div class="col-sm-1"></div><div class="col-sm-9"></div></div></div></div></div></div></div><div class="modal-footer" style="padding:20px"><button type="button" class="btn btn-success" data-dismiss="modal">取消</button> <button type="button" class="btn btn-success" data-dismiss="modal" id="saveComnBtn">保存</button></div></div></div></div><script>var comn="",addLine=function(n){if(0==n.length){return $("#comn_table").find("tbody").append('<tr><td class="text-center" colspan="4">暂无可提取佣金</td></tr>'),$("#comn_table").find(".selectAll").prop("disabled",!0),!1}var c=$("#comn_table").find("tbody");$.each(n,function(e){var t='<tr><td><input type="checkbox" class="select"></td><td class="hidden">'+n[e].id+"</td><td>"+n[e].totalAmt+"</td><td>"+n[e].fee+'</td><td><input type="text" readonly value="0.00"></td></tr>';c.append(t)})};Core.AjaxRequest({url:_global_settings.service.url+"/agentrevenue/agentrevenueall",type:"GET",showMsg:!1,async:!1,callback:function(e){$("#comn_table").find("tbody").find("tr:gt(0)").remove(),addLine(comn=e)},failure:function(){}}),$("#comn_table").on("click",".selectAll",function(){var e=$(this).is(":checked");selectOrNot(e)}),$("#comn_table").on("click",".select",function(){var e=$(this).is(":checked");selectClick($(this),e)});var selectOrNot=function(c){var e=$("#comn_table").find("tr:gt(0)");$.each(e,function(e,t){if(c){$(this).children().eq(0).children()[0].checked=!0;var n=$(this).children().eq(3).text();$(this).children().eq(4).children().val(money(n))}else $(this).children().eq(0).children()[0].checked=!1,$(this).children().eq(4).children().val(money(0))})},selectClick=function(e,t){if($(".selectAll")[0].checked=!1,t){e[0].checked=!0;var n=e.parent().parent().children().eq(3).text();e.parent().parent().children().eq(4).children().val(money(n))}else e[0].checked=!1,e.parent().parent().children().eq(4).children().val(money(0))};$("#saveComnBtn").on("click",function(){if(0==comn.length)return Core.alert({message:"没有可提取佣金！"}),!1;var n=[],e=$("#comn_table").find("tbody").find("tr:gt(0)");$.each(e,function(e,t){0!=$(this).children().eq(4).children().val()&&n.push(parseInt($(this).children().eq(1).text()))}),console.log(n),Core.AjaxRequest({url:_global_settings.service.url+"/agentrevenue/updateagentrevenueapply",type:"POST",params:n,async:!1,callback:function(e){$("#comnMgtGrid").jqxGrid("updatebounddata","cells")},failure:function(){}})})</script>