var CashflowMgt=function(){var t=this,e=_global_settings.service.url+"/ac/";this.random=Math.random(),this.cashFlowId=null,this.yearAmt=null,this.monthAmt=null,this.date=new Date,this.initInput=function(){t.setIdAndTextAlign(),$("#cashFlow_nowDate").text(t.setDate()),$("#cashflow-time").monthpicker({callback:"dasdasd"}),$("#cashflow_comname").text(_global_settings.owner.companyname),t.getTableData(),t.disInput("y"),t.disInput("m"),t.inputEvent(),t.initPages()},this.initPages=function(){if("中文"==$("#main-changeLanguage").html()){$("#cashflow-search").html("&nbsp;&nbsp;Search&nbsp;&nbsp;&nbsp;"),$("#cashflow-print").html("&nbsp;&nbsp;Print&nbsp;&nbsp;&nbsp;"),$("#cashflow-out").html("&nbsp;&nbsp;Export&nbsp;&nbsp;&nbsp;"),$("#cashFlow-searchdate").html("Date"),$("#cashFlow-headMsg").html("Cash Flow Statement");$("#cashFlow_nowDate").text(function(){var e=t.date.getFullYear(),a=t.date.getMonth();a+=1;var n=t.date.getDate();return a<10&&(a="0"+a),n<10&&(n="0"+n),n+"/"+a+"/"+e}()),$("#cashFlow-unit").html("Unit：RMB");var e=$("#cashFlowDataTable>thead>tr>th");e.eq(0).html("Items"),e.eq(1).html("Line No."),e.eq(2).html("Accumulated Amount For The Year"),e.eq(3).html("Accumulated Amount For The Month");var a=$("#cashFlowDataTable>tbody>tr");a.eq(0).find("td:first").text("I、 Cash flows from operating activities:"),a.eq(1).find("td:first").text("Cash received from sale of goods or rendering of services"),a.eq(2).find("td:first").text("Other cash received relating to operating activities"),a.eq(3).find("td:first").text("Cash paid for goods and services"),a.eq(4).find("td:first").text("Cash paid to and on behalf of employees"),a.eq(5).find("td:first").text("Payments of all types of taxes"),a.eq(6).find("td:first").text("Other cash paid relating to operating activities"),a.eq(7).find("td:first").text("Net cash flows from operating activities"),a.eq(8).find("td:first").text("II、 cash flow from investing activities:"),a.eq(9).find("td:first").text("Cash received from disposal of investments"),a.eq(10).find("td:first").text("Cash received from returns on investments"),a.eq(11).find("td:first").text("Net cash received from disposal of fixed assets,intangible assets & other long-term assets"),a.eq(12).find("td:first").text("Other cash received relating to investing activities"),a.eq(13).find("td:first").text("Cash paid to acquire fixed assets,intangible assets & other long-term assets"),a.eq(14).find("td:first").text("Net cash flows from investing activities"),a.eq(15).find("td:first").text("III、 cash flow from financing activities:"),a.eq(16).find("td:first").text("Cash received from borrowings"),a.eq(17).find("td:first").text("Cash received from capital contribution"),a.eq(18).find("td:first").text("Cash repayments of amounts borrowed"),a.eq(19).find("td:first").text("Cash payments of interest expenses"),a.eq(20).find("td:first").text("Cash payments for distribution of dividends or profit"),a.eq(21).find("td:first").text("Net cash flows from financing activities"),a.eq(22).find("td:first").text("IV、Net increase in cash"),a.eq(23).find("td:first").text("Plus:Cash at beginning of year"),a.eq(24).find("td:first").text("V、Cash at end of year")}},this.inputEvent=function(){var a="update";$("#cashflow-update-m").on("click",function(){var n=$(this);if($(".editInput_m").parent().removeClass("p-r-10").addClass("p-r-l-10"),$(".editInput_y").parent().removeClass("p-r-10").addClass("p-r-l-10"),"save"==a){var i=moneySmall($("#cf_input_m_20").text()),s=moneySmall($("#cf_input_m_21").text()),o=moneySmall($("#cf_input_m_22").text());if(money(i+s)!=money(o))return Core.alert({message:"现金净增加额加期初现金余额不等于期末现金余额,请重新调整"}),!1;var r=[];return $("#cashFlowDataTable").find(".editInput_m").each(function(t,e){var a={},n=$(this);a.id=n.attr("data-id"),a.monthAmt=t in{6:!0,12:!0,18:!0,19:!0,20:!0,21:!0}?moneySmall(n.text()):moneySmall(n.val()),r.push(a)}),void Core.AjaxRequest({type:"POST",showMsg:!1,async:!1,params:r,url:e+(new Base64).encode("tosys/coaReport/adjust/"+$("#cashflow-time").val()+"/"+currentUserInfo.id+"/"+currentUserInfo.loginId),callback:function(e){setCloseAlertTimeOneSecond(),t.setValue(e),n.addClass("md-rate-review"),n.removeClass("md-save"),n.attr("title","保存"),t.disInput("m"),a="update"}})}if("update"==a)return n.addClass("md-save"),n.removeClass("md-rate-review"),n.attr("title","保存"),t.allowInput("m"),void(a="save")});var n="update";$("#cashflow-update-y").on("click",function(){var a=$(this);if($(".editInput_m").parent().removeClass("p-r-10").addClass("p-r-l-10"),$(".editInput_y").parent().removeClass("p-r-10").addClass("p-r-l-10"),"save"==n){var i=moneySmall($("#cf_input_y_20").text()),s=moneySmall($("#cf_input_y_21").text()),o=moneySmall($("#cf_input_y_22").text());if(money(i+s)!=money(o))return Core.alert({message:"现金净增加额加期初现金余额不等于期末现金余额,请重新调整"}),!1;var r=[];return $("#cashFlowDataTable").find(".editInput_y").each(function(t,e){var a={},n=$(this);a.id=n.attr("data-id"),a.yearAmt=t in{6:!0,12:!0,18:!0,19:!0,20:!0,21:!0}?moneySmall(n.text()):moneySmall(n.val()),r.push(a)}),void Core.AjaxRequest({type:"POST",showMsg:!1,async:!1,params:r,url:e+(new Base64).encode("tosys/coaReport/adjustYear/"+$("#cashflow-time").val()+"/"+currentUserInfo.id+"/"+currentUserInfo.loginId),callback:function(e){setCloseAlertTimeOneSecond(),t.setValue(e),a.addClass("md-rate-review"),a.removeClass("md-save"),a.attr("title","保存"),t.disInput("y"),n="update"}})}if("update"==n)return a.addClass("md-save"),a.removeClass("md-rate-review"),a.attr("title","保存"),t.allowInput("y"),void(n="save")}),$(".editInput_m").moneyinput(),$(".editInput_y").moneyinput(),$(".editInput_m").parent().removeClass("p-r-10").addClass("p-r-l-10"),$(".editInput_y").parent().removeClass("p-r-10").addClass("p-r-l-10"),$("#cashFlowDataTable").on("keyup",".editInput_m",function(){if(!$("#cf_input_m_1").attr("readonly")){var t=0,e=0,a=0,n=0,i=[1,2,3,4,5,6];$.each(i,function(t,e){i[t]=parseFloat(moneySmall($("#cf_input_m_"+e).val()))}),t=i[0]+i[1]-i[2]-i[3]-i[4]-i[5],$("#cf_input_m_7").text(moneyBig(t));var s=[8,9,10,11,12];$.each(s,function(t,e){s[t]=parseFloat(moneySmall($("#cf_input_m_"+e).val()))}),e=s[0]+s[1]+s[2]-s[3]-s[4],$("#cf_input_m_13").text(moneyBig(e));var o=[14,15,16,17,18];$.each(o,function(t,e){o[t]=parseFloat(moneySmall($("#cf_input_m_"+e).val()))}),a=o[0]+o[1]-o[2]-o[3]-o[4],$("#cf_input_m_19").text(moneyBig(a)),n=moneySmall(t)+moneySmall(e)+moneySmall(a),$("#cf_input_m_20").text(moneyBig(n))}}),$("#cashFlowDataTable").on("keyup",".editInput_y",function(){if(!$("#cf_input_y_1").attr("readonly")){var t=0,e=0,a=0,n=0,i=[1,2,3,4,5,6];$.each(i,function(t,e){i[t]=parseFloat(moneySmall($("#cf_input_y_"+e).val()))}),t=i[0]+i[1]-i[2]-i[3]-i[4]-i[5],$("#cf_input_y_7").text(moneyBig(t));var s=[8,9,10,11,12];$.each(s,function(t,e){s[t]=parseFloat(moneySmall($("#cf_input_y_"+e).val()))}),e=s[0]+s[1]+s[2]-s[3]-s[4],$("#cf_input_y_13").text(moneyBig(e));var o=[14,15,16,17,18];$.each(o,function(t,e){o[t]=parseFloat(moneySmall($("#cf_input_y_"+e).val()))}),a=o[0]+o[1]-o[2]-o[3]-o[4],$("#cf_input_y_19").text(moneyBig(a)),n=moneySmall(t)+moneySmall(e)+moneySmall(a),$("#cf_input_y_20").text(moneyBig(n))}})},this.disInput=function(t){$("#cashFlowDataTable").find(".editInput_"+t).each(function(){$(this).attr("readonly","readonly")})},this.allowInput=function(t){$("#cashFlowDataTable").find(".editInput_"+t).each(function(){$(this).removeAttr("readonly")})},this.setValue=function(t,e){for(var a=0;a<t.length;a++){var n=t[a].id,i=t[a].yearAmt,s=t[a].monthAmt,o=0,r=0;n in{7:!0,13:!0,19:!0,20:!0,21:!0,22:!0}?($("#cf_input_y_"+n).text(moneyBig(i)),$("#cf_input_m_"+n).text(moneyBig(s)),n in{7:!0,13:!0,19:!0}&&(o+=i,r+=s)):($("#cf_input_y_"+n).val(money(i)),$("#cf_input_m_"+n).val(money(s))),$("#cf_input_m_"+n).attr("data-id",n),$("#cf_input_y_"+n).attr("data-id",n)}$("#cashFlowDataTable").data("time",e)},this.setIdAndTextAlign=function(){$("#cashFlowDataTable tr:gt(0)").each(function(e,a){var n=$(this).attr("id");void 0!=n&&$(this).attr("id",n+t.random)})},this.setDate=function(){var e=t.date.getFullYear(),a=t.date.getMonth();a+=1;var n=t.date.getDate();return a<10&&(a="0"+a),n<10&&(n="0"+n),e+"年"+a+"月"+n+"日"},this.getYearAndMonth=function(){var e=t.date.getFullYear(),a=t.date.getMonth();return a+=1,a<10&&(a="0"+a),e+"-"+a},this.getTableData=function(){Core.AjaxRequest({type:"GET",showMsg:!1,url:e+(new Base64).encode("tosys/coaReport/cashflow/month/"+$("#cashflow-time").val()+"/"+currentUserInfo.id+"/"+currentUserInfo.loginId),callback:function(e){for(var a=0;a<e.length;a++)t.cashFlowId=e[a].id,t.yearAmt=e[a].yearAmt,t.monthAmt=e[a].monthAmt,t.addDataToTable(t.cashFlowId,t.yearAmt,t.monthAmt);t.setValue(e,t.getYearAndMonth()),t.setTextStyle()}})},this.setTextStyle=function(){$("#cashFlowDataTable tr:gt(0)").each(function(t,e){void 0!=$(this).attr("id")&&$(this).find("td").each(function(t){2!=t&&3!=t||$(this).attr("class","p-r-10 text-right")})})},this.addDataToTable=function(t,e,a){$("#cashFlowDataTable");$("#cashFlowDataTable tr:gt(0)").each(function(n,i){var s=$(this).attr("id");void 0!=s&&(s=s.substring(0,3)>=100?s.substring(0,2):s.substring(0,1),$(this).find("td").each(function(n){var i=$(this),o=i.find("input");0!=n&&1!=n&&(s==t?2==n?o.val(formatNum(e)):o.val(formatNum(a)):""==o.val()&&o.val(0))}))})},this.setFirstValue=function(){var t=0,e=0;return $("#cashFlowDataTable>tbody>tr").each(function(a,n){a>0&&a<=6&&(1==a||2==a?$(this).find("td").each(function(a,n){0!=a&&1!=a&&(2==a?t+=parseFloat($(this).text()):e+=parseFloat($(this).text()))}):$(this).find("td").each(function(a,n){0!=a&&1!=a&&(2==a?t-=parseFloat($(this).text()):e-=parseFloat($(this).text()))}))}),[t,e]},this.setSecondValue=function(){var t=0,e=0;return $("#cashFlowDataTable>tbody>tr").each(function(a,n){a>=9&&a<=13&&(a>=9&&a<=11?$(this).find("td").each(function(a,n){0!=a&&1!=a&&(2==a?t+=parseFloat($(this).text()):e+=parseFloat($(this).text()))}):$(this).find("td").each(function(a,n){0!=a&&1!=a&&(2==a?t-=parseFloat($(this).text()):e-=parseFloat($(this).text()))}))}),[t,e]},this.setThirdValue=function(){var t=0,e=0;return $("#cashFlowDataTable>tbody>tr").each(function(a,n){a>=16&&a<=20&&(a>=16&&a<=17?$(this).find("td").each(function(a,n){0!=a&&1!=a&&(2==a?t+=parseFloat($(this).text()):e+=parseFloat($(this).text()))}):$(this).find("td").each(function(a,n){0!=a&&1!=a&&(2==a?t-=parseFloat($(this).text()):e-=parseFloat($(this).text()))}))}),[t,e]},this.calculate=function(){var e=$("#cashFlowDataTable>tbody>tr");e.eq(7).find("td").eq(2).text(t.setFirstValue()[0]),e.eq(7).find("td").eq(3).text(t.setFirstValue()[1]),e.eq(14).find("td").eq(2).text(t.setSecondValue()[0]),e.eq(14).find("td").eq(3).text(t.setSecondValue()[1]),e.eq(21).find("td").eq(2).text(t.setThirdValue()[0]),e.eq(21).find("td").eq(3).text(t.setThirdValue()[1]);var a=parseFloat(e.eq(7).find("td").eq(2).text())+parseFloat(e.eq(14).find("td").eq(2).text())+parseFloat(e.eq(21).find("td").eq(2).text()),n=parseFloat(e.eq(7).find("td").eq(3).text())+parseFloat(e.eq(14).find("td").eq(3).text())+parseFloat(e.eq(21).find("td").eq(3).text());e.eq(22).find("td").eq(2).text(parseFloat(a)),e.eq(22).find("td").eq(3).text(parseFloat(n));var i=parseFloat(e.eq(23).find("td").eq(2).text()),s=parseFloat(e.eq(23).find("td").eq(3).text());e.eq(24).find("td").eq(2).text(a+i),e.eq(24).find("td").eq(3).text(n+s)}},CashflowBindModle=function(t){var e=this,a=_global_settings.service.url+"/ac/";this.searchTableData=function(e){Core.AjaxRequest({type:"GET",showMsg:!1,url:a+(new Base64).encode("tosys/coaReport/cashflow/month/"+e+"/"+currentUserInfo.id+"/"+currentUserInfo.loginId),callback:function(e){for(var a=0;a<e.length;a++)t.cashFlowId=e[a].id,t.yearAmt=e[a].yearAmt,t.monthAmt=e[a].monthAmt,t.addDataToTable(t.cashFlowId,t.yearAmt,t.monthAmt)}})},this.emptyTable=function(t){e.searchTableData(t)},this.bind=function(){$("#cashflow-search").on("click",function(){var a=$("#cashflow-time").val();""==a&&(a=t.getYearAndMonth()),$("#cashFlow_nowDate").text(a),e.emptyTable(a)}),$("#cashflow-refresh").on("click",function(){$.addTab({title:"现金流量表",isFrame:!1,url:ctx+"/page/modules/equipment/cashFlow.html",pk:{random:Math.random()},reload:!0})}),$("#cashflow-out").on({click:function(){var e=$("#cashflow-time").val();""==e&&(e=t.getYearAndMonth()),$.openHref(_global_settings.service.url+"/common/export/cashflow/"+e)}})},this.unbindAll=function(){},$("#cashflow-out").on({click:function(){var e=t.getYearAndMonth(),a=$("#cashflow-time").val();11==a.length&&(a=e);var n;n="中文"==$("#main-changeLanguage").html()?(new Base64).encode("tosys/coaReport/export/cashflowEnglish/"+a+"/"+currentUserInfo.id+"/"+currentUserInfo.loginId):(new Base64).encode("tosys/coaReport/export/cashflow/"+a+"/"+currentUserInfo.id+"/"+currentUserInfo.loginId),$.openHref(_global_settings.service.url+"/ac/exportReport/"+n)}}),$("#cashflow-print").on("click",function(){var e=t.getYearAndMonth(),a=$("#cashflow-time").val();11==a.length&&(a=e);var n;n="中文"==$("#main-changeLanguage").html()?(new Base64).encode("reportName=CashFlowPrintEN&date="+a+"&printType=pdf&ownerId="+currentUserInfo.id+"&username="+currentUserInfo.loginId):(new Base64).encode("reportName=CashFlowPrint&date="+a+"&printType=pdf&ownerId="+currentUserInfo.id+"&username="+currentUserInfo.loginId),window.open(_global_settings.service.url+"/ac/print/"+n)})};