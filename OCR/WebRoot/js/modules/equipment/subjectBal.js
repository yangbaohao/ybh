var BssSubjectBalMgt=function(){var t=this,e=_global_settings.service.url+"/ac/";_global_settings.service.url;this.date=new Date,this.random=Math.random(),this.sumBalance=0,this.sumDebit=0,this.sumCredit=0,this.sumLastBalance=0,this.type=1,this.initInput=function(){$("#subjectBal-sendEmail").css("display","none"),$("#subjectBal_nowDate").text(t.setDate()),$("#subjectBal-time").monthpicker({callback:"dasdasd"}),$("#subjectbal_comname").text(_global_settings.owner.companyname),t.getTableData(t.getYearAndMonth(),t.type),t.initPages()},this.initPages=function(){if("中文"==$("#main-changeLanguage").html()){$("#subjectBal-search").text("Search"),$("#subjectBal-print").text("Print"),$("#subjectBal-out").text("Export"),$("#subjectBal-searchdate").text("Date"),$("#subjectBal-headMsg").text("Account Balance Sheet"),$("#subjectBal-unit").text("Unit：RMB");$("#subjectBal_nowDate").text(function(){var e=t.date.getFullYear(),a=t.date.getMonth();a+=1;var n=t.date.getDate();return a<10&&(a="0"+a),n<10&&(n="0"+n),n+"/"+a+"/"+e}());var e=$("#subjectBalDataTable>thead>tr>th");e.eq(1).html("Account Name"),e.eq(2).html("Beginning balance"),e.eq(3).html("Current Occurrence Amount"),e.eq(4).html("Ending balance"),e.eq(5).html("Debit"),e.eq(6).html("Credit"),$("#subjectBal_dropdownMenuCode").text("Account Code"),$("#show_two").text("Expand two"),$("#show_three").text("Expand Three"),$("#show_four").text("ExpandAll"),$("#show_one").text("PackUp")}},this.setDate=function(){var e=t.date.getFullYear(),a=t.date.getMonth();a+=1;var n=t.date.getDate();return a<10&&(a="0"+a),n<10&&(n="0"+n),e+"年"+a+"月"+n+"日"},this.getYearAndMonth=function(){var e=t.date.getFullYear(),a=t.date.getMonth();return a+=1,a<10&&(a="0"+a),e+"-"+a},this.getTableData=function(a,n){Core.AjaxRequest({type:"GET",showWaiting:!1,url:e+(new Base64).encode("tosys/coaReport/balance/balance/"+t.getYearAndMonth()+"/"+currentUserInfo.id+"/"+currentUserInfo.loginId+"/"+t.type),callback:function(e){var a=e.pop();if($.each(e,function(a){t.addTableData(e[a])}),t.addLastData(a),"中文"==$("#main-changeLanguage").html())for(var n=($("#subjectBalTbody>tbody>tr"),0);n<$("#subjectBalTbody").children().length-2;n++)$("#subjectBalTbody").children().eq(n).children().eq(1).html(void 0==e[n].itemEnglishName?e[n].itemName:e[n].itemEnglishName)}})},this.addTableData=function(e){var a=ComboBoxSources.getInfoMapByKey("chartOfAccounts","hardCode"),n=a[e.itemCoaHardCodes],s=n.name,c=n.debitCredit,l=void 0==e.itemVale1?0:e.itemVale1,o=void 0==e.itemVale2?0:e.itemVale2,i=void 0==e.itemVale3?0:e.itemVale3,r="";r="debit"==c?parseFloat(i-l+o):parseFloat(i+l-o);var d=$('<tr><td class="code text-left p-l-20">'+e.itemCoaHardCodes+'</td><td class="name text-left p-l-20">'+s+'</td><td class="beginAmt text-right">'+money(r)+'</td><td class="debit text-right">'+money(l)+'</td><td class="crebit text-right">'+money(o)+'</td><td class="endAmt text-right">'+money(i)+"</td></tr>");$("#subjectBalTbody").append(d),t.sumBalance+=parseFloat(d.find(".beginAmt").text()),t.sumDebit+=parseFloat(d.find(".debit").text()),t.sumCredit+=parseFloat(d.find(".crebit").text()),t.sumLastBalance+=parseFloat(d.find(".endAmt").text())},this.addLastData=function(e){var a='<tr><td id="totalMonth" colspan=2 class="text-center">本月合计</td><td class="text-right">'+money(t.sumBalance)+'</td><td class="text-right">'+money(t.sumDebit)+'</td><td class="text-right">'+money(t.sumCredit)+'</td><td class="text-right">'+money(t.sumLastBalance)+"</td></tr>";$("#subjectBalTbody").append(a),"中文"==$("#main-changeLanguage").html()&&$("#subjectBalTbody").find("#totalMonth").text("Month Cumulative");var n='<tr><td id="totalYears" colspan=2 class="text-center">本年累计</td><td class="text-right">'+money(e.itemVale4)+'</td><td class="text-right">'+money(e.itemVale1)+'</td><td class="text-right">'+money(e.itemVale2)+'</td><td class="text-right">'+money(e.itemVale3)+"</td></tr>";$("#subjectBalTbody").append(n),"中文"==$("#main-changeLanguage").html()&&$("#subjectBalTbody").find("#totalYears").text("Year Cumulative")}},BssSubjectBalBindModle=function(t){var e=this,a=_global_settings.service.url+"/ac/";t.type=1,this.emptyTable=function(a,n){var a=$("#subjectBal-time").val();$("#subjectBalTbody").html(""),t.sumBalance=0,t.sumDebit=0,t.sumCredit=0,t.sumLastBalance=0,e.getTableData(a,n)},this.getTableData=function(e,n){Core.AjaxRequest({type:"GET",showWaiting:!1,url:a+(new Base64).encode("tosys/coaReport/balance/balance/"+e+"/"+currentUserInfo.id+"/"+currentUserInfo.loginId+"/"+t.type),callback:function(e){var a=e.pop();$.each(e,function(a){t.addTableData(e[a])}),t.addLastData(a)}})},this.bind=function(){var a=$("#subjectBal-time").val();""==a&&(a=t.getYearAndMonth()),$("#subjectBal-search").on("click",function(){a=$("#subjectBal-time").val(),$("#subjectBal_nowDate").text(a),e.emptyTable(a,t.type)}),$("#subjectBal-refresh").on("click",function(){$.addTab({title:"科目余额表",isFrame:!1,url:ctx+"/page/modules/equipment/subjectBal.html",reload:!0})}),$("#show_one").on("click",function(){t.type=1,e.emptyTable(a,t.type)}),$("#show_two").on("click",function(){t.type=2,e.emptyTable(a,t.type)}),$("#show_three").on("click",function(){t.type=3,e.emptyTable(a,t.type)}),$("#show_four").on("click",function(){t.type=4,e.emptyTable(a,t.type)}),$("#subjectBal-print").on("click",function(){var e=t.getYearAndMonth(),a=$("#subjectBal-time").val();if(11==a.length&&(a=e),"中文"==$("#main-changeLanguage").text())var n=(new Base64).encode("reportName=AccountBalanceEN&accountBalancedate="+a+"&printType=pdf&ownerId="+currentUserInfo.id+"&username="+currentUserInfo.loginId+"&type="+t.type+"&printType=pdf");else var n=(new Base64).encode("reportName=AccountBalance&accountBalancedate="+a+"&printType=pdf&ownerId="+currentUserInfo.id+"&username="+currentUserInfo.loginId+"&type="+t.type+"&printType=pdf");window.open(_global_settings.service.url+"/ac/print/"+n)}),$("#subjectBal-out").on({click:function(){var e=t.getYearAndMonth(),a=$("#subjectBal-time").val();if(11==a.length&&(a=e),"中文"==$("#main-changeLanguage").text())var n=(new Base64).encode("tosys/coaReport/export/subjectBalEnglish/"+a+"/"+t.type+"/0/0/0/0/0/0/0/0/0/"+currentUserInfo.id+"/"+currentUserInfo.loginId);else var n=(new Base64).encode("tosys/coaReport/export/subjectBal/"+a+"/"+t.type+"/0/0/0/0/0/0/0/0/0/"+currentUserInfo.id+"/"+currentUserInfo.loginId);$.openHref(_global_settings.service.url+"/ac/exportReport/"+n)}})},this.unbindAll=function(){$("#subjectBal-search").off("click")}};