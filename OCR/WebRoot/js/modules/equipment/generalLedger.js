var GeneralLedgerMgt=function(){var e=this;this.debug=!1;var t=_global_settings.service.url+"/ac/";this.date=new Date,this.initInput=function(){$("#generalLedger_nowDate").text(e.setDate()),$("#generalLedger_comname").text(_global_settings.owner.companyname),e.loadControl(),e.getSearch(),e.searchDate(),e.initPages()},this.initPages=function(){if("中文"==$("#main-changeLanguage").html()){$("#generalLedger-search").text("Search"),$("#generalLedger-print").text("Print"),$("#generalLedger-refresh").text("Refresh"),$("#generalLedger-out").text("Export"),$("#generalLedger-searchdate").text("Date"),$("#generalLedger-headMsg").text("General Ledger"),$("#generalLedger-unit").text("Unit：RMB"),$("#generalLedger-subject").text("Subject");$("#generalLedger_nowDate").html(function(){var t=e.date.getFullYear(),a=e.date.getMonth();a+=1;var r=e.date.getDate();return a<10&&(a="0"+a),r<10&&(r="0"+r),r+"/"+a+"/"+t}());var t=$("#generalLedgerDataTable>thead>tr>th");t.eq(0).html("Date"),t.eq(1).html("Account Name"),t.eq(2).html("Remark"),t.eq(3).html("Debit"),t.eq(4).html("Credit"),t.eq(5).html("Balance")}},this.loadControl=function(){var e=ComboBoxSources.getInfoMapOrderByKey("chartOfAccounts","level",1);e.unshift({name:"全部",hardCode:""}),$("#generalLedger_oneSub").comboBox({source:e,displayMember:"name",valueMember:"hardCode",disabled:!1,placeHolder:"全部",selectedIndex:0})},this.getSearch=function(a,r){var a=null==a?"%20":a;a=""==a?"%20":a;var r=null==r?e.getYearmonth():$("#generalLedger-time").val();Core.AjaxRequest({type:"GET",showWaiting:!1,url:t+(new Base64).encode("tosys/coaReport/ledger/"+a+"/"+r+"/"+currentUserInfo.id+"/"+currentUserInfo.loginId),callback:function(t){e.setTableData(t)}})},this.setTableData=function(e){for(var t="",a=["Vault Cash","Bank Deposit","Other Monetary Capital","Temporary Investment","Bills receivable","Accounts receivable","Accounts Prepayment","Dividend Receivable","Interest receivable","Other receivables ","Bad debt reserves ","Consignment-in","Material Procurement","Materials In Transit","Raw materials","Materials Cost Difference","Commodity Stocks","Merchandise shipped","Differences between purchasing and selling price","Materials for Consigned Processing","Revolving Materials","Inventory falling price reserves","Long-term debt investments","Provision for long-term investment","Financial assets available for sale","Long-term investment on stocks","Long-term equity investment devaluation provision","Investment Real Estate","Long-term Accounts Receivable","Fixed Asset","Accumulated depreciation","Fixed assets depreciation reserves","Construction-in-progress","Engineer Material","Disposal of Fixed Assets","Productive Biological Assets","Productive living assets accumulated depreciation","Intangible Assets","Accumulated Amortization","Impairment For Intangible Assets","Goodwill","Long-term deferred expenses","Deferred Tax Asset","Unsettled Assets Profit and Loss","Short-term Borrowing","Transactional Moneytary Liabilities","Bills payable","Accounts Payable","Deposit received","Payroll Payable","Taxes and Dues Payable","Profit Payable","Interest Payable","Other Payables","Accounts Of Consigned Goods","Deferred Profits","Long-term Borrowing","Bond payable","Long-term payables","Special  Payables","Estimated Liabilities","Deferred Tax Liability","Actual Receipt Capital","Additional Paid-In Capital","Features Surplus","Current Year Profits","Allocation of Profits","Treasury Share","Production Cost","Manufacturing Expenses","Service Costs","R&D Expenditure","Engineering Constructon","Mechanical Engineering","Prime Operating Revenue","Other Business Revenue","Loss of the change of fair value","investment income","Non-operating Revenue","Prime Operating Cost","Other Operational Costs","Business Tariff And Annex","Selling Expenses"," Managing Costs","Financing Costs","Asset Impairment loss","Non-business Expenditure","Income Tax Expense","Profit and Loss Adjustment of Former Years"],r=0;r<e.length;r++){""!=e[r].description&&void 0!=e[r].description||(e[r].description="");var n=e[r].date.substring(0,10),i=e[r].id,o=ComboBoxSources.getInfoMapByKey("chartOfAccounts","id",i),s=o.name,l=o.hardCode,d=moneyBig(e[r].initValue.balance),c=moneyBig(e[r].monthValue.debitAmt),g=moneyBig(e[r].monthValue.creditAmt),u=moneyBig(e[r].monthValue.balance),m=moneyBig(e[r].yearValue.debitAmt),h=moneyBig(e[r].yearValue.creditAmt),f=moneyBig(e[r].yearValue.balance);"中文"==$("#main-changeLanguage").html()&&(s=a[r]);t+='<tr><td rowspan="3">'+n+'</td><td rowspan="3" class="certificate text-center" data-date='+n+" data-id="+l+'><a class="color-1193C5 hoverspan">'+s+'</a></td><td class="initia-balance">期初余额</td><td class="text-right"></td><td class="text-right"></td><td class="text-right">'+d+'</td></tr><tr><td class="month-cumulative">本月累计</td><td class="text-right">'+c+'</td><td class="text-right">'+g+'</td><td class="text-right">'+u+'</td></tr><tr><td class="year-cumulative">本年累计</td><td class="text-right">'+m+'</td><td class="text-right">'+h+'</td><td class="text-right">'+f+"</td></tr>"}$("#generalLedgerTbody").html(t),"中文"==$("#main-changeLanguage").html()&&($("#generalLedgerTbody").find(".initia-balance").text("Initia Balance"),$("#generalLedgerTbody").find(".month-cumulative").text("Month Cumulative"),$("#generalLedgerTbody").find(".year-cumulative").text("Year Cumulative"))},$("#generalLedgerTbody").on("click",".certificate",function(){var e=$(this).attr("data-id"),t=$(this).attr("data-date");$.addTab({title:"明细账",isFrame:!1,url:"page/modules/equipment/detailMoney.html",pk:{search:!0},callback:function(){$("#detail-time").val(t),$("#detailMoney_oneSub").val(ComboBoxSources.getInfoMapByKey("chartOfAccounts","hardCode",e).id)},reload:!0})}),this.setDate=function(){var t=e.date.getFullYear(),a=e.date.getMonth();a+=1;var r=e.date.getDate();return a<10&&(a="0"+a),r<10&&(r="0"+r),t+"年"+a+"月"+r+"日"},this.getYearmonth=function(){var t=e.date.getFullYear(),a=e.date.getMonth();a+=1;e.date.getDate();return a<10&&(a="0"+a),t+"-"+a},this.searchDate=function(){$("#generalLedger-time").monthpicker({callback:"dasdasd"})}},GeneralLedgerBindModle=function(e){var t=this;this.searchByTime=function(){var t=$("#generalLedger-time").val(),a=$("#generalLedger_oneSub").val();null==$("#generalLedger_oneSub").jqxComboBox("getSelectedItem")&&(a=""),e.getSearch(a,t)},this.bind=function(){$("#generalLedger-out").on({click:function(){createDate=$("#generalLedger-time").val(),""==createDate&&(createDate=e.getYearmonth()),id=$("#generalLedger_oneSub").val(),hardCode=""==$("#generalLedger_oneSub").val()?"%20":$("#generalLedger_oneSub").val(),null==$("#generalLedger_oneSub").jqxComboBox("getSelectedItem")&&(hardCode="%20"),"中文"==$("#main-changeLanguage").text()?$.openHref(_global_settings.service.url+"/ac/exportReport/"+(new Base64).encode("tosys/coaReport/export/generalLedgerEnglish/"+hardCode+"/"+createDate+"/0/0/0/0/0/0/0/0/0/"+currentUserInfo.id+"/"+currentUserInfo.loginId)):$.openHref(_global_settings.service.url+"/ac/exportReport/"+(new Base64).encode("tosys/coaReport/export/generalLedger/"+hardCode+"/"+createDate+"/0/0/0/0/0/0/0/0/0/"+currentUserInfo.id+"/"+currentUserInfo.loginId))}}),$("#generalLedger-refresh").on("click",function(){$.addTab({title:"总账",isFrame:!1,url:ctx+"/page/modules/equipment/generalLedger.html",reload:!0})}),$("#generalLedger-search").on("click",function(){$("#generalLedger_nowDate").text($("#generalLedger-time").val()),t.searchByTime()})},this.unbindAll=function(){$("#generalLedger-search").off("click")},$("#generalLedger-print").on("click",function(){var t=e.getYearmonth(),a=$("#generalLedger-time").val();if(11==a.length&&(a=t),""==$("#generalLedger_oneSub").val()){if("中文"==$("#main-changeLanguage").text())var r=(new Base64).encode("reportName=GeneralLedgerEN&date="+a+"&printType=pdf&ownerId="+currentUserInfo.id+"&username="+currentUserInfo.loginId);else var r=(new Base64).encode("reportName=GeneralLedger&date="+a+"&printType=pdf&ownerId="+currentUserInfo.id+"&username="+currentUserInfo.loginId);window.open(_global_settings.service.url+"/ac/print/"+r)}else{if("中文"==$("#main-changeLanguage").text())var r=(new Base64).encode("reportName=GeneralLedgerEN&date="+a+"&printType=pdf&ownerId="+currentUserInfo.id+"&username="+currentUserInfo.loginId+"&code="+$("#generalLedger_oneSub").val()+"&1=1");else var r=(new Base64).encode("reportName=GeneralLedger&date="+a+"&printType=pdf&ownerId="+currentUserInfo.id+"&username="+currentUserInfo.loginId+"&code="+$("#generalLedger_oneSub").val()+"&1=1");window.open(_global_settings.service.url+"/ac/print/"+r)}})};