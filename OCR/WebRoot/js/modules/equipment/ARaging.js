var AragMgt=function(){var t=this,e=_global_settings.service.url+"/ac/";this.date=new Date,this.sumnormalAmt=0,this.sumdueAmt30=0,this.sumdueAmt60=0,this.sumdueAmt90=0,this.sumdueAmtMore90=0,this.sumdueAmtAll=0,this.initInput=function(){$("#arag_nowDate").text(t.setDate()),$("#arag_comname").text(currentUserInfo.name),t.initCustomer(),t.getTableData(),$("#araging-show").attr("class","row hiddendiv"),t.initPages()},this.initPages=function(){if("中文"==$("#main-changeLanguage").html()){$("#arag-search").text("Search"),$("#arag-refresh").text("Refresh"),$("#arag-print").text("Print"),$("#arag-out").text("Export"),$("#arag-unit").text("Unit：RMB");$("#arag_nowDate").text(function(){var e=t.date.getFullYear(),a=t.date.getMonth();a+=1;var r=t.date.getDate();return a<10&&(a="0"+a),r<10&&(r="0"+r),r+"/"+a+"/"+e}()),$("#arag-headMsg").text("Accounts Receivable Aging Sheet");var e=$("#ARDataTable>thead>tr:first>th");e.eq(0).html("Client Name"),e.eq(1).html("No overdue Receivables"),e.eq(2).html("Overdue Receivables"),e.eq(3).html("Overdue Subtotal");var e=$("#ARDataTable>thead>tr:last>th");e.eq(0).html("Net term (1-30 days )"),e.eq(1).html("Net term (30-60 days )"),e.eq(2).html("Net term (60-90 days )"),e.eq(3).html("Net term (Above 90 days )"),$("#ARDataTable>tbody>tr:last").find("td").eq(0).text("Total")}};for(var a=[],r=ComboBoxSources.getRecords("clientInfo"),n=0;n<r.length;n++)r[n].customerFlag&&a.push(r[n]);this.initCustomer=function(){$("#arag-cust").comboBox({source:a,theme:currentTheme,displayMember:"name",valueMember:"name",width:"220px",height:"34px",placeHolder:"请选择或输入"})},this.getTableData=function(){Core.AjaxRequest({type:"GET",showWaiting:!0,url:e+(new Base64).encode("tosys/coaReport/ar/%20/0/0/"+currentUserInfo.id+"/"+currentUserInfo.loginId),callback:function(e){for(var a,r,n,o,s,m,i=0;i<e.length;i++)a=e[i].clientId,normalAmt=e[i].normalAmt,r=e[i].dueAmt30,n=e[i].dueAmt60,o=e[i].dueAmt90,s=e[i].dueAmtMore90,m=r+n+o+s,t.setTableData(a,normalAmt,r,n,o,s,m);t.addLastLine(),t.setTextStyle()}})},this.getClientName=function(t){for(var e=ComboBoxSources.getRecords("clientInfo"),a=0;a<e.length;a++)if(e[a].clientInfoid==t)return e[a];if(!t)return"暂无"},this.setTextStyle=function(){$("#ARDataTable tr:gt(0)").each(function(){$(this).find("td").each(function(t){0!=t&&$(this).attr("class","p-r-8 text-right")})})},this.setTableData=function(e,a,r,n,o,s,m){var i='<tr><td class="text-left">'+t.getClientName(e).name+"</td><td>"+formatNum(a)+"</td><td>"+formatNum(r)+"</td><td>"+formatNum(n)+"</td><td>"+formatNum(o)+"</td><td>"+formatNum(s)+"</td><td>"+formatNum(m)+"</td></tr>";t.sumnormalAmt+=a,t.sumdueAmt30+=r,t.sumdueAmt60+=n,t.sumdueAmt90+=o,t.sumdueAmtMore90+=s,t.sumdueAmtAll+=m,$("#ARDataTbody").append(i)},this.addLastLine=function(){var e='<tr><td class="text-left">合计</td><td>'+formatNum(t.sumnormalAmt)+"</td><td>"+formatNum(t.sumdueAmt30)+"</td><td>"+formatNum(t.sumdueAmt60)+"</td><td>"+formatNum(t.sumdueAmt90)+"</td><td>"+formatNum(t.sumdueAmtMore90)+"</td><td>"+formatNum(t.sumdueAmtAll)+"</td></tr>";$("#ARDataTbody").append(e)},this.setDate=function(){var e=t.date.getFullYear(),a=t.date.getMonth();a+=1;var r=t.date.getDate();return a<10&&(a="0"+a),r<10&&(r="0"+r),e+"年"+a+"月"+r+"日"},this.search=function(){t.sumnormalAmt=0,t.sumdueAmt30=0,t.sumdueAmt60=0,t.sumdueAmt90=0,t.sumdueAmtMore90=0,t.sumdueAmtAll=0,$("#ARDataTbody").html("");var a=$("#arag-cust").val(),r=$("#arag-amt").val(),n=$("#arag-secondamt").val();""==a&&(a="%20"),""==r&&(r=0),""==n&&(n=0),Core.AjaxRequest({type:"GET",showMsg:!1,showWaiting:!1,url:e+(new Base64).encode("tosys/coaReport/ar/"+a+"/"+r+"/"+n+"/"+currentUserInfo.id+"/"+currentUserInfo.loginId),callback:function(e){for(var a=0;a<e.length;a++){var r=e[a].clientId,n=e[a].normalAmt,o=e[a].dueAmt30,s=e[a].dueAmt60,m=e[a].dueAmt90,i=e[a].dueAmtMore90,u=o+s+m+i;t.setTableData(r,n,o,s,m,i,u)}t.addLastLine(),t.setTextStyle()}})}},AragBindModle=function(t){var e=_global_settings.service.url+"/ac/";this.bind=function(){$("#arag-search").on("click",function(){$("#araging-show").is(":hidden")?$("#araging-show").slideDown("slow"):t.search()}),hiddenAclick(),$("#arag-refresh").on("click",function(){$.addTab({title:"应收账龄表",isFrame:!1,url:ctx+"/page/modules/equipment/ARaging.html",pk:{random:Math.random()},reload:!0})}),$("#arag-out").on({click:function(){var t=$("#arag-cust").val(),e=$("#arag-amt").val(),a=$("#arag-secondamt").val();""==t&&(t="%20"),""==e&&(e=0),""==a&&(a=0),"中文"==$("#main-changeLanguage").text()?$.openHref(_global_settings.service.url+"/ac/exportReport/"+(new Base64).encode("tosys/coaReport/export/aragEnglish/"+t+"/"+e+"/"+a+"/"+currentUserInfo.id+"/"+currentUserInfo.loginId)):$.openHref(_global_settings.service.url+"/ac/exportReport/"+(new Base64).encode("tosys/coaReport/export/arag/"+t+"/"+e+"/"+a+"/"+currentUserInfo.id+"/"+currentUserInfo.loginId))}})},this.unbindAll=function(){$("#arag-search").off("click")},$("#arag-print").on("click",function(){var t="%20",a="0",r="0";""!==$("#arag-cust").val()&&(t=$("#arag-cust").val()),""!=$("#arag-amt").val()&&(a=$("#arag-amt").val()),""!=$("#arag-secondamt").val()&&(r=$("#arag-secondamt").val()),"中文"==$("#main-changeLanguage").html()?window.open(e+"print/"+(new Base64).encode("reportName=AragingPrintEN&name="+t+"&beginAmt="+a+"&endAmt="+r+"&printType=pdf&ownerId="+currentUserInfo.id+"&username="+currentUserInfo.loginId)):window.open(e+"print/"+(new Base64).encode("reportName=AragingPrint&name="+t+"&beginAmt="+a+"&endAmt="+r+"&printType=pdf&ownerId="+currentUserInfo.id+"&username="+currentUserInfo.loginId))})};