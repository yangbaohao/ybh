var ApagMgt=function(){var t=this,e=_global_settings.service.url+"/ac/";this.date=new Date,this.sumnormalAmt=0,this.sumdueAmt30=0,this.sumdueAmt60=0,this.sumdueAmt90=0,this.sumdueAmtMore90=0,this.sumdueAmtAll=0,this.initInput=function(){$("#apag_nowDate").text(t.setDate()),$("#apag_comname").text(currentUserInfo.name),t.initVendor(),t.getTableData(),$("#apaging-show").attr("class","row hiddendiv"),t.initPages()},this.initPages=function(){if("中文"==$("#main-changeLanguage").html()){$("#apag-search").text("Search"),$("#apag-refresh").text("Refresh"),$("#apag-print").text("Print"),$("#apag-out").text("Export"),$("#apag-unit").text("Unit：RMB");$("#apag_nowDate").text(function(){var e=t.date.getFullYear(),a=t.date.getMonth();a+=1;var n=t.date.getDate();return a<10&&(a="0"+a),n<10&&(n="0"+n),n+"/"+a+"/"+e}()),$("#apag-headMsg").text("Accounts Payable Aging Sheet");var e=$("#APDataTable>thead>tr:first>th");e.eq(0).html("Vendor Name"),e.eq(1).html("No overdue payable"),e.eq(2).html("Overdue ayable"),e.eq(3).html("Subtotal");var e=$("#APDataTable>thead>tr:last>th");e.eq(0).html("Net term (1-30 days )"),e.eq(1).html("Net term (30-60 days )"),e.eq(2).html("Net term (60-90 days )"),e.eq(3).html("Net term (Above 90 days )"),$("#APDataTable>tbody>tr:last").find("td").eq(0).text("Total")}};for(var a=[],n=ComboBoxSources.getRecords("clientInfo"),r=0;r<n.length;r++)n[r].vendorType&&a.push(n[r]);this.initVendor=function(){$("#arag-vendor").comboBox({source:a,theme:currentTheme,displayMember:"name",valueMember:"name",width:"220px",height:"34px",placeHolder:"请选择或输入"})},$("#apag-time").bind("focus,blur",function(){var t=$("#apag-time").val();$("#apag_nowDate").text(""),$("#apag_nowDate").text(t)}),this.setTime=function(){},this.getClientName=function(t){for(var e=ComboBoxSources.getRecords("clientInfo"),a=0;a<e.length;a++)if(e[a].clientInfoid==t)return e[a];if(!t)return"暂无"},this.getTableData=function(){Core.AjaxRequest({type:"GET",showWaiting:!0,url:e+(new Base64).encode("tosys/coaReport/ap/%20/0/0/"+currentUserInfo.id+"/"+currentUserInfo.loginId),callback:function(e){for(var a,n,r,o,d,s,i=0;i<e.length;i++)a=e[i].clientId,normalAmt=e[i].normalAmt,n=e[i].dueAmt30,r=e[i].dueAmt60,o=e[i].dueAmt90,d=e[i].dueAmtMore90,s=n+r+o+d,t.setTableData(a,normalAmt,n,r,o,d,s);t.addLastLine(),t.setTextStyle()}})},this.setTextStyle=function(){$("#APDataTable tr:gt(0)").each(function(){$(this).find("td").each(function(t){0!=t&&$(this).attr("class","p-r-8 text-right")})})},this.setTableData=function(e,a,n,r,o,d,s){var i='<tr><td class="text-left">'+t.getClientName(e).name+"</td><td>"+formatNum(a)+"</td><td>"+formatNum(n)+"</td><td>"+formatNum(r)+"</td><td>"+formatNum(o)+"</td><td>"+formatNum(d)+"</td><td>"+formatNum(s)+"</td></tr>";t.sumnormalAmt+=a,t.sumdueAmt30+=n,t.sumdueAmt60+=r,t.sumdueAmt90+=o,t.sumdueAmtMore90+=d,t.sumdueAmtAll+=s,$("#APDataTbody").append(i)},this.addLastLine=function(){var e='<tr><td class="text-left">合计</td><td>'+formatNum(t.sumnormalAmt)+"</td><td>"+formatNum(t.sumdueAmt30)+"</td><td>"+formatNum(t.sumdueAmt60)+"</td><td>"+formatNum(t.sumdueAmt90)+"</td><td>"+formatNum(t.sumdueAmtMore90)+"</td><td>"+formatNum(t.sumdueAmtAll)+"</td></tr>";$("#APDataTbody").append(e)},this.setDate=function(){var e=t.date.getFullYear(),a=t.date.getMonth();a+=1;var n=t.date.getDate();return a<10&&(a="0"+a),n<10&&(n="0"+n),e+"年"+a+"月"+n+"日"},this.getYearAndMonth=function(){var e=t.date.getFullYear(),a=t.date.getMonth();return a+=1,a<10&&(a="0"+a),e+"-"+a},this.search=function(){t.sumnormalAmt=0,t.sumdueAmt30=0,t.sumdueAmt60=0,t.sumdueAmt90=0,t.sumdueAmtMore90=0,t.sumdueAmtAll=0,$("#APDataTbody").html("");var a=$("#arag-vendor").val(),n=$("#apag-amt").val(),r=$("#apag-secondamt").val();""==a&&(a="%20"),""==n&&(n=0),""==r&&(r=0),Core.AjaxRequest({type:"GET",showMsg:!1,showWaiting:!1,url:e+(new Base64).encode("tosys/coaReport/ap/"+a+"/"+n+"/"+r+"/"+currentUserInfo.id+"/"+currentUserInfo.loginId),callback:function(e){for(var a=0;a<e.length;a++){var n=e[a].clientId,r=e[a].normalAmt,o=e[a].dueAmt30,d=e[a].dueAmt60,s=e[a].dueAmt90,i=e[a].dueAmtMore90,m=o+d+s+i;t.setTableData(n,r,o,d,s,i,m)}t.addLastLine(),t.setTextStyle()}})}},ApagBindModle=function(t){var e=_global_settings.service.url+"/ac/";this.bind=function(){$("#apag-search").on("click",function(){$("#apaging-show").is(":hidden")?$("#apaging-show").slideDown("slow"):t.search()}),hiddenAclick(),$("#apag-refresh").on("click",function(){$.addTab({title:"应付账龄表",isFrame:!1,url:ctx+"/page/modules/equipment/APaging.html",pk:{random:Math.random()},reload:!0})}),$("#apag-out").on({click:function(){var t=$("#arag-vendor").val(),e=$("#apag-amt").val(),a=$("#apag-secondamt").val();""==t&&(t="%20"),""==e&&(e=0),""==a&&(a=0),"中文"==$("#main-changeLanguage").text()?$.openHref(_global_settings.service.url+"/ac/exportReport/"+(new Base64).encode("tosys/coaReport/export/apagEnglish/"+t+"/"+e+"/"+a+"/"+currentUserInfo.id+"/"+currentUserInfo.loginId)):$.openHref(_global_settings.service.url+"/ac/exportReport/"+(new Base64).encode("tosys/coaReport/export/apag/"+t+"/"+e+"/"+a+"/"+currentUserInfo.id+"/"+currentUserInfo.loginId))}})},this.unbindAll=function(){$("#apag-search").off("click")},$("#apag-print").on("click",function(){var t="",a=0,n=0;""==$("#arag-vendor").val()&&(t="%20"),""!=$("#apag-amt").val()&&(a=$("#apag-amt").val()),""!=$("#apag-secondamt").val()&&(n=$("#apag-secondamt").val()),"中文"==$("#main-changeLanguage").text()?window.open(e+"print/"+(new Base64).encode("reportName=ApagingPrintEN&name="+t+"&beginAmt="+a+"&endAmt="+n+"&printType=pdf&ownerId="+currentUserInfo.id+"&username="+currentUserInfo.loginId)):window.open(e+"print/"+(new Base64).encode("reportName=ApagingPrint&name="+t+"&beginAmt="+a+"&endAmt="+n+"&printType=pdf&ownerId="+currentUserInfo.id+"&username="+currentUserInfo.loginId))})};