var BssDetailMoneyMgt=function(){var t=this;this.debug=!1;var e=_global_settings.service.url+"/ac/";this.date=new Date,this.arr=[],this.arr2=[],this.hardCode="1001",this.initAmt=0,this.currentAmt=0,this.debitCredit,this.sumInitAmt=0,this.sumDebitAmt=0,this.sumCreditAmt=0,this.createDate,this.recordRes,this.initInput=function(){$("#detail-sendEmail").css("display","none"),$("#detailMoney_nowDate").text(t.setDate()),t.createDate=t.getYearmonth(),t.getOneSub(),t.setOneSub(),t.getTwoSub(),t.setTwoSub(),null!=$.pk&&1==$.pk.search||t.getSearch(),t.searchDate(),t.initComboBoxes(),t.initPages()},this.initPages=function(){if("中文"==$("#main-changeLanguage").html()){$("#detail-search").text("Search"),$("#detail-searchdate").text("Date"),$("#detail-print").text("Print"),$("#detail-out").text("Export"),$("#detail-headMsg").text("Detail Account"),$("#detail-unit").text("unit：RMB"),$("#detail-category").text("Category A"),$("#detail-subjects").text("Subjects"),$("#detail-subjectsTwo").text("Secondary Subjects");var e=$("#detailMoneyDataTable>thead>tr>th");e.eq(0).text("Date"),e.eq(1).text("Documents Number"),e.eq(2).text("Remark"),e.eq(3).text("Debit"),e.eq(4).text("Credit"),e.eq(5).text("Balance");$("#detailMoney_nowDate").html(function(){var e=t.date.getFullYear(),a=t.date.getMonth();a+=1;var n=t.date.getDate();return a<10&&(a="0"+a),n<10&&(n="0"+n),n+"/"+a+"/"+e}())}},this.getSearch=function(){Core.AjaxRequest({type:"GET",showMsg:!1,url:e+(new Base64).encode("tosys/coaReport/journal/detailedaccount/"+t.hardCode+"/"+t.createDate+"/"+currentUserInfo.id+"/"+currentUserInfo.loginId),callback:function(e){var a=e.pop();t.setTableData(e),t.addFirstLine(e),t.setTdValue(e,t.hardCode,t.getYearmonth(),a)}})},this.setTableData=function(e){var a=$("#detailMoney_oneSub").val();t.debitCredit=t.getCredit(a);for(var n=0;n<e.length;n++){""!=e[n].description&&void 0!=e[n].description||(e[n].description="");var d,r=void 0==e[n].journalNumberForShow?"":e[n].journalNumberForShow;d="发票生成凭证"==e[n].description&&"中文"==$("#main-changeLanguage").html()?"Invoice Generation Certificate":e[n].description;var i="<tr><td>"+e[n].createDate.substring(0,10)+'</td><td class="certificate text-center" data-id='+e[n].journalid+">"+r+"</td><td>"+d+"</td><td>"+money(e[n].debitAmt)+"</td><td>"+money(e[n].creditAmt)+"</td><td></td></tr>";$("#detailMoneyTbody").append(i)}},this.addFirstLine=function(e){var a=$("#detailMoneyTbody").html();if(0!=e.length)if("中文"==$("#main-changeLanguage").html())var n="<tr><td>"+t.createDate+"</td><td></td><td>Initial Balance</td><td></td><td></td><td>"+money(t.initAmt)+"</td></tr>";else var n="<tr><td>"+t.createDate+"</td><td></td><td>期初余额</td><td></td><td></td><td>"+money(t.initAmt)+"</td></tr>";else if(0==e.length)if("中文"==$("#main-changeLanguage").html())var n="<tr><td>"+t.createDate+"</td><td></td><td>Initial Balance</td><td></td><td></td><td>"+money(t.currentAmt)+"</td></tr>";else var n="<tr><td>"+t.createDate+"</td><td></td><td>期初余额</td><td></td><td></td><td>"+money(t.currentAmt)+"</td></tr>";$("#detailMoneyTbody").html(n+a)},this.addLastLine=function(e,a,n){var d;if(d="debit"==t.debitCredit?money(parseFloat(t.initAmt)+parseFloat(t.sumDebitAmt)-parseFloat(t.sumCreditAmt)):money(parseFloat(t.initAmt)+parseFloat(t.sumCreditAmt)-parseFloat(t.sumDebitAmt)),0!=e.length)if("中文"==$("#main-changeLanguage").html())var r="<tr><td>"+t.createDate+"</td><td></td><td>This month total</td><td>"+money(t.sumDebitAmt)+"</td><td>"+money(t.sumCreditAmt)+"</td><td>"+d+"</td></tr>";else var r="<tr><td>"+t.createDate+"</td><td></td><td>本月合计</td><td>"+money(t.sumDebitAmt)+"</td><td>"+money(t.sumCreditAmt)+"</td><td>"+d+"</td></tr>";else if("中文"==$("#main-changeLanguage").html())var r="<tr><td>"+t.createDate+"</td><td></td><td>This month total</td><td>"+money(0)+"</td><td>"+money(0)+"</td><td>"+money(t.currentAmt)+"</td></tr>";else var r="<tr><td>"+t.createDate+"</td><td></td><td>本月合计</td><td>"+money(0)+"</td><td>"+money(0)+"</td><td>"+money(t.currentAmt)+"</td></tr>";if($("#detailMoneyTbody").append(r),"中文"==$("#main-changeLanguage").html())var i="<tr><td>"+t.createDate+"</td><td></td><td>Accumulated This Year</td><td>"+money(n.debitAmt)+"</td><td>"+money(n.creditAmt)+"</td><td>"+money(n.balance)+"</td></tr>";else var i="<tr><td>"+t.createDate+"</td><td></td><td>本年累计</td><td>"+money(n.debitAmt)+"</td><td>"+money(n.creditAmt)+"</td><td>"+money(n.balance)+"</td></tr>";$("#detailMoneyTbody").append(i),t.setTextRight()},this.setTextRight=function(){$("#detailMoneyTbody").find("tr").each(function(){$(this).find("td").each(function(t){3!=t&&4!=t&&5!=t||$(this).attr("class","text-right")})})},this.setTdValue=function(a,n,d,r){_global_settings.service.url;Core.AjaxRequest({type:"GET",url:e+(new Base64).encode("tosys/coaReport/monthSum/"+t.hardCode+"/"+t.createDate+"/"+currentUserInfo.id+"/"+currentUserInfo.loginId),callback:function(e){t.initAmt=parseFloat(e.initAmt),t.currentAmt=parseFloat(e.currentAmt),0!=a.length?$("#detailMoneyTbody").find("tr").eq(0).find("td").eq(5).text(money(t.initAmt)):$("#detailMoneyTbody").find("tr").eq(0).find("td").eq(5).text(money(t.currentAmt)),$("#detailMoneyTbody").find("tr").each(function(e){0!=e&&("debit"==t.debitCredit&&($(this).find("td").eq(5).text(money(parseFloat($(this).find("td").eq(3).text())-parseFloat($(this).find("td").eq(4).text())+parseFloat(t.initAmt))),t.initAmt=money(parseFloat($(this).find("td").eq(5).text()))),"credit"==t.debitCredit&&($(this).find("td").eq(5).text(money(parseFloat($(this).find("td").eq(4).text())-parseFloat($(this).find("td").eq(3).text())+parseFloat(t.initAmt))),t.initAmt=money(parseFloat($(this).find("td").eq(5).text()))),t.sumDebitAmt+=parseFloat($(this).find("td").eq(3).text()),t.sumCreditAmt+=parseFloat($(this).find("td").eq(4).text()))}),t.initAmt=$("#detailMoneyTbody").find("tr").eq(0).find("td").eq(5).text(),t.addLastLine(a,e,r),t.setFormat()}})},this.setFormat=function(){$("#detailMoneyTbody").find("tr").each(function(){$(this).find("td").each(function(t){if((3==t||4==t||5==t)&&""!=$(this).text()){var e=$(this).text();$(this).text(formatNum(money(e)))}})})},this.setDate=function(){var e=t.date.getFullYear(),a=t.date.getMonth();a+=1;var n=t.date.getDate();return a<10&&(a="0"+a),n<10&&(n="0"+n),e+"年"+a+"月"+n+"日"},this.getYearmonth=function(){var e=t.date.getFullYear(),a=t.date.getMonth();a+=1;t.date.getDate();return a<10&&(a="0"+a),e+"-"+a},this.searchDate=function(){$("#detail-time").monthpicker({callback:"dasdasd"})},this.setType=function(){var t=["全部","种类一","种类二","种类三","种类四","种类五","种类六"];$("#detailMoney_type").jqxDropDownList({placeHolder:"请选择",source:t,theme:"energyblue",width:"100%",height:"30px",selectedIndex:0,dropDownHeight:200})},this.getCredit=function(e){for(var a=ComboBoxSources.getRecords("chartOfAccounts"),n=0;n<a.length;n++)if(a[n].id==e)return t.debitCredit=a[n].debitCredit,t.debitCredit},this.getOneSub=function(){for(var e=ComboBoxSources.getRecords("chartOfAccounts"),a=0;a<e.length;a++)if(1==e[a].level){var n=e[a].hardCode;t.arr.push(n)}},this.setOneSub=function(){$("#detailMoney_oneSub").coaCombboxOne({theme:"energyblue",displayMember:"displayValue",valueMember:"id",width:"100%",height:"30px",selectedIndex:0,searchMode:"contains",dropDownHeight:200},t.arr),id=$("#detailMoney_oneSub").val()},this.getTwoSub=function(){for(var e=ComboBoxSources.getRecords("chartOfAccounts"),a=0;a<e.length;a++)if(2==e[a].level&&1==e[a].pid){var n=e[a].hardCode;t.arr2.push(n)}},this.setTwoSub=function(){$("#detailMoney_twoSub").coaCombboxTwo({theme:"energyblue",displayMember:"displayValue",valueMember:"id",width:"100%",height:"30px",selectedIndex:0,searchMode:"contains",dropDownHeight:200},t.arr2),tId=$("#detailMoney_twoSub").val()},this.getHardCodeByPid=function(e){t.arr2=[];for(var a=ComboBoxSources.getRecords("chartOfAccounts"),n=0;n<a.length;n++)if(2==a[n].level&&a[n].pid==e){var d=a[n].hardCode;t.arr2.push(d)}},this.searchHardCode=function(t,e){for(var a=ComboBoxSources.getAdapter(t),n=a.records,d=0;d<n.length;d++)if(n[d].id==e)return n[d].hardCode;if(!e)return ComboBoxSources.load(t),"暂无"},this.getSearchByChange=function(a,n){$("#detailMoneyTbody").html(""),t.initAmt=0,t.currentAmt=0,t.sumInitAmt=0,t.sumDebitAmt=0,t.sumCreditAmt=0,Core.AjaxRequest({type:"GET",showWaiting:!1,url:e+(new Base64).encode("tosys/coaReport/journal/detailedaccount/"+t.hardCode+"/"+t.createDate+"/"+currentUserInfo.id+"/"+currentUserInfo.loginId),callback:function(e){var d=e.pop();t.setTableData(e),t.addFirstLine(e),t.setTdValue(e,a,n,d)}})},this.initComboBoxes=function(){var e=function(){t.sumDebitAmt=0,t.sumCreditAmt=0,t.sumInitAmt=0,t.initAmt=0;var e=$(this).val();t.createDate=$("#detail-time").val(),""==t.createDate&&(t.createDate=t.getYearmonth()),null==$("#detailMoney_oneSub").jqxComboBox("getSelectedItem")?$("#detailMoney_oneSub").jqxComboBox("selectIndex",0):"全部"==e?(e=$("#detailMoney_oneSub").val(),t.hardCode=t.searchHardCode("chartOfAccounts",e),t.getSearchByChange(t.hardCode,t.createDate)):(t.hardCode=t.searchHardCode("chartOfAccounts",e),t.getSearchByChange(t.hardCode,t.createDate))};$("#detailMoney_oneSub").on({change:function(){$("#detailMoney_twoSub").off("change"),t.sumDebitAmt=0,t.sumCreditAmt=0,t.sumInitAmt=0,t.initAmt=0;var a=$(this).val();t.createDate=$("#detail-time").val(),""==t.createDate&&(t.createDate=t.getYearmonth()),null==$("#detailMoney_oneSub").jqxComboBox("getSelectedItem")||""==$("#detailMoney_oneSub").val()||(t.hardCode=t.searchHardCode("chartOfAccounts",a)),t.getSearchByChange(t.hardCode,t.createDate),t.getHardCodeByPid(a);var n=[],d=t.arr2,r=ComboBoxSources.getRecords("chartOfAccounts");void 0===d||$.each(r,function(t,e){for(var a=e.ref,r=0;r<d.length;r++)0==a.indexOf(d[r])&&6==a.length&&n.push(e)});for(var i=$("#detailMoney_twoSub").jqxComboBox("getItems"),o=i.length,s=1;s<o;s++)$("#detailMoney_twoSub").jqxComboBox("removeAt",1);$.each(n,function(t,e){$("#detailMoney_twoSub").jqxComboBox("addItem",e)}),$("#detailMoney_twoSub").jqxComboBox("selectIndex",0),$("#detailMoney_twoSub").on("change",e)}}),$("#detailMoney_twoSub").on("change",e)},this.searchObj={},this.initSearch=function(){t.searchObj={"coa.hardCode":{value:["1001"],action:"like"},"journalDetail.createDate":{value:[""+t.getYearmonth()],action:"like"}}},this.searchDataInfo=function(e){var a=void 0===e?t.settings.grid.element:e;$("#"+a).jqxGrid("applyfilters"),$("#"+a).jqxGrid("refreshfilterrow"),$("#"+a).jqxGrid("clearselection")},this.search=function(e,a){t.searchObj["coa.hardCode"].value=[""+e],t.searchObj["journalDetail.createDate"].value=[""+a],t.searchDataInfo()},this.refreshDataInfo=function(e){var a=void 0===e?t.settings.grid.element:e;$("#"+a).jqxGrid("updatebounddata","cells"),$("#"+a).jqxGrid("clearselection"),$("#"+a).jqxGrid("refreshdata")}},BssDetailMoneyBindModle=function(t){var e=this;_global_settings.service.url;this.searchByTime=function(){var e=t.hardCode,a=$("#detail-time").val();""==a&&(a=t.getYearmonth()),t.createDate=a,$("#detailMoney_nowDate").text(a),t.getSearchByChange(e,a)},this.bind=function(){$("#detail-search").on("click",function(){e.searchByTime()})},this.unbindAll=function(){$("#detail-search").off("click")},$("#detail-print").on("click",function(){var e=t.getYearmonth(),a=$("#detail-time").val();if(11==a.length&&(a=e),"全部"!=$("#detailMoney_twoSub").val()){if("中文"==$("#main-changeLanguage").text())var n=(new Base64).encode("reportName=InventoryCashEN&detailBilldate="+a+"&printType=pdf&chartOfAccountid="+$("#detailMoney_twoSub").val()+"&ownerId="+currentUserInfo.id+"&username="+currentUserInfo.loginId);else var n=(new Base64).encode("reportName=InventoryCash&detailBilldate="+a+"&printType=pdf&chartOfAccountid="+$("#detailMoney_twoSub").val()+"&ownerId="+currentUserInfo.id+"&username="+currentUserInfo.loginId);window.open(_global_settings.service.url+"/ac/print/"+n)}else{if("中文"==$("#main-changeLanguage").text())var n=(new Base64).encode("reportName=InventoryCashEN&detailBilldate="+a+"&printType=pdf&chartOfAccountid="+$("#detailMoney_oneSub").val()+"&ownerId="+currentUserInfo.id+"&username="+currentUserInfo.loginId);else var n=(new Base64).encode("reportName=InventoryCash&detailBilldate="+a+"&printType=pdf&chartOfAccountid="+$("#detailMoney_oneSub").val()+"&ownerId="+currentUserInfo.id+"&username="+currentUserInfo.loginId);window.open(_global_settings.service.url+"/ac/print/"+n)}}),$("#detail-out").on({click:function(){var e=null,a=$("#detailMoney_twoSub").val();e="全部"==a?t.searchHardCode("chartOfAccounts",$("#detailMoney_oneSub").val()):t.searchHardCode("chartOfAccounts",a);var n=t.getYearmonth(),d=$("#detail-time").val();if(11==d.length&&(d=n),"中文"==$("#main-changeLanguage").text())var r=(new Base64).encode("tosys/coaReport/export/detailMoneyEnglish/"+e+"/"+d+"/0/0/0/0/0/0/0/0/0/"+currentUserInfo.id+"/"+currentUserInfo.loginId);else var r=(new Base64).encode("tosys/coaReport/export/detailMoney/"+e+"/"+d+"/0/0/0/0/0/0/0/0/0/"+currentUserInfo.id+"/"+currentUserInfo.loginId);$.openHref(_global_settings.service.url+"/ac/exportReport/"+r)}})};