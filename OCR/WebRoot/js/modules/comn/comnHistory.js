var ComnhMgt=function(){var e=this,t=_global_settings.service.url+"/salesagent",a=_global_settings.owner.roleName;this.debug=!1,this.initInput=function(){e.initUserPage(),e.initSearch(),e.initGrid(e.searchObj)},this.initUserPage=function(){$("#comnH-show").css("display","");for(var e=ComboBoxSources.getRecords("salesAgent"),t=["全部"],a=0;a<e.length;a++)t.push(e[a].agentName);$("#comnH-name").comboBox({theme:currentTheme,source:t,searchMode:"contains",height:34,width:"100%",selectedIndex:0}),$("#comnH-show").addClass("hiddendiv")},this.initGrid=function(){e.settings.source.data=e.searchObj;var t=Core.AcDataAdapter("comnHistoryGrid",e.settings.source,{beforeLoadComplete:function(e){}},e.debug),a={source:t,rendergridrows:function(){return t.recordids},columns:[{text:"代理商编码",dataField:"agentCode",width:"10%"},{text:"代理商用户名",dataField:"agentName",width:"15%"},{text:"付费客户",width:"15%",cellsrenderer:function(e,t,a,i,n,r){var s='<div class="agrid">';return s+='<a class="hoverspan viewComn">'+r.customernum+"</a></div>"}},{text:"累计购买金额",dataField:"amt",cellsalign:"right",cellsformat:"c2",width:"15%"},{text:"应提佣金",dataField:"fee",cellsalign:"right",cellsformat:"c2",width:"15%"},{text:"已提佣金",dataField:"revenueAmt",cellsalign:"right",cellsformat:"c2",width:"15%"},{text:"未提佣金",dataField:"notRevenueAmt",cellsalign:"right",cellsformat:"c2",width:"15%"}],pagesize:20,columnsheight:45};$("#comnHistoryGrid").grid(a),$("#comnHistoryGrid").on("click",".viewComn",function(){var e=$("#comnHistoryGrid").jqxGrid("getselectedrowindex");if(e>=0){var t=$("#comnHistoryGrid").jqxGrid("getrowdata",e);$.addTab({title:"佣金详情",url:"page/modules/comn/viewComn.html",pk:{name:t.agentName,agentCode:t.agentCode,agentId:t.id},reload:!0})}})},this.settings={source:{url:t+"/search/page",data:e.searchObj},grid:{element:"comnHistoryGrid"},ajax:{url:t}},this.searchObj={},this.initSearch=function(){e.searchObj={agentCode:{value:[],action:"like"},agentName:{value:[],action:"like"},customernum:{value:[],action:"between"},fee:{value:[],action:"between"}},"salesStaff"!=a&&"salesManage"!=a||(e.searchObj["ow.sales_id"]={value:[""+_global_settings.owner.userid],action:"eq"})},this.searchDataInfo=function(){$("#comnHistoryGrid").jqxGrid("applyfilters"),$("#comnHistoryGrid").jqxGrid("refreshfilterrow"),$("#comnHistoryGrid").jqxGrid("clearselection")},this.refreshDataInfo=function(){$("#comnHistoryGrid").jqxGrid("updatebounddata","cells"),$("#comnHistoryGrid").jqxGrid("clearselection"),$("#comnHistoryGrid").jqxGrid("refreshdata")}},ComnhBindModle=function(e){var t=this;this.search=function(){var t=$("#comnH-number").val(),a=$("#comnH-name").find("input").val(),i=$("#comnH-sc").val(),n=$("#comnH-ec").val(),r=$("#comnH-sa").val(),s=$("#comnH-ea").val();e.searchObj.agentCode.value=[],""!=t&&e.searchObj.agentCode.value.push(t),e.searchObj.agentName.value=[],"全部"!=a&&e.searchObj.agentName.value.push(a),e.searchObj.customernum.value=[],""!=i&&""!=n&&e.searchObj.customernum.value.push(i,n),e.searchObj.fee.value=[],""!=r&&""!=s&&e.searchObj.fee.value.push(r,s),e.searchDataInfo()},this.bind=function(){$("#comnH-search").on("click",function(){$("#comnH-show").is(":hidden")?$("#comnH-show").slideDown("slow"):t.search()}),hiddenAclick()},this.unbindAll=function(){$("#comnH-search").off("click")}};