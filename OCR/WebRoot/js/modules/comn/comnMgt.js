var ComnMgt=function(){var t=this,e=_global_settings.service.url+"/agentrevenue";this.initInput=function(){t.set(),t.initSearch(),t.initGrid(t.searchObj)},this.set=function(){Core.AjaxRequest({url:_global_settings.service.url+"/agentrevenue/total",type:"GET",showMsg:!1,async:!1,callback:function(t){$("#smnComn").text(money(t.fee)),$("#hmnComn").text(money(t.isFee)),$("#balComn").text(money(t.unFee))},failure:function(){}})},this.initGrid=function(){t.settings.source.data=t.searchObj;var e=Core.AcDataAdapter("comnMgtGrid",t.settings.source,{beforeLoadComplete:function(t){}},!1),n={source:e,rendergridrows:function(t){return e.recordids},columns:[{text:"日期",dataField:"orderCreateDate",width:"18%"},{text:"客户购买金额",dataField:"totalAmt",cellsformat:"c2",width:"18%"},{text:"应提佣金",dataField:"fee",cellsformat:"c2",width:"18%"},{text:"已提佣金",dataField:"isFee",cellsformat:"c2",width:"18%"},{text:"状态",width:"18%",cellsrenderer:function(t,e,n,i,o,a){var d='<div class="agrid">';return(d+="paid"==a.payStatus?"已提交":"notpaid"==a.payStatus?"未提取":"已申请")+"</div>"}},{text:"操作",width:"10%",cellsrenderer:function(t,e,n,i,o,a){var d='<div class="text-center" title="查看审批记录">';return(d+='<a class="hoverspan md-dns viewProcess"></a>')+"</div>"}}],pagesize:20,columnsheight:45,ready:function(){}};$("#comnMgtGrid").grid(n),$("#comnMgtGrid").on("click",".viewProcess",function(){var e=$("#comnMgtGrid").jqxGrid("getselectedrowindex"),n=$("#comnMgtGrid").jqxGrid("getrowdata",e),i=void 0==n.list?"no":n.list;0==$("#comn_modal").length?$.loadModal("page/common/segment/getComn.html",function(e){$("body").append(e),t.initComnModal(i)}):t.initComnModal(i)})},this.settings={source:{url:e+"/page",data:t.searchObj},grid:{element:"comnMgtGrid"},ajax:{url:e}},this.searchObj={},this.initSearch=function(){t.searchObj={"salesAgent.id":{value:[""+_global_settings.owner.id],action:"eq"}}},this.searchDataInfo=function(){$("#comnMgtGrid").jqxGrid("applyfilters"),$("#comnMgtGrid").jqxGrid("refreshfilterrow"),$("#comnMgtGrid").jqxGrid("clearselection")},this.refreshDataInfo=function(){$("#comnMgtGrid").jqxGrid("updatebounddata","cells"),$("#comnMgtGrid").jqxGrid("clearselection"),$("#comnMgtGrid").jqxGrid("refreshdata")},this.initComnModal=function(t){if($("#comn_modal").modal("show"),t){if($("#comn_table").addClass("hide"),$("#comn_tableView").removeClass("hide").find("tbody").find("tr:gt(0)").remove(),$("#saveComnBtn").addClass("hide"),$("#comn_text").text("查看审批记录"),"no"==t){return $("#comn_tableView").find("tbody").append('<tr><td class="text-center" colspan="4">暂无审批记录</td></tr>'),!1}$.each(t,function(e,n){var i="notpaid"==t[e].payStatus?"拒绝":"同意",o="<tr><td>"+t[e].createDate+"</td><td>"+t[e].createBy+"</td><td>"+i+"</td><td>"+t[e].remark+"</td></tr>";$("#comn_tableView").find("tbody").append(o)})}else $("#comn_table").removeClass("hide"),$("#comn_tableView").addClass("hide"),$("#saveComnBtn").removeClass("hide"),$("#comn_text").text("提取佣金")}},ComnBindModle=function(t){this.bind=function(){$("#comn-btn").on("click",function(){0==$("#comn_modal").length?$.loadModal("page/common/segment/getComn.html",function(e){$("body").append(e),t.initComnModal()}):t.initComnModal()})},this.unbindAll=function(){$("#comn-btn").off("click")}};