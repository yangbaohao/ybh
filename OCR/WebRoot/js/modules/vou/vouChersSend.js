var VouSendMgt=function(){var e=this,n=_global_settings.service.url+"/voucher";this.boolean=null,this.initInput=function(){e.initPage(),e.initValidator(),e.nameBlur(),e.amtInput()},this.initPage=function(){$("#vousend-time").dropDownlist({source:["请选择","最近一周","最近两周","最近三周","本月","本季度","本年"],width:"100%",height:34,selectedIndex:0}),$("#vousend-sTime").datetimeinput({formatString:"yyyy-MM-dd",height:34,width:"100%"}),$("#vousend-eTime").datetimeinput({formatString:"yyyy-MM-dd",height:34,width:"100%"}),$("#vousend-startTime").datetimeinput({value:new Date,formatString:"yyyy-MM-dd",height:34,width:"100%"}),$("#vousend-endTime").datetimeinput({formatString:"yyyy-MM-dd",height:34,width:"100%"}),$("#vousend-time").on("change",function(){setValueById("vousend-time","vousend-sTime","vousend-eTime")}),$("#vousend-sendtype").dropDownlist({source:{SYSPUSH:"系统推送",LINE:"线下验码"},height:34,width:"100%",selectedIndex:0}),$("#vousend-vouchers").dropDownlist({source:{choose:"请选择",noUse:"未使用金额",use:"已使用金额",overdue:"已过期金额"},width:"100%",height:34,selectedIndex:0}),$("#vousend-type").dropDownlist({source:{ordinary:"普通代金券",all:"全额代金券"},width:"100%",height:34,selectedIndex:0}),$("#vousend-sendtype").on("select",function(){"SYSPUSH"==$("#vousend-sendtype").val()?($("#vousendNum").css("display","none"),$("#vousendHead").css("display",""),$("#vousend-show").css("display",""),$("#vousend-amt").val("")):($("#vousendNum").css("display",""),$("#vousendHead").css("display","none"),$("#vousend-show").css("display","none"),$("#vousend-amt").val(""),$("#vousend-num").val(""))})},this.initValidator=function(){$("#vouChersSend").jqxValidator({hintType:"label",animationDuration:1,rules:[{input:"#vousend-name",message:"不能为空",action:"keyup,blur",rule:"required"},{input:"#vousend-price",message:"不能为空",action:"keyup,blur",rule:"required"},{input:"#vousend-num",message:"大于0的数",action:"keyup,blur",rule:function(e,n){return!!$("#vousendNum").is(":hidden")||!!(/^\d*$/.test(e.val())&&e.val()>0)}},{input:"#vousend-startTime",message:"不能为空",action:"keyup,blur",rule:function(e,n){return""!=e.val()}},{input:"#vousend-endTime",message:"不能为空",action:"keyup,blur",rule:function(e,n){return""!=e.val()}}]})},this.nameBlur=function(){$("#vousend-name").on("blur",function(){""!=$("#vousend-name").val()&&Core.AjaxRequest({type:"GET",url:n+"/check/"+$("#vousend-name").val(),async:!1,callback:function(n){e.boolean=n},failure:function(){}})})},this.amtInput=function(){$("#vousend-price").on("input",function(){var e=$("#vousend-price").val();"SYSPUSH"==$("#vousend-sendtype").val()?""==$("#userNumber").text()?$("#vousend-amt").val(""):$("#vousend-amt").val(e*parseInt($("#userNumber").text())):""==$("#vousend-num").val()?$("#vousend-amt").val(""):$("#vousend-amt").val(e*$("#vousend-num").val())}),$("#vousend-num").on("input",function(){var e=$("#vousend-num").val();""==$("#vousend-price").val()?$("#vousend-amt").val(""):$("#vousend-amt").val(e*$("#vousend-price").val())})}},VouSendBindModle=function(e){var n=_global_settings.service.url+"/voucher",u=null;this.bind=function(){$("#vousend-search").on("click",function(){var e=$("#vousend-sc").val(),n=$("#vousend-ec").val(),s=$("#vousend-vouchers").val(),o=$("#vousend-sVouchers").val(),t=$("#vousend-eVouchers").val(),i=$("#vousend-sTime").val(),a=$("#vousend-eTime").val(),d=$("#vousend-username").val(),v=$("#vousend-code").val();""!=e&&""!=n||(e=-1,n=-1),"choose"==s&&(s=-1),""!=o&&""!=t||(o=-1,t=-1),""!=i&&""!=a||(i=-1,a=-1),""==d&&(d=-1),""==v&&(v=-1),Core.AjaxRequest({type:"GET",url:_global_settings.service.url+"/voucher/search/page/"+e+"/"+n+"/"+s+"/"+o+"/"+t+"/"+i+"/"+a+"/"+d+"/"+v,async:!1,callback:function(e){u=e.ids,$("#userNumber").text(e.count)},failure:function(e){}})});var s=function(e){return 0!=e&&""!=e};$("#vousend-save").on("click",function(){var o=!0,t=$("#vousend-name").val(),i=$("#vousend-startTime").val(),a=$("#vousend-endTime").val(),d=$("#vousend-price").val();if(type=$("#vousend-type").val(),sendType=$("#vousend-sendtype").val(),num=$("#vousend-num").val(),userNumber=$("#userNumber").text(),$("#vouChersSend").jqxValidator("validate")){if(null==e.boolean)return Core.alert({message:"代金券名称重复！"}),!1;if("SYSPUSH"==sendType?(num=-1,o=s(userNumber)):u=-1,!o)return Core.alert({message:"用户数不能为0或者空！"}),!1;Core.AjaxRequest({type:"GET",url:n+"/putvoucher/"+sendType+"/"+t+"/"+i+"/"+a+"/"+d+"/"+u+"/"+type+"/"+num,async:!1,showMsg:!1,callback:function(e){try{setCloseAlertTimeOneSecond(),$("#vouGrid").jqxGrid("updatebounddata","cells"),$.closeTab()}catch(e){}},failure:function(){}})}}),$("#vousend-cancle").on("click",function(){$.closeTab()}),hiddenAclick()},this.unbindAll=function(){$("#vousend-search").off("click"),$("#vousend-save").off("click"),$("#vousend-cancle").off("click")}};