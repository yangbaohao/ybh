var VouMgt=function(){var e=this,t=_global_settings.service.url+"/voucher";this.initInput=function(){e.initPage(),e.initSearch(),e.initGrid(e.searchObj)},this.initPage=function(){$("#vou-show").css("display",""),$("#vou-time").dropDownlist({source:["请选择","最近一周","最近两周","最近三周","本月","本季度","本年"],width:"100%",height:34,selectedIndex:0}),$("#vou-sTime").datetimeinput({formatString:"yyyy-MM-dd",height:34,width:"100%"}),$("#vou-eTime").datetimeinput({formatString:"yyyy-MM-dd",height:34,width:"100%"}),$("#vou-time").on("change",function(){setValueById("vou-time","vou-sTime","vou-eTime")}),$("#vou-type").dropDownlist({source:{all:"请选择",SYSPUSH:"系统推送",LINE:"线下验码"},width:"100%",height:34,selectedIndex:0}),$("#vou-stype").dropDownlist({source:{select:"请选择",ordinary:"普通代金券",all:"全额代金券"},width:"100%",height:34,selectedIndex:0}),$("#vou-show").addClass("hiddendiv")},this.initGrid=function(){e.settings.source.data=e.searchObj;var t=Core.AcDataAdapter("vouGrid",e.settings.source,{beforeLoadComplete:function(e){}},!1),i={source:t,rendergridrows:function(e){return t.recordids},columns:[{text:"代金券名称",width:"15%",cellsrenderer:function(e,t,i,a,r,s){var u='<div class="agrid" title="查看详情">';return(u+='<a class="hoverspan viewVouchers">'+s.name+"</a>")+"</div>"}},{text:"代金券类型",width:"15%",cellsrenderer:function(e,t,i,a,r,s){return'<div class="agrid">'+getCodeData(s.type)+"</div>"}},{text:"代金券总金额",dataField:"amount",cellsalign:"right",cellsformat:"c2",width:"15%"},{text:"发放类型",width:"15%",cellsrenderer:function(e,t,i,a,r,s){var u='<div class="agrid">';return(u+="SYSPUSH"==s.dispatchType?"系统推送":"线下验码")+"</div>"}},{text:"开券日期",width:"10%",cellsrenderer:function(e,t,i,a,r,s){return'<div class="agrid">'+s.startTime.substring(0,10)+"</div>"}},{text:"有效日期",width:"10%",cellsrenderer:function(e,t,i,a,r,s){return'<div class="agrid">'+s.endTime.substring(0,10)+"</div>"}},{text:"总数量",dataField:"sum",width:"10%"},{text:"使用数量",dataField:"available",width:"10%"}],pagesize:20,columnsheight:45,ready:function(){}};$("#vouGrid").grid(i),$("#vouGrid").on("click",".viewVouchers",function(){var e=$("#vouGrid").jqxGrid("getselectedrowindex");if(e>=0){var t=$("#vouGrid").jqxGrid("getrowdata",e);$.addTab({title:"代金券详情",isFrame:!1,url:"page/modules/vou/viewVouChers.html",pk:{name:t.name},reload:!0})}})},this.settings={source:{url:t+"/vouchersupervise",data:e.searchObj},grid:{element:"vouGrid"},ajax:{url:t}},this.searchObj={},this.initSearch=function(){e.searchObj={"t.name":{value:[],action:"like"},"t.amount":{value:[],action:"between"},"t.sum":{value:[],action:"between"},"t.startTime":{value:[],action:"between"},"t.dispatchType":{value:[],action:"eq"},"t.type":{value:[],action:"eq"}}},this.searchDataInfo=function(){$("#vouGrid").jqxGrid("applyfilters"),$("#vouGrid").jqxGrid("refreshfilterrow"),$("#vouGrid").jqxGrid("clearselection")},this.refreshDataInfo=function(){$("#vouGrid").jqxGrid("updatebounddata","cells"),$("#vouGrid").jqxGrid("clearselection"),$("#vouGrid").jqxGrid("refreshdata")}},VouBindModle=function(e){var t=this;this.search=function(){var t=$("#vou-name").val(),i=$("#vou-stype").val(),a=$("#vou-sc").val(),r=$("#vou-ec").val(),s=$("#vou-sm").val(),u=$("#vou-em").val(),o=$("#vou-sTime").val(),n=$("#vou-eTime").val(),d=$("#vou-type").val();e.searchObj["t.name"].value=[],""!=t&&e.searchObj["t.name"].value.push(t),e.searchObj["t.type"].value=[],"select"!=i&&e.searchObj["t.type"].value.push(i),e.searchObj["t.amount"].value=[],""!=a&&""!=r&&e.searchObj["t.amount"].value.push(a,r),e.searchObj["t.sum"].value=[],""!=s&&""!=u&&e.searchObj["t.sum"].value.push(s,u),e.searchObj["t.startTime"].value=[],""!=o&&""!=n&&e.searchObj["t.startTime"].value.push(o,n),""!=o&&""===n&&e.searchObj["t.startTime"].value.push(o,getNowFormatDate()),""===o&&""!=n&&e.searchObj["t.startTime"].value.push("2015-01-01",n),e.searchObj["t.dispatchType"].value=[],"all"!=d&&e.searchObj["t.dispatchType"].value.push(d),e.searchDataInfo()},this.bind=function(){$("#vou-search").on("click",function(){$("#vou-show").is(":hidden")?$("#vou-show").slideDown("slow"):t.search()}),hiddenAclick(),$("#vou-send").on("click",function(){$.addTab({title:"推送代金券",url:"page/modules/vou/vouChersSend.html",isFrame:!1,reload:!0})})},this.unbindAll=function(){$("#vou-search").off("click"),$("#vou-send").off("click")}};