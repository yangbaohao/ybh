var ViewVou=function(){var e=this,i=_global_settings.service.url+"/voucher/vouchername",a=null,t=null;this.name=null,this.initInput=function(){$("#viewVou-show").css("display",""),e.name=$.pk.name,void 0==$.pk&&null==$.pk||void 0!=$.pk.name&&null!=$.pk.name||(Core.alert({message:"传入名称错误"}),$.closeTab()),$("#viewVou-show").addClass("hiddendiv"),$("#viewVou-name").text(e.name),e.initSearch(),e.initGrid(e.searchObj)},this.initGrid=function(){e.settings.source.data=e.searchObj;var i=Core.AcDataAdapter("viewVouGrid",e.settings.source,{beforeLoadComplete:function(e){$.each(e,function(i){a=e[i].startTime.substring(0,10),t=e[i].endTime.substring(0,10),$("#viewVou-time").text("有效期："+a+"——"+t)})}},!1),o={source:i,rendergridrows:function(e){return i.recordids},columns:[{text:"代金券编号",dataField:"voucherCode",width:"20%"},{text:"代金券金额",dataField:"amount",cellsalign:"right",cellsformat:"c2",width:"10%"},{text:"发放类型",width:"10%",cellsrenderer:function(e,i,a,t,o,n){var r='<div class="agrid">';return(r+="SYSPUSH"==n.dispatchType?"系统推送":"线下验码")+"</div>"}},{text:"用户类型",dataField:"userType",width:"15%"},{text:"代理商",dataField:"agentName",width:"15%"},{text:"分配用户名",dataField:"loginId",width:"15%"},{text:"状态",dataField:"state",width:"15%"}],pagesize:20,columnsheight:45,ready:function(){}};$("#viewVouGrid").grid(o)},this.settings={source:{url:i,data:e.searchObj},grid:{element:"viewVouGrid"},ajax:{url:i}},this.searchObj={},this.initSearch=function(){e.searchObj={"v.name":{value:[""+e.name],action:"eq"},"v.voucherCode":{value:[],action:"like"},"a.agentName":{value:[],action:"like"},"o.loginId":{value:[],action:"like"},type:{value:[],action:"like"}}},this.searchDataInfo=function(){$("#viewVouGrid").jqxGrid("applyfilters"),$("#viewVouGrid").jqxGrid("refreshfilterrow"),$("#viewVouGrid").jqxGrid("clearselection")},this.refreshDataInfo=function(){$("#viewVouGrid").jqxGrid("updatebounddata","cells"),$("#viewVouGrid").jqxGrid("clearselection"),$("#viewVouGrid").jqxGrid("refreshdata")}},viewVouBindModle=function(e){var i=this,a=_global_settings.service.url+"/common/export/voucher";this.search=function(){var i=$("#viewVou-code").val(),a=$("#viewVou-type").val(),t=$("#viewVou-agent").val(),o=$("#viewVou-username").val();e.searchObj["v.voucherCode"].value=[],e.searchObj["a.agentName"].value=[],e.searchObj["o.loginId"].value=[],e.searchObj.type.value=[],""!=i&&e.searchObj["v.voucherCode"].value.push(i),""!=t&&e.searchObj["a.agentName"].value.push(t),""!=o&&e.searchObj["o.loginId"].value.push(o),""!=a&&e.searchObj.type.value.push(a),e.searchDataInfo()},this.bind=function(){$("#viewVou-search").on("click",function(){$("#viewVou-show").is(":hidden")?$("#viewVou-show").slideDown("slow"):i.search()}),$("#viewVou-import").on("click",function(){window.open(a+"/"+e.name+"/eyJjb25kaXRpb24iOltdLCJmaWx0ZXJzY291bnQiOjAsImdyb3Vwc2NvdW50IjowLCJwYWdlbnVtIjowLCJwYWdlc2l6ZSI6MjB9")}),hiddenAclick()},this.unbindAll=function(){$("#viewVou-search").off("click"),$("#viewVou-import").off("click")}};