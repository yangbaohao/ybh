var _global_settings={id:Core.randNum(),js_path:"/js",html_path:"/page"};!function(e){e.service={},e.service.url=ws_url+"/CXF/rs",e.owner={},-1==window.location.host.indexOf("localhost")&&(e.service.url="/CXF/rs");var t=(e.js_path,e.html_path,new ZqwTab_Mgt);e.zqwTabMgt=t;var i=[],a=[];$(document).ready(function(){var t=new Date,a=["日","一","二","三","四","五","六"],n=t.getFullYear()+"年"+(t.getMonth()+1)+"月"+t.getDate()+"日 星期"+a[t.getDay()];$("#time").html(n);var r=function(){for(var t=[],i=$("#zqw_tabs").find("li"),a=i.length,n=0;n<a;n++)t.push(i.eq(n).data("map"));localStorage.map=[],localStorage.owner=e.owner.username,localStorage.map=JSON.stringify(t),localStorage.index=$("#zqw_tabs").find("li.active").index(),window.onbeforeunload=function(e){},window.location.href=window.location.href};$("#main-refreshBtn").on({click:function(){delete localStorage.map,delete localStorage.index,r()}});var l=new MenuMgt;l.initUserPermissions(),l.initLeftMenu(),company(),$("#main-updatePassword").off("click").on("click",function(){0==$("#segment-updatePassword").length?$.get("page/common/segment/updatePassword.html",function(e){$(e).appendTo($("body")),$("#segment-updatePassword").modal("show"),timeOut(function(){$("#segment-updatePassword").find("input").val("")},200)}):($("#segment-updatePassword").modal("show"),timeOut(function(){$("#segment-updatePassword").find("input").val("")},200))});var o=$("<img style='position: fixed;display:none;z-index: 50000;' id='floatImg' src=''/>"),s=$("<img style='position: fixed;display:none;z-index: 50000;background-color:#f4f2f2' id='grid_test_img' src=''/>");$("body").append(o).append(s),$("#level1_menu>li").eq(0).addClass("active"),$(".level1 > li > a").click(function(e){$(".level1 > li").removeClass("active"),$(this).parent().addClass("active");var t=$(this).parent().attr("id").substring(7);return 0==$(this).parent().hasClass("has_sub")?($(".level2").animate({width:"0"},200),$(this).addTab()):($(".level2").animate({width:"0"},200),$("#level2_"+t).animate({width:"120px"},200),!1)}),$(".level2 > li  >a").click(function(e){return $(".level2 > li").removeClass("active"),$(this).parent().addClass("active"),$(this).addTab()}),$("#mainTab").on({created:function(e){for(var t=$("#zqw_tabs"),a=t.find("ul li"),n=a.length,r=0;r<n;r++){var l={};l.index=r,l.title=a.eq(r).text().trim(),i.push(l)}},add:function(e,t,a,n){i=[];for(var r=$("#zqw_tabs"),l=r.find("ul li"),o=l.length,s=0;s<o;s++){var d={};d.index=s,d.title=l.eq(s).text().trim(),l.eq(s).attr("title",l.eq(s).text().trim()),i.push(d)}var c=$(".active").eq(0).data("map");if(null!=c&&0==c.read){var a=c.title,u=c.url,m=c.pk;null==localStorage.index&&(c.read=null,$.addTab({title:a,url:u,pk:m,map:c,reload:!0}))}},removed:function(e,t){i=[];for(var a=$("#zqw_tabs"),n=a.find("ul li"),r=n.length,l=0;l<r;l++){var o={};o.index=l,o.title=n.eq(l).text().trim(),i.push(o)}},selected:function(e,t){var i=$(".zqw_refreshGrid");$.each(i,function(){if(!$(this).is(":hidden")){var e=$(this).attr("id");try{$("#"+e).jqxGrid("updatebounddata","cells"),$("#"+e).jqxGrid("clearselection")}catch(e){}}});var a=$(".active").eq(0).data("map");if(null!=a&&0==a.read){var n=a.title,r=a.url,l=a.pk;null==localStorage.index&&(a.read=null,$.addTab({title:n,url:r,pk:l,map:a,reload:!0}))}}}),$("#mainTab").trigger($.Event("created"))}),$(document).keydown(function(e){var t=e.target;if(e.altKey&&(37==e.keyCode||39==e.keyCode))return e.returnValue=!1,!1;if(8==e.keyCode&&"password"!=t.type&&"text"!=t.type&&"textarea"!=t.type)return!1;if(13==e.keyCode){var i=$(".searchBtn");return void $.each(i,function(){if(!$(this).is(":hidden"))return e.preventDefault(),$(this).trigger("click"),!1})}}),$.addTab=function(e){var a={tabs_ele:"mainTab",title:"",content:"",isFrame:!1,url:"",reload:!1,position:0},n=$.extend(!0,a,e);0==n.position?n.position=t.selectedIndex():n.position=0;if(n.isFrame){if(""===n.url)return;var r='<iframe src="'+n.url+'" name="tabReportItem" width="100%" height="100%" style="background:#fff;min-height:768px;margin:0px;padding:0px;overflow-y:none;overflow-x:none;" frameborder="no" border="0" marginwidth="0" marginheight="0" scrolling="no"></iframe><br clear="all">';t.addTab(n.position,n.title,r)}else{for(var l=!1,o=0;o<i.length;o++){var s=i[o];if(n.title.trim(),s.title==n.title.trim()){l=!0,!0===n.reload&&function(e){if(""===n.url||"#"==n.url)t.setContent(e,n.content);else{var i=$("<div></div>");$.pk=n.pk,$.ajax({url:n.url,cache:!0,async:!1,type:"get",dataType:"html",success:function(i){$.timeOutCookie(i),t.setContent(e,i),n.callback&&timeOut(n.callback)},error:function(){}}),i.html(""),i=null}}(s.index),t.clickTab(s.index);break}}l||function(){if(""===n.url||"#"==n.url)t.addTab(n.position,n.title,n.content,n.map);else{var e=$("<div></div>");$.pk=n.pk,$.ajax({url:n.url,cache:!0,async:!1,type:"get",dataType:"html",success:function(e){$.timeOutCookie(e);var i={};i.pk=$.pk,i.title=n.title,i.url=n.url,t.addTab(n.position,n.title,e,i),n.callback&&timeOut(n.callback)},error:function(){}}),e.html(""),e=null}}()}},$.closeTab=function(e){setPara(),void 0===e&&(e=t.selectedIndex()),0!=e&&t.removeTab(e)},$.addTabCloseEvent=function(e){t.addCloseEvent(t.selectedIndex(),e)},$.loadScript=function(e,t){t=void 0===t?function(){}:t;var i=!1;return $.each(a,function(t,a){a==e&&(i=!0)}),i?t():$.getScript(e,function(){t()}),!1},$.loadHtml=function(e,t){$("<div></div>").load(e,function(i){$.timeOutCookie(i);try{var a={};a.title=t,a.url=e+"?v="+version_html,$.addTab({title:t,isFrame:!1,url:"",content:$(this).html(),reload:!0,map:a})}catch(e){}})},$.fn.extend({addTab:function(){var e=$(this).attr("href");if(void 0===e&&(e=""),""===e||"#"==e)$.addTab({title:$(this).html(),isFrame:!1,url:e,content:"<div class='content'><h2>"+$(this).html()+" is comming soon!</h2></div>",reload:!0});else{if("iframe"!=$(this).attr("flag")){if(0===e.indexOf("http://"))return $(this).attr("target","_blank"),!0;var t=$(this).text();return $.loadHtml(e,t),!1}if(""===e||"#"==e)return Core.alert({message:"iframe的url非法"}),!1;$.addTab({title:$(this).text(),isFrame:!0,url:e,reload:!0})}return!1}})}(_global_settings);var MenuMgt=function(){var e=this;this.menus=[{id:0,name:"总览",icon:"md-home",href:"page/modules/home.html",iframe:!1,permission:"all"},{id:1,name:"用户管理",icon:"md-group",href:"page/modules/user/userMgt.html",iframe:!1,permission:"ocruser"},{id:2,name:"业绩报表",icon:"md-format-align-right",href:"page/modules/sys/report.html",iframe:!1,permission:"ocrreport"},{id:3,name:"员工管理",icon:"md-account-box",href:"page/modules/sys/sysMgt.html",iframe:!1,permission:"ocrperson"},{id:4,name:"业务日志",icon:"md-assignment",href:"page/modules/sys/operationLog.html",iframe:!1,permission:"ocrlog"},{id:5,name:"附件存档",icon:"md-folder-open",href:"page/modules/sys/fileMgt.html",iframe:!1,permission:"ocrattachment"}],this.permissions=[],this.initLeftMenu=function(){var t=[];$.each(e.menus,function(i,a){("*"===a.permission||e.permissions.toString().indexOf(a.permission+":")>=0)&&(void 0!=a.child&&e.initLeftChildMenu(a.child),t.push(a))});var i=$("aside"),a=$("#level1_menu");$.each(t,function(e,t){var n=$('<li id="level1_'+t.id+'"><a href="'+t.href+'" '+(1==t.iframe?'flag="iframe"':"")+'><i class="'+t.icon+'"></i><span class="hide">'+t.name+"</span></a></li>");if(void 0!=t.child){var r=!1,l=$('<ul class="level2" id="level2_'+t.id+'" style="width:0;display:block"><li>'+t.name+"</li></ul>");$.each(t.child,function(e,t){0==t.delFlag&&($('<li id="level2_"'+t.id+'"><a href="'+t.href+'" '+(1==t.iframe?'flag="iframe"':"")+">"+t.name+"</a></li>").appendTo(l),r=!0)}),!0===r&&(n.addClass("has_sub"),l.appendTo(i))}n.appendTo(a)}),leftMenuHover()},this.eventBind=function(){$(".level1 > li > a").click(function(e){$(".level1 > li").removeClass("active"),$(this).parent().addClass("active");var t=$(this).parent().attr("id").substring(7);0==$(this).parent().hasClass("has_sub")?$(".level2").animate({width:"0"},200):($(".level2").animate({width:"0"},200),$("#level2_"+t).animate({width:"120px"},200))}),$(".level2 > li  >a").click(function(e){$(".level2 > li").removeClass("active"),$(this).parent().addClass("active")})},this.initLeftChildMenu=function(t){$.each(t,function(t,i){void 0==i.permission&&(i.permission="*"),e.permissions.toString().indexOf(i.permission+":")<0?i.delFlag=!0:i.delFlag=!1,"*"===i.permission&&(i.delFlag=!1)})},this.initUserPermissions=function(){Core.AjaxRequest({url:ws_url+"/CXF/rs/resource/permission/type/all",type:"GET",showMsg:!1,async:!1,callback:function(t){permission=t,$.each(t,function(t,i){void 0!=i&&e.permissions.push(i)}),e.permissions=$.unique(e.permissions)},failure:function(e){}})}};