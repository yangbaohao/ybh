var CpaMgt=function(){var e=this,a=_global_settings.service.url+"/user";this.initInput=function(){e.initPage(),e.initGrid(e.searchObj)},this.searchObj={"u.createDate":{value:[],action:"between"},"u.employeeCode":{value:[],action:"like"},"u.username":{value:[],action:"like"},"ui.name":{value:[],action:"like"},"ui.telephone":{value:[],action:"like"}},this.initPage=function(){$("#cpa-show").css("display",""),$("#cpa-time").dropDownlist({source:["请选择","最近一周","最近两周","最近三周","本月","本季度","本年"],theme:"energyblue",width:"100%",height:"34px",selectedIndex:0,dropDownHeight:150}),$("#cpa-sTime").datetimeinput({formatString:"yyyy-MM-dd",width:"100%",height:"34px"}),$("#cpa-eTime").datetimeinput({formatString:"yyyy-MM-dd",width:"100%",height:"34px"}),$("#cpa-time").on("change",function(){setValueById("cpa-time","cpa-sTime","cpa-eTime")}),$("#cpa-show").addClass("hiddendiv")};var t=function(e){for(var a=ComboBoxSources.getRecords("docker"),t=0;t<a.length;t++)if(a[t].username==e)return a[t];if(!e)return""};this.initGrid=function(){e.settings.source.data=e.searchObj;var a=Core.AcDataAdapter("coopAgentGrid",e.settings.source,{beforeLoadComplete:function(e){}},e.debug),i={source:a,rendergridrows:function(){return a.recordids},columns:[{text:"日期",width:"14%",cellsrenderer:function(e,a,t,i,r,n){return'<div class="agrid">'+n.createDate.substring(0,10)+"</div>"}},{text:"合作商编码",dataField:"employeeCode",width:"14%"},{text:"用户名",dataField:"username",width:"14%"},{text:"公司名称",width:"14%",cellsrenderer:function(e,a,t,i,r,n){return'<div class="agrid">'+n.userInfo.name+"</div>"}},{text:"电话号码",width:"14%",cellsrenderer:function(e,a,t,i,r,n){return'<div class="agrid">'+n.userInfo.telephone+"</div>"}},{text:"成功客户",width:"15%",cellsrenderer:function(e,a,t,i,r,n){var c='<div class="agrid">';return(c+='<a class="hoverspan viewClient">'+n.client+"</a>")+"</div>"}},{text:"对接人",width:"15%",cellsrenderer:function(e,a,i,r,n,c){return'<div class="agrid">'+t(c.docking.username).userInfo.name+"("+t(c.docking.username).username+")</div>"}}],pagesize:20,columnsheight:45};$("#coopAgentGrid").grid(i),$("#coopAgentGrid").on("click",".viewClient",function(){var e=$("#coopAgentGrid").jqxGrid("getselectedrowindex");if(e>=0){var a=$("#coopAgentGrid").jqxGrid("getrowdata",e);$.addTab({title:"查看详情",pk:{data:a},url:"page/modules/ps/viewClient.html",reload:!0})}})},this.settings={source:{url:a+"/partner",data:e.searchObj},grid:{element:"coopAgentGrid"},ajax:{url:a}},this.searchDataInfo=function(){$("#coopAgentGrid").jqxGrid("applyfilters"),$("#coopAgentGrid").jqxGrid("refreshfilterrow"),$("#coopAgentGrid").jqxGrid("clearselection")},this.refreshDataInfo=function(){$("#coopAgentGrid").jqxGrid("updatebounddata","cells"),$("#coopAgentGrid").jqxGrid("clearselection"),$("#coopAgentGrid").jqxGrid("refreshdata")}},CpaBindModle=function(e){var a=this;_global_settings.service.url;this.search=function(){var a=$("#cpa-sTime").val(),t=$("#cpa-eTime").val(),i=$("#cpa-code").val(),r=$("#cpa-user").val(),n=$("#cpa-company").val(),c=$("#cpa-phone").val();e.searchObj["u.createDate"].value=[],""!=a&""!=t&&e.searchObj["u.createDate"].value.push(a+" 00:00:00",t+" 23:59:59"),""!=a&""===t&&e.searchObj["u.createDate"].value.push(a+" 00:00:00",getNowFormatDate()+" 23:59:59"),""===a&""!=t&&e.searchObj["u.createDate"].value.push("2015-01-01 00:00:00",t+" 23:59:59"),e.searchObj["u.employeeCode"].value=[],""!=i&&e.searchObj["u.employeeCode"].value.push(i),e.searchObj["u.username"].value=[],""!=r&&e.searchObj["u.username"].value.push(r),e.searchObj["ui.name"].value=[],""!=n&&e.searchObj["ui.name"].value.push(n),e.searchObj["ui.telephone"].value=[],""!=c&&e.searchObj["ui.telephone"].value.push(c),e.searchDataInfo()},this.bind=function(){$("#cpa-search").on("click",function(){$("#cpa-show").is(":hidden")?$("#cpa-show").slideDown("slow"):a.search()}),$("#cpa-add").on("click",function(){$.addTab({title:"新增合作商",url:"page/modules/ps/addCoopAgent.html",reload:!0})}),hiddenAclick()},this.unbindAll=function(){$("#cpa-search").off("click"),$("#cpa-add").off("click")}};