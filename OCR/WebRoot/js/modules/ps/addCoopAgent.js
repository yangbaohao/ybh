var ad=new address("cpaAddressTableArs","form-control");ad.init();var AcpMgt=function(){var e=this;this.bool=!1,this.initInput=function(){e.initPage(),e.judgeName(),e.initValidator()},this.initPage=function(){Core.AjaxRequest({url:_global_settings.service.url+"/salesagent/getcode/agentcode",type:"GET",dataType:"text",async:!1,callback:function(e){$("#addCpa-code").val(e)},failure:function(){}}),$("#addCpa-person").comboBox({source:ComboBoxSources.getRecords("docker"),displayMember:"username",valueMember:"id",width:"100%",height:34,placeHolder:""})},this.judgeName=function(){$("#addCpa-user").on("blur",function(){var a=$(this).val();""!=a&&Core.AjaxRequest({type:"GET",url:_global_settings.service.url+"/user/repeat/"+a,showMsg:!1,callback:function(a){if(e.bool=a,a)return Core.alert({message:"用户名已存在，请重新输入！"}),!1}})})},this.initValidator=function(){$("#addCoopAgent").jqxValidator({hintType:"label",animationDuration:1,rules:[{input:"#addCpa-person",message:"请选择",action:"keyup,blur",rule:function(e,a){return null!=e.jqxComboBox("getSelectedItem")}},{input:"#addCpa-user",message:"不能为空",action:"keyup,blur",rule:"required"},{input:"#addCpa-pwd",message:"不能为空",action:"keyup,blur",rule:"required"},{input:"#addCpa-pwd",message:"长度不能小于6位",action:"keyup,blur",rule:function(e,a){return!(e.val().length<6)}},{input:"#addCpa-apwd",message:"不能为空",action:"keyup,blur",rule:"required"},{input:"#addCpa-apwd",message:"两次输入密码不一致",action:"keyup,blur",rule:function(e,a){return e.val()==$("#addCpa-pwd").val()}},{input:"#addCpa-phone",message:"不能为空",action:"keyup,blur",rule:"required"},{input:"#addCpa-phone",message:"联系电话格式不正确,请重新输入",action:"keyup,blur",rule:function(e,a){return!!/^1[3|4|5|7|8]\d{9}$/.test(e.val())}},{input:"#addCpa-company",message:"不能为空",action:"keyup,blur",rule:"required"},{input:"#addCpa-email",message:"邮箱格式不正确,请重新输入",action:"keyup,blur",rule:function(e,a){return""==e.val()||!!/^([0-9A-Za-z\-_\.]+)@([0-9a-z]+\.[a-z]{2,3}(\.[a-z]{2})?)$/g.test(e.val())}}]})}},AcpBindModle=function(e){var a=this;this.clearAd=function(){$("#cpaAddress").find("input").val(""),$("#cpaAddress").find("select").val(""),$("#cpaAddress").find("textarea").val("")},this.addRess=function(){var e=($("#addCpa-address"),$("#cpaAddressTableArs").children()),a=e.eq(0).val(),d=e.eq(1).val(),t=e.eq(2).val(),n=$("#cpaAddressTableSt").val(),r=$("#cpaAddressTableSn").val(),s=$("#cpaAddressTableZc").val(),i=$("#cpaAddressTableRm").val(),l='<tr><td class="hidden">'+r+'</td><td><i class="glyphicon glyphicon-home"style="padding-right: 20px;"></i></td><td><font>'+a+"</font><font>"+d+"</font><font>"+t+"</font><font>"+n+'</font></td><td class="hidden">'+s+'</td><td class="hidden">'+i+'</td><td style="float:rigth;"><font class="md-rate-review edit" data-toggle="modal" data-target="#cpaAddress">编辑</font><font class="md-cancel style=color:#75798B; delete">删除</font></td></tr>',o=$("#cpaAddressTableArs").children().eq(0).val(),c=$("#cpaAddressTableArs").children().eq(1).val(),p=$("#cpaAddressTableArs").children().eq(2).val(),u=$("#cpaAddressTableSt").val();if(""!=o&&""!=c&&""!=p&&""!=u)if(""!==$("#cpaAddressTableType").val()){var f=$("#cpaAddressTableType").val();$("#addCpa-address").find("tr").eq(f).replaceWith(l)}else $("#addCpa-address").append(l)},this.bind=function(){$("#cancleCpaAddressBtn").on("click",function(){a.clearAd()}),$("#cpaAddressBtn").on("click",function(){a.addRess(),a.clearAd()}),$("#addCpa-address").on("click",".edit",function(){var e=$("#addCpa-address").find("tr"),a=$(this).parent().parent().index(),d={};d={shortName:e.eq(a).find("td").eq(0).text(),province:e.eq(a).find("td").eq(2).children().eq(0).text(),city:e.eq(a).find("td").eq(2).children().eq(1).text(),district:e.eq(a).find("td").eq(2).children().eq(2).text(),street:e.eq(a).find("td").eq(2).children().eq(3).text(),zipCode:e.eq(a).find("td").eq(3).text(),remark:e.eq(a).find("td").eq(4).text()},$("#cpaAddressTableSn").val(d.shortName),$("#cpaAddressTableRm").val(d.remark),$("#cpaAddressTableZc").val(d.zipCode),$("#cpaAddressTableSt").val(d.street),$("#cpaAddressTableType").val(a),ad.setVal(d.province,d.city,d.district)}),$("#addCpa-address").on("click",".delete",function(){var e=$(this);Core.confirm({message:"确认删除吗？",confirmCallback:function(){e.parent().parent().remove()}})}),$("#addCoopAgentBtn").on("click",function(){a.submitParam(a.initParam())})},this.submitParam=function(a){if($("#addCoopAgent").jqxValidator("validate")){if(e.bool)return Core.alert({message:"用户名已存在，请重新输入！"}),!1;var d=_global_settings.service.url+"/user/savepartner";Core.AjaxRequest({url:d,type:"POST",params:a,async:!1,showMsg:!1,callback:function(e){try{setCloseAlertTimeOneSecond(),$.closeTab(),$("#coopAgentGrid").jqxGrid("updatebounddata","cells")}catch(e){}},failure:function(e){}})}},this.initParam=function(){var e={};return e.userInfo={},e.userInfo.name=$("#addCpa-company").val(),e.userInfo.telephone=$("#addCpa-phone").val(),e.userInfo.email=$("#addCpa-email").val(),e.userInfo.businessCode=$("#addCpa-busiNum").val(),e.userInfo.taxCode=$("#addCpa-taxNum").val(),e.userInfo.qq=$("#addCpa-qq").val(),e.userInfo.wechat=$("#addCpa-wx").val(),e.userInfo.remark=$("#addCpa-remark").val(),e.userInfo.ownerId=-1,e.userInfo.type="enterprise",e.userInfo.address=a.getAddress(),e.ownerId=-1,e.employeeCode=$("#addCpa-code").val(),e.docking={id:$("#addCpa-person").val()},e.username=$("#addCpa-user").val(),e.password=$("#addCpa-pwd").val(),e.oldPassword=$("#addCpa-apwd").val(),e.openBank=$("#addCpa-bank").val(),e.bankAccount=$("#addCpa-bankNumber").val(),e},this.getAddress=function(){var e=$("#addCpa-address").find("tr"),a=[];return $.each(e,function(d){var t={};t.shortName=e.eq(d).find("td").eq(0).text(),t.province=e.eq(d).find("td").eq(2).children().eq(0).text(),t.city=e.eq(d).find("td").eq(2).children().eq(1).text(),t.district=e.eq(d).find("td").eq(2).children().eq(2).text(),t.street=e.eq(d).find("td").eq(2).children().eq(3).text(),t.zipCode=e.eq(d).find("td").eq(3).text(),t.remark=e.eq(d).find("td").eq(4).text(),t.ownerId=-1,a.push(t)}),a},this.unbindAll=function(){$("#cpaAddressBtn").off("click"),$("#addCoopAgentBtn").off("click")}};