var ad=new address("editPmAddressTableArs","form-control");ad.init();var EditPmMgt=function(){var e=this;this.bool=!1,this.initInput=function(){e.getInfo(),e.initValidator()},this.getInfo=function(){Core.AjaxRequest({url:_global_settings.service.url+"/user/username/"+_global_settings.owner.username,type:"GET",async:!1,callback:function(t){e.initPage(t)},failure:function(){}})},this.initPage=function(e){$("#editPm-user").val(e.username),$("#editPm-company").val(e.userInfo.name),$("#editPm-phone").val(void 0==e.userInfo.telephone?"":e.userInfo.telephone),$("#editPm-email").val(void 0==e.userInfo.email?"":e.userInfo.email),$("#editPm-busiNum").val(void 0==e.userInfo.businessCode?"":e.userInfo.businessCode),$("#editPm-taxNum").val(void 0==e.userInfo.taxCode?"":e.userInfo.taxCode),$("#editPm-bank").val(void 0==e.openBank?"":e.openBank),$("#editPm-bankNumber").val(void 0==e.bankAccount?"":e.bankAccount),$("#editPm-qq").val(void 0==e.userInfo.qq?"":e.userInfo.qq),$("#editPm-wx").val(void 0==e.userInfo.wechat?"":e.userInfo.wechat),$("#editPm-remark").val(void 0==e.userInfo.remark?"":e.userInfo.remark),$.each(e.userInfo.address,function(e,t){var d='<tr><td class="hidden">'+t.shortName+'</td><td><i class="glyphicon glyphicon-home"style="padding-right: 20px;"></i></td><td><font>'+t.province+"</font><font>"+t.city+"</font><font>"+t.district+"</font><font>"+t.street+'</font></td><td class="hidden">'+t.zipCode+'</td><td class="hidden">'+t.remark+'</td><td style="float:rigth;"><font class="md-rate-review edit" data-toggle="modal" data-target="#editPmAddress">编辑</font><font class="md-cancel style=color:#75798B; delete">删除</font></td></tr>';$("#editPm-address").append(d)})},this.initValidator=function(){$("#personMesMgt").jqxValidator({hintType:"label",animationDuration:1,rules:[{input:"#editPm-user",message:"不能为空",action:"keyup,blur",rule:"required"},{input:"#editPm-pwd",message:"不能为空",action:"keyup,blur",rule:"required"},{input:"#editPm-pwd",message:"长度不能小于6位",action:"keyup,blur",rule:function(e,t){return!(e.val().length<6)}},{input:"#editPm-apwd",message:"不能为空",action:"keyup,blur",rule:"required"},{input:"#editPm-apwd",message:"两次输入密码不一致",action:"keyup,blur",rule:function(e,t){return e.val()==$("#editPm-pwd").val()}},{input:"#editPm-phone",message:"不能为空",action:"keyup,blur",rule:"required"},{input:"#editPm-phone",message:"联系电话格式不正确,请重新输入",action:"keyup,blur",rule:function(e,t){return!!/^1[3|4|5|7|8]\d{9}$/.test(e.val())}},{input:"#editPm-company",message:"不能为空",action:"keyup,blur",rule:"required"},{input:"#editPm-email",message:"邮箱格式不正确,请重新输入",action:"keyup,blur",rule:function(e,t){return""==e.val()||!!/^([0-9A-Za-z\-_\.]+)@([0-9a-z]+\.[a-z]{2,3}(\.[a-z]{2})?)$/g.test(e.val())}}]})}},EditPmBindModle=function(e){var t=this;this.clearAd=function(){$("#editPmAddress").find("input").val(""),$("#editPmAddress").find("select").val(""),$("#editPmAddress").find("textarea").val("")},this.addRess=function(){var e=($("#editPm-address"),$("#editPmAddressTableArs").children()),t=e.eq(0).val(),d=e.eq(1).val(),i=e.eq(2).val(),n=$("#editPmAddressTableSt").val(),a=$("#editPmAddressTableSn").val(),r=$("#editPmAddressTableZc").val(),s=$("#editPmAddressTableRm").val(),l='<tr><td class="hidden">'+a+'</td><td><i class="glyphicon glyphicon-home"style="padding-right: 20px;"></i></td><td><font>'+t+"</font><font>"+d+"</font><font>"+i+"</font><font>"+n+'</font></td><td class="hidden">'+r+'</td><td class="hidden">'+s+'</td><td style="float:rigth;"><font class="md-rate-review edit" data-toggle="modal" data-target="#editPmAddress">编辑</font><font class="md-cancel style=color:#75798B; delete">删除</font></td></tr>',o=$("#editPmAddressTableArs").children().eq(0).val(),u=$("#editPmAddressTableArs").children().eq(1).val(),m=$("#editPmAddressTableArs").children().eq(2).val(),c=$("#editPmAddressTableSt").val();if(""!=o&&""!=u&&""!=m&&""!=c)if(""!==$("#editPmAddressTableType").val()){var f=$("#editPmAddressTableType").val();$("#editPm-address").find("tr").eq(f).replaceWith(l)}else $("#editPm-address").append(l)},this.bind=function(){$("#cancleeditPmAddressBtn").on("click",function(){t.clearAd()}),$("#editPmAddressBtn").on("click",function(){t.addRess(),t.clearAd()}),$("#editPm-address").on("click",".edit",function(){var e=$("#editPm-address").find("tr"),t=$(this).parent().parent().index(),d={};d={shortName:e.eq(t).find("td").eq(0).text(),province:e.eq(t).find("td").eq(2).children().eq(0).text(),city:e.eq(t).find("td").eq(2).children().eq(1).text(),district:e.eq(t).find("td").eq(2).children().eq(2).text(),street:e.eq(t).find("td").eq(2).children().eq(3).text(),zipCode:e.eq(t).find("td").eq(3).text(),remark:e.eq(t).find("td").eq(4).text()},$("#editPmAddressTableSn").val(d.shortName),$("#editPmAddressTableRm").val(d.remark),$("#editPmAddressTableZc").val(d.zipCode),$("#editPmAddressTableSt").val(d.street),$("#editPmAddressTableType").val(t),ad.setVal(d.province,d.city,d.district)}),$("#editPm-address").on("click",".delete",function(){var e=$(this);Core.confirm({message:"确认删除吗？",confirmCallback:function(){e.parent().parent().remove()}})}),$("#editPmBtn").on("click",function(){t.submitParam(t.initParam())})},this.submitParam=function(e){if($("#personMesMgt").jqxValidator("validate")){var t=_global_settings.service.url+"/user/detailed";Core.AjaxRequest({url:t,type:"PUT",params:e,async:!1,callback:function(e){$.closeTab();try{$.addTab({title:"基本信息",isFrame:!1,url:ctx+"/page/modules/ps/viewPersonMes.html",reload:!0}),$("#viewPersonMesMgt").jqxGrid("updatebounddata","cells")}catch(e){}},failure:function(e){}})}},this.initParam=function(){var e={};return e.userInfo={},e.userInfo.name=$("#editPm-company").val(),e.userInfo.telephone=$("#editPm-phone").val(),e.userInfo.email=$("#editPm-email").val(),e.userInfo.businessCode=$("#editPm-busiNum").val(),e.userInfo.taxCode=$("#editPm-taxNum").val(),e.userInfo.qq=$("#editPm-qq").val(),e.userInfo.wechat=$("#editPm-wx").val(),e.userInfo.remark=$("#editPm-remark").val(),e.userInfo.ownerId=-1,e.userInfo.type="enterprise",e.userInfo.address=t.getAddress(),e.ownerId=-1,e.username=$("#editPm-user").val(),e.password=$("#editPm-pwd").val(),e.oldPassword=$("#editPm-apwd").val(),e.openBank=$("#editPm-bank").val(),e.bankAccount=$("#editPm-bankNumber").val(),e},this.getAddress=function(){var e=$("#editPm-address").find("tr"),t=[];return $.each(e,function(d){var i={};i.shortName=e.eq(d).find("td").eq(0).text(),i.province=e.eq(d).find("td").eq(2).children().eq(0).text(),i.city=e.eq(d).find("td").eq(2).children().eq(1).text(),i.district=e.eq(d).find("td").eq(2).children().eq(2).text(),i.street=e.eq(d).find("td").eq(2).children().eq(3).text(),i.zipCode=e.eq(d).find("td").eq(3).text(),i.remark=e.eq(d).find("td").eq(4).text(),i.ownerId=-1,t.push(i)}),t},this.unbindAll=function(){$("#editPmAddressBtn").off("click"),$("#editPmBtn").off("click")}};