var AuMgt=function(){var e=this,t=_global_settings.service.url+"/applyloan";this.debug=!1,this.id=null,this.initInput=function(){e.initPage(),e.initWindows(),e.initGrid(e.searchObj)},this.searchObj={"ap.loanResponsible":{value:[],action:"like"},"ap.projectName":{value:[],action:"like"},"ap.createDate":{value:[],action:"between"},"ap.loanState":{value:[],action:"eq"},"en.name":{value:[],action:"like"}},this.initPage=function(){$("#proAudit-show").css("display",""),$("#proAudit-time").dropDownlist({source:["请选择","最近一周","最近两周","最近三周","本月","本季度","本年"],theme:"energyblue",width:"100%",height:"34px",selectedIndex:0,dropDownHeight:150}),$("#proAudit-sTime").datetimeinput({formatString:"yyyy-MM-dd",width:"100%",height:"34px"}),$("#proAudit-eTime").datetimeinput({formatString:"yyyy-MM-dd",width:"100%",height:"34px"}),$("#proAudit-time").on("change",function(){setValueById("proAudit-time","proAudit-sTime","proAudit-eTime")}),$("#proAudit-status").dropDownlist({source:{all:"全部",Pending:"待审",Approved:"已批",Refuse:"已拒"},height:34,width:"100%",selectedIndex:0}),$("#proAudit-show").addClass("hiddendiv")},this.initWindows=function(){$("#proAuditWin").jqxWindow({theme:currentTheme,isModal:!0,autoOpen:!1,maxHeight:1e3,minHeight:450,height:"auto",minWidth:500,cancelButton:$("#proAuditCancleBtn"),initContent:function(){}}).on({close:function(){setTimeout(function(){$("#proAuditWin-opinion").val("")},500)}}),$("#viewProAuditWin").jqxWindow({theme:currentTheme,isModal:!0,autoOpen:!1,maxHeight:1e3,minHeight:350,height:"auto",minWidth:500,cancelButton:$("#viewProAuditCancleBtn"),initContent:function(){}}).on({close:function(){}})},this.initGrid=function(){e.settings.source.data=e.searchObj;var a=Core.AcDataAdapter("proAuditGrid",e.settings.source,{beforeLoadComplete:function(e){}},e.debug),r={source:a,rendergridrows:function(){return a.recordids},columns:[{text:"申请日期",dataField:"createDate",width:"14.2%"},{text:"公司名称",dataField:"companyName",width:"18.8%"},{text:"用户名",dataField:"createBy",width:"12%"},{text:"贷款负责人",dataField:"peopleName",width:"12%"},{text:"联系电话",dataField:"tel",width:"14.2%"},{text:"状态",width:"14.2%",cellsrenderer:function(e,t,i,a,r,d){return'<div class="agrid">'+getCodeData(d.loanState)+"</div>"}},{text:"操作",width:"14.2%",cellsrenderer:function(e,t,i,a,r,d){var o='<div class="text-center">';return o+='<a class="hoverspan md-verified-user paProAudit" title="审批"></a>',o+='<a class="hoverspan md-cancel deleteProAudit" title="删除"></a>',(o+='<a class="hoverspan md-description viewProAudit" title="审批历史"></a>')+"</div>"}}],pagesize:20,columnsheight:45};$("#proAuditGrid").grid(r),$("#proAuditGrid").on("click",".loadProAudit",function(){var e=$("#proAuditGrid").jqxGrid("getselectedrowindex"),t=$("#proAuditGrid").jqxGrid("getrowdata",e);window.open(_global_settings.service.url+"/common/file/"+t.fileId)}),$("#proAuditGrid").on("click",".paProAudit",function(){var t=$("#proAuditGrid").jqxGrid("getselectedrowindex"),a=$("#proAuditGrid").jqxGrid("getrowdata",t);if(e.id=a.id,"Approved"==a.loanState)return Core.alert({message:"审批状态为已批，不需要审批！"}),!1;$("#proAuditWin").jqxWindow("open"),i("proAuditWinGrid",a.remark)}),$("#proAuditGrid").on("click",".viewProAudit",function(){var t=$("#proAuditGrid").jqxGrid("getselectedrowindex"),a=$("#proAuditGrid").jqxGrid("getrowdata",t);e.id=a.id,$("#viewProAuditWin").jqxWindow("open"),i("viewProAuditWinGrid",a.remark)}),$("#proAuditGrid").on("click",".deleteProAudit",function(){var e=$("#proAuditGrid").jqxGrid("getselectedrowindex"),i=$("#proAuditGrid").jqxGrid("getrowdata",e);if("Approved"!=i.loanState)return Core.alert({message:"审批状态为"+getCodeData(i.loanState)+"，不可删除！"}),!1;Core.confirm({message:"确定要删除吗？",confirmCallback:function(){Core.AjaxRequest({url:t+"/delete/"+i.id,type:"GET",async:!1,callback:function(){$("#proAuditGrid").jqxGrid("updatebounddata","cells")}})}})})};var i=function(e,t){var i={localdata:t,datatype:"array"},a=new $.jqx.dataAdapter(i);$("#"+e).jqxGrid({source:a,width:"100%",height:160,pageable:!1,columns:[{text:"更新人",dataField:"lastUpdateBy",width:"33.3%"},{text:"备注",dataField:"remark",width:"33.3%"},{text:"更新时间",dataField:"createDate",width:"33.4%"}]})};this.settings={source:{url:t+"/page",data:e.searchObj},grid:{element:"proAuditGrid"},ajax:{url:t}},this.searchDataInfo=function(){$("#proAuditGrid").jqxGrid("applyfilters"),$("#proAuditGrid").jqxGrid("refreshfilterrow"),$("#proAuditGrid").jqxGrid("clearselection")},this.refreshDataInfo=function(){$("#proAuditGrid").jqxGrid("updatebounddata","cells"),$("#proAuditGrid").jqxGrid("clearselection"),$("#proAuditGrid").jqxGrid("refreshdata")}},AuBindModle=function(e){var t=this,i=_global_settings.service.url+"/applyloan";this.search=function(){var t=$("#proAudit-head").val(),i=$("#proAudit-proname").val(),a=$("#proAudit-sTime").val(),r=$("#proAudit-eTime").val(),d=$("#proAudit-status").val(),o=$("#proAudit-compname").val();e.searchObj["ap.loanResponsible"].value=[],""!=t&&e.searchObj["ap.loanResponsible"].value.push(t),e.searchObj["ap.projectName"].value=[],""!=i&&e.searchObj["ap.projectName"].value.push(i),e.searchObj["ap.createDate"].value=[],""!=a&&""!=r&&e.searchObj["ap.createDate"].value.push(a+" 00:00:00",r+" 23:59:59"),e.searchObj["ap.loanState"].value=[],"all"!=d&&e.searchObj["ap.loanState"].value.push(d),e.searchObj["en.name"].value=[],""!=o&&e.searchObj["en.name"].value.push(o),e.searchDataInfo()},this.bind=function(){$("#proAudit-search").on("click",function(){$("#proAudit-show").is(":hidden")?$("#proAudit-show").slideDown("slow"):t.search()}),hiddenAclick(),$("#proAuditAgreeBtn,#proAuditRejectBtn").on("click",function(){var t=$(this).attr("id"),a={};a.loanState=null,a.id=e.id,a.remark=[{remark:$("#proAuditWin-opinion").val()}],a.loanState="proAuditAgreeBtn"==t?"Approved":"Refuse",Core.AjaxRequest({url:i,type:"PUT",params:a,async:!1,callback:function(){$("#proAuditWin").jqxWindow("close"),$("#proAuditGrid").jqxGrid("updatebounddata","cells")}})})},this.unbindAll=function(){$("#proAudit-search").off("click")}};