var VoMgt=function(){var e=this;e.url=_global_settings.service.url,e.data=$.pk.data,e.name=$.pk.name,e.amount=$.pk.amount,e.orderCode=$.pk.orderCode,e.orderEndDate=$.pk.orderEndDate,e.vouchers=$.pk.vouchers,e.init=function(){e.loadList(e.data),null==e.vouchers?e.getAccountList():e.readAccountList(),e.loadEvent(),$("#orderDetailsCompanyName").text(e.name),$("#orderDetailsCode").text(e.orderCode),$("#orderDetailsSum").text(money(e.amount))},e.loadEvent=function(){$("#orderDetailsPage").on("click",".myAccount",function(t){if(null!=e.vouchers)return!1;"input"!=t.target.nodeName.toLowerCase()&&(1==$(this).find("input")[0].checked?$(this).find("input")[0].checked=!1:$(this).find("input")[0].checked=!0);var o=e.getCheckSum();if(e.amount/2>parseFloat(o))var a=parseFloat(e.amount)-parseFloat(o);else var a=e.amount/2;$("#orderDetailsSum").text(money(a))}),$("#orderDetails-search").on("click",function(){var t=$("#orderDetails-code").val();if(""==t)return Core.alert({message:"不能为空！"}),!1;Core.AjaxRequest({url:e.url+"/voucher/code/"+t,type:"GET",callback:function(e){if(null==e)return Core.alert({message:"此优惠券号码无效！"}),!1;var t=loadmyAccountList(e,!0);$("#orderDetailsMyAccountList").append(t)},failure:function(e){}})}),$("#orderDetailsBtn").on("click",function(){var t=new Object;t.amount=$("#orderDetailsSum").text(),t.orderCode=$("#orderDetailsCode").text();var o={};o.vouchers=e.getvouchers(),o.accountOrder={orderCode:t.orderCode},o.amt=t.amount,o.accountAmt=0,o.vouchertAmt=0,o.totalAmt=t.amount,Core.AjaxRequest({type:"post",params:o,async:!1,showMsg:!1,url:ws_url+"/CXF/rs/accountOrderPay/create",callback:function(e){},failure:function(e){Core.alert({message:"订单创建失败！"})}}),Core.confirm({title:"充值",message:"支付宝充值结果确认",yes:"支付完成",no:"支付失败",type:"info",confirmCallback:function(){$.closeTab();try{$("#payHistory_Grid").jqxGrid("updatebounddata","cells")}catch(e){}},cancelCallback:function(){Core.alert({message:"请联系客服"}),$.closeTab();try{$("#payHistory_Grid").jqxGrid("updatebounddata","cells")}catch(e){}}}),window.open().location=ctx+"/page/pay/pay_api.jsp?amount="+t.amount+"&orderCode="+t.orderCode})},e.getCheckSum=function(){var e=$("#orderDetailsPage").find(".myAccount"),t=0;return $.each(e,function(){1==$(this).find("input")[0].checked&&(t+=parseFloat($(this).find(".myAccountPrice").find("span").text()))}),t},e.loadList=function(e){var t=loadPayList(e);$("#orderDetailsList").html(t),1==e.accountProducts.length&&($("#orderDetailsList").find(".col-md-6").attr("class","col-md-12"),$("#orderDetailsList").find(".hight120").attr("class","hight70"))},e.loadAccountList=function(e,t){var o=loadmyAccountList(e,!0,t);$("#orderDetailsMyAccountList").html(o)},e.getvouchers=function(){var e=$(".myAccountListCheck"),t=[];return $.each(e,function(){if($(this)[0].checked){var e=JSON.parse($(this).next().text());t.push(e)}}),t},e.getAccountList=function(){var t={value:["Y"],action:"eq",key:"clientInfo.customerFlag"},t={condition:[],filterscount:0,groupscount:0,pagenum:0,pagesize:100};t.condition.push({value:["Y"],action:"eq",key:"available"},{value:["N"],action:"eq",key:"overdue"});var o=(new Base64).encode(JSON.stringify(t));Core.AjaxRequest({url:e.url+"/voucher/page/"+o,type:"GET",callback:function(t){e.loadAccountList(t.rows)},failure:function(t){e.loadAccountList()}})},e.readAccountList=function(){e.loadAccountList(e.vouchers,!0),$(".orderDetails-bar").remove(),0==e.vouchers.length&&$("#orderDetails-title").parent().parent().remove(),$("#orderDetails-title").html("已使用优惠券")}};