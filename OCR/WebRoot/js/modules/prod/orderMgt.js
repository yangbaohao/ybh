var OrderMgt=function(){var e=this,r=_global_settings.service.url+"/accountorder";this.initInput=function(){e.initPage(),e.initGrid(e.searchObj)},this.searchObj={sortdatafield:"ex.orderCreateDate","ex.loginId":{value:[],action:"like"},"ex.name":{value:[],action:"like"},"ex.orderCode":{value:[],action:"like"},"ex.orderCreateDate":{value:[],action:"between"},"ex.productName":{value:[],action:"like"},"ex.payStatus":{value:[],action:"eq"}},this.initPage=function(){$("#order-show").css("display",""),$("#order-time").dropDownlist({source:["请选择","最近一周","最近两周","最近三周","本月","本季度","本年"],theme:"energyblue",width:"100%",height:"34px",selectedIndex:0,dropDownHeight:150}),$("#order-sTime").datetimeinput({formatString:"yyyy-MM-dd",width:"100%",height:"34px"}),$("#order-eTime").datetimeinput({formatString:"yyyy-MM-dd",width:"100%",height:"34px"}),$("#order-time").on("change",function(){setValueById("order-time","order-sTime","order-eTime")}),$("#order-module").comboBox({source:ComboBoxSources.getRecords("productName"),searchMode:"contains",displayMember:"productName",valueMember:"productName",width:"100%"}),$("#order-status").dropDownlist({source:{all:"全部",give:"赠送",paid:"已支付",paying:"支付中",offline:"线下支付",fail:"支付失败"},height:34,width:"100%",selectedIndex:0}),$("#order-show").addClass("hiddendiv")},this.initGrid=function(){e.settings.source.data=e.searchObj;var r=Core.AcDataAdapter("orderMgtGrid",e.settings.source,{beforeLoadComplete:function(e){}},!1),t={source:r,rendergridrows:function(){return r.recordids},columns:[{text:"订单号",width:"18%",cellsrenderer:function(e,r,t,a,d,i){var o='<div class="agrid">';return(o+='<a class="hoverspan viewOrder">'+i.orderCode+"</a>")+"</div>"}},{text:"用户名",dataField:"loginId",width:"12%"},{text:"公司名称",dataField:"name",width:"15%"},{text:"订单模块",dataField:"productName",width:"15%"},{text:"总金额",dataField:"totalAmt",cellsalign:"left",cellsformat:"c2",width:"10%"},{text:"订单时间",width:"10%",cellsrenderer:function(e,r,t,a,d,i){return'<div class="agrid">'+i.orderCreateDate.substring(0,10)+"</div>"}},{text:"到期时间",width:"10%",cellsrenderer:function(e,r,t,a,d,i){return'<div class="agrid">'+i.orderEndDate.substring(0,10)+"</div>"}},{text:"状态",dataField:"abc",width:"10%",cellsrenderer:function(e,r,t,a,d,i){return'<div class="agrid">'+getCodeData(i.payStatus)+"</div>"}}],pagesize:20,columnsheight:45};$("#orderMgtGrid").grid(t),$("#orderMgtGrid").on("click",".viewOrder",function(){var e=$("#orderMgtGrid").jqxGrid("getselectedrowindex");if(e>=0){var r=$("#orderMgtGrid").jqxGrid("getrowdata",e),t={condition:[],filterscount:0,groupscount:0,pagenum:0,pagesize:100};t.condition.push({value:[r.id.toString()],action:"eq",key:"accountOrder.id"});var a=(new Base64).encode(JSON.stringify(t));Core.AjaxRequest({url:_global_settings.service.url+"/accountOrderPay/page/"+a,type:"GET",callback:function(e){var t=e.rows[0];$.addTab({title:"订单详情",url:"page/modules/prod/viewOrder.html",pk:{data:t.accountOrder,amount:t.totalAmt,orderCode:t.accountOrder.orderCode,vouchers:t.vouchers,name:r.name},reload:!0})},failure:function(e){}})}})},this.settings={source:{url:r+"/page",data:e.searchObj},grid:{element:"orderMgtGrid"},ajax:{url:r}},this.searchDataInfo=function(){$("#orderMgtGrid").jqxGrid("applyfilters"),$("#orderMgtGrid").jqxGrid("refreshfilterrow"),$("#orderMgtGrid").jqxGrid("clearselection")},this.refreshDataInfo=function(){$("#orderMgtGrid").jqxGrid("updatebounddata","cells"),$("#orderMgtGrid").jqxGrid("clearselection"),$("#orderMgtGrid").jqxGrid("refreshdata")}},OrderBindModle=function(e){var r=this;this.search=function(){var r=$("#order-username").val(),t=$("#order-compName").val(),a=$("#order-number").val(),d=$("#order-sTime").val(),i=$("#order-eTime").val(),o=$("#order-module").val(),s=$("#order-status").val();e.searchObj["ex.loginId"].value=[],""!=r&&e.searchObj["ex.loginId"].value.push(r),e.searchObj["ex.name"].value=[],""!=t&&e.searchObj["ex.name"].value.push(t),e.searchObj["ex.orderCode"].value=[],a&&e.searchObj["ex.orderCode"].value.push(a),e.searchObj["ex.orderCreateDate"].value=[],""!=d&&""!=i&&e.searchObj["ex.orderCreateDate"].value.push(d+" 00:00:00",i+" 23:59:59"),""!=d&&""===i&&e.searchObj["ex.orderCreateDate"].value.push(d+" 00:00:00",getNowFormatDate()+" 23:59:59"),""===d&&""!=i&&e.searchObj["ex.orderCreateDate"].value.push("2015-01-01 00:00:00",i+" 23:59:59"),e.searchObj["ex.productName"].value=[],"全部"!=o&&e.searchObj["ex.productName"].value.push(o),e.searchObj["ex.payStatus"].value=[],"all"!=s&&e.searchObj["ex.payStatus"].value.push(s),e.searchDataInfo()},this.bind=function(){$("#order-search").on("click",function(){$("#order-show").is(":hidden")?$("#order-show").slideDown("slow"):r.search()}),hiddenAclick()},this.unbindAll=function(){$("#order-search").off("click")}};