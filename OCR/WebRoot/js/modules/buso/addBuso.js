var AddBusoMgt=function(){var e=this,a=getCurrentInfo();this.initInput=function(){e.initPage(),e.initValidator()},this.initPage=function(){if($("#addBuso-sale").comboBox({source:ComboBoxSources.getRecords("salesAgent_name"),displayMember:"name_user",valueMember:"id",width:"100%"}),$("#addBuso-headname").comboBox({source:ComboBoxSources.getRecords("salesInfo_name"),displayMember:"name_user",valueMember:"id",width:"100%"}),"sys"!=a)if(a.indexOf("sale")>=0||a.indexOf("customer")>=0)a.indexOf("customer")>=0&&($("#addBuso-headname").parent().parent().find("label").text("客服"),$("#addBuso-headname").comboBox({source:ComboBoxSources.getRecords("custService_name"),displayMember:"name_user",valueMember:"id",width:"100%"})),"sales"==a&&$("#addBuso-headname").comboBox({source:ComboBoxSources.getRecords("sale_name"),displayMember:"name_user",valueMember:"id",width:"100%"}),$("#addBuso-headname").val(_global_settings.owner.userid);else{$("#addBuso-sale").val(_global_settings.owner.id);var e=getAgentInfoById(_global_settings.owner.id).sales;void 0==e?$("#addBuso-headname").val(""):$("#addBuso-headname").val(e.id)}"sys"==a&&($("#addBuso-headname").parent().parent().find("label").text("销售负责人/客服"),$("#addBuso-headname").comboBox({source:ComboBoxSources.getRecords("salesAndCust_name"),displayMember:"name_user",valueMember:"id",width:"100%"})),$("#deal-date").datetimeinput({value:new Date,formatString:"yyyy-MM-dd",height:34,width:"60%"})},this.initValidator=function(){$("#addBuso").jqxValidator({hintType:"label",animationDuration:1,rules:[{input:"#addBuso-cust",message:"不能为空",action:"keyup,blur",rule:"required"},{input:"#addBuso-phone",message:"不能为空",action:"keyup,blur",rule:"required"},{input:"#addBuso-phone",message:"联系电话格式不正确,请重新输入",action:"keyup,blur",rule:function(e,a){return!!/^1[3|4|5|7|8]\d{9}$/.test(e.val())}},{input:"#addBuso-headname",message:"请选择",action:"keyup,blur",rule:function(e,d){return"sys"==a||null!=e.jqxComboBox("getSelectedItem")}},{input:"#addBuso-sale",message:"请选择",action:"keyup,blur",rule:function(e,d){return"sys"!=a||null!=e.jqxComboBox("getSelectedItem")}},{input:"#addBuso-compName",message:"不能为空",action:"keyup,blur",rule:"required"},{input:"#addBuso-email",message:"邮箱格式不正确,请重新输入",action:"keyup,blur",rule:function(e,a){return""==e.val()||!!/^([0-9A-Za-z\-_\.]+)@([0-9a-z]+\.[a-z]{2,3}(\.[a-z]{2})?)$/g.test(e.val())}},{input:"#deal-date",message:"不能为空",action:"keyup,blur",rule:function(e,a){return""!=e.val()}}]})}},AddBusoBindModle=function(e){var a=this;this.bind=function(){$("#busoAddress-btn").off("click").on("click",function(){addRess("#addBuso-address")}),$("#addBuso-address").on("click",".edit",function(){editOrdelAddress("#addBuso-address",$(this),"edit")}),$("#addBuso-address").on("click",".delete",function(){editOrdelAddress("#addBuso-address",$(this),"delete")}),$("#addBusoBtn").on("click",function(){a.submitParam(a.initParam())})},this.submitParam=function(e){if($("#addBuso").jqxValidator("validate")){var a=_global_settings.service.url+"/potential";Core.AjaxRequest({url:a,type:"POST",params:e,async:!1,callback:function(e){$.closeTab()},failure:function(e){}})}},this.initParam=function(){var e={};e.sal=[],e.custom=[],e.potentialName=$("#addBuso-cust").val(),e.contact=$("#addBuso-compName").val(),e.phone=$("#addBuso-phone").val(),e.email=$("#addBuso-email").val(),e.comment=$("#addBuso-remark").val();var d=$("#addBuso-sale").val();if(e.salesAgent=""==d?{}:{id:$("#addBuso-sale").val()},""!=$("#addBuso-headname").val()){var s=$("#addBuso-headname").val(),t=getSalesInfoById(s),o=getCustomerInfoById(s);""!=t.name_user&&e.sal.push({id:$("#addBuso-headname").val()}),""!=o.name_user&&e.custom.push({id:$("#addBuso-headname").val()})}return e.title=$("#addBuso-work").val(),e.wechat=$("#addBuso-wx").val(),e.qq=$("#addBuso-qq").val(),e.closingDate=$("#deal-date").val(),e.address=a.getAddress(),e},this.getAddress=function(){var e=$("#addBuso-address").find("tr"),a=[];return $.each(e,function(d){var s={};s.shortName=e.eq(d).find("td").eq(0).text(),s.province=e.eq(d).find("td").eq(2).children().eq(0).text(),s.city=e.eq(d).find("td").eq(2).children().eq(1).text(),s.district=e.eq(d).find("td").eq(2).children().eq(2).text(),s.street=e.eq(d).find("td").eq(2).children().eq(3).text(),s.zipCode=e.eq(d).find("td").eq(3).text(),s.remark=e.eq(d).find("td").eq(4).text(),s.ownerId=-1,a.push(s)}),a},this.unbindAll=function(){$("#addBusoAddressBtn").off("click"),$("#addBusoBtn").off("click")}};