var PushMgt=function(){var e=this,t=_global_settings.service.url+"/informationLogs";this.initInput=function(){e.initPage(),e.initSearch(),e.initGrid(e.searchObj)},this.initPage=function(){$("#push-show").css("display",""),$("#push-time").dropDownlist({source:["请选择","最近一周","最近两周","最近三周","本月","本季度","本年"],width:"100%",height:34,selectedIndex:0}),$("#push-sTime").datetimeinput({formatString:"yyyy-MM-dd",height:34,width:"100%"}),$("#push-eTime").datetimeinput({formatString:"yyyy-MM-dd",height:34,width:"100%"}),$("#push-time").on("change",function(){setValueById("push-time","push-sTime","push-eTime")}),$("#push-show").addClass("hiddendiv"),$("#push-user").comboBox({source:ComboBoxSources.getRecords("salesInfo_name"),searchMode:"contains",displayMember:"name_user",valueMember:"username",width:"90%"})},this.getSalesByName=function(e){for(var t=ComboBoxSources.getRecords("salesInfo"),i=0;i<t.length;i++)if(t[i].username==e)return t[i];if(!e)return""},this.getCustomerByName=function(e){for(var t=ComboBoxSources.getRecords("custService"),i=0;i<t.length;i++)if(t[i].username==e)return t[i];if(!e)return""},this.initGrid=function(){e.settings.source.data=e.searchObj;var t=Core.AcDataAdapter("pushMgtGrid",e.settings.source,{beforeLoadComplete:function(e){}},!1),i={source:t,rendergridrows:function(e){return t.recordids},columns:[{text:"日期",dataField:"createDate",width:"13%"},{text:"编号",dataField:"number",width:"13%"},{text:"代推送主题",dataField:"theme",width:"20%"},{text:"推送数量",width:"10%",cellsrenderer:function(e,t,i,a,s,r){var n='<div class="agrid" title="查看详情">';return(n+='<a class="hoverspan viewPushDetail">'+r.count+"</a>")+"</div>"}},{text:"查看数量",dataField:"lookCount",width:"10%"},{text:"推送内容",width:"21%",cellsrenderer:function(e,t,i,a,s,r){return'<div class="agrid">'+r.content+"</div>"}},{text:"推送人",width:"13%",cellsrenderer:function(t,i,a,s,r,n){var u='<div class="agrid text-center" style="padding-top:6px">';return"admin"==n.username?u+="系统管理员(admin)":void 0!=e.getSalesByName(n.username)?u+=e.getSalesByName(n.username).userInfo.name+"("+n.username+")":void 0!=e.getCustomerByName(n.username)&&(u+=e.getCustomerByName(n.username).name+"("+n.username+")"),u+"</div>"}}],pagesize:20,columnsheight:45,ready:function(){}};$("#pushMgtGrid").grid(i)},this.settings={source:{url:t+"/search/page",data:e.searchObj},grid:{element:"pushMgtGrid"},ajax:{url:t}},this.searchObj={},this.initSearch=function(){e.searchObj={"il.number":{value:[],action:"like"},"il.createDate":{value:[],action:"between"},"il.theme":{value:[],action:"like"},"il.createBy":{value:[],action:"like"}}},this.searchDataInfo=function(){$("#pushMgtGrid").jqxGrid("applyfilters"),$("#pushMgtGrid").jqxGrid("refreshfilterrow"),$("#pushMgtGrid").jqxGrid("clearselection")},this.refreshDataInfo=function(){$("#pushMgtGrid").jqxGrid("updatebounddata","cells"),$("#pushMgtGrid").jqxGrid("clearselection"),$("#pushMgtGrid").jqxGrid("refreshdata")}},PushBindModle=function(e){var t=this;this.search=function(){var t=$("#push-sTime").val(),i=$("#push-eTime").val(),a=$("#push-num").val(),s=$("#push-theme").val(),r=$("#push-user").val();e.searchObj["il.createDate"].value=[],""!=t&&""!=i&&e.searchObj["il.createDate"].value.push(t+" 00:00:00",i+" 23:59:59"),""!=t&&""===i&&(e.searchObj["il.createDate"].value.push(t+" 00:00:00"),e.searchObj["il.createDate"].action="ge"),""===t&&""!=i&&(e.searchObj["il.createDate"].value.push("2015-01-01 00:00:00",i+" 23:59:59"),e.searchObj["il.createDate"].action="le"),e.searchObj["il.number"].value=[],""!=a&&e.searchObj["il.number"].value.push(a),e.searchObj["il.theme"].value=[],""!=s&&e.searchObj["il.theme"].value.push(s),e.searchObj["il.createBy"].value=[],""!=r&&e.searchObj["il.createBy"].value.push(r),e.searchDataInfo()},this.bind=function(){$("#push-search").on("click",function(){$("#push-show").is(":hidden")?$("#push-show").slideDown("slow"):t.search()}),hiddenAclick(),$("#push-send").on("click",function(){$.addTab({title:"推送代金券",url:"page/modules/buso/addPush.html",isFrame:!1,reload:!0})}),$("#pushMgtGrid").on("click",".viewPushDetail",function(){var e=$("#pushMgtGrid").jqxGrid("getselectedrowindex");if(e>=0){var t=$("#pushMgtGrid").jqxGrid("getrowdata",e);$.addTab({title:"查看详情",url:"page/modules/buso/viewPushDetail.html",isFrame:!1,pk:{number:t.number},reload:!0})}})},this.unbindAll=function(){}};