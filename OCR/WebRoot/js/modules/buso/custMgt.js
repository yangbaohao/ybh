var boolean=!0,CustMgt=function(){var t=this,e=_global_settings.service.url+"/importLog";this.custData=null,this.initInput=function(){t.initPage(),t.initWindows(),t.initGrid(t.searchObj)},this.searchObj={sortdatafield:"createDate",status:{value:[],action:"eq"},batchNum:{value:[],action:"like"},createDate:{value:[],action:"between"}},this.initPage=function(){$("#cust-show").css("display",""),$("#cust-time").dropDownlist({source:["请选择","最近一周","最近两周","最近三周","本月","本季度","本年"],theme:"energyblue",width:"100%",height:"34px",selectedIndex:0,dropDownHeight:150}),$("#cust-sTime").datetimeinput({formatString:"yyyy-MM-dd",width:"100%",height:"34px"}),$("#cust-eTime").datetimeinput({formatString:"yyyy-MM-dd",width:"100%",height:"34px"}),$("#cust-time").on("change",function(){setValueById("cust-time","cust-sTime","cust-eTime")}),$("#cust-status").dropDownlist({source:{all:"请选择",sendSuccess:"已发送",notSend:"未发送"},height:34,width:"100%",selectedIndex:0}),$("#cust-show").addClass("hiddendiv")},this.initWindows=function(){$("#custWin").jqxWindow({theme:currentTheme,isModal:!0,autoOpen:!1,maxHeight:700,minHeight:300,height:"auto",minWidth:600,maxWidth:800,cancelButton:$("#cancelCustBtn"),initContent:function(){}}).on("close",function(){setTimeout(function(){$("#custwin-zt").val(""),$("#custwin-remark").val(""),$("#custwin-phone").val("")},500)}),$("#editCustWin").jqxWindow({theme:currentTheme,isModal:!0,autoOpen:!1,maxHeight:700,minHeight:300,height:"auto",minWidth:600,maxWidth:800,cancelButton:$("#cancelEditCustBtn"),initContent:function(){}}).on("close",function(){setTimeout(function(){$("#custwin-editzt").val(""),$("#custwin-editremark").val(""),$("#custwin-editphone").val("")},500)})},this.initGrid=function(){var e=Core.AcDataAdapter("custMgtGrid",t.settings.source,{beforeLoadComplete:function(t){}},!1),i={source:e,rendergridrows:function(){return e.recordids},columns:[{text:"导入时间",width:"10%",cellsrenderer:function(t,e,i,a,s,c){return'<div class="agrid">'+c.createDate.substring(0,10)+"</div>"}},{text:"客户主题",dataField:"batchNum",width:"15%"},{text:"数量",width:"15%",cellsrenderer:function(t,e,i,a,s,c){var n='<div class="agrid" title="客户详情">';return(n+='<a class="hoverspan viewCustDet">'+c.num+"</a>")+"</div>"}},{text:"注册用户数",width:"15%",cellsrenderer:function(t,e,i,a,s,c){var n='<div class="agrid">';return(n+='<a class="hoverspan viewRegisterCust">'+c.registerNum+"</a>")+"</div>"}},{text:"备注",dataField:"remark",width:"15%"},{text:"状态",width:"15%",cellsrenderer:function(t,e,i,a,s,c){return'<div class="agrid">'+getCodeData(c.status)+"</div>"}},{text:"操作",width:"15%",cellsrenderer:function(t,e,i,a,s,c){var n='<div class="text-center">';return n+='<a class="hoverspan md-edit editCust" title="编辑"></a>',(n+='<a class="hoverspan md-archive importCust" title="导入客户"></a>')+"</div>"}}],pagesize:20,columnsheight:45};$("#custMgtGrid").grid(i),$("#custMgtGrid").on("click",".viewCustDet",function(){var t=$("#custMgtGrid").jqxGrid("getselectedrowindex");if(t>=0){var e=$("#custMgtGrid").jqxGrid("getrowdata",t);$.addTab({title:"客户详情",isFrame:!1,url:"page/modules/buso/viewCust.html",pk:{batchNum:e.batchNum,date:e.createDate},reload:!0})}}),$("#custMgtGrid").on("click",".viewRegisterCust",function(){var t=$("#custMgtGrid").jqxGrid("getselectedrowindex");if(t>=0){var e=$("#custMgtGrid").jqxGrid("getrowdata",t);$.addTab({title:"注册用户详情",isFrame:!1,url:"page/modules/buso/viewRegisterCust.html",pk:{batchNum:e.batchNum,createDate:e.createDate},reload:!0})}}),$("#custMgtGrid").on("click",".editCust",function(){boolean=!1;var e=$("#custMgtGrid").jqxGrid("getselectedrowindex");if(e>=0){var i=$("#custMgtGrid").jqxGrid("getrowdata",e);t.custData=i,$("#editCustWin").jqxWindow("open",function(){$("#custwin-editzt").val(i.batchNum),$("#custwin-editremark").val(i.remark),$("#custwin-editphone").val(i.testPhone)})}}),$("#custMgtGrid").on("click",".importCust",function(){var t=$("#custMgtGrid").jqxGrid("getselectedrowindex");if(t>=0){var e=$("#custMgtGrid").jqxGrid("getrowdata",t),i={url:_global_settings.service.url+"/common/import/potentialCustomers/"+e.id};$("#cust-attachment").html(""),$("#cust-modal").modal("show"),$("#cust-attachment").fileuploader(i)}})},this.settings={source:{url:e+"/page",data:t.searchObj},grid:{element:"custMgtGrid"},ajax:{url:e}},this.searchDataInfo=function(){$("#custMgtGrid").jqxGrid("applyfilters"),$("#custMgtGrid").jqxGrid("refreshfilterrow"),$("#custMgtGrid").jqxGrid("clearselection")},this.refreshDataInfo=function(){$("#custMgtGrid").jqxGrid("updatebounddata","cells"),$("#custMgtGrid").jqxGrid("clearselection"),$("#custMgtGrid").jqxGrid("refreshdata")}},CustBindModle=function(t){var e=this,i=_global_settings.service.url+"/importLog";this.search=function(){var e=$("#cust-status").val(),i=$("#cust-name").val(),a=$("#cust-sTime").val(),s=$("#cust-eTime").val();t.searchObj.status.value=[],"all"!=e&&t.searchObj.status.value.push(e),t.searchObj.batchNum.value=[],""!=i&&t.searchObj.batchNum.value.push(i),t.searchObj.createDate.value=[],""!=a&&""!=s&&t.searchObj.createDate.value.push(a+" 00:00:00",s+" 23:59:59"),""!=a&&""===s&&(t.searchObj.createDate.value.push(a+" 00:00:00"),t.searchObj.createDate.action="ge"),""===a&&""!=s&&(t.searchObj.createDate.value.push(s+" 23:59:59"),t.searchObj.createDate.action="le"),t.searchDataInfo()},this.bind=function(){$("#cust-search").on("click",function(){$("#cust-show").is(":hidden")?$("#cust-show").slideDown("slow"):e.search()}),hiddenAclick(),$("#cust-load").on("click",function(){window.open("template/PotentialCustomers.xls")}),$("#mes-addZt").on("click",function(){boolean=!0,$("#custWin").jqxWindow("open")}),$("#addCustSaveBtn").off("click").on("click",function(){var t={};if(t.batchNum=$("#custwin-zt").val(),t.remark=$("#custwin-remark").val(),t.testPhone=$("#custwin-phone").val(),""==t.batchNum)return Core.alert({message:"客户主题不能为空！"}),!1;for(var e=$("#custwin-phone").val().split("，"),a=0;a<e.length;a++)if(""!=e[a]&&!/^1[34578]\d{9}$/.test(e[a]))return Core.alert({message:"电话号码格式不正确。多个电话，逗号隔开"}),!1;Core.AjaxRequest({type:"POST",url:i,async:!1,params:t,callback:function(){$("#custWin").jqxWindow("close"),$("#custMgtGrid").jqxGrid("updatebounddata","cells")},failure:function(){}})}),$("#editCustSaveBtn").on("click",function(){var e={};e.id=t.custData.id,e.remark=$("#custwin-editremark").val(),e.testPhone=$("#custwin-editphone").val();for(var a=$("#custwin-editphone").val().split("，"),s=0;s<a.length;s++)if(""!=a[s]&&!/^1[34578]\d{9}$/.test(a[s]))return Core.alert({message:"电话号码格式不正确。多个电话，逗号隔开"}),!1;Core.AjaxRequest({type:"PUT",url:i,async:!1,params:e,callback:function(){$("#editCustWin").jqxWindow("close"),$("#custMgtGrid").jqxGrid("updatebounddata","cells")},failure:function(){}})})},this.unbindAll=function(){$("#cust-search").off("click"),$("#cust-load").off("click"),$("#mes-addZt").off("click"),$("#addCustSaveBtn").off("click"),$("#editCustSaveBtn").off("click")}};