var EditBusoMgt=function(){var e=this,t=getCurrentInfo();this.initInput=function(){e.data=$.pk.data,null!=e.data&&void 0!=e.data||(Core.alert({message:"data入参错误！"}),$.closeTab()),e.initPage(e.data),e.initValidator()},this.initPage=function(i){$("#editBuso-cust").val(i.potentialName),$("#editBuso-compName").val(i.contact),$("#editBuso-sale").comboBox({source:ComboBoxSources.getRecords("salesAgent_name"),displayMember:"name_user",valueMember:"id",width:"100%"}).val(void 0==i.salesAgent?$("#editBuso-sale").val(""):$("#editBuso-sale").val(i.salesAgent.id)),$("#editBuso-headname").comboBox({source:ComboBoxSources.getRecords("salesAndCust_name"),checkboxes:!0,displayMember:"name_user",valueMember:"id",width:"100%"}),"sys"!=t&&(t.indexOf("customer")>=0&&($("#editBuso-headname").parent().parent().find("label").text("客服"),$("#editBuso-headname").comboBox({source:ComboBoxSources.getRecords("custService_name"),displayMember:"name_user",valueMember:"id",width:"100%"})),"sales"==t&&$("#editBuso-headname").comboBox({source:ComboBoxSources.getRecords("sale_name"),checkboxes:!0,displayMember:"name_user",valueMember:"id",width:"100%"}));for(var a=0;a<i.sal.length;a++)$("#editBuso-headname").jqxComboBox("checkItem",i.sal[a].id);for(var a=0;a<i.custom.length;a++)$("#editBuso-headname").jqxComboBox("checkItem",i.custom[a].id);"sys"==t&&$("#editBuso-headname").parent().parent().find("label").text("销售负责人/客服"),$("#editBuso-dealdate").datetimeinput({value:i.closingDate,formatString:"yyyy-MM-dd",height:34,width:"60%"}),$("#editBuso-phone").val(i.phone),$("#editBuso-email").val(i.email),$("#editBuso-work").val(i.title),$("#editBuso-wx").val(i.wechat),$("#editBuso-qq").val(i.qq),$("#editBuso-remark").val(i.comment),e.setAddress(i.address)},this.setAddress=function(e){for(var t=0;t<e.length;t++){var i='<tr><td class="hidden">'+e[t].shortName+'</td><td><i class="glyphicon glyphicon-home"style="padding-right: 20px;"></i></td><td><font>'+e[t].province+"</font><font>"+e[t].city+"</font><font>"+e[t].district+"</font><font>"+e[t].street+'</font></td><td class="hidden">'+e[t].zipCode+'</td><td class="hidden">'+e[t].remark+'</td><td style="float:rigth;"><font class="md-rate-review edit">编辑</font><font class="md-cancel delete">删除</font></td></tr>';$("#editBuso-address").append(i)}},this.initValidator=function(){$("#editBusoPage").jqxValidator({hintType:"label",animationDuration:1,rules:[{input:"#editBuso-cust",message:"不能为空",action:"keyup,blur",rule:"required"},{input:"#editBuso-phone",message:"不能为空",action:"keyup,blur",rule:"required"},{input:"#editBuso-phone",message:"联系电话格式不正确,请重新输入",action:"keyup,blur",rule:function(e,t){return!!/^1[3|4|5|7|8]\d{9}$/.test(e.val())}},{input:"#editBuso-compName",message:"不能为空",action:"keyup,blur",rule:"required"},{input:"#editBuso-email",message:"邮箱格式不正确,请重新输入",action:"keyup,blur",rule:function(e,t){return""==e.val()||!!/^([0-9A-Za-z\-_\.]+)@([0-9a-z]+\.[a-z]{2,3}(\.[a-z]{2})?)$/g.test(e.val())}},{input:"#editBuso-dealdate",message:"不能为空",action:"keyup,blur",rule:function(e,t){return""!=e.val()}}]})}},EditBusoBindModle=function(e){var t=this;this.bind=function(){$("#editBusoAddress-btn").off("click").on("click",function(){addRess("#editBuso-address")}),$("#editBuso-address").on("click",".edit",function(){editOrdelAddress("#editBuso-address",$(this),"edit")}),$("#editBuso-address").on("click",".delete",function(){editOrdelAddress("#editBuso-address",$(this),"delete")}),$("#editBusoBtn-btn").on("click",function(){t.submitParam(t.initParam())})},this.submitParam=function(t){if($("#editBusoPage").jqxValidator("validate")){var i=_global_settings.service.url+"/potential";Core.AjaxRequest({url:i,type:"PUT",params:t,async:!1,callback:function(t){$.closeTab();try{setBuso(e.data.id),$("#busoGrid").jqxGrid("updatebounddata","cells")}catch(e){}},failure:function(){}})}},this.initParam=function(){var i={};i.sal=[],i.custom=[],i.id=e.data.id,i.potentialName=$("#editBuso-cust").val(),i.contact=$("#editBuso-compName").val(),i.phone=$("#editBuso-phone").val(),i.email=$("#editBuso-email").val(),i.comment=$("#editBuso-remark").val(),""==$("#editBuso-sale").val()||(i.salesAgent={id:$("#editBuso-sale").val()});var a=$("#editBuso-headname").jqxComboBox("getCheckedItems");if(0!=a.length)for(var d=0;d<a.length;d++){var s=a[d].originalItem.id,o=getSalesInfoById(s),n=getCustomerInfoById(s);""!=o.name_user&&i.sal.push({id:s}),""!=n.name_user&&i.custom.push({id:s})}return i.title=$("#editBuso-work").val(),i.wechat=$("#editBuso-wx").val(),i.qq=$("#editBuso-qq").val(),i.closingDate=$("#editBuso-dealdate").val(),i.address=t.getAddress(),i},this.getAddress=function(){var e=$("#editBuso-address").find("tbody").children(),t=[];return $.each(e,function(i){var a={};a.shortName=e.eq(i).find("td").eq(0).text(),a.province=e.eq(i).find("td").eq(2).children().eq(0).text(),a.city=e.eq(i).find("td").eq(2).children().eq(1).text(),a.district=e.eq(i).find("td").eq(2).children().eq(2).text(),a.street=e.eq(i).find("td").eq(2).children().eq(3).text(),a.zipCode=e.eq(i).find("td").eq(3).text(),a.remark=e.eq(i).find("td").eq(4).text(),a.ownerId=-1,t.push(a)}),t},this.unbindAll=function(){$("#editBusoAddressBtn").off("click"),$("#editBusoBtn-btn").off("click")}};