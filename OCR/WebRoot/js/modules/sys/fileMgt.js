!function(){var e=function(){var e=this,a=0,t=[],s=_global_settings.service.url;e.init=function(){$("#file-time").dropDownlist({source:{0:"请选择",1:"最近一周",2:"最近两周",3:"最近三周",4:"本月",5:"本季度",6:"本年"},selectedIndex:0,dropDownHeight:120}),$("#file-st,#file-et").datetimeinputs(),$("#file-time").on("change",function(){setValueById("file-time","file-st","file-et")}),$("#file-person").comboBox({source:ComboBoxSources.getRecords("getEmployee"),displayMember:"name",valueMember:"name"}),$("#file-search").click(function(){e.search()}),$("#file-load").click(function(){var e=s+"/SimpleAC/file/"+(new Base64).encode("toocr/order/file/"+_global_settings.owner.username);$("#file-modal").modal("show"),0==a&&$("#file-attachment").fileuploader({url:e,ownerName:_global_settings.owner.username}),a++}),e.getData(t)},e.search=function(){var a=$("#file-st").val(),s=$("#file-et").val(),n=$("#file-person").val(),i=$("#file-name").val();e.searchObj.handleDate.value=[],""!=a&&""!=s&&(e.searchObj.handleDate.value.push(a+" 00:00:00",s+" 23:59:59"),e.searchObj.handleDate.action="between"),""!=a&&""==s&&(e.searchObj.handleDate.value.push(a+" 00:00:00"),e.searchObj.handleDate.action="ge"),""==a&&""!=s&&(e.searchObj.handleDate.value.push(s+" 23:59:59"),e.searchObj.handleDate.action="le"),e.searchObj["CONCAT(userinfo.name,’(‘, logd.createBy,’)’)"].value=[],""!=n&&e.searchObj["CONCAT(userinfo.name,’(‘, logd.createBy,’)’)"].value.push(n),e.searchObj["logd.fileName"].value=[],""!=i&&e.searchObj["logd.fileName"].value.push(i);var l=e.searchObj;for(var r in l)0!=l[r].value.length&&(l[r].key=r,t.push(l[r]));e.getData(t)},e.searchObj={"CONCAT(userinfo.name,’(‘, logd.createBy,’)’)":{value:[],action:"like"},handleDate:{value:[],action:"between"},"logd.fileName":{value:[],action:"like"}},e.getData=function(a){var a=void 0==a?t:a,n={condition:a,filterscount:0,groupscount:0,sortorder:"desc",pagenum:0,pagesize:20};$("#file-list").html(""),n=JSON.stringify(n),Core.AjaxRequest({type:"get",url:s+"/overview/searchLogFileInfo/"+(new Base64).encode(n),showMsg:!1,callback:function(a){e.initFile(a)}})},window.setFile=e.getData,e.initFile=function(e){if(2==JSON.stringify(e).length){var a='<div class="time-item"><div class="item-info"><div class="text-muted"><br><a></a></div><p class="m-t-15">暂无数据</p></div></div>';return void $("#file-list").append(a)}for(var t in e){var s=e[t];if(0!=s.length){for(var n='<div class="time-item"><div class="item-info"><div class="text-muted">'+t+"<br>",i=0,l=s.length;i<l;i++){var r=s[i],o=r.data;if(n+='<div class="w30"><a title="下载" target="_blank" href="'+(ctx+"/CXF/rs/SimpleAC/down/"+(new Base64).encode("toocr/order/downFileAttachment/"+r.fileId+"/"+_global_settings.owner.username+"/Y"))+'">'+r.fileName+'</a></div><div class="w30"<span>'+getCodeData(r.handletype)+'：</span><span class="mr10">'+r.createBy+"</span></div><span>"+r.handleDate+"</span>",0!=o.length){for(var c="<div>",d=0,p=o.length;d<p;d++)1==o.length?c+="<span>"+getCodeData(o[d].handletype)+'：</span><span class="m-r-10">'+o[d].createBy+'</span><span class="m-r-10">'+o[d].handleDate+"；</span>":c+=0==d?"<span>"+getCodeData(o[d].handletype)+'：</span><span class="m-r-10">'+o[d].createBy+'</span><span class="m-r-10">'+o[d].handleDate+"；</span>":'<span class="m-r-10">'+o[d].createBy+'</span><span class="m-r-10">'+o[d].handleDate+"；</span>";c+="</div>",n+=c}else n+="<div><span></span><span></span><span></span></div>"}n+="</div></div>",$("#file-list").append(n)}else{var a='<div class="time-item"><div class="item-info"><div class="text-muted">'+t+'<br><a></a></div><p class="m-t-15">暂无数据</p></div></div>';$("#file-list").append(a)}}}};setTimeout(function(){(new e).init()},0)}();