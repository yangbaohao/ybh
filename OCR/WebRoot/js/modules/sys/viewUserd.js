var VudMgt=function(){var e=this,i=_global_settings.service.url+"/user/manage/forall/";this.data=$.pk.data,this.initInput=function(){$("#viewuserd-show").css("display",""),$("#viewuserd-show").addClass("hiddendiv"),e.initPage(),e.initGrid(e.searchObj)},this.initPage=function(){$("#viewuser-selRoleName").text(e.data.name),$("#viewuser-selUserName").text("("+e.data.username+")"),$("#viewUserdEmpWin").jqxWindow({theme:currentTheme,isModal:!0,autoOpen:!1,showCollapseButton:!1,minHeight:260,minWidth:500,resizable:!0,cancelButton:$("#cancelViewuserdEmpBtn"),initContent:function(){}})},this.initGrid=function(){e.settings.source.data=e.searchObj;var i=Core.AcDataAdapter("viewUserdGrid",e.settings.source,{beforeLoadComplete:function(e){}},e.debug),a={source:i,rendergridrows:function(e){return i.recordids},columns:[{text:"用户名",dataField:"username",width:"12.5%"},{text:"姓名",dataField:"name",width:"12.5%"},{text:"角色",dataField:"roleName",width:"12.5%"},{text:"电话",dataField:"phone",width:"12.5%"},{text:"拥有代理商",dataField:"agentNum",width:"12.5%"},{text:"成功客户",dataField:"successNum",width:"12.5%"},{text:"付费客户",dataField:"payNum",width:"12.5%"},{text:"操作",width:"12.5%",align:"center",cellsrenderer:function(e,i,a,s,t,r){var n='<div class="text-center">';return(n+='<a class="hoverspan md-cancel deleteUserdBtn" title="删除"></a>')+"</div>"}}],pagesize:20,columnsheight:45,ready:function(){}};$("#viewUserdGrid").grid(a)},this.settings={source:{url:i+e.data.userid,data:e.searchObj},grid:{element:"viewUserdGrid"},ajax:{url:i}},this.searchObj={"u.username":{value:[],action:"like"},"u.userInfo.name":{value:[],action:"like"},"u.userInfo.telephone":{value:[],action:"like"}},this.searchDataInfo=function(){$("#viewUserdGrid").jqxGrid("applyfilters"),$("#viewUserdGrid").jqxGrid("refreshfilterrow"),$("#viewUserdGrid").jqxGrid("clearselection")}},VudBindModle=function(e){var i=this,a=_global_settings.service.url+"/user/userParentCode/byId";this.search=function(){var i=$("#viewuserd-username").val(),a=$("#viewuserd-name").val(),s=$("#viewuserd-phone").val();e.searchObj["u.username"].value=[],""!=i&&e.searchObj["u.username"].value.push(i),e.searchObj["u.userInfo.name"].value=[],""!=a&&e.searchObj["u.userInfo.name"].value.push(a),e.searchObj["u.userInfo.telephone"].value=[],""!=s&&e.searchObj["u.userInfo.telephone"].value.push(s),e.searchDataInfo()};var s=function(e){Core.AjaxRequest({url:_global_settings.service.url+"/common/manage/"+e,type:"GET",showMsg:!1,async:!1,callback:function(e){$("#viewuserd-emp").dropDownlist({theme:currentTheme,source:e,searchMode:"contains",displayMember:"username",valueMember:"id",height:34,width:"100%",checkboxes:!0,placeHolder:""})}})};this.bind=function(){$("#viewUserdGrid").off("click").on("click",".deleteUserdBtn",function(){var e=$("#viewUserdGrid").jqxGrid("getselectedrowindex");if(e>=0){var i=$("#viewUserdGrid").jqxGrid("getrowdata",e);Core.confirm({message:"确定要解绑员工："+i.username+"("+i.name+")",confirmCallback:function(){Core.AjaxRequest({type:"PUT",url:a,params:{id:i.id},async:!1,showMsg:!1,callback:function(){setCloseAlertTimeOneSecond(),$("#viewUserdGrid").jqxGrid("updatebounddata","cells")}})}})}}),$("#viewuserd-search").on("click",function(){$("#viewuserd-show").is(":hidden")?$("#viewuserd-show").slideDown("slow"):i.search()}),hiddenAclick(),$("#viewuserd-fp").on("click",function(){$("#viewUserdEmpWin").jqxWindow("open",function(){$("#viewuserd-uname").text(e.data.username),s("salesManage"==e.data.roleName?"sales":"customerManage"==e.data.roleName?"customer":"secondLevelSalesManage"==e.data.roleName?"secondLevelSalesManage":"secondLevelCustomerManage")})}),$("#viewuserdSaveBtn").on("click",function(){var i=[],a=$("#viewuserd-emp").jqxDropDownList("getCheckedItems");$.each(a,function(e){var s={};s.id=a[e].originalItem.id,i.push(s)}),Core.AjaxRequest({url:_global_settings.service.url+"/user/gaveup/"+e.data.userid,type:"PUT",params:i,async:!1,showMsg:!1,callback:function(){try{setCloseAlertTimeOneSecond(),$("#viewUserdEmpWin").jqxWindow("close",function(){$("#viewuserd-name").text(""),$("#viewuserd-emp").jqxDropDownList("uncheckAll")}),$("#viewUserdGrid").jqxGrid("updatebounddata","cells")}catch(e){}}})})},this.unbindAll=function(){$("#viewuserd-search").off("click"),$("#viewuserd-fp").off("click"),$("#viewuserdSaveBtn").off("click")}};