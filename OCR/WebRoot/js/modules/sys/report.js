var Report=function(){var e=this,t=_global_settings.service.url,a=0,r=[];this.initInput=function(){e.initSearch(),e.init()},this.init=function(){$("#report-show").css("display",""),$("#report_date").val("createDate"),$("#report-user").comboBox({source:ComboBoxSources.getRecords("getEmployee")}),$("#report-role").dropDownlist({source:["制单人","审核人"],dropDownHeight:60,selectedIndex:0}),$("#report-mins").dropDownlist({source:{avgTime:"平均制单时长(min)",checkTimeNumber:"平均审单时长(min)"},dropDownHeight:60,selectedIndex:0}),$("#report-time").dropDownlist({source:{0:"请选择",1:"最近一周",2:"最近两周",3:"最近三周",4:"本月",5:"本季度",6:"本年"},selectedIndex:0,dropDownHeight:120}),$("#report-st,#report-et").datetimeinputs(),$("#report-time").on("change",function(){setValueById("report-time","report-st","report-et")}),$("#report-nums").dropDownlist({source:{detailQty:"平均制单产品数",kfreject:"制单驳回单数",checkFailed:"审核拒绝单数",checkRefused:"客户驳回单数",khbackout:"客户撤销单数",total:"制单数量"},selectedIndex:0}),$("#report-role").on("select",function(){var t=$(this).val();for(var r in e.searchObj)e.searchObj[r].value=[];$("#report-show").find("input").val(""),"制单人"==t?(a=0,$("#report_date").val("createDate"),$("#report-mins").val("avgTime"),$("#checkTable").parent().addClass("hide"),$("#createTable").parent().removeClass("hide"),$("#createTable").html(""),$("#report-nums").dropDownlist({source:{detailQty:"平均制单产品数",kfreject:"制单驳回单数",checkFailed:"审核拒绝单数",checkRefused:"客户驳回单数",khbackout:"客户撤销单数",total:"制单数量"},selectedIndex:0}),e.initCreate()):(a=0,$("#report_date").val("checkDate"),$("#report-mins").val("checkTimeNumber"),$("#createTable").parent().addClass("hide"),$("#checkTable").parent().removeClass("hide"),$("#checkTable").html(""),$("#report-nums").dropDownlist({source:{checkDetailQtyNumber:"平均审单产品数",checkAgainRefusedNumber:"复核拒绝单数",checkRefusedNumber:"审核拒绝单数",khrefusedNumber:"客户驳回单数",khbackOutNumber:"客户撤销单数",checkNumber:"审单数量"},selectedIndex:0}),e.initCheck())}),$("#report-show").addClass("hiddendiv"),e.search(),e.initCreate(),e.mouseWheel()},this.searchObj={},this.initSearch=function(){e.searchObj={username:{value:[],action:"like"},detailQty:{value:[],action:"between"},kfreject:{value:[],action:"between"},checkFailed:{value:[],action:"between"},checkRefused:{value:[],action:"between"},khbackout:{value:[],action:"between"},total:{value:[],action:"between"},avgTime:{value:[],action:"between"},createDate:{value:[],action:"between"},checkTimeNumber:{value:[],action:"between"},checkDetailQtyNumber:{value:[],action:"between"},checkAgainRefusedNumber:{value:[],action:"between"},checkRefusedNumber:{value:[],action:"between"},khrefusedNumber:{value:[],action:"between"},khbackOutNumber:{value:[],action:"between"},checkNumber:{value:[],action:"between"},checkDate:{value:[],action:"between"}}},this.mouseWheel=function(){$(document).on("mousewheel",function(t){var a=$(window).height(),r=$(window).scrollTop(),c=$(document).height();c-a-r>=0&&c-a-r<1&&($("#createTable").parent().is(":visible")&&e.initCreate(!0),$("#checkTable").parent().is(":visible")&&e.initCheck(!0))})},this.initCreate=function(a){if(a)return void e.initCreateTable(r);var c={condition:[],filterscount:0,groupscount:0,pagenum:0,pagesize:1e4},i=e.searchObj;for(var n in i){0!=i[n].value.length&&(i[n].key=n,c.condition.push(i[n]))}Core.AjaxRequest({url:t+"/report/search/creater/"+(new Base64).encode(JSON.stringify(c)),type:"get",showMsg:!1,callback:function(t){r=t.rows,e.initCreateTable(t.rows)},failure:function(){r=[],e.initCreateTable([])}})},this.initCheck=function(a){if(a)return void e.initCheckTable(r);var c={condition:[],filterscount:0,groupscount:0,pagenum:0,pagesize:1e4},i=e.searchObj;for(var n in i){0!=i[n].value.length&&(i[n].key=n,c.condition.push(i[n]))}Core.AjaxRequest({url:t+"/report/search/checker/"+(new Base64).encode(JSON.stringify(c)),type:"get",showMsg:!1,callback:function(t){r=t.rows,e.initCheckTable(t.rows)},failure:function(){r=[],e.initCheckTable([])}})},this.initCreateTable=function(e){var t=length=e.length;if(0==t&&0==a)return $("#createTable").html('<tr><td colspan="11">暂无数据</td></tr>'),void a++;if(!(a>=length)){t=a+30>=length?length:a+30;for(var r="",c=a;c<t;c++){var i=e[c];r+='<tr class="text-center"><td>'+i.username+"</td><td>"+i.type+"</td><td>"+i.total+"</td><td>"+i.kfreject+"</td><td>"+i.checkFailed+"</td><td>"+i.checkAgainFailed+"</td><td>"+i.checkRefused+"</td><td>"+i.khbackout+"</td><td>"+(void 0==i.detailQty?"-":i.detailQty)+"</td><td>"+(void 0==i.avgTime?"-":i.avgTime)+"</td><td>制单明细</td></tr>"}a+=30,$("#createTable").html(r)}},this.initCheckTable=function(e){var t=length=e.length;if(0==t&&0==a)return $("#checkTable").html('<tr><td colspan="10">暂无数据</td></tr>'),void a++;if(!(a>=length)){t=a+30>=length?length:a+30;for(var c="",i=0;i<t;i++){var n=r[i];c+='<tr class="text-center"><td>'+n.username+"</td><td>"+n.type+"</td><td>"+n.checkNumber+"</td><td>"+n.checkRefusedNumber+"</td><td>"+n.checkAgainRefusedNumber+"</td><td>"+n.khrefusedNumber+"</td><td>"+n.khbackOutNumber+"</td><td>"+(void 0==n.checkDetailQtyNumber?"-":n.checkDetailQtyNumber)+"</td><td>"+(void 0==n.checkTimeNumber?"-":n.checkTimeNumber)+"</td><td>制单明细</td></tr>"}a+=30,$("#checkTable").html(c)}},this.search=function(){$("#report-search").off("click").on("click",function(){$("#report-show").is(":hidden")?$("#report-show").slideDown("slow"):(a=0,$("#createTable").html(""),$("#checkTable").html(""),e.searchData())}),hiddenAclick()},this.searchData=function(){var t=$("#report-user").val(),a=$("#report-mins").val(),r=$("#report-smin").val(),c=$("#report-emin").val(),i=$("#report-snum").val(),n=$("#report-enum").val(),o=$("#report-nums").val(),s=$("#report_date").val(),l=$("#report-st").val(),h=$("#report-et").val();for(var u in e.searchObj)e.searchObj[u].value=[];""!=t&&e.searchObj.username.value.push(t),""!=r&&""!=c&&(e.searchObj[a].value.push(r,c),e.searchObj[a].action="between"),""!=r&&""==c&&(e.searchObj[a].value.push(r),e.searchObj[a].action="ge"),""==r&&""!=c&&(e.searchObj[a].value.push(c),e.searchObj[a].action="le"),""!=i&&""!=n&&(e.searchObj[o].value.push(i,n),e.searchObj[o].action="between"),""!=i&&""==n&&(e.searchObj[o].value.push(i),e.searchObj[o].action="ge"),""==i&&""!=n&&(e.searchObj[o].value.push(n),e.searchObj[o].action="le"),""!=l&&""!=h&&(e.searchObj[s].value.push(l+" 00:00:00",h+" 23:59:59"),e.searchObj[s].action="between"),""!=l&&""==h&&(e.searchObj[s].value.push(l+" 00:00:00"),e.searchObj[s].action="ge"),""==l&&""!=h&&(e.searchObj[s].value.push(h+" 23:59:59"),e.searchObj[s].action="le"),$("#createTable").parent().is(":visible")&&e.initCreate(),$("#checkTable").parent().is(":visible")&&e.initCheck()}};