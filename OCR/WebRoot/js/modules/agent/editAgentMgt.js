var EditAgentMgt=function(){var e=this;this.data=null,this.initInput=function(){e.data=$.pk.data,void 0!=e.data&&null!=e.data||Core.alert({message:"data入参错误！"}),e.initPage(e.data),e.initValidator()},this.initPage=function(e){$("#editAgent-head").comboBox({source:ComboBoxSources.getRecords("salesInfo_name"),displayMember:"name_user",valueMember:"id",width:"100%"}).jqxComboBox({disabled:!0}).val(void 0==e.sales?"":e.sales.id),$("#editAgent-cust").comboBox({source:ComboBoxSources.getRecords("custService_name"),displayMember:"name_user",valueMember:"id",width:"100%"}).jqxComboBox({disabled:!0}).val(void 0==e.customer?"":e.customer.id),"enterprise"==e.type?($("#editAgent-type").val("enterprise"),$("#editAgent-compName").val(e.userInfo.name),$("#editAgent-busi").val(e.userInfo.businessCode),$("#editAgent-tax").val(e.userInfo.taxCode)):($("#editAgentSex").css("display",""),$("#editAgentComp").css("display","none"),$("#editAgentName").css("display",""),$("#editAgentBusi").css("display","none"),$("#editAgentTax").css("display","none"),$("#editAgentCert-type").css("display",""),$("#editAgentCert-number").css("display",""),$("#enterprise-editqq").css("display","none"),$("#enterprise-editwx").css("display","none"),$("#edit-qq").css("display",""),$("#edit-wx").css("display",""),$("#editAgent-type").val("person"),"nan"==e.userInfo.salutation?$("#editAgent-sex").val("nan"):"nv"==e.userInfo.salutation?$("#editAgent-sex").val("nv"):$("#editAgent-sex").val(""),$("#editAgent-name").val(e.userInfo.name),$("#editAgent-certType").val(e.userInfo.certificateType),$("#editAgent-certNumber").val(e.userInfo.certificateId)),$("#editAgent-type").attr("disabled","disabled"),$("#editAgent-number").val(e.agentCode),$("#editAgent-userName").val(e.agentName),$("#editAgent-bank").val(e.openBank),$("#editAgent-bankNumber").val(e.bankAccount),$("#editAgent-phone").val(e.userInfo.telephone),$("#editAgent-eamil").val(e.userInfo.email),$("#editAgent-qq").val(e.userInfo.qq),$("#editAgent-wx").val(e.userInfo.wechat),$("#editAgent-remark").val(e.userInfo.remark),$.each(e.userInfo.address,function(e,t){var n='<tr><td class="hidden">'+t.shortName+'</td><td><i class="glyphicon glyphicon-home"style="padding-right: 20px;"></i></td><td><font>'+t.province+"</font><font>"+t.city+"</font><font>"+t.district+"</font><font>"+t.street+'</font></td><td class="hidden">'+t.zipCode+'</td><td class="hidden">'+t.remark+'</td><td style="float:rigth;"><font class="md-rate-review edit">编辑</font><font class="md-cancel delete">删除</font></td></tr>';$("#editAgent-address").append(n)})},this.initValidator=function(){$("#editAgentMgt").jqxValidator({hintType:"label",animationDuration:1,rules:[{input:"#editAgent-sex",message:"请选择",action:"keyup,blur",rule:function(e,t){return"person"!=$("#editAgent-type").val()||null!=e.val()}},{input:"#editAgent-phone",message:"不能为空",action:"keyup,blur",rule:"required"},{input:"#editAgent-phone",message:"联系电话格式不正确,请重新输入",action:"keyup,blur",rule:function(e,t){return!!/^1[3|4|5|7|8]\d{9}$/.test(e.val())}},{input:"#editAgent-pw",message:"不能为空",action:" keyup,blur",rule:"required"},{input:"#editAgent-pw",message:"长度不能小于6位",action:" keyup,blur",rule:function(e,t){return!(e.val().length<6)}},{input:"#editAgent-apw",message:"不能为空",action:" keyup,blur",rule:"required"},{input:"#editAgent-apw",message:"两次输入密码不一致",action:" keyup,blur",rule:function(e,t){return e.val()==$("#editAgent-pw").val()}},{input:"#editAgent-eamil",message:"邮箱格式不正确,请重新输入",action:"keyup,blur",rule:function(e,t){return""==e.val()||!!/^([0-9A-Za-z\-_\.]+)@([0-9a-z]+\.[a-z]{2,3}(\.[a-z]{2})?)$/g.test(e.val())}},{input:"#editAgent-certNumber",message:"请选择",action:"keyup,blur",rule:function(e,t){return"enterprise"==$("#editAgent-type").val()||""!=e.val()}}]})}},EditAgentBindModle=function(e){var t=this;this.bind=function(){$("#editaddress-btn").off("click").on("click",function(){addRess("#editAgent-address")}),$("#editAgent-address").on("click",".edit",function(){editOrdelAddress("#editAgent-address",$(this),"edit")}),$("#editAgent-address").on("click",".delete",function(){editOrdelAddress("#editAgent-address",$(this),"delete")}),$("#editAgentBtn-btn").on("click",function(){t.submitEditParam(t.initEditParam())})},this.submitEditParam=function(t){if($("#editAgentMgt").jqxValidator("validate")){var n=_global_settings.service.url+"/salesagent/1";Core.AjaxRequest({params:t,type:"PUT",url:n,async:!1,callback:function(t){try{$.closeTab(),getAgentById(e.data.id),getId(_global_settings.owner.userinfoid),$("#agentGrid").jqxGrid("updatebounddata","cells"),ComboBoxSources.load("salesAgent")}catch(e){}},failure:function(e){}})}},this.initEditParam=function(){var n=e.data.parentAgentCode,i={};return i.user={},i.userInfo={},i.sales={},i.customer={},i.id=e.data.id,i.type=$("#editAgent-type").val(),i.agentCode=$("#editAgent-number").val(),i.senior=e.data.senior,void 0==i.senior&&(i.senior=null),i.parentAgentCode=void 0==n?null:n,"person"==i.type?(i.userInfo.name=$("#editAgent-name").val(),i.userInfo.salutation=$("#editAgent-sex").val(),i.userInfo.certificateType=$("#editAgent-certType").val(),i.userInfo.certificateId=$("#editAgent-certNumber").val()):(i.userInfo.name=$("#editAgent-compName").val(),i.userInfo.businessCode=$("#editAgent-busi").val(),i.userInfo.taxCode=$("#editAgent-tax").val()),i.openBank=$("#editAgent-bank").val(),i.bankAccount=$("#editAgent-bankNumber").val(),i.rate=e.data.rate,i.userInfo.type=$("#editAgent-type").val(),i.agentName=$("#editAgent-userName").val(),i.userInfo.email=$("#editAgent-eamil").val(),i.userInfo.remark=$("#editAgent-remark").val(),i.userInfo.telephone=$("#editAgent-phone").val(),i.userInfo.qq=$("#editAgent-qq").val(),i.userInfo.wechat=$("#editAgent-wx").val(),i.userInfo.id=e.data.userInfo.id,i.userInfo.ownerId=-1,i.sales.id=$("#editAgent-head").val(),i.customer.id=$("#editAgent-cust").val(),i.user.ownerId=-1,i.user.id=e.data.user.id,i.user.username=$("#editAgent-userName").val(),i.user.password=$("#editAgent-pw").val(),i.user.oldPassword=$("#editAgent-apw").val(),i.user.roles=[{id:2}],i.userInfo.address=t.getAddress(),i},this.getAddress=function(){var e=$("#editAgent-address").find("tr"),t=[];return $.each(e,function(n){var i={};i.shortName=e.eq(n).find("td").eq(0).text(),i.province=e.eq(n).find("td").eq(2).children().eq(0).text(),i.city=e.eq(n).find("td").eq(2).children().eq(1).text(),i.district=e.eq(n).find("td").eq(2).children().eq(2).text(),i.street=e.eq(n).find("td").eq(2).children().eq(3).text(),i.zipCode=e.eq(n).find("td").eq(3).text(),i.remark=e.eq(n).find("td").eq(4).text(),i.ownerId=-1,t.push(i)}),t},this.unbindAll=function(){$("#editAgentBtn-btn").off("click"),$("#editAgentMgtAddressBtn").off("click"),$("#editAgentCancleAddressBtn").off("click")}};