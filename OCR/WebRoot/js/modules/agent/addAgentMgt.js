var AddAgentMgt=function(){var e=this;this.boolean=!1,this.initInput=function(){e.initPage(),e.judgeName(),e.initValidator()},this.judgeName=function(){$("#addAgent-userName").on("blur",function(){var n=$(this).val();""!=n&&Core.AjaxRequest({url:_global_settings.service.url+"/user/repeat/"+n,type:"GET",showMsg:!1,async:!1,callback:function(n){e.boolean=n,n&&Core.alert({message:"用户名已被使用！"})}})})},this.initPage=function(){$("#addAgent-head").comboBox({source:ComboBoxSources.getRecords("salesInfo_name"),displayMember:"name_user",valueMember:"id",width:"100%"}),$("#addAgent-cust").comboBox({source:ComboBoxSources.getRecords("custService_name"),displayMember:"name_user",valueMember:"id",width:"100%"});var e=getCurrentInfo();e.indexOf("sale")>=0&&$("#addAgent-head").jqxComboBox({disabled:!0}).val(_global_settings.owner.userid),e.indexOf("customer")>=0&&$("#addAgent-cust").jqxComboBox({disabled:!0}).val(_global_settings.owner.userid),$("#addAgent-type").on("change",function(){"person"==$(this).val()?($("#person-qq").css("display",""),$("#person-wx").css("display",""),$("#addAgentSex").css("display",""),$("#addAgentName").css("display",""),$("#addAgentCert-type").css("display",""),$("#addAgentCert-number").css("display",""),$("#addAgentComp").css("display","none"),$("#addAgentBusi").css("display","none"),$("#addAgentTax").css("display","none"),$("#entryprise-qq").css("display","none"),$("#entryprise-wx").css("display","none")):($("#person-qq").css("display","none"),$("#person-wx").css("display","none"),$("#addAgentSex").css("display","none"),$("#addAgentName").css("display","none"),$("#addAgentCert-type").css("display","none"),$("#addAgentCert-number").css("display","none"),$("#addAgentComp").css("display",""),$("#addAgentBusi").css("display",""),$("#addAgentTax").css("display",""),$("#entryprise-qq").css("display",""),$("#entryprise-wx").css("display",""))}),Core.AjaxRequest({url:_global_settings.service.url+"/salesagent/getcode/agentcode",type:"GET",dataType:"text",async:!1,callback:function(e){$("#addAgent-number").val(e)},failure:function(){}})},this.initValidator=function(){$("#addAgentMgt").jqxValidator({hintType:"label",animationDuration:1,rules:[{input:"#addAgent-userName",message:"不能为空",action:"keyup,blur",rule:"required"},{input:"#addAgent-userName",message:"用户名只能是数字，字母，下划线",action:"keyup,blur",rule:function(e,n){return!!/^[A-Za-z0-9_]+$/.test(e.val())}},{input:"#addAgent-head",message:"请选择",action:"keyup,blur",rule:function(e,n){return""==e.val()||null!=e.jqxComboBox("getSelectedItem")}},{input:"#addAgent-cust",message:"请选择",action:"keyup,blur",rule:function(e,n){return""==e.val()||null!=e.jqxComboBox("getSelectedItem")}},{input:"#addAgent-pw",message:"不能为空",action:"keyup,blur",rule:"required"},{input:"#addAgent-pw",message:"长度不能小于6位",action:"keyup,blur",rule:function(e,n){return!(e.val().length<6)}},{input:"#addAgent-apw",message:"不能为空",action:"keyup,blur",rule:"required"},{input:"#addAgent-apw",message:"两次输入密码不一致",action:"keyup,blur",rule:function(e,n){return e.val()==$("#addAgent-pw").val()}},{input:"#addAgent-phone",message:"不能为空",action:"keyup,blur",rule:"required"},{input:"#addAgent-phone",message:"格式不正确",action:"keyup,blur",rule:function(e,n){return!!/^1[3|4|5|7|8]\d{9}$/.test(e.val())}},{input:"#addAgent-eamil",message:"格式不正确",action:"keyup,blur",rule:function(e,n){return""==e.val()||!!/^([a-z0-9A-Z]+[-|\\.]?)+[a-z0-9A-Z]@([a-z0-9A-Z]+(-[a-z0-9A-Z]+)?\\.)+[a-zA-Z]{2,}$/.test(e.val())}},{input:"#addAgent-certNumber",message:"不能为空",action:"keyup,blur",rule:function(e,n){return"enterprise"==$("#addAgent-type").val()||""!=e.val()}}]})}},AddAgentBindModle=function(e){var n=this;this.bind=function(){$("#addaddress-btn").off("click").on("click",function(){addRess("#addAgent-address")}),$("#addAgent-address").on("click",".edit",function(){editOrdelAddress("#addAgent-address",$(this),"edit")}),$("#addAgent-address").on("click",".delete",function(){editOrdelAddress("#addAgent-address",$(this),"delete")}),$("#addAgentBtn").on("click",function(){n.submitParam(n.initParam())})},this.submitParam=function(n){if(e.boolean)return Core.alert({message:"用户名已被使用！"}),!1;if($("#addAgentMgt").jqxValidator("validate")){var a=_global_settings.service.url+"/salesagent/save";Core.AjaxRequest({params:n,type:"POST",url:a,async:!1,callback:function(e){$.closeTab();try{$("#agentGrid").jqxGrid("updatebounddata","cells"),ComboBoxSources.load("salesAgent")}catch(e){}},failure:function(e){}})}},this.initParam=function(){var e={};return e.user={},e.userInfo={},e.sales={},e.customer={},e.type=$("#addAgent-type").val(),e.agentCode=$("#addAgent-number").val(),e.agentName=$("#addAgent-userName").val(),"person"==e.type?(e.userInfo.name=$("#addAgent-name").val(),e.userInfo.salutation=$("#addAgent-sex").val(),e.userInfo.certificateType=$("#addAgent-certType").val(),e.userInfo.certificateId=$("#addAgent-certNumber").val()):(e.userInfo.name=$("#addAgent-compName").val(),e.userInfo.businessCode=$("#addAgent-busi").val(),e.userInfo.taxCode=$("#addAgent-tax").val()),e.openBank=$("#addAgent-bank").val(),e.bankAccount=$("#addAgent-bankNumber").val(),e.userInfo.type=$("#addAgent-type").val(),e.userInfo.email=$("#addAgent-eamil").val(),e.userInfo.remark=$("#addAgent-remark").val(),e.userInfo.telephone=$("#addAgent-phone").val(),e.userInfo.qq=$("#addAgent-qq").val(),e.userInfo.wechat=$("#addAgent-wx").val(),e.userInfo.ownerId=-1,e.user.ownerId=-1,e.user.username=$("#addAgent-userName").val(),e.user.password=$("#addAgent-pw").val(),e.user.oldPassword=$("#addAgent-apw").val(),e.user.roles=[{id:2}],e.userInfo.address=n.getAddress(),e.sales.id=$("#addAgent-head").val(),e.customer.id=$("#addAgent-cust").val(),e},this.getAddress=function(){var e=$("#addAgent-address").children().children(),n=[];return $.each(e,function(a){var t={};t.shortName=e.eq(a).find("td").eq(0).text(),t.province=e.eq(a).find("td").eq(2).children().eq(0).text(),t.city=e.eq(a).find("td").eq(2).children().eq(1).text(),t.district=e.eq(a).find("td").eq(2).children().eq(2).text(),t.street=e.eq(a).find("td").eq(2).children().eq(3).text(),t.zipCode=e.eq(a).find("td").eq(3).text(),t.remark=e.eq(a).find("td").eq(4).text(),t.ownerId=-1,n.push(t)}),n},this.unbindAll=function(){$("#addAgentBtn").off("click")}};