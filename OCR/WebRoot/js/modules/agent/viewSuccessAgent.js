var SuccessAgent=function(){var e=this,t=null,s=null,n=null,c=_global_settings.service.url+"/salesagent/ownerdetails/";this.debug=!1,this.userData=null,this.initInput=function(){t=$.pk.agentCode,n=$.pk.id,s=$.pk.agentName,e.initUserPage(),e.initSearch(),e.initGrid(e.searchObj),$("#successAgentName").html(s)},this.initUserPage=function(){$("#successAgent-show").css("display",""),$("#successAgent-time").jqxDropDownList({source:["请选择","最近一周","最近两周","最近三周","本月","本季度","本年"],theme:"energyblue",width:"100%",height:"34px",selectedIndex:0,dropDownHeight:150}),$("#successAgent-sTime").datetimeinput({formatString:"yyyy-MM-dd",width:"100%",height:"34px"}),$("#successAgent-eTime").datetimeinput({formatString:"yyyy-MM-dd",width:"100%",height:"34px"}),$("#successAgent-time").on("change",function(){setValueById("successAgent-time","successAgent-sTime","successAgent-eTime")});for(var e=ComboBoxSources.getRecords("userInfo"),t=["全部"],s=["全部"],i=0;i<e.length;i++)t.push(e[i].username),s.push(e[i].name);$("#successAgent-name").comboBox({theme:currentTheme,source:t,height:34,width:"100%",selectedIndex:0}),$("#successAgent-compName").comboBox({theme:currentTheme,source:s,height:34,width:"100%",selectedIndex:0}),$("#viewSuccessAgentRemarkWin").jqxWindow({theme:currentTheme,isModal:!0,autoOpen:!1,maxHeight:1e3,minHeight:420,height:"auto",minWidth:500,cancelButton:$("#SuccessAgentRemarkCancleBtn"),initContent:function(){}}).on({close:function(){setTimeout(function(){},500)}}),$("#successAgent-show").addClass("hiddendiv")},this.getSalesInfo=function(e){var t=ComboBoxSources.getRecords("salesInfo");for(i=0;i<t.length;i++)if(e==t[i].employeeCode)return t[i];if(!e)return""},this.getCustService=function(e){var t=ComboBoxSources.getRecords("custService");for(i=0;i<t.length;i++)if(e==t[i].employeeCode)return t[i];if(!e)return""},this.initGrid=function(){e.settings.source.data=e.searchObj,e.settings.source.url=c+"success/"+t;var s=Core.AcDataAdapter("successAgentGrid",e.settings.source,{beforeLoadComplete:function(e){}},e.debug),n={columnsresize:!1,autorowheight:!0,source:s,rendergridrows:function(){return s.records},columns:[{text:"日期",dataField:"createDate",width:"10%"},{text:"用户名",dataField:"loginId",width:"15%"},{text:"电话号码",dataField:"regTelephone",width:"10%"},{text:"公司名称",dataField:"name",width:"15%"},{text:"累计购买金额",dataField:"totalAmt",cellsalign:"right",cellsformat:"c2",width:"9%"},{text:"销售负责人(姓名/用户名)",width:"12%",cellsrenderer:function(e,t,s,n,c,r){var a='<div class="agrid">',o=function(e){var t=ComboBoxSources.getRecords("salesInfo");for(i=0;i<t.length;i++)if(e==t[i].username)return t[i];if(!e)return""};return void 0!=o(r.xs)&&""!=o(r.xs)&&null!=o(r.xs)?a+=o(r.xs).userInfo.name+"("+o(r.xs).username+")":a+=r.xs,a+"</div>"}},{text:"客服人员(姓名/用户名)",width:"12%",cellsrenderer:function(e,t,s,n,c,r){var a='<div class="agrid">',o=function(e){var t=ComboBoxSources.getRecords("custService");for(i=0;i<t.length;i++)if(e==t[i].username)return t[i];if(!e)return""};return void 0!=o(r.kf)&&""!=o(r.kf)&&null!=o(r.kf)?a+=o(r.kf).name+"("+o(r.kf).username+")":a+=r.kf,a+"</div>"}},{text:"标签",width:"9%",dataField:"lebal"},{text:"备注",width:"8%",cellsrenderer:function(e,t,s,i,n,c){userData=c;var r='<div style="text-align:center">';return r+='<a class="hoverspan md-note-add viewSuccessAgentRemark" title="查看备注"></a>',r+="</div>"}}],pagesize:e.settings.grid.pagesize,columnsheight:50};$("#successAgentGrid").grid(n),$("#successAgentGrid").on("click",".viewSuccessAgentRemark",function(){var e=$("#successAgentGrid").jqxGrid("getselectedrowindex"),t=$("#successAgentGrid").jqxGrid("getrowdata",e);$("#viewSuccessAgentRemarkWin").jqxWindow("open",function(){var e={localdata:t.remark,datatype:"array"},s=new $.jqx.dataAdapter(e);$("#SuccessAgentRemarkTbody").jqxGrid({source:s,width:"100%",height:160,autorowheight:!0,autoheight:!0,pageable:!1,columns:[{text:"更新时间",dataField:"createDate",width:"40%"},{text:"备注",dataField:"remark",width:"60%"}]})})})},this.settings={source:{data:e.searchObj},grid:{element:"successAgentGrid"},ajax:{url:c}},this.searchObj={},this.initSearch=function(){e.searchObj={"o.createDate":{value:[],action:"between"},"o.loginId":{value:[],action:"like"},"o.regTelephone":{value:[],action:"like"},"ui.name":{value:[],action:"like"}}},this.searchDataInfo=function(){$("#successAgentGrid").jqxGrid("applyfilters"),$("#successAgentGrid").jqxGrid("refreshfilterrow"),$("#successAgentGrid").jqxGrid("clearselection")},this.refreshDataInfo=function(){$("#successAgentGrid").jqxGrid("updatebounddata","cells"),$("#successAgentGrid").jqxGrid("clearselection"),$("#successAgentGrid").jqxGrid("refreshdata")}},SuccessAgentBindModle=function(e){var t=this;this.search=function(){var t=$("#successAgent-sTime").find("input").val(),s=$("#successAgent-eTime").find("input").val(),i=$("#successAgent-name").val(),n=$("#successAgent-compName").find("input").val(),c=$("#successAgent-phone").val();e.searchObj["o.createDate"].value=[],""!=t&&""!=s&&e.searchObj["o.createDate"].value.push(t+" 00:00:00",s+" 23:59:59"),e.searchObj["o.loginId"].value=[],"全部"!=i&&e.searchObj["o.loginId"].value.push(i),e.searchObj["ui.name"].value=[],"全部"!=n&&e.searchObj["ui.name"].value.push(n),e.searchObj["o.regTelephone"].value=[],""!=c&&e.searchObj["o.regTelephone"].value.push(c),e.searchDataInfo()},this.bind=function(){$("#successAgent-search").on("click",function(){$("#successAgent-show").is(":hidden")?$("#successAgent-show").slideDown("slow"):t.search()}),hiddenAclick()},this.unbindAll=function(){}};