var _global_settings={id:Core.randNum(),js_path:"/js",html_path:"/page"};!function(e){e.service={},e.service.url=ws_url+"/CXF/rs",e.owner={};var i=(e.js_path,e.html_path,[]),n=[];$(document).ready(function(){Core.AjaxRequest({url:e.service.url+"/common/ownerinformation",type:"GET",showMsg:!1,callback:function(i){e.owner=i,$("#index-username").text(e.owner.username),$("#index-companyname").text(e.owner.companyname)},failure:function(){}}),$("#left").load("page/common/left.html",function(){var e=new MenuMgt;e.initUserPermissions(),e.initLeftMenu();var i=new ReceiptMgt(e.permissions);i.initUserPermissions(),i.initReceipt();var n=new Date,a=["日","一","二","三","四","五","六"],r=n.getFullYear()+"年"+(n.getMonth()+1)+"月"+n.getDate()+"日 星期"+a[n.getDay()];$("#time").html(r),$("#sidebar-menu ul li > a").click(function(){return-1!=$(this).attr("href").indexOf("www.ydcfo.net.cn")?(window.open($(this).attr("href")),!1):($(this).addTab(),window.scrollTo(0,0),!1)}),$("#sidebar-menu ul li.has_sub > a").off("click").click(function(){return $(this).siblings("ul").toggle(350),!1}),$("#left a.hoverspan").click(function(){return $(this).addTab(),!1}),$("#main-refreshBtn").on({click:function(){var e=$("#main-refreshBtn").html();$("#main-refreshBtn").html("<img src='images/common/refresh.gif'/>"),ComboBoxSources.loadAll(),setTimeout(function(){$("#main-refreshBtn").html(e)},2e3)}}),$("#main-logoutBtn").on({click:function(){return!!window.confirm("您确定要退出吗？")&&(localStorage.clear(),!0)}})});var n=new ZqwTabMgt("mainTab");$("#time").text((new Date).format("yyyy年M月d日")),$("#mainTab").on({created:function(e){for(var a=$(this).jqxTabs("length"),r=0;r<a;r++){var s={};s.index=r,s.title=$(this).jqxTabs("getTitleAt",r).trim(),i.push(s),n.tab_array.push(s)}n.addTab(n.tab_array[0])},add:function(e){i=[],n.tab_array=[];for(var a=$(this).jqxTabs("length"),r=0;r<a;r++){var s={};s.index=r,s.title=$(this).jqxTabs("getTitleAt",r).trim(),i.push(s),n.tab_array.push(s)}n.addTab(n.tab_array[1]),a>9&&($(this).jqxTabs("removeLast"),$("#mainTab").jqxTabs("select",1))},removed:function(e){var a=e.args.item;$("#zqw_tabs").find("ul li").eq(a).remove(),9==a&&$("#mainTab").jqxTabs("select",1);var r=$(this).jqxTabs("length");i=[],n.tab_array=[];for(var s=0;s<r;s++){var o={};o.index=s,o.title=$(this).jqxTabs("getTitleAt",s).trim(),i.push(o),n.tab_array.push(o)}},selected:function(e){var i=e.args.item,n=$("#zqw_tabs");n.find("ul li").removeClass("active"),n.find("ul li").eq(i).addClass("active")},unselected:function(e){var i=e.args.item;$("#zqw_tabs").find("ul li").eq(i).removeClass("active")}}),$("#mainTab").jqxTabs({width:"100%",scrollPosition:"both",showCloseButtons:!0,theme:currentTheme}),$("#mainTab").jqxTabs("hideCloseButtonAt",0),$("#mainTab").find(".jqx-tabs-headerWrapper").hide(),$.addTab({title:"首页",url:"page/modules/home.html",reload:!0})}),$(document).keydown(function(e){var i=e.target;return!e.altKey||37!=e.keyCode&&39!=e.keyCode?(8!=e.keyCode||"password"==i.type||"text"==i.type||"textarea"==i.type)&&116!=e.keyCode&&void 0:(e.returnValue=!1,!1)}),$.addTab=function(e){var n={tabs_ele:"mainTab",title:"",content:"",isFrame:!1,url:"",reload:!1},a=$.extend(!0,n,e);if(a.isFrame){if(""===a.url)return;var r='<iframe src="'+a.url+'" name="tabReportItem" width="100%" height="100%" style="background:#fff;min-height:768px;margin:0px;padding:0px;overflow-y:none;overflow-x:none;" frameborder="no" border="0" marginwidth="0" marginheight="0" scrolling="no"></iframe><br clear="all">';$("#"+a.tabs_ele).jqxTabs("addAt",1,a.title,r)}else{for(var s=!1,o=0;o<i.length;o++){var t=i[o],m="";if(m=$(a.title).length>0?$(a.title).text().trim():a.title.trim(),t.title==m.trim()){s=!0,$("#"+a.tabs_ele).jqxTabs("select",t.index),!0===a.reload&&function(e){if(""===a.url||"#"==a.url)$("#"+a.tabs_ele).jqxTabs("setContentAt",e,a.content);else{var i=$("<div></div>");$.pk=a.pk,i.load(a.url,function(i){$("#"+a.tabs_ele).jqxTabs("setContentAt",e,i)}),i.html(""),i=null}}(t.index);break}}s||function(){if(""===a.url||"#"==a.url)$("#"+a.tabs_ele).jqxTabs("addAt",1,a.title,a.content);else{var e=$("<div></div>");$.pk=a.pk,e.load(a.url,function(e){$("#"+a.tabs_ele).jqxTabs("addAt",1,a.title,e)}),e.html(""),e=null}}()}},$.closeTab=function(e){void 0===e&&(e=$("#mainTab").jqxTabs("selectedItem")),0!=e&&$("#mainTab").jqxTabs("removeAt",e)},$.loadScript=function(e,i){i=void 0===i?function(){}:i;var a=!1;return $.each(n,function(i,n){n==e&&(a=!0)}),a?i():$.getScript(e,function(){i()}),!1},$.loadHtml=function(e,i){$("<div></div>").load(e,function(e){try{$.addTab({title:i,isFrame:!1,url:"",content:$(this).html(),reload:!0})}catch(e){}})},$.fn.extend({addTab:function(){var e=$(this).attr("href");if(void 0===e&&(e=""),""===e||"#"==e)$.addTab({title:$(this).html(),isFrame:!1,url:e,content:"<div class='content'><h2>"+$(this).html()+" is comming soon!</h2></div>",reload:!0});else{if("iframe"!=$(this).attr("flag")){var i=$(this).html();return $.loadHtml(e,i),!1}if(""===e||"#"==e)return Core.alert({message:"iframe的url非法"}),!1;$.addTab({title:$(this).html(),isFrame:!0,url:e,reload:!0})}return!1}})}(_global_settings);var ZqwTabMgt=function(e){this.tab_array=[],this.initTab=function(e){},this.addTab=function(i){var n=$("#zqw_tabs"),a=$('<li><a href="javascript:void(0)" data="'+i.index+'">'+i.title+'</a><i class="fa fa-remove close-tab"></i></li>');n.find("ul").children().length>0?(n.find("ul").children().eq(0).after(a),n.find("ul li").removeClass("active"),a.addClass("active")):(n.find("ul").append(a),a.addClass("active"),a.find("i").remove()),a.find("i.close-tab").on({click:function(e){var i=$(this).parent().index();e.preventDefault(),$.closeTab(i)}}),a.find("a").on({click:function(i){var n=$(this).parent().index();$("#"+e).jqxTabs("select",n)}})},this.removeTab=function(e){},this.clickTab=function(e){}},ReceiptMgt=function(e){var i=this;this.menus=[{id:1,name:"客户",icon:"",iframe:!1,child:[{id:12,name:"新建报价单",icon:"",href:"page/modules/biz/addQuotation.html",iframe:!1,reload:!0,permission:"crm:quotationorder"},{id:13,name:"新建销售单",icon:"",href:"page/modules/biz/addSaleOrder.html",iframe:!1,reload:!0,permission:"crm:salesorder"},{id:11,name:"收款",icon:"",href:"page/modules/biz/receive.html",iframe:!1,reload:!0,permission:"crm:salesorderpay"}],permission:"crm"},{id:2,name:"供应商",icon:"",iframe:!1,child:[{id:22,name:"新建采购单",icon:"",href:"page/modules/biz/addPurchaseOrder.html",iframe:!1,reload:!0,permission:"vendor:purchaseorder"},{id:21,name:"付款",icon:"",href:"page/modules/biz/payment.html",iframe:!1,reload:!0,permission:"vendor:purchaseorderpay"}],permission:"vendor"},{id:3,name:"凭证",icon:"",iframe:!1,child:[{id:31,name:"新增凭证",icon:"",href:"page/modules/fms/JournalDetail.html",iframe:!1,reload:!0,permission:"fms:journal:create"}],permission:"fms:journal"}],this.permissions=[],this.initReceipt=function(){var e=[];$.each(i.menus,function(n,a){("*"===a.permission||$.inArray(a.permission,i.permissions)>=0)&&(void 0!=a.child&&i.initLeftChildMenu(a.child),e.push(a))});var n=$("#receipt"),a=$('<a style="width:100px"></a>');$.each(e,function(e,i){var n=$('<a  ><i class="'+i.icon+'"></i><h5 style="margin-bottom: 0px;"><strong style="padding-left: 10px;">'+i.name+"</strong></h5></a>");if(void 0!=i.child){var r=!1,s=$('<a style="width:100px style="display：block" ></a>');$.each(i.child,function(e,i){0==i.delFlag&&($('<a id="level2_'+i.id+'" onclick="$.addTab({title:\''+i.name+"',url:'"+i.href+'\'})"  style="display:block;margin-top: 0px;margin-bottom: 0px; " '+(1==i.iframe?'flag="iframe"':"")+'><span style="  padding-left: 45px"  class="hidden-xs" >'+i.name+"</span></a>").appendTo(s),r=!0),i.id}),!0===r&&(n.addClass("has_sub"),s.appendTo(n))}n.appendTo(a)}),a.appendTo(n)},this.initLeftChildMenu=function(e){$.each(e,function(e,n){void 0==n.permission&&(n.permission="*"),$.inArray(n.permission,i.permissions)<0?n.delFlag=!0:n.delFlag=!1,"*"===n.permission&&(n.delFlag=!1)})},this.eventBind=function(){},this.initUserPermissions=function(){void 0===e?Core.AjaxRequest({url:ws_url+"/CXF/rs/resource/permission/type/all",type:"GET",showMsg:!1,async:!1,callback:function(e){$.each(e,function(e,n){void 0!=n&&i.permissions.push(n)}),i.permissions=$.unique(i.permissions)},failure:function(e){}}):i.permissions=e}},MenuMgt=function(){var e=this;this.menus=[{id:0,name:"首页",icon:"md-home",href:"page/modules/home.html",iframe:!1,permission:"fpage"},{id:10,name:"客户",icon:"md-person",href:"page/modules/biz/customerBizMgt.html",iframe:!1,permission:"crm"},{id:11,name:"供应商",icon:"md-group",href:"page/modules/biz/vendorBizMgt.html",iframe:!1,permission:"vendor"},{id:2,name:"业务",icon:"md-description",href:"#",iframe:!1,child:[{id:20,name:"报价单",icon:"icon-home",href:"page/modules/prod/offerOrder.html",iframe:!1,permission:"biz:quotation"},{id:21,name:"销售单",icon:"icon-home",href:"page/modules/prod/saleOrder.html",iframe:!1,permission:"biz:sales"},{id:22,name:"送货单",icon:"icon-home",href:"page/modules/biz/sendCargo.html",iframe:!1,permission:"biz:salesdelivery"},{id:23,name:"收款单",icon:"icon-home",href:"page/modules/prod/receiveOrder.html",iframe:!1,permission:"biz:salespay"},{id:24,name:"采购单",icon:"icon-home",href:"page/modules/prod/buyOrder.html",iframe:!1,permission:"biz:purchase"},{id:25,name:"收货单",icon:"icon-home",href:"page/modules/biz/receiveCargo.html",iframe:!1,permission:"biz:purchasedelivery"},{id:26,name:"付款单",icon:"icon-home",href:"page/modules/prod/payOrder.html",iframe:!1,permission:"biz:purchasepay"},{id:27,name:"报销",icon:"icon-home",href:"page/modules/prod/costExpense.html",iframe:!1,permission:"biz:reimburse"},{id:28,name:"费用支出",icon:"icon-home",href:"page/modules/prod/costPay.html",iframe:!1,permission:"biz:expensepay"},{id:29,name:"库存",icon:"icon-layers",href:"page/modules/prod/inventory.html",iframe:!1,permission:"biz:inventory"},{id:30,name:"业务日志",icon:"icon-home",href:"page/modules/sys/operationLog.html",iframe:!1,permission:"biz:actionlog"}],permission:"biz"},{id:3,name:"财务",icon:"md-equalizer",href:"#",iframe:!1,child:[{id:31,name:"凭证",icon:"icon-home",href:"page/modules/fms/Journal.html",iframe:!1,permission:"fms:journal"},{id:32,name:"银行对账",icon:"icon-home",href:"page/modules/fms/bankReconciliation.html",iframe:!1,permission:"fms:bankrec"},{id:33,name:"期末结转",icon:"icon-home",href:"page/modules/fms/finalTransaction.html",iframe:!1,permission:"fms:endforward"},{id:34,name:"结账",icon:"icon-home",href:"page/modules/fms/accountPeriod.html",iframe:!1,permission:"fms:pay"},{id:35,name:"固定资产",icon:"icon-grid",href:"page/modules/equipment/equipment.html",iframe:!1,permission:"fms:asset"},{id:36,name:"账簿",icon:"icon-chart",href:"page/modules/equipment/accountBook.html",iframe:!1,permission:"fms:accountbook"},{id:37,name:"报表",icon:"icon-chart",href:"page/modules/equipment/report.html",iframe:!1,permission:"fms:report"}],permission:"fms"},{id:4,name:"基础设置",icon:"md-settings",href:"#",iframe:!1,child:[{id:40,name:"资源管理",icon:"icon-home",href:"page/modules/sys/resourceMgt.html",iframe:!1,permission:"base:resource"},{id:41,name:"角色管理",icon:"icon-home",href:"page/modules/sys/roleMgt.html",iframe:!1,permission:"base:role"},{id:42,name:"用户管理",icon:"icon-home",href:"page/modules/sys/userMgt.html",iframe:!1,permission:"base:user"},{id:44,name:"公司设置",icon:"icon-home",href:"page/modules/sys/ownerBizTypeInfo.html",iframe:!1,permission:"base:company"},{id:45,name:"科目设置",icon:"",href:"page/modules/fms/chartOfAccountMgt.html",iframe:!1,permission:"base:coa"},{id:46,name:"产品与服务",icon:"icon-drawar",href:"page/modules/prod/product.html",iframe:!1,permission:"base:prod"}],permission:"base"},{id:9,name:"帮助",icon:"md-help",href:"http://www.ydcfo.net.cn/help/help.html",iframe:!1,permission:"help"}],this.permissions=[],this.initLeftMenu=function(){var i=[];$.each(e.menus,function(n,a){("*"===a.permission||$.inArray(a.permission,e.permissions)>=0)&&(void 0!=a.child&&e.initLeftChildMenu(a.child),i.push(a))});var n=$("#sidebar-menu"),a=$("<ul></ul>");$.each(i,function(e,i){var n=$('<li id="level1_'+i.id+'"><a href="'+i.href+'" class="waves-effect"><i class="'+i.icon+'"></i><span class="hidden-xs">'+i.name+"</span></a></li>");if(void 0!=i.child){var r=!1,s=$('<ul class="list-unstyled"></ul>');$.each(i.child,function(e,i){0==i.delFlag&&($('<li id="level2_'+i.id+'"><a href="'+i.href+'" class="waves-effect" '+(1==i.iframe?'flag="iframe"':"")+">"+i.name+"</a></li>").appendTo(s),r=!0)}),!0===r&&(n.addClass("has_sub"),s.appendTo(n))}n.appendTo(a)}),a.appendTo(n)},this.initLeftChildMenu=function(i){$.each(i,function(i,n){void 0==n.permission&&(n.permission="*"),$.inArray(n.permission,e.permissions)<0?n.delFlag=!0:n.delFlag=!1,"*"===n.permission&&(n.delFlag=!1)})},this.eventBind=function(){},this.initUserPermissions=function(){Core.AjaxRequest({url:ws_url+"/CXF/rs/resource/permission/type/all",type:"GET",showMsg:!1,async:!1,callback:function(i){$.each(i,function(i,n){void 0!=n&&e.permissions.push(n)}),e.permissions=$.unique(e.permissions)},failure:function(e){}})}};