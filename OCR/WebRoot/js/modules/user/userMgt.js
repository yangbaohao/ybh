var UserMgt=function(){var e=this,r=_global_settings.service.url+"/user";this.initInput=function(){e.initPage(),e.initSearch(),e.initGrid(e.searchObj)},this.initPage=function(){$("#user-show").css("display",""),$("#user-firstTime").dropDownlist({source:{0:"请选择",1:"最近一周",2:"最近两周",3:"最近三周",4:"本月",5:"本季度",6:"本年"},selectedIndex:0,dropDownHeight:120}),$("#user-sTime,#user-eTime").datetimeinput(),$("#user-firstTime").on("change",function(){setValueById("user-firstTime","user-sTime","user-eTime")}),$("#user-name").comboBox({source:ComboBoxSources.getRecords("username"),displayMember:"name",valueMember:"name"}),$("#user-compname").comboBox({source:ComboBoxSources.getRecords("company"),displayMember:"company",valueMember:"company"}),$("#user-show").addClass("hiddendiv"),a(),hiddenAclick()},this.searchObj={},this.initSearch=function(){e.searchObj={"owner0.createDate":{value:[],action:"between"},"owner0.loginId":{value:[],action:"like"},"enterprise.name":{value:[],action:"like"},"owner0.regTelephone":{value:[],action:"like"}}};var a=function(){$("#user-search").off("click").on("click",function(){$("#user-show").is(":hidden")?$("#user-show").slideDown("slow"):t()})},t=function(){var r=$("#user-name").val(),a=$("#user-compname").val(),t=$("#user-phone").val(),i=$("#user-sTime").val(),n=$("#user-eTime").val();e.searchObj["owner0.createDate"].value=[],""!=i&&""!=n&&(e.searchObj["owner0.createDate"].value.push(i+" 00:00:00",n+" 23:59:59"),e.searchObj["owner0.createDate"].action="between"),""==i&&""!=n&&(e.searchObj["owner0.createDate"].value.push(n+" 23:59:59"),e.searchObj["owner0.createDate"].action="le"),""!=i&&""==n&&(e.searchObj["owner0.createDate"].value.push(i+" 00:00:00"),e.searchObj["owner0.createDate"].action="ge"),e.searchObj["owner0.loginId"].value=[],""!=r&&e.searchObj["owner0.loginId"].value.push(r),e.searchObj["enterprise.name"].value=[],""!=a&&e.searchObj["enterprise.name"].value.push(a),e.searchObj["owner0.regTelephone"].value=[],""!=t&&e.searchObj["owner0.regTelephone"].value.push(t),searchDataInfo("userMgtGrid")};this.initColumns=function(){return[{text:"首次充值日期",dataField:"firstDate",width:"11%"},{text:"用户名",dataField:"username",width:"11%"},{text:"商户名称",dataField:"name",width:"12%"},{text:"联系电话",dataField:"telephone",width:"11%"},{text:"服务单数",dataField:"totalNum",width:"11%",cellsrenderer:function(e,r,a,t,i,n){var s='<div class="agrid">';return(s+='<a class="hoverspan viewTotal">'+n.totalNum+"</a>")+"</div>"}},{text:"一般单数",dataField:"ordinaryNum",width:"11%",cellsrenderer:function(e,r,a,t,i,n){var s='<div class="agrid">';return(s+='<a class="hoverspan viewOrdinary">'+n.ordinaryNum+"</a>")+"</div>"}},{text:"加急单数",dataField:"urgentNum",width:"11%",cellsrenderer:function(e,r,a,t,i,n){var s='<div class="agrid">';return(s+='<a class="hoverspan viewUrgent">'+n.urgentNum+"</a>")+"</div>"}},{text:"账户余额",dataField:"balanceAmt",width:"11%"},{text:"充值记录",width:"11%",align:"center",cellsrenderer:function(e,r,a,t,i,n){var s='<div class="text-center agrid">';return(s+="详情")+"</div>"}}]},this.initGrid=function(){var a={url:r+"/search/userbuy/0/0/"+_global_settings.owner.roleName,data:e.searchObj},t=Core.AcDataAdapter("userMgtGrid",a,{beforeLoadComplete:function(e){},loadComplete:function(e){}},!1),n={source:t,rendergridrows:function(){return t.recordids},columns:e.initColumns(),pagesize:20,columnsheight:45};$("#userMgtGrid").grid(n),i()};var i=function(){$("#userMgtGrid").on("click",".viewTotal",function(){var e=$("#userMgtGrid").jqxGrid("getselectedrowindex");if(e>=0){var r=$("#userMgtGrid").jqxGrid("getrowdata",e),a={name:r.name,phone:r.telephone,ownerId:r.ownerId,type:null};$.addTab({title:"单数详情",url:"page/modules/user/viewDetail.html",pk:{vduser:a},reload:!0})}}),$("#userMgtGrid").on("click",".viewOrdinary",function(){var e=$("#userMgtGrid").jqxGrid("getselectedrowindex");if(e>=0){var r=$("#userMgtGrid").jqxGrid("getrowdata",e),a={name:r.name,phone:r.telephone,ownerId:r.ownerId,type:"general"};$.addTab({title:"单数详情",url:"page/modules/user/viewDetail.html",pk:{vduser:a},reload:!0})}}),$("#userMgtGrid").on("click",".viewUrgent",function(){var e=$("#userMgtGrid").jqxGrid("getselectedrowindex");if(e>=0){var r=$("#userMgtGrid").jqxGrid("getrowdata",e),a={name:r.name,phone:r.telephone,ownerId:r.ownerId,type:"emergency"};$.addTab({title:"单数详情",url:"page/modules/user/viewDetail.html",pk:{vduser:a},reload:!0})}})}};