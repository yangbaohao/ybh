var ViewTaxerUserMgt=function(){var e=this,t=_global_settings.service.url;this.debug=!1,this.data=$.pk.data;var a=null;this.initInput=function(){e.initWindows(),e.initPage(),e.initGrid(),e.bind(),e.unbindAll()},this.searchObjPayment={},this.searchObjPayment={},this.getTaxerInfo=function(e){var t=ComboBoxSources.getRecords("taxerInfo");for(i=0;i<t.length;i++)if(e==t[i].username)return t[i];if(!e)return""},this.initWindows=function(){$("#editReceiptMgtWin").jqxWindow({theme:currentTheme,isModal:!0,autoOpen:!1,maxHeight:700,minHeight:300,height:"auto",minWidth:600,maxWidth:800,cancelButton:$("#editReceiptMgtCancleBtn"),initContent:function(){}}).on("close",function(){setTimeout(function(){},"open",function(){},500)}),$("#editPaymentMgtWin").jqxWindow({theme:currentTheme,isModal:!0,autoOpen:!1,maxHeight:700,minHeight:300,height:"auto",minWidth:600,maxWidth:800,cancelButton:$("#editPaymentMgtCancleBtn"),initContent:function(){}}).on("close",function(){setTimeout(function(){},"open",function(){},500)})},this.initPage=function(){$("#viewTaxerUser-taxer").text(void 0==e.getTaxerInfo(e.data.taxer)?"":e.getTaxerInfo(e.data.taxer).name),$("#viewTaxerUser-username").text(e.data.loginId),$("#viewTaxerUser-stime").text(void 0==e.data.startDate?"":e.data.startDate.substring(0,10)),$("#viewTaxerUser-etime").text(void 0==e.data.endDate?"":e.data.endDate.substring(0,10)),$("#viewTaxerUser-name").text(e.data.name),$("#viewTaxerUser-taxrate").text(e.data.vat+"%"),$("#viewTaxerUser-taxType").text(getCodeData(e.data.taxType)),$("#viewTaxerUser-owerTaxCode").text(e.data.owerTaxCode),$("#viewTaxerUser-period").text(getCodeData(e.data.dateType)),$("#viewTaxerUser-money").text("￥"+money(e.data.payAmt)),$("#viewTaxerUser-email").text(e.data.email),$("#viewTaxerUser-phone").text(e.data.regTelephone)},this.initGrid=function(){e.settings.source.data=e.searchObjReceipt,e.settings.source.url=_global_settings.service.url+"/owner/search/payRemark/"+e.data.id+"/pay";var t=Core.AcDataAdapter("viewTaxerUserReceipt",e.settings.source,{beforeLoadComplete:function(e){}},e.debug);e.setting1.source.data=e.searchObjPayment,e.setting1.source.url=_global_settings.service.url+"/owner/search/payRemark/"+e.data.id+"/nopay";var i=Core.AcDataAdapter("viewTaxerUserPayment",e.setting1.source,{beforeLoadComplete:function(e){}},e.debug),a={source:t,pageable:!1,rendergridrows:function(){return t.recordids},columns:[{text:"收款日期",width:"20%",cellsrenderer:function(e,t,i,a,n,d){var r='<div style="padding-top:6px;">';return(r+=d.entryDate.substring(0,10))+"</div>"}},{text:"收款区间",dataField:"startDate",width:"20%",cellsrenderer:function(e,t,i,a,n,d){var r='<div style="padding-top:6px;">';return void 0==d.startDate&&void 0==d.endDate||(r+=d.startDate.substring(0,7)+"~"+d.endDate.substring(0,7)),r+"</div>"}},{text:"收款金额",dataField:"amt",cellsformat:"c2",width:"20%"},{text:"收款方式",width:"20%",cellsrenderer:function(e,t,i,a,n,d){var r='<div style="padding-top:6px;">';return(r+=getCodeData(d.dateType))+"</div>"}},{text:"操作",width:"20%",cellsrenderer:function(e,t,i,a,n,d){var r='<div style="padding-top:6px; text-align:center;">';return(r+='<a class="hoverspan md-edit editReceiptLineBtn" data-index="'+e+'" title="编辑"></a>')+"</div>"}}],pagesize:20,columnsheight:45};$("#viewTaxerUserReceipt").grid(a);var n={source:i,columnsresize:!1,autorowheight:!0,autoheight:!0,columnsheight:45,pageable:!1,rendergridrows:function(){return i.records},columns:[{text:"催款日期",width:"20%",cellsrenderer:function(e,t,i,a,n,d){var r='<div style="padding-top:6px;">';return(r+=d.entryDate.substring(0,10))+"</div>"}},{text:"催款区间",dataField:"startDate",width:"20%",cellsrenderer:function(e,t,i,a,n,d){var r='<div style="padding-top:6px;">';return void 0==d.startDate&&void 0==d.endDate||(r+=d.startDate.substring(0,7)+"~"+d.endDate.substring(0,7)),r+"</div>"}},{text:"催款金额",dataField:"amt",cellsformat:"c2",width:"20%"},{text:"催款方式",width:"20%",cellsrenderer:function(e,t,i,a,n,d){var r='<div style="padding-top:6px;">';return(r+=getCodeData(d.dateType))+"</div>"}},{text:"操作",width:"20%",cellsrenderer:function(e,t,i,a,n,d){var r='<div style="padding-top:6px; text-align:center;">';return(r+='<a class="hoverspan md-edit editPaymentLineBtn" data-index="'+e+'" title="编辑"></a>')+"</div>"}}]};$("#viewTaxerUserPayment").grid(n)},this.settings={source:{data:e.searchObjReceipt},grid:{element:"viewTaxerUserReceipt"},ajax:{url:t}},this.setting1={source:{data:e.searchObjPayment},grid:{element:"viewTaxerUserPayment"},ajax:{url:t}},this.bind=function(){$("#viewTaxerUserReceipt").on("click",".deleteReceiptLineBtn",function(){var e=$(this).attr("data-index"),t=$("#viewTaxerUserReceipt").jqxGrid("getrowdata",e);a=t,Core.AjaxRequest({type:"DELETE",url:_global_settings.service.url+"/owner/payRemark/delete/"+a.id,async:!1,showMsg:!1,callback:function(){setCloseAlertTimeOneSecond(),$("#viewTaxerUserReceipt").jqxGrid("updatebounddata","cells")},failure:function(){}})}),$("#viewTaxerUserReceipt").on("click",".editReceiptLineBtn",function(){var t=$(this).attr("data-index"),i=$("#viewTaxerUserReceipt").jqxGrid("getrowdata",t);a=i,$("#editReceiptMgtWin").jqxWindow("open",function(){function t(){"paymouth"==$("#editReceipt-period").val()?($("#editReceipt-money").val(money(i.amt)),$("#editReceipt-eTime").val(getChangeDate($("#editReceipt-sTime").val(),1))):"payseason"==$("#editReceipt-period").val()?($("#editReceipt-money").val(money(3*i.amt)),$("#editReceipt-eTime").val(getChangeDate($("#editReceipt-sTime").val(),3))):"payhalfyear"==$("#editReceipt-period").val()?($("#editReceipt-money").val(money(6*i.amt)),$("#editReceipt-eTime").val(getChangeDate($("#editReceipt-sTime").val(),6))):"payyear"==$("#editReceipt-period").val()&&($("#editReceipt-money").val(money(12*i.amt)),$("#editReceipt-eTime").val(getChangeDate($("#editReceipt-sTime").val(),12)))}$("#editReceipt-period").dropDownlist({source:{paymouth:"按月收款",payseason:"按季度收款",payhalfyear:"按半年收款",payyear:"按年收款"},theme:currentTheme,height:34,width:"100%",selectedIndex:0}),$("#editReceipt-sTime").datetimeinput({formatString:"yyyy-MM-dd",width:"100%",height:"34px"}),$("#editReceipt-eTime").datetimeinput({formatString:"yyyy-MM-dd",width:"100%",height:"34px"}),$("#editReceipt-amount").datetimeinput({formatString:"yyyy-MM-dd",width:"100%",height:"34px"}),$("#editReceipt-money").input({width:"98%",height:33}).moneyinput(),$("#editReceipt-loginId").val(e.data.loginId),$("#editReceipt-name").val(e.data.name),$("#editReceipt-amount").val(i.entryDate.substring(0,10)),$("#editReceipt-money").val(money(i.amt)),$("#editReceipt-sTime").val(i.startDate.substring(0,7)),$("#editReceipt-eTime").val(i.endDate.substring(0,7)),void 0!=i.startDate?($("#editReceipt-sTime").val(i.startDate),t()):($("#editReceipt-sTime").val($("#editReceipt-amount").val()),t()),$("#editReceipt-sTime").change(function(){t()}),t(),$("#editReceipt-period").on("select",function(){t()})})}),$("#editReceiptSubmitBtn").off("click").on("click",function(){var t={};t.id=a.id,t.owner={id:e.data.id},t.entryDate=$("#editReceipt-amount").val(),t.startDate=$("#editReceipt-sTime").val(),t.endDate=$("#editReceipt-eTime").val(),t.dateType=$("#editReceipt-period").val(),t.amt=$("#editReceipt-money").val(),t.type="pay",Core.AjaxRequest({type:"PUT",url:_global_settings.service.url+"/owner/payRemark/update",async:!1,params:t,showMsg:!1,callback:function(){setCloseAlertTimeOneSecond(),$("#editReceiptMgtWin").jqxWindow("close"),$("#viewTaxerUserReceipt").jqxGrid("updatebounddata","cells")},failure:function(){}})}),$("#viewTaxerUserPayment").on("click",".deletePaymentLineBtn",function(){var e=$(this).attr("data-index"),t=$("#viewTaxerUserPayment").jqxGrid("getrowdata",e);a=t,Core.AjaxRequest({type:"DELETE",url:_global_settings.service.url+"/owner/payRemark/delete/"+a.id,async:!1,showMsg:!1,callback:function(){setCloseAlertTimeOneSecond(),$("#viewTaxerUserPayment").jqxGrid("updatebounddata","cells")},failure:function(){}})}),$("#viewTaxerUserPayment").on("click",".editPaymentLineBtn",function(){var t=$(this).attr("data-index"),i=$("#viewTaxerUserPayment").jqxGrid("getrowdata",t);a=i,$("#editPaymentMgtWin").jqxWindow("open",function(){function t(){"paymouth"==$("#editPayment-period").val()?($("#editPayment-money").val(money(i.amt)),$("#editPayment-eTime").val(getChangeDate($("#editPayment-sTime").val(),1))):"payseason"==$("#editPayment-period").val()?($("#editPayment-money").val(money(3*i.amt)),$("#editPayment-eTime").val(getChangeDate($("#editPayment-sTime").val(),3))):"payhalfyear"==$("#editPayment-period").val()?($("#editPayment-money").val(money(6*i.amt)),$("#editPayment-eTime").val(getChangeDate($("#editPayment-sTime").val()),6)):"payyear"==$("#editPayment-period").val()&&($("#editPayment-money").val(money(12*i.amt)),$("#editPayment-eTime").val(getChangeDate($("#editPayment-sTime").val(),12)))}$("#editPayment-sTime").datetimeinput({formatString:"yyyy-MM-dd",width:"100%",height:"34px"}),$("#editPayment-eTime").datetimeinput({formatString:"yyyy-MM-dd",width:"100%",height:"34px"}),$("#editPayment-amount").datetimeinput({formatString:"yyyy-MM-dd",width:"100%",height:"34px"}),$("#editPayment-money").input({width:"98%",height:33}).moneyinput(),$("#editPayment-loginId").val(e.data.loginId),$("#editPayment-name").val(e.data.name),$("#editPayment-amount").val(i.entryDate.substring(0,10)),$("#editPayment-money").val(money(i.amt)),$("#editPayment-sTime").val(i.startDate.substring(0,7)),$("#editPayment-eTime").val(i.endDate.substring(0,7)),$("#editPayment-period").dropDownlist({source:{paymouth:"按月收款",payseason:"按季度收款",payhalfyear:"按半年收款",payyear:"按年收款"},theme:currentTheme,height:34,width:"100%",selectedIndex:0}),void 0!=i.startDate?($("#editPayment-sTime").val(i.startDate),t()):($("#editPayment-sTime").val($("#editPayment-amount").val()),t()),$("#editPayment-sTime").change(function(){t()}),t(),$("#editPayment-period").on("select",function(){t()})})}),$("#editPaymentSubmitBtn").off("click").on("click",function(){var t={};t.id=a.id,t.owner={id:e.data.id},t.entryDate=$("#editPayment-amount").val(),t.startDate=$("#editPayment-sTime").val(),t.endDate=$("#editPayment-eTime").val(),t.dateType=$("#editPayment-period").val(),t.amt=$("#editPayment-money").val(),t.type="nopay",Core.AjaxRequest({type:"PUT",url:_global_settings.service.url+"/owner/payRemark/update",async:!1,params:t,showMsg:!1,callback:function(){setCloseAlertTimeOneSecond(),$("#editPaymentMgtWin").jqxWindow("close"),$("#viewTaxerUserPayment").jqxGrid("updatebounddata","cells")},failure:function(){}})})},this.unbindAll=function(){}};