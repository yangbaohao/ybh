var DurMgt=function(){var e=this,t=_global_settings.service.url+"/user";this.userData=null,this.boolean=!1,this.initInput=function(){e.initWindows(),e.initValidator(),e.initGrid(e.searchObj),e.userNameJudge()},this.userNameJudge=function(){$("#adddec-username").on("blur",function(){var r=$("#adddec-username").val();""!=r&&Core.AjaxRequest({url:t+"/repeat/"+r,type:"GET",async:!1,callback:function(t){e.boolean=t,t&&Core.alert({message:"用户名不能重复！"})}})})},this.searchObj={"user.username":{value:[],action:"like"}},this.initWindows=function(){$("#addDecUserWin").jqxWindow({theme:currentTheme,isModal:!0,autoOpen:!1,maxHeight:1e3,minHeight:580,height:"auto",minWidth:500,cancelButton:$("#cancelAddDecUserBtn"),initContent:function(){$("#adddec-salutation").dropDownlist({source:["男","女"],width:"100%",selectedIndex:0})}}).on({close:function(){$("#addDecUserWin").find("input").val("")}}),$("#editDecUserInfoWin").jqxWindow({theme:currentTheme,isModal:!0,autoOpen:!1,maxHeight:1e3,minHeight:580,height:"auto",minWidth:500,cancelButton:$("#cancelEditDecUserBtn"),initContent:function(){$("#editdecuser-salutation").dropDownlist({source:["男","女"],width:"100%"})}}).on({close:function(){$("#editDecUserInfoWin").find("input").val("")}}),$("#disableUserWin").jqxWindow({theme:currentTheme,isModal:!0,autoOpen:!1,maxHeight:1e3,minHeight:280,height:"auto",minWidth:500,cancelButton:$("#cancelDisableUserBtn"),initContent:function(){$("#disabled-locked").dropDownlist({source:{true:"是",false:"否"},width:"100%",selectedIndex:0})}})},this.initGrid=function(){e.settings.source.data=e.searchObj;var t=Core.AcDataAdapter("decUserGridMgt",e.settings.source,{beforeLoadComplete:function(e){}},e.debug),r={source:t,rendergridrows:function(){return t.records},columns:[{text:"员工编号",dataField:"employeeCode",width:"10%"},{text:"用户名",dataField:"username",width:"15%"},{text:"姓名",dataField:"name",width:"15%"},{text:"手机号码",dataField:"telephone",width:"10%"},{text:"职位",dataField:"title",width:"10%"},{text:"用户数",dataField:"ownerNum",width:"10%",cellsrenderer:function(e,t,r,a,d,i){var n='<div style="padding-top:6px; padding-left:6px;">';return(n+='<a class="hoverspan userNum">'+i.ownerNum+"</a>")+"</div>"}},{text:"是否禁用",width:"15%",cellsrenderer:function(e,t,r,a,d,i){return'<div class="agrid">'+getCodeData(i.locked)}},{text:"操作",align:"center",width:"15%",cellsrenderer:function(e,t,r,a,d,i){var n='<div style="text-align: center;">';return n+='<a class="hoverspan md-mode-edit editDecUserBtn" title="编辑"></a>',n+='<a class="hoverspan md-format-list-bulleted fpUserBtn" title="分配客户"></a>',n+='<a class="hoverspan md-error disableUserBtn" title="禁用"></a>',n+="</div>"}}],pagesize:20,columnsheight:45};$("#decUserGridMgt").grid(r),$("#decUserGridMgt").on("click",".editDecUserBtn",function(){var t=$("#decUserGridMgt").jqxGrid("getselectedrowindex");if(t>=0){var r=$("#decUserGridMgt").jqxGrid("getrowdata",t);e.userData=r,$("#editDecUserInfoWin").jqxWindow("open",function(){$("#editdecuser-username").val(r.username),$("#editdecuser-employeeCode").val(r.employeeCode),$("#editdecuser-name").val(r.name),$("#editdecuser-mobile").val(r.telephone)})}}),$("#decUserGridMgt").on("click",".userNum",function(){var e=$("#decUserGridMgt").jqxGrid("getselectedrowindex");if(e>=0){var t=$("#decUserGridMgt").jqxGrid("getrowdata",e);$.addTab({title:"用户详情",isFrame:!1,url:"page/modules/user/decUserDetail.html",pk:{employeeCode:t.employeeCode},reload:!0})}}),$("#decUserGridMgt").on("click",".disableUserBtn",function(){var t=$("#decUserGridMgt").jqxGrid("getselectedrowindex");if(t>=0){var r=$("#decUserGridMgt").jqxGrid("getrowdata",t);e.userData=r,$("#disableUserWin").jqxWindow("open",function(){$("#disable-username").val(r.username)})}}),$("#decUserGridMgt").on("click",".fpUserBtn",function(){var e=$("#decUserGridMgt").jqxGrid("getselectedrowindex");if(e>=0){var t=$("#decUserGridMgt").jqxGrid("getrowdata",e);if(t.locked)return Core.alert({message:"禁用的用户不能分配客户！"}),!1;$.addTab({title:"分配客户",isFrame:!1,url:"page/modules/user/decFpUser.html",pk:{data:t},reload:!0})}})},this.settings={source:{url:t+"/userAgentTax",data:e.searchObj},grid:{element:"decUserGridMgt"},ajax:{url:t}},this.searchDataInfo=function(){$("#decUserGridMgt").jqxGrid("applyfilters"),$("#decUserGridMgt").jqxGrid("refreshfilterrow"),$("#decUserGridMgt").jqxGrid("clearselection")},this.refreshDataInfo=function(){$("#decUserGridMgt").jqxGrid("updatebounddata","cells"),$("#decUserGridMgt").jqxGrid("clearselection"),$("#decUserGridMgt").jqxGrid("refreshdata")},this.initValidator=function(){$("#addDecUserWin").jqxValidator({hintType:"label",animationDuration:1,rules:[{input:"#adddec-username",message:"不能为空",action:"keyup, blur",rule:"required"},{input:"#adddec-username",message:"只能是数字,字母,下划线。下划线不能开头或结尾",action:"keyup, blur",rule:function(e,t){var r=e.val(),a=new RegExp("[`~!@#$^&*()=|{}':;',\\[\\].<>/?~！@#￥……&*（） &;|{}【】‘；：”“'。，、？一-龥]");return 0!==r.indexOf("_")&&r.indexOf("_")!==r.length-1&&!a.test(e.val())}},{input:"#adddec-employeeCode",message:"不能为空",action:"keyup, blur",rule:"required"},{input:"#adddec-employeeCode",message:"必须为数字，长度5位",action:"keyup, blur",rule:function(e,t){return!!/^\d*$/.exec(e.val())&&5==e.val().length}},{input:"#adddec-password",message:"不能为空",action:"keyup, blur",rule:"required"},{input:"#adddec-password",message:"密码长度应为6-20位",action:"keyup, blur",rule:function(e,t){var r=e.val();return!(r.length<6||r.length>20)}},{input:"#adddec-passwordcheck",message:"不能为空",action:"keyup, blur",rule:"required"},{input:"#adddec-passwordcheck",message:"两次密码输入不一致",action:"keyup, blur",rule:function(e,t){return e.val()==$("#adddec-password").val()}},{input:"#adddec-name",message:"不能为空",action:"keyup, blur",rule:"required"},{input:"#adddec-mobile",message:"不能为空",action:"keyup, blur",rule:"required"},{input:"#adddec-mobile",message:"格式不正确",action:"keyup,blur",rule:function(e,t){return!!/^1[3|4|5|7|8]\d{9}$/.test(e.val())}},{input:"#adddec-email",message:"邮箱格式不正确",action:"keyup, blur",rule:function(e,t){if(""!=e.val()){return/[\w!#$%&'*+\/=?^_`{|}~-]+(?:\.[\w!#$%&'*+\/=?^_`{|}~-]+)*@(?:[\w](?:[\w-]*[\w])?\.)+[\w](?:[\w-]*[\w])?/.test(e.val())}return!0}}]}),$("#editDecUserInfoWin").jqxValidator({hintType:"label",animationDuration:1,rules:[{input:"#editdecuser-password",message:"不能为空",action:"keyup, blur",rule:"required"},{input:"#editdecuser-password",message:"密码长度应为6-20位",action:"keyup, blur",rule:function(e,t){var r=e.val();return!(r.length<6||r.length>20)}},{input:"#editdecuser-passwordcheck",message:"不能为空",action:"keyup, blur",rule:"required"},{input:"#editdecuser-passwordcheck",message:"两次密码输入不一致",action:"keyup, blur",rule:function(e,t){return e.val()==$("#editdecuser-password").val()}},{input:"#editdecuser-name",message:"不能为空",action:"keyup, blur",rule:"required"},{input:"#editdecuser-mobile",message:"不能为空",action:"keyup, blur",rule:"required"},{input:"#editdecuser-mobile",message:"格式不正确",action:"keyup,blur",rule:function(e,t){return!!/^1[3|4|5|7|8]\d{9}$/.test(e.val())}},{input:"#editdecuser-email",message:"邮箱格式不正确",action:"keyup, blur",rule:function(e,t){if(""!=e.val()){return/[\w!#$%&'*+\/=?^_`{|}~-]+(?:\.[\w!#$%&'*+\/=?^_`{|}~-]+)*@(?:[\w](?:[\w-]*[\w])?\.)+[\w](?:[\w-]*[\w])?/.test(e.val())}return!0}}]})}},DurBindModle=function(e){var t=this,r=_global_settings.service.url+"/user";this.search=function(){var t=$("#search-decusername").val();e.searchObj["user.username"].value=[],""!=t&&e.searchObj["user.username"].value.push(t),e.searchDataInfo()},this.saveUser=function(){var t={};if(t.username=$("#adddec-username").val(),t.employeeCode=$("#adddec-employeeCode").val(),t.password=$("#adddec-password").val(),t.locked=!1,t.roles=[],t.userInfo={},t.userInfo.email=$("#adddec-email").val(),t.userInfo.name=$("#adddec-name").val(),t.userInfo.salutation=$("#adddec-salutation").val(),t.userInfo.telephone=$("#adddec-mobile").val(),t.userInfo.title=$("#adddec-title").val(),t.userInfo.type="person",e.boolean)return Core.alert({message:"用户名不能重复！"}),!1;$("#addDecUserWin").jqxValidator("validate")&&Core.AjaxRequest({type:"POST",url:r+"/savetax",params:t,async:!1,callback:function(){$("#addDecUserWin").jqxWindow("close");try{ComboBoxSources.load("taxManage"),$("#decUserGridMgt").jqxGrid("updatebounddata","cells"),$("#userbMgtGrid").jqxGrid("updatebounddata","cells")}catch(e){}}})},this.saveEditUser=function(t){var a={};a.id=t,a.username=$("#editdecuser-username").val(),a.employeeCode=$("#editdecuser-employeeCode").val(),a.password=$("#editdecuser-password").val(),a.locked=e.userData.locked,a.parentEmployeeCode=e.userData.parentEmployeeCode,a.roles=[],a.userInfo={},a.userInfo.email=$("#editdecuser-email").val(),a.userInfo.name=$("#editdecuser-name").val(),a.userInfo.salutation=$("#editdecuser-salutation").val(),a.userInfo.telephone=$("#editdecuser-mobile").val(),a.userInfo.title=$("#editdecuser-title").val(),a.userInfo.type="person",$("#editDecUserInfoWin").jqxValidator("validate")&&Core.AjaxRequest({type:"PUT",url:r,params:a,async:!1,showMsg:!1,callback:function(){setCloseAlertTimeOneSecond(),$("#editDecUserInfoWin").jqxWindow("close"),$("#decUserGridMgt").jqxGrid("updatebounddata","cells"),$("#userbMgt").jqxGrid("updatebounddata","cells"),$("#Journal").jqxGrid("updatebounddata","cells")}})},this.bind=function(){$("#searchDecUserBtn").on("click",function(){t.search()}),$("#addDecUserBtn").on("click",function(){$("#addDecUserWin").jqxWindow("open")}),$("#addDecUserSubmitBtn").off("click").on("click",function(){t.saveUser(),$("#decUserGridMgt").jqxGrid("updatebounddata","cells"),$("#userbMgtGrid").jqxGrid("updatebounddata","cells"),$("#partUserbMgtWin").jqxGrid("updatebounddata","cells")}),$("#editDecUserSubmitBtn").off("click").on("click",function(){t.saveEditUser(e.userData.id)}),$("#disableUserSubmitBtn").off("click").on("click",function(){var t=$("#disabled-locked").val();Core.AjaxRequest({url:r+"/lock/"+e.userData.id+"/"+t,type:"PUT",async:!1,showMsg:!1,callback:function(){setCloseAlertTimeOneSecond(),$("#disableUserWin").jqxWindow("close"),$("#decUserGridMgt").jqxGrid("updatebounddata","cells")}})})},this.unbindAll=function(){$("#addDecUserBtn").off("click"),$("#searchDecUserBtn").off("click")}};