var UserFollowMgt=function(){var e=this,o=_global_settings.service.url+"/user/search/userbuy/0/0/"+_global_settings.owner.roleName;this.debug=!1,this.initInput=function(){e.initUserPage(),e.initSearch(),e.initGrid(e.searchObj)},this.initUserPage=function(){$("#userFollow-show").css("display",""),$("#userFollow-date").jqxDropDownList({source:["请选择","最近一周","最近两周","最近三周","本月","本季度","本年"],theme:"energyblue",width:"100%",height:"34px",selectedIndex:0,dropDownHeight:150}),$("#userFollow-sDate").datetimeinput({formatString:"yyyy-MM-dd",width:"100%",height:"34px"}),$("#userFollow-eDate").datetimeinput({formatString:"yyyy-MM-dd",width:"100%",height:"34px"}),$("#userFollow-date").on("change",function(){var e=$("#userFollow-date").attr("id"),o=$("#userFollow-sDate").attr("id"),r=$("#userFollow-eDate").attr("id");setValueById(e,o,r)});var e=null;e="sales"==getCurrentInfo()||"sale"==getCurrentInfo()?ComboBoxSources.getRecords("sale_name"):ComboBoxSources.getRecords("salesInfo_name"),$("#userFollow-sales").comboBox({theme:currentTheme,source:e,searchMode:"contains",displayMember:"name_user",valueMember:"employeeCode",height:34,width:"100%",placeHolder:"请选择或输入"}),$("#userFollow-kefu").comboBox({theme:currentTheme,source:ComboBoxSources.getRecords("custService_name"),searchMode:"contains",displayMember:"name_user",valueMember:"employeeCode",height:34,width:"100%",placeHolder:"请选择或输入用户名"}),$("#userFollow-show").addClass("hiddendiv")},this.searchObj={},this.initGrid=function(){e.setting.source.data=e.searchObj,e.setting.source.url=o;var r=Core.AcDataAdapter("userFollow",e.setting.source,{beforeLoadComplete:function(e){}},e.debug),t={source:r,columnsresize:!1,autorowheight:!0,autoheight:!0,rendergridrows:function(){return r.recordids},columns:[{text:"注册日期",dataField:"createDate",width:"8%",cellsrenderer:function(e,o,r,t,l,s){return'<div class="agrid" style=" margin-top:-21px; position:relative; top:50%; text-overflow: ellipsis;">'+s.createDate.substring(0,10)+"</div>"}},{text:"用户名称",width:"13%",cellsrenderer:function(e,o,r,t,l,s){return'<div class="agrid" style=" margin-top:-21px; position:relative; top:50%; text-overflow: ellipsis;">'+s.username+"<br />"+s.name+"</div>"}},{text:"联系电话",dataField:"telephone",width:"9%",cellsrenderer:function(e,o,r,t,l,s){return'<div class="agrid" style=" margin-top:-21px; position:relative; top:50%; text-overflow: ellipsis;">'+s.telephone+"</div>"}},{text:"销售负责人(姓名/用户名)",width:"11%",cellsrenderer:function(e,o,r,t,l,s){var a='<div class="agrid" style="margin-top:-21px; position:relative; top:50%;">';return(a+=void 0==s.employeeCode||""==s.employeeCode||null==s.employeeCode?"":void 0==getSalesInfoById(null,s.employeeCode)?"":getSalesInfoById(null,s.employeeCode).name_user)+"</div>"}},{text:"客服人员(姓名/用户名)",width:"10%",cellsrenderer:function(e,o,r,t,l,s){var a='<div class="agrid" style="margin-top:-21px; position:relative; top:50%;">';return(a+=void 0==s.customerCode||""==s.customerCode||null==s.customerCode?"":getCustomerInfoById(null,s.customerCode)?"":getCustomerInfoById(null,s.customerCode).name_user)+"</div>"}},{text:"标签",width:"9%",cellsrenderer:function(e,o,r,t,l,s){var a='<div class="agrid" style="margin-top:-21px; position:relative; top:50%;">';return(a+=void 0==s.lebal||null==s.lebal||""==s.lebal?"":s.lebal)+"</div>"}},{text:"备注详情",width:"40%",cellsrenderer:function(e,o,r,t,l,s){var a="",i="";if(void 0!==s.remark)for(var n=0;n<s.remark.length;n++)i=s.remark[n].createDate+"&nbsp;,&nbsp;"+s.remark[n].remark,a+='<div class="agrid" style="position: relative; border-top: 1px solid  #EBEFF2;text-overflow: ellipsis; height:auto; line-height:20px; font-size:13px;" title='+i+">"+i+"</div>";return'<div style="height:auto;">'+a+"</div>"}}],columnsheight:50};$("#userFollow").grid(t)},this.setting={source:{data:e.searchObj},grid:{element:"userFollow"},ajax:{url:o}},this.initSearch=function(){e.searchObj={"owner0.createDate":{value:[],action:"between"},"owner0.loginId":{value:[],action:"like"},"owner0.regTelephone":{value:[],action:"like"},"owner0.employeeCode":{value:[],action:"eq"},"owner0.customerCode":{value:[],action:"eq"}}},this.searchDataInfo=function(){$("#userFollow").jqxGrid("applyfilters"),$("#userFollow").jqxGrid("refreshfilterrow"),$("#userFollow").jqxGrid("clearselection")},this.refreshDataInfo=function(){$("#userFollow").jqxGrid("updatebounddata","cells"),$("#userFollow").jqxGrid("clearselection"),$("#userFollow").jqxGrid("refreshdata")}},UserFollowBindModle=function(e){var o=this;this.search=function(o){var r=$("#userFollow-sDate").val(),t=$("#userFollow-eDate").val(),l=$("#userFollow-name").val(),s=$("#userFollow-telephone").val(),a=$("#userFollow-sales").val(),i=$("#userFollow-kefu").val();e.searchObj["owner0.createDate"].value=[],""!=r&&""!=t&&e.searchObj["owner0.createDate"].value.push(r+" 00:00:00",t+" 23:59:59"),""!=r&&""===t&&(e.searchObj["owner0.createDate"].value.push(r+" 00:00:00"),e.searchObj["owner0.createDate"].action="ge"),""===r&&""!=t&&(e.searchObj["owner0.createDate"].value.push(t+" 23:59:59"),e.searchObj["owner0.createDate"].action="le"),e.searchObj["owner0.loginId"].value=[],""!=l&&e.searchObj["owner0.loginId"].value.push(l),e.searchObj["owner0.regTelephone"].value=[],""!=s&&e.searchObj["owner0.regTelephone"].value.push(s);var n=$("#userFollow-sales").find("input").val(),u=$("#userFollow-kefu").find("input").val();if(e.searchObj["owner0.employeeCode"].value=[],null!=n&&""!=n&&void 0!=n&&e.searchObj["owner0.employeeCode"].value.push(a),e.searchObj["owner0.customerCode"].value=[],null!=u&&""!=u&&void 0!=u&&e.searchObj["owner0.customerCode"].value.push(i),!0===o)return e.searchObj;e.searchDataInfo()},this.initInformation=function(){var e=getConditionParams(o.search(!0));Core.AjaxRequest({type:"GET",async:!1,url:_global_settings.service.url+"/owner/isornotremark/0/0/"+_global_settings.owner.roleName+"/"+e,callback:function(e){$("#readyFollowUser").text(e.noRemark),$("#alreadyFollowUser").text(e.isRemark)},failure:function(e){}})},this.bind=function(){$("#userFollow-search").on("click",function(){$("#userFollow-show").is(":hidden")?$("#userFollow-show").slideDown("slow"):(o.search(),o.initInformation())}),hiddenAclick(),$("#userFollow-export").off("click").on("click",function(){var e=_global_settings.service.url+"/common/export/userbuy/0/0/"+_global_settings.owner.roleName+"/",r=getConditionParams(o.search(!0));$.openHref(e+r+"?t="+Math.random())})},this.unbindAll=function(){}};