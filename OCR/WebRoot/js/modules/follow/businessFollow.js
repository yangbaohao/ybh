var BusinessFollowMgt=function(){var e=this,t=_global_settings.service.url+"/potential/",s=_global_settings.owner.roleName;this.debug=!1,this.initInput=function(){e.initUserPage(),e.initSearch(),e.initGrid(e.searchObj)},this.initUserPage=function(){$("#businessFollow-show").css("display",""),$("#businessFollow-date").jqxDropDownList({source:["请选择","最近一周","最近两周","最近三周","本月","本季度","本年"],theme:"energyblue",width:"100%",height:"34px",selectedIndex:0,dropDownHeight:150}),$("#businessFollow-sDate").datetimeinput({formatString:"yyyy-MM-dd",width:"100%",height:"34px"}),$("#businessFollow-eDate").datetimeinput({formatString:"yyyy-MM-dd",width:"100%",height:"34px"}),$("#businessFollow-date").on("change",function(){var e=$("#businessFollow-date").attr("id"),t=$("#businessFollow-sDate").attr("id"),s=$("#businessFollow-eDate").attr("id");setValueById(e,t,s)});var e=null;e="sales"==getCurrentInfo()||"sale"==getCurrentInfo()?ComboBoxSources.getRecords("sale_name"):ComboBoxSources.getRecords("salesInfo_name"),$("#businessFollow-sales").comboBox({theme:currentTheme,source:e,searchMode:"contains",displayMember:"name_user",valueMember:"employeeCode",height:34,width:"100%",placeHolder:"请选择或输入"}),$("#businessFollow-status").jqxDropDownList({source:{all:"请选择",notContact:"未联系",notSuccess:"未成功",success:"已成功"},width:"100%",height:34,selectedIndex:0,dropDownHeight:150}),$("#businessFollow-show").addClass("hiddendiv")},this.searchObj={},this.initGrid=function(){e.setting.source.data=e.searchObj,e.setting.source.url=t+"page";var s=Core.AcDataAdapter("businessFollow",e.setting.source,{beforeLoadComplete:function(e){}},e.debug),o={source:s,columnsresize:!1,autorowheight:!0,autoheight:!0,rendergridrows:function(){return s.recordids},columns:[{text:"新增日期",dataField:"lastUpdateDate",width:"7%",cellsrenderer:function(e,t,s,o,i,l){return'<div style=" margin-top:-10px; position:relative; top:50%;text-overflow: ellipsis;">'+l.lastUpdateDate.substring(0,10)+"</div>"}},{text:"潜在客户",dataField:"potentialName",width:"10%",cellsrenderer:function(e,t,s,o,i,l){return'<div style=" margin-top:-10px; position:relative; top:50%; text-overflow: ellipsis;">'+l.potentialName+"</div>"}},{text:"联系电话",dataField:"phone",width:"9%",cellsrenderer:function(e,t,s,o,i,l){return'<div style=" margin-top:-10px; position:relative; top:50%; text-overflow: ellipsis;">'+l.phone+"</div>"}},{text:"公司名称",dataField:"contact",width:"13%",cellsrenderer:function(e,t,s,o,i,l){return'<div style=" margin-top:-10px; position:relative; top:50%; text-overflow: ellipsis;">'+l.contact+"</div>"}},{text:"销售负责人(姓名/用户名)",width:"15%",cellsrenderer:function(e,t,s,o,i,l){var a='<div style=" margin-top:-10px; position:relative; top:50%; text-overflow: ellipsis;">';return l.sal.length>0?$.each(l.sal,function(e,t){a+=void 0===getSalesInfoById(l.sal[e].id,null)||""===getSalesInfoById(l.sal[e].id,null)?"":getSalesInfoById(l.sal[e].id,null).name_user+"&nbsp; "}):a+="",a+"</div>"}},{text:"客服负责人(姓名/用户名)",width:"15%",cellsrenderer:function(e,t,s,o,i,l){var a='<div style=" margin-top:-10px; position:relative; top:50%; text-overflow: ellipsis;">';return l.custom.length>0?$.each(l.custom,function(e,t){a+=void 0===getCustomerInfoById(null,l.custom[e].employeeCode)||""===getCustomerInfoById(null,l.custom[e].employeeCode)?"":getCustomerInfoById(null,l.custom[e].employeeCode).name_user+"&nbsp; "}):a+="",a+"</div>"}},{text:"状态",width:"5%",cellsrenderer:function(e,t,s,o,i,l){var a="";return"success"==l.status&&(a+='<div style="margin-top:-6px; position:relative; top:50%;">已成功</div>'),"notContact"==l.status&&(a+='<div style="margin-top:-6px; position:relative; top:50%;">未联系</div>'),"notSuccess"==l.status&&(a+='<div style="margin-top:-6px; position:relative; top:50%;">未成功</div>'),a+"</div>"}},{text:"备注详情",width:"26%",cellsrenderer:function(e,t,s,o,i,l){var a="",n="";if(void 0!==l.trackList)for(var r=0;r<l.trackList.length;r++)n=l.trackList[r].lastUpdateDate+"&nbsp;,&nbsp;"+l.trackList[r].comment,a+='<div class="agrid" style="position: relative; border-top: 1px solid  #EBEFF2;text-overflow: ellipsis; height:auto; line-height:20px; font-size:13px;" title='+n+">"+n+"</div>";return'<div style="height:auto;">'+a+"</div>"}}],columnsheight:45};$("#businessFollow").grid(o)},this.setting={source:{data:e.searchObj},grid:{element:"businessFollow"},ajax:{url:t}},this.initSearch=function(){e.searchObj={"t.createDate":{value:[],action:"between"},potentialName:{value:[],action:"like"},phone:{value:[],action:"like"},contact:{value:[],action:"like"},status:{value:[],action:"eq"},"s.username":{value:[],action:"like"},"t.salesAgent.agentName":{value:[],action:"like"}},"customerService"!=s&&"salesStaff"!=s||(e.searchObj["s.id"]={value:[""+_global_settings.owner.userid],action:"eq"})},this.searchDataInfo=function(){$("#businessFollow").jqxGrid("applyfilters"),$("#businessFollow").jqxGrid("refreshfilterrow"),$("#businessFollow").jqxGrid("clearselection")},this.refreshDataInfo=function(){$("#businessFollow").jqxGrid("updatebounddata","cells"),$("#businessFollow").jqxGrid("clearselection"),$("#businessFollow").jqxGrid("refreshdata")}},BusinessFollowBindModle=function(e){var t=this;this.search=function(t){var s=$("#businessFollow-sales").find("input").val(),o=s.substring(s.indexOf("(")+1,s.length-1),i=$("#businessFollow-sDate").val(),l=$("#businessFollow-eDate").val(),a=$("#businessFollow-customer").val(),n=$("#businessFollow-telephone").val(),r=$("#businessFollow-company").val(),u=void 0==getSalesInfoByName(s)?void 0==getSalesInfoByName(o)?"":getSalesInfoByName(o).username:getSalesInfoByName(s).username,c=$("#businessFollow-status").val();if(e.searchObj["t.createDate"].value=[],""!=i&&""!=l&&e.searchObj["t.createDate"].value.push(i+" 00:00:00",l+" 23:59:59"),""!=i&&""===l&&(e.searchObj["t.createDate"].value.push(i+" 00:00:00"),e.searchObj["t.createDate"].action="ge"),""===i&&""!=l&&(e.searchObj["t.createDate"].value.push(l+" 00:00:00"),e.searchObj["t.createDate"].action="le"),e.searchObj.potentialName.value=[],""!=a&&e.searchObj.potentialName.value.push(a),e.searchObj.phone.value=[],""!=n&&e.searchObj.phone.value.push(n),e.searchObj.contact.value=[],""!=r&&e.searchObj.contact.value.push(r),e.searchObj["s.username"].value=[],""!=u&&null!=u&&e.searchObj["s.username"].value.push(u),e.searchObj.status.value=[],"all"!=c&&e.searchObj.status.value.push(c),!0===t)return e.searchObj;e.searchDataInfo()},this.initInformation=function(){var e=getConditionParams(t.search(!0));Core.AjaxRequest({type:"GET",async:!1,url:_global_settings.service.url+"/potential/followup/"+e,callback:function(e){$("#readyFollowBusiness").text(e.noFollowUp),$("#alreadyFollowBusiness").text(e.isFollowUp)},failure:function(e){}})},this.bind=function(){$("#businessFollow-search").off("click").on("click",function(){$("#businessFollow-show").is(":hidden")?$("#businessFollow-show").slideDown("slow"):(t.search(),t.initInformation())}),hiddenAclick(),$("#businessFollow-export").off("click").on("click",function(){var e=_global_settings.service.url+"/common/export/potential/",s=getConditionParams(t.search(!0));$.openHref(e+s+"?t="+Math.random())})},this.unbindAll=function(){}};