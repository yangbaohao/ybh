var AgentFollowMgt=function(){var e=this,t=_global_settings.service.url+"/salesagent/follow";this.debug=!1,this.initInput=function(){e.initUserPage(),e.initSearch(),e.initGrid(e.searchObj)},this.initUserPage=function(){$("#agentFollow-show").css("display",""),$("#agentFollow-date").jqxDropDownList({source:["请选择","最近一周","最近两周","最近三周","本月","本季度","本年"],theme:"energyblue",width:"100%",height:"34px",selectedIndex:0,dropDownHeight:150}),$("#agentFollow-sDate").datetimeinput({formatString:"yyyy-MM-dd",width:"100%",height:"34px"}),$("#agentFollow-eDate").datetimeinput({formatString:"yyyy-MM-dd",width:"100%",height:"34px"}),$("#agentFollow-date").on("change",function(){var e=$("#agentFollow-date").attr("id"),t=$("#agentFollow-sDate").attr("id"),o=$("#agentFollow-eDate").attr("id");setValueById(e,t,o)});var e=null;e="sales"==getCurrentInfo()||"sale"==getCurrentInfo()?ComboBoxSources.getRecords("sale_name"):ComboBoxSources.getRecords("salesInfo_name"),$("#agentFollow-sales").comboBox({theme:currentTheme,source:e,searchMode:"contains",displayMember:"name_user",valueMember:"employeeCode",height:34,width:"100%",placeHolder:"请选择或输入"}),$("#agentFollow-kefu").comboBox({theme:currentTheme,source:ComboBoxSources.getRecords("custService_name"),searchMode:"contains",displayMember:"name_user",valueMember:"employeeCode",height:34,width:"100%",placeHolder:"请选择或输入"}),$("#agentFollow-show").addClass("hiddendiv")},this.searchObj={},this.initGrid=function(){e.setting.source.data=e.searchObj,e.setting.source.url=t;var o=Core.AcDataAdapter("agentFollow",e.setting.source,{beforeLoadComplete:function(e){}},e.debug),a={source:o,columnsresize:!1,autorowheight:!0,autoheight:!0,rendergridrows:function(){return o.recordids},columns:[{text:"注册日期",dataField:"createDate",width:"8%",cellsrenderer:function(e,t,o,a,l,s){return'<div class="agrid" style=" margin-top:-15px; position:relative; top:50%;text-overflow: ellipsis;">'+s.userInfo.createDate.substring(0,10)+"</div>"}},{text:"代理商名称",dataField:"agentName",width:"8%",cellsrenderer:function(e,t,o,a,l,s){return'<div class="agrid" style=" margin-top:-15px; position:relative; top:50%; text-overflow: ellipsis;">'+s.agentName+"</div>"}},{text:"联系电话",dataField:"telephone",width:"9%",cellsrenderer:function(e,t,o,a,l,s){return'<div class="agrid" style=" margin-top:-15px; position:relative; top:50%; text-overflow: ellipsis;">'+s.userInfo.telephone+"</div>"}},{text:"销售负责人(姓名/用户名)",width:"12%",cellsrenderer:function(e,t,o,a,l,s){var n='<div class="agrid" style=" margin-top:-15px; position:relative; top:50%; text-overflow: ellipsis;">',r=getSatffInfoByKey({keys:"employeeCode",map:"salesInfo_name",words:void 0==s.sales||""==s.sales||null==s.sales?"":s.sales.employeeCode});return(n+=void 0===r||""===r||null===r?"":r.name_user)+"</div>"}},{text:"客服人员(姓名/用户名)",width:"12%",cellsrenderer:function(e,t,o,a,l,s){var n='<div class="agrid" style=" margin-top:-15px; position:relative; top:50%; text-overflow: ellipsis;">',r=getSatffInfoByKey({keys:"employeeCode",map:"custService_name",words:void 0==s.customer||""==s.customer||null==s.customer?"":s.customer.employeeCode});return(n+=void 0===r||""===r||null===r?"":r.name_user)+"</div>"}},{text:"标签",width:"8%",cellsrenderer:function(e,t,o,a,l,s){var n='<div class="agrid" style="margin-top:-15px; position:relative; top:50%;">';return(n+=void 0==s.lebal?"":s.lebal)+"</div>"}},{text:"备注详情",width:"43%",cellsrenderer:function(e,t,o,a,l,s){var n="",r="";if(void 0!==s.trackList)for(var i=0;i<s.trackList.length;i++)r=s.trackList[i].lastUpdateDate.substring(.1)+"&nbsp;,&nbsp;"+s.trackList[i].comment,n+='<div class="agrid" style="position: relative; border-top: 1px solid  #EBEFF2;text-overflow: ellipsis; height:auto; line-height:20px; font-size:13px;">'+r+"</div>";return'<div style="height:auto;">'+n+"</div>"}}],columnsheight:45};$("#agentFollow").grid(a)},this.setting={source:{data:e.searchObj},grid:{element:"agentFollow"},ajax:{url:t}},this.initSearch=function(){e.searchObj={"s.userInfo.createDate":{value:[],action:"between"},"s.agentName":{value:[],action:"like"},"s.userInfo.telephone":{value:[],action:"like"},"s.sales.username":{value:[],action:"like"},"s.customer.username":{value:[],action:"like"}}},this.searchDataInfo=function(){$("#agentFollow").jqxGrid("applyfilters"),$("#agentFollow").jqxGrid("refreshfilterrow"),$("#agentFollow").jqxGrid("clearselection")},this.refreshDataInfo=function(){$("#agentFollow").jqxGrid("updatebounddata","cells"),$("#agentFollow").jqxGrid("clearselection"),$("#agentFollow").jqxGrid("refreshdata")}},AgentFollowBindModle=function(e){var t=this;this.search=function(t){var o=$("#agentFollow-sDate").val(),a=$("#agentFollow-eDate").val(),l=$("#agentFollow-name").val(),s=$("#agentFollow-telephone").val(),n=$("#agentFollow-sales").val(),r=$("#agentFollow-kefu").val();if(e.searchObj["s.userInfo.createDate"].value=[],""!=o&&""!=a&&e.searchObj["s.userInfo.createDate"].value.push(o+" 00:00:00",a+" 23:59:59"),""!=o&&""===a&&(e.searchObj["s.userInfo.createDate"].value.push(o+" 00:00:00"),e.searchObj["s.userInfo.createDate"].action="ge"),""===o&&""!=a&&(e.searchObj["s.userInfo.createDate"].value.push(a+" 00:00:00"),e.searchObj["s.userInfo.createDate"].action="le"),e.searchObj["s.agentName"].value=[],""!=l&&e.searchObj["s.agentName"].value.push(l),e.searchObj["s.userInfo.telephone"].value=[],""!=s&&e.searchObj["s.userInfo.telephone"].value.push(s),e.searchObj["s.sales.username"].value=[],null!=n&&""!=n&&void 0!=n&&e.searchObj["s.sales.username"].value.push(n),e.searchObj["s.customer.username"].value=[],null!=r&&""!=r&&void 0!=r&&e.searchObj["s.customer.username"].value.push(r),!0===t)return e.searchObj;e.searchDataInfo()},this.initInformation=function(){var e=getConditionParams(t.search(!0));Core.AjaxRequest({type:"GET",async:!1,url:_global_settings.service.url+"/salesagent/followup/"+e,callback:function(e){$("#readyFollowAgent").text(e.noFollowUp),$("#alreadyFollowAgent").text(e.isFollowUp)},failure:function(e){}})},this.bind=function(){$("#agentFollow-search").on("click",function(){$("#agentFollow-show").is(":hidden")?$("#agentFollow-show").slideDown("slow"):(t.initInformation(),t.search())}),hiddenAclick(),$("#agentFollow-export").off("click").on("click",function(){var e=_global_settings.service.url+"/common/export/follow/",o=getConditionParams(t.search(!0));$.openHref(e+o+"?t="+Math.random())})},this.unbindAll=function(){$("#agentFollow-search").off("click")}};