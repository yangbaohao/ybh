!function(){timeOut(function(){(new e).init()},0);var e=function(){var e=this,a=_global_settings.service.url;e.init=function(){e.loadPublicControl(),e.loadEvent(),e.requestJson()},e.requestJson=function(){Core.AjaxRequest({url:_global_settings.service.url+"/owner/category/"+currentUserInfo.id,type:"GET",showMsg:!1,callback:function(e){$(".category1_name").val(e.category1),$(".category1_name").val(e.category2)},failure:function(e){Core.alert({message:e.responseJSON.errorMsg})}});var n;void 0!=$.pk.data?void 0!=$.pk.data.dcmid&&(n=$.pk.data.dcmid):void 0!=$.pk.id&&(n=$.pk.id),Core.AjaxRequest({type:"GET",url:a+"/ac/"+(new Base64).encode("tobss/receipt/generaldocument/"+n+"/"+currentUserInfo.id+"/"+currentUserInfo.loginId),callback:function(a){json=a;var r=a;$("#generalView_returnFlag")[0].checked=r.returnFlag,$("#generalView_campanyFlag")[0].checked=r.isStuff,$("#generalView_type").val(r.dcmType),$("#generalView_clientName").val(r.clientInfoId),$("#generalView_vendorName").val(r.clientInfoId),$("#generalView_num").val(r.payNumber),$("#generalView_time").val(r.entryDate),$("#generalView_way").val(r.payWay),$("#generalView_category1").val(r.Category1),$("#generalView_category2").val(r.Category2),$("#generalView_moneyType").val(getCodeData(r.oandiType));var i=ComboBoxSources.getInfoMapByKey("chartOfAccounts","id");if(null!=r.coaDeposits){for(var l=r.coaDeposits.split(","),o="",t=0;t<l.length;t++)o+=i[l[t]].name+",";o=o.substring(0,o.length-1),$("#generalView_account").val(o)}if(null!=r.coaReasons){for(var l=r.coaReasons.split(","),s="",t=0;t<l.length;t++)s+=i[l[t]].name+",";s=s.substring(0,s.length-1),$("#generalView_reason").val(s)}if(null!=r.oandiType){for(var d=r.oandiType.split(","),c="",t=0;t<d.length;t++)c+=getCodeData(d[t])+",";c=c.substring(0,c.length-1),$("#generalView_moneyType").replaceWith('<input type="text" class="form-control" value="" readonly="readonly" id="generalView_moneyType">'),$("#generalView_moneyType").val(c)}$("#generalView_amt").val(money(r.amt)),$("#generalView_preAmount").val(money(r.prepareAmt)),0!=r.isUsername?(null!=r.userId&&$("#generalView_person-show").removeClass("hide"),$("#generalView_person").val(r.userId)):($("#generalView_person").replaceWith('<input type="text" class="form-control" value="" readonly="readonly" id="generalView_person">'),$("#generalView_person").val(r.username),$("#generalView_person-show").find(".control-label").text("预支人员")),$("#generalView_mark").val(r.lebal),$("#generalView_invType").val(getCodeData(r.receiptInvoiceType)),$("#generalView_tax").val(r.vat),$("#generalView_rmb").val(r.currency),$("#generalView_invNum").val(r.receiptNumber),$("#generalView_invMon").val(r.receiptAmt),$("#generalView_addremarkPrint").val(r.remarkprint),$("#generalView_addremark").val(r.remark);var g=$("#generalView_type").jqxDropDownList("getSelectedIndex"),w=-1==$("#generalView_moneyType").jqxDropDownList("getSelectedIndex")?0:$("#generalView_moneyType").jqxDropDownList("getSelectedIndex");e.set_person(g,w,r.coaDeposits,r.coaReasons);var u=$("#generalView_addattachment");timeOut(function(){u.fileuploader({readonly:!0,filelist:r.fileInfoIds})}),$.visibleDoFunc($("#generalView_addForm").find(".jqx-dropdownlist-state-normal"),function(e){e.jqxDropDownList("disabled",!0)}),$.visibleDoFunc($("#generalView_addForm").find(".jqx-combobox"),function(e){e.jqxComboBox("disabled",!0)}),$.visibleDoFunc($("#generalView_addForm").find(".jqx-datetimeinput"),function(e){e.jqxDateTimeInput("disabled",!0)}),$.visibleDoFunc($("#generalView_addForm").find("input"),function(e){e.attr("readonly","readonly")}),$("#generalView_accountday").val(r.termValue),$("#generalView_returnFlag").attr("disabled","disabled"),$("#generalView_campanyFlag").attr("disabled","disabled"),$("#generalView_print").on("click",function(){r.dcmType in{nowreceivables:0,answerreceivables:1,preparereceivables:2}?window.open("page/print/printHtml.jsp?reportName=CurrencyBill&CurrencyBillId="+r.id+"&printType=pdf"):window.open("page/print/printHtml.jsp?reportName=CurrencyBillPay&CurrencyBillPayId="+r.id+"&printType=pdf")}),0==r.createFlag&&$("#generalView_addsave").remove(),null!=r.receiptInvoiceType&&""!=r.receiptInvoiceType||$("#generalView_invType_show").remove();var p=_global_settings.service.url;$("#generalView_save").on("click",function(){var e={};e.amount=r.amt,e.orderNumber=r.payNumber,e.clientInfoId=r.clientInfoId,e.bizId=r.id,e.favouritesType="generraldocument",Core.AjaxRequest({url:p+"/favourites",type:"POST",params:e,callback:function(e){},failure:function(e){}})}),$("#generalView_del").on("click",function(){Core.confirm({message:"确定要删除？",confirmCallback:function(){Core.AjaxRequest({url:p+"/generalDocuments/delete/"+n,type:"GET",callback:function(e){$.closeTab()},failure:function(e){}})}})});var _={createby:{"编辑":"generalView_addsave","删除":"generalView_del"}};new powerStatus(r,_).init(),idReset("generalView_addForm")},failure:function(){idReset("generalView_addForm"),$.closeTab()}})},e.loadPublicControl=function(){var e={};e="generalvat"==_global_settings.owner.taxType?{" ":" ",otherinvoice:"其他",specialinvoice:"增值税专用发票",ordinaryinvoice:"增值税普通发票"}:{" ":" ",otherinvoice:"其他",ordinaryinvoice:"增值税普通发票"},$("#generalView_invType").dropDownlist({source:e,selectedIndex:0,width:"100%"}),$("#generalView_addCategory1Btn").on({click:function(){var e=$(this).attr("data");Core.showModal({type:e,broth:"generalView_category1",callback:function(e){}})}}),$("#generalView_addCategory2Btn").on({click:function(){var e=$(this).attr("data");Core.showModal({type:e,broth:"generalView_category2",callback:function(e){}})}}),$("#generalView_way").dropDownlist({source:{cash:"现金",alipay:"支付宝",wechatpay:"微信支付",bankpay:"银行存款",bankpayonline:"网银支付",cheque:"支票",journalOutflow:"凭证流出",journalInflow:"凭证流入"},placeHolder:"",width:"100%"}),$("#generalView_time").datetimeinput({width:"100%",height:33,value:new Date}),$("#generalView_amt").moneyinput(),$("#generalView_preAmount").moneyinput(),$("#generalView_category1").comboBoxType({source:ComboBoxSources.getRecords("category1"),placeHolder:"",width:"100%"}),$("#generalView_category2").comboBoxType({source:ComboBoxSources.getRecords("category2"),placeHolder:"",width:"100%"}),$("#generalView_tax").dropDownlist({source:{0:"0%",3:"3%",5:"5%",6:"6%",11:"11%",13:"13%",17:"17%"},selectedIndex:0,width:"100%"}),$("#generalView_type").dropDownlist({source:{nowreceivables:"现收款",answerreceivables:"预收款",preparereceivables:"应收款",nowpayment:"现付款",answerpayment:"预付款",preparepayment:"应付款",otherdocuments:"其他"},width:"100%"}),$("#generalView_person").comboBox({source:ComboBoxSources.getRecords("users"),displayMember:"name",valueMember:"userid"}),$("#generalView_clientName").comboBox({source:ComboBoxSources.getRecords("clientInfo"),displayMember:"name",valueMember:"clientInfoid",placeHolder:"",height:"33px",width:"100%"}),$("#generalView_vendorName").comboBox({source:ComboBoxSources.getRecords("clientInfo"),displayMember:"name",valueMember:"clientInfoid",placeHolder:"",width:"100%"})},e.loadControlPayIn=function(e){$("#generalView_moneyType").dropDownlist({source:{choose:"",outofbusiness:"营业外",mainbusiness:"主营业务",otherbusiness:"其他业务",shorttermloan:"关于借款",OtherPay:"其他应付",interestincome:"利息收入","documentsgetPay ":"冲销应收款 "},placeHolder:"",width:"100%"}),0==e&&$("#generalView_returnFlag").is(":checked")&&($("#generalView_moneyType").dropDownlist({source:{returnvendor:"供应商退款"},width:"100%",selectedIndex:0}),$("#generalView_addForm").find(".control-label.col-sm-4").each(function(){$(this).text($(this).text().replace("应收","应付").replace("预收","预付"))}))},e.loadControlPayOut=function(e){$("#generalView_moneyType").dropDownlist({source:{choose:"",SALES:"销售",MANAGEMENT:"管理",FINANCE:"财务",UNRELATED:"营业外",IMPREST:"提取备用金",ADVANCE:"预支报销",PREPAREWAGES:"预支工资",Otherreceivable:"其他应收",STAFF:"关于职工",REPAYMENT:"关于还款","documentsPay ":"冲销应付款 ",carryoverCost:"结转成本"},placeHolder:"",width:"100%"}),3==e&&$("#generalView_returnFlag").is(":checked")&&($("#generalView_moneyType").dropDownlist({source:{returnclient:"客户退款"},width:"100%",selectedIndex:0}),$("#generalView_addForm").find(".control-label.col-sm-4").each(function(){$(this).text($(this).text().replace("应付","应收").replace("预付","预收"))}))},e.loadEvent=function(){var a=function(e){switch(e){case 0:!function(){$("#generalView_addForm").find(".hide").removeClass("hide"),$("#generalView_moneyType").trigger("change"),$("#generalView_returnFlag").is(":checked")?$("#generalView_clientName_show").addClass("hide"):$("#generalView_vendorName_show").addClass("hide"),$("#generalView_campanyFlag").is(":checked")&&$("#generalView_campanyFlag_show").addClass("hide")}();break;case 1:!function(){$("#generalView_addForm").find(".hide").removeClass("hide"),$("#generalView_moneyType").trigger("change"),$("#generalView_moneyType-show").addClass("hide"),$("#generalView_reason-show").addClass("hide"),$("#generalView_vendorName_show").addClass("hide"),$("#generalView_returnFlag_show").addClass("hide")}();break;case 2:!function(){$("#generalView_addForm").find(".hide").removeClass("hide"),$("#generalView_moneyType").trigger("change"),$("#generalView_way-show").addClass("hide"),$("#generalView_account-show").addClass("hide"),$("#generalView_vendorName_show").addClass("hide"),$("#generalView_returnFlag_show").addClass("hide")}();break;case 3:!function(){$("#generalView_addForm").find(".hide").removeClass("hide"),$("#generalView_moneyType").trigger("change"),$("#generalView_returnFlag").is(":checked")?$("#generalView_vendorName_show").addClass("hide"):$("#generalView_clientName_show").addClass("hide"),$("#generalView_campanyFlag").is(":checked")&&$("#generalView_campanyFlag_show").addClass("hide")}();break;case 4:!function(){$("#generalView_addForm").find(".hide").removeClass("hide"),$("#generalView_moneyType").trigger("change"),$("#generalView_moneyType-show").addClass("hide"),$("#generalView_reason-show").addClass("hide"),$("#generalView_clientName_show").addClass("hide"),$("#generalView_returnFlag_show").addClass("hide")}();break;case 5:!function(){$("#generalView_addForm").find(".hide").removeClass("hide"),$("#generalView_moneyType").trigger("change"),$("#generalView_way-show").addClass("hide"),$("#generalView_account-show").addClass("hide"),$("#generalView_clientName_show").addClass("hide"),$("#generalView_returnFlag_show").addClass("hide")}()}};$("#generalView_type").on("change",function(){var n=$(this).jqxDropDownList("getSelectedIndex");$("#generalView_moneyType").jqxDropDownList({selectedIndex:0}),n<3?($("#generalView_addForm").find(".control-label.col-sm-3").each(function(){$(this).text($(this).text().replace("付款","收款").replace("支出账户","存入账户").replace("支出类别","收入类别"))}),$("#generalView_addForm").find(".control-label.col-sm-4").each(function(){$(this).text($(this).text().replace("应付","应收").replace("预付","预收"))}),$("#generalView_addForm").find(".generalView_returnFlag").each(function(){$(this).text($(this).text().replace("客户","供应商"))}),$("#generalView_addForm").find(".generalView_campanyFlag").each(function(){$(this).text($(this).text().replace("支出","收入"))}),e.loadControlPayIn(n)):($("#generalView_addForm").find(".control-label.col-sm-3").each(function(){$(this).text($(this).text().replace("收款","付款").replace("存入账户","支出账户").replace("收入类别","支出类别"))}),$("#generalView_addForm").find(".control-label.col-sm-4").each(function(){$(this).text($(this).text().replace("应收","应付").replace("预收","预付"))}),$("#generalView_addForm").find(".generalView_returnFlag").each(function(){$(this).text($(this).text().replace("供应商","客户"))}),$("#generalView_addForm").find(".generalView_campanyFlag").each(function(){$(this).text($(this).text().replace("收入","支出"))}),e.loadControlPayOut(n)),a(n)}),$("#generalView_clientName,#generalView_vendorName").on("change",function(){$("#generalView_type").trigger("change")}),$("#generalView_returnFlag").on("change",function(){$("#generalView_campanyFlag")[0].checked=!1,$("#generalView_type").trigger("change")}),$("#generalView_campanyFlag").on("change",function(){$("#generalView_returnFlag")[0].checked=!1,$("#generalView_type").trigger("change")}),$("#generalView_person,#generalView_account").on("change",function(){var a=$("#generalView_type").jqxDropDownList("getSelectedIndex"),n=-1==$("#generalView_moneyType").jqxDropDownList("getSelectedIndex")?0:$("#generalView_moneyType").jqxDropDownList("getSelectedIndex");e.set_person(a,n)}),$("#generalView_moneyType").on("change",function(){$("#generalView_preAmount-show").addClass("hide"),$("#generalView_person-show").addClass("hide");var a=$("#generalView_type").jqxDropDownList("getSelectedIndex"),n=$(this).jqxDropDownList("getSelectedIndex");if(a<3){if(0==a&&$("#generalView_returnFlag").is(":checked"))return;if(7==n)return void $("#generalView_preAmount-show").removeClass("hide");var r={0:"",1:"6301",2:"6001",3:"6051",4:"2001",5:"2241",6:"660302",7:"a",8:"a",9:"a",10:"a",11:"a"}}else{if(3==a&&$("#generalView_returnFlag").is(":checked"))return;if(11==n)return void $("#generalView_preAmount-show").removeClass("hide");var r={0:"",1:"6601",2:"6602",3:"6603",4:"6711",5:"1001",6:"1221",7:"1221",8:"1221",9:"2211",10:"2001,2241",11:"a",12:"6401"}}r[n].split(","),$("#generalView_person").jqxComboBox("clearSelection"),e.set_person(a,n)}),e.set_person=function(e,a,n,r){var i=null==n?"":n,l=null==r?"":r;0==json.createFlag&&null!=json.userId&&$("#generalView_person-show").removeClass("hide"),e>2&&(6==a||7==a||8==a||3==e&&!$("#generalView_returnFlag").is(":checked")&&a<11&&$.strEqArr("26",i.split(","))||$.strEqArr("26",l.split(",")))&&$("#generalView_person-show").removeClass("hide"),3==e&&!$("#generalView_returnFlag").is(":checked")&&a<11&&""!=$("#generalView_person").val()&&$.strEqArr("26",i.split(","))?$("#generalView_amt").attr("disabled","disabled"):$("#generalView_amt").removeAttr("disabled")},$("#generalView_addsave").on("click",function(){$.closeTab(),$.addTab({title:"编辑通用单据",url:"page/modules/public/generalEdit.html",pk:{id:id},reload:!0})})},e.getJson=function(){var e=$("#generalView_clientName").is(":visible")?$("#generalView_clientName").val():null,a=$("#generalView_type").is(":visible")?$("#generalView_type").val():null,n=$("#generalView_num").is(":visible")?$("#generalView_num").val():null,r=$("#generalView_time").is(":visible")?$("#generalView_time").val():null,i=$("#generalView_way").is(":visible")?$("#generalView_way").val():null,l=$("#generalView_account").is(":visible")?$("#generalView_account").val():null,o=$("#generalView_moneyType").is(":visible")?$("#generalView_moneyType").val():null,t=$("#generalView_reason").is(":visible")?$("#generalView_reason").val():null,s=$("#generalView_amt").is(":visible")?$("#generalView_amt").val():null,d=$("#generalView_preAmount").is(":visible")?$("#generalView_preAmount").val():null,c=$("#generalView_person").is(":visible")?$("#generalView_person").val():null,g=$("#generalView_mark").is(":visible")?$("#generalView_mark").val():null,w=$("#generalView_category1").is(":visible")?$("#generalView_category1").val():null,u=$("#generalView_category2").is(":visible")?$("#generalView_category2").val():null,p=$("#generalView_invType").is(":visible")?$("#generalView_invType").val():null,_=$("#generalView_tax").is(":visible")?$("#generalView_tax").val():null,m=$("#generalView_rmb").is(":visible")?$("#generalView_rmb").val():null,V=$("#generalView_invNum").is(":visible")?$("#generalView_invNum").val():null,h=$("#generalView_invMon").is(":visible")?$("#generalView_invMon").val():null,y=$("#generalView_addremarkPrint").is(":visible")?$("#generalView_addremarkPrint").val():"",v=$("#generalView_addremark").is(":visible")?$("#generalView_addremark").val():"",f="sales";$("#generalView_type").jqxDropDownList("getSelectedIndex")>2&&(f="purchase");var b=[];return $("#generalView_addattachment").find(".item").each(function(e,a){var n=$(a).attr("data-id");void 0!==n&&b.push(n)}),b=b.toString(),{clientInfoId:e,payNumber:n,payWay:i,dcmType:a,currency:m,receiptNumber:V,receiptInvoiceType:p,amt:s,lebal:g,prepareAmt:d,vat:_,receiptAmt:h,entryDate:r,oandiType:o,Category1:w,Category2:u,coaDeposits:l,coaReasons:t,remark:v,remarkprint:y,documentType:f,userId:c,fileInfoIds:b}},e.save=function(){var n=e.getJson();Core.AjaxRequest({url:a+"/generalDocuments/",type:"POST",async:!1,params:n,callback:function(e){$.closeTab()},failure:function(e){}})}}}();