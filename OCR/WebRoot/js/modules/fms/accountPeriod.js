timeOut(function(){!function(){function t(t){if(!t)return!1;$("#acpd-check1").children().eq(0).before('<div class="panel panel-default acpd_YWWL">                                                              \t<div class="panel-heading" data-toggle="collapse"                                           \t\tdata-parent="#accordion-test-2zf1" href="#acpd-YWWL"                        \t\taria-expanded="false">                                                                  \t\t<h4 class="panel-title">                                                                \t\t\t<a class="zkk collapsed"><span class="acpd-num">1</span>.业务往来挂账与财务往来账款</a><span class="weijiancha"><a\t\t\t\tclass="hoverspan acpd-label0" style="color: #169ad0;"                           \t\t\t\t></a></span>                                                                                                                                          \t\t</h4>                                                                                   \t</div>                                                                                      \t<div id="acpd-YWWL" class="panel-collapse collapse"                                         \t\taria-expanded="false" style="height: 0px;">                                             \t\t<div class="panel-body">                                                                \t\t\t<div class="card-box" style="background: #ffffff;">                                 \t\t\t\t<div class="row">                                                               \t\t\t\t\t<div class="table-responsive">                                              \t\t\t\t\t\t<table class="table m-0 tablewhite">                                    \t\t\t\t\t\t\t<tbody>                                                             \t\t\t\t\t\t\t</tbody>                                                            \t\t\t\t\t\t</table>                                                                \t\t\t\t\t</div>                                                                                                                                                                     \t\t\t\t</div>                                                                          \t\t\t</div>                                                                              \t\t</div>                                                                                  \t</div>                                                                                      </div>                                                                                         '),0!=c?Core.AjaxRequest({type:"GET",url:a+"/ac/"+(new Base64).encode("tosys/carryover/search/accountsForInit/"+$("#acpd-datetime").val()+"/"+currentUserInfo.id+"/"+currentUserInfo.loginId).replace("_$_",".").replace(/\//g,"_a").replace(/\+/g,"_b").replace(/\=/g,"_c"),callback:function(t){var a="",c=0;if(null!=t){var n={"期初预收款":"客户期初预收总额-预收账款期初值=","期初应收款":"客户期初应收总额-应收账款期初值=","期初预付款":"供应商期初预付总额-预付账款期初值=","期初应付款":"供应商期初应付总额-应付账款期初值="};for(var r in t)0!=t[r]&&(a+='<tr style="border-bottom: 2px solid #D2D2D2;"><td style="width: 40%;"><span >'+r+"</span></td><td>"+n[r]+(t[r]>0?moneyBig(t[r])+">0":moneyBig(t[r])+"<0")+'<span style="padding-left:10px;color:red;font-weight:900;font-size:17px;">!<span></td></tr>',c+=1,o=!1)}$(".acpd-label0").text("共有4项——其中"+c+"项会有危险"),$("#acpd-YWWL").find("tbody").html(a),c>0?$("#acpd-YWWL").collapse("show"):$("#acpd-YWWL").collapse("hide"),e()},failure:function(t){}}):e()}function e(){$(".acpd-num").each(function(t,e){$(this).text(t+1)}),0!=c&&(0==o?$(".acpd-label3").text("有红色风险，不可继续结账！"):$(".acpd-label3").text("无红色风险，点击继续结账，去结账吧！"))}var a=_global_settings.service.url,o=!0,c=0;$("#acpd-datetime").monthpicker({callback:"a"}),checkInitialAccountPeriod(t),$(".acpd-label1").on("click",function(){$.addTab({title:"期末结转",isFrame:!1,url:"page/modules/fms/finalTransaction.html",reload:!0})}),$(".acpd-label2").on("click",function(){$.addTab({title:"资产负债表",isFrame:!1,url:"page/modules/equipment/assetLiabilitie.html",reload:!0})}),$("#acpd-cknow").on("click",function(){currentUserInfo.mouthDate<$("#acpd-datetime").val()?Core.confirm({message:currentUserInfo.mouthDate+"账期未关闭,是否继续检查"+$("#acpd-datetime").val()+"账期？",title:"提示",confirmCallback:function(){c++,$(".acpd_YWWL").remove(),checkInitialAccountPeriod(t),Core.AjaxRequest({type:"GET",url:a+"/ac/"+(new Base64).encode("tosys/carryover/search/accounts/"+$("#acpd-datetime").val()+"/"+currentUserInfo.id+"/"+currentUserInfo.loginId).replace("_$_",".").replace(/\//g,"_a").replace(/\+/g,"_b").replace(/\=/g,"_c"),callback:function(t){var a=t,c=0,n=0,r="",l="";for(var s in a)if("报表结平"!==s){if("结转损益"===s){var i='<span style="padding-left:10px;color:red;font-weight:900;font-size:17px;">!<span>';o=!1}else var i='<span style="padding-left:10px;color:yellow;font-weight:900;font-size:17px;">!<span>';r+='<tr style="border-bottom: 2px solid #D2D2D2;"><td style="width: 40%;"><span >'+s+"</span></td><td>本月未"+s+i+"</td></tr>",c+=1}else{var i='<span style="padding-left:10px;color:red;font-weight:900;font-size:17px;">!<span>';l+='<tr style="border-bottom: 2px solid #D2D2D2;"><td style="width: 40%;"><span >资产负债表</span></td><td>不平'+i+"</td></tr>",n+=1,o=!1}$(".acpd-label1").text("共有6项——其中"+c+"项会有危险"),$(".acpd-label2").text("共有1项——其中"+n+"项会有危险"),$("#acpd-finalTransaction").find("tbody").html(r),$("#acpd-reportform").find("tbody").html(l),c>0?$("#acpd-finalTransaction").collapse("show"):$("#acpd-finalTransaction").collapse("hide"),n>0?$("#acpd-reportform").collapse("show"):$("#acpd-reportform").collapse("hide"),e()},failure:function(t){}})}}):(c++,$(".acpd_YWWL").remove(),checkInitialAccountPeriod(t),Core.AjaxRequest({type:"GET",url:a+"/ac/"+(new Base64).encode("tosys/carryover/search/accounts/"+$("#acpd-datetime").val()+"/"+currentUserInfo.id+"/"+currentUserInfo.loginId).replace("_$_",".").replace(/\//g,"_a").replace(/\+/g,"_b").replace(/\=/g,"_c"),callback:function(t){var a=t,c=0,n=0,r="",l="";for(var s in a)if("报表结平"!==s){if("结转损益"===s){var i='<span style="padding-left:10px;color:red;font-weight:900;font-size:17px;">!<span>';o=!1}else var i='<span style="padding-left:10px;color:yellow;font-weight:900;font-size:17px;">!<span>';r+='<tr style="border-bottom: 2px solid #D2D2D2;"><td style="width: 40%;"><span >'+s+"</span></td><td>本月未"+s+i+"</td></tr>",c+=1}else{var i='<span style="padding-left:10px;color:red;font-weight:900;font-size:17px;">!<span>';l+='<tr style="border-bottom: 2px solid #D2D2D2;"><td style="width: 40%;"><span >资产负债表</span></td><td>不平'+i+"</td></tr>",n+=1,o=!1}$(".acpd-label1").text("共有6项——其中"+c+"项会有危险"),$(".acpd-label2").text("共有1项——其中"+n+"项会有危险"),$("#acpd-finalTransaction").find("tbody").html(r),$("#acpd-reportform").find("tbody").html(l),c>0?$("#acpd-finalTransaction").collapse("show"):$("#acpd-finalTransaction").collapse("hide"),n>0?$("#acpd-reportform").collapse("show"):$("#acpd-reportform").collapse("hide"),e()},failure:function(t){}}))}),$("#acpd-goon").on("click",function(){if(Core.AjaxRequest({type:"GET",async:!1,showMsg:!1,url:a+"/common/owner/accountperiod/"+currentUserInfo.id,callback:function(t){accountdate=t.accountPeriodMonth},failure:function(t){Core.alert({message:"系统出错！"})}}),accountdate<$("#acpd-datetime").val())return Core.alert({message:accountdate+"账期未关闭，请检查"+accountdate+"账期"}),!1;Core.AjaxRequest({type:"GET",showMsg:!1,url:a+"/ac/"+(new Base64).encode("tosys/carryover/closeAccountPeriod/"+currentUserInfo.id+"/"+currentUserInfo.loginId).replace("_$_",".").replace(/\//g,"_a").replace(/\+/g,"_b").replace(/\=/g,"_c"),async:!1,callback:function(t){if("报表结平"==t.createBy){var e=t.accountPeriodMonth.toString().substring(5,7);0==e&&(e=12),1==e.length&&(e="0"+e);var a=e+"月份报表不平，不能结账！";Core.alert({message:a}),_global_settings.owner.accountPeriodMonth=t.accountPeriodMonth}else{var o=t.accountPeriodMonth.toString().substring(5,7)-1;0==o&&(o=12),1==o.length&&(o="0"+o);var a="结账成功，"+o+"月份账期已关闭";Core.alert({message:a}),_global_settings.owner.accountPeriodMonth=t.accountPeriodMonth}},failure:function(t){Core.alert({message:"系统出错！"})}})}),$("#acpd-goback").on("click",function(){Core.AjaxRequest({type:"GET",async:!1,url:a+"/ac/"+(new Base64).encode("tosys/carryover/reOpenAccountPeriod/"+currentUserInfo.id+"/"+currentUserInfo.loginId).replace("_$_",".").replace(/\//g,"_a").replace(/\+/g,"_b").replace(/\=/g,"_c"),callback:function(t){var e="没有关闭的会计期，不能反结账！";if(void 0!=t.accountPeriodMonth){e="反结账成功，"+t.accountPeriodMonth.toString().substring(0,7)+"月份账期已打开"}Core.alert({message:e}),_global_settings.owner.accountPeriodMonth=t.accountPeriodMonth},failure:function(t){}})})}()},10);