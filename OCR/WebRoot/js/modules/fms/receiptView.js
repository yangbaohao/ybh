var ReceiptView=function(){var e=this,t=_global_settings.service.url,n=(_global_settings.service.url,null),r=null,c=null;this.initInput=function(){n=$.pk.data.receiptid,void 0!=$.pk.data.bizId&&(r=$.pk.data.bizId),e.initInterface(),e.initUserPage(),e.bindModel()},this.initInterface=function(){var e=null;e=void 0!=$.pk.data.bizId?r:n,Core.AjaxRequest({url:t+"/receipt/id/"+e+"/"+currentUserInfo.id,type:"GET",async:!1,callback:function(e){c=e},failure:function(){}}),Core.AjaxRequest({url:t+"/common/getAllclient/N/"+currentUserInfo.id,type:"GET",async:!1,callback:function(e){clientARd=e},failure:function(){}}),Core.AjaxRequest({url:t+"/common/getAllclient/Y/"+currentUserInfo.id,type:"GET",async:!1,callback:function(e){clientCRd=e},failure:function(){}})},this.getClientCustomer=function(e){for(i=0;i<clientCRd.length;i++)if(e==clientCRd[i].clientId)return clientCRd[i];if(!e)return""},this.getClientAgent=function(e){for(i=0;i<clientARd.length;i++)if(e==clientARd[i].clientId)return clientARd[i];if(!e)return""},this.initUserPage=function(){"sales"==c.receiptType?($("#receiptView-radioOut").attr("checked",!0),$("#rcptView-account").parent().parent().find("label:first").text("收款账户")):"purchase"==c.receiptType&&($("#receiptView-radioIn").attr("checked",!0),$("#rcptView-account").parent().parent().find("label:first").text("付款账户")),$("#receiptView-radioOut").attr("disabled",!0),$("#receiptView-radioIn").attr("disabled",!0),$("#rcptView-reasons").jqxComboBox({source:c,width:"100%",height:"34px",disabled:!0,displayMember:"name",valueMember:"id"}),$("#rcptView-account").jqxComboBox({source:c,width:"100%",height:"34px",disabled:!0,displayMember:"name",valueMember:"id"}),void 0!=c.clientId?void 0!=e.getClientCustomer(c.clientId)?$("#rcptView-clientName").val(e.getClientCustomer(c.clientId).name):void 0!=e.getClientAgent(c.clientId)&&$("#rcptView-clientName").val(e.getClientAgent(c.clientId).name):void 0!=c.name?$("#rcptView-clientName").val(c.name):$("#rcptView-clientName").val(""),$("#rcptView-num").val(void 0==c.receiptNumber?"":c.receiptNumber),$("#rcptView-time").val(void 0==c.entryDate?"":c.entryDate.substring(0,10)),$("#rcptView-tax").val(void 0==c.taxRate?"0%":c.taxRate+"%"),$("#rcptView-sum").val(money(c.receiptAmt)),$("#rcptView-addremarkPrint").val(void 0==c.remark2?"":c.remark2),$("#rcptView-addremark").val(void 0==c.remark?"":c.remark),$("#rcptView-nosum").val(money(c.unuseAmt)),$("#rcptView-reasons").find("input").css("color","#000"),$("#rcptView-account").find("input").css("color","#000"),$("#rcptView-reasons").val(void 0==c.coaReason?"":void 0==c.coaReason.id?"":c.coaReason.id),$("#rcptView-account").val(void 0==c.coaDeposit?"":void 0==c.coaDeposit.id?"":c.coaDeposit.id),$("#rcptView-category").val(void 0==getCodeData(c.receiptInvoiceType)?"":getCodeData(c.receiptInvoiceType)),void 0==c.coaReason&&void 0==c.coaDeposit&&($("#rcptView-editsave").css("display","none"),$("#rcptView-delsave").css("display","none"))},this.bindModel=function(){$("#rcptView-addattachment").fileuploader({readonly:!0,filelist:c.fileInfoIds}),$("#rcptView-delsave").off("click").on("click",function(){Core.confirm({message:"确定要删除？",confirmCallback:function(){Core.AjaxRequest({type:"DELETE",showWaiting:!1,url:_global_settings.service.url+"/ac/"+(new Base64).encode("tobss/receipt/delete/"+c.id+"/"+currentUserInfo.id+"/"+currentUserInfo.loginId),showMsg:!1,callback:function(e){setCloseAlertTimeOneSecond(),$.closeTab(),$("#rcpt-Grid").jqxGrid("updatebounddata","cells")},failure:function(e){}})}})}),$("#rcptView-editsave").on("click",function(){$.closeTab(),$.addTab({title:"发票编辑",url:"page/modules/fms/receiptEdit.html",pk:{data:c},reload:!0})}),$("#rcptView-addsaveprint").off("click").on("click",function(){var e;void 0==c.coaReason&&void 0==c.coaDeposit?($("#receiptView-radioOut")[0].checked?e=(new Base64).encode("reportName=SalesReceiptPrint&salesReceiptId="+c.id+"&printType=pdf&ownerId="+currentUserInfo.id+"&username="+currentUserInfo.loginId):$("#receiptView-radioIn")[0].checked&&(e=(new Base64).encode("reportName=PurchaseReceiptPrint&purchaseReceiptId="+c.id+"&printType=pdf&ownerId="+currentUserInfo.id+"&username="+currentUserInfo.loginId)),window.open(_global_settings.service.url+"/ac/print/"+e)):($("#receiptView-radioOut")[0].checked?e=(new Base64).encode("reportName=SalesReceiptPrintbss&salesReceiptId="+c.id+"&printType=pdf&ownerId="+currentUserInfo.id+"&username="+currentUserInfo.loginId):$("#receiptView-radioIn")[0].checked&&(e=(new Base64).encode("reportName=PurchaseReceiptPrintbss&purchaseReceiptId="+c.id+"&printType=pdf&ownerId="+currentUserInfo.id+"&username="+currentUserInfo.loginId)),window.open(_global_settings.service.url+"/ac/print/"+e))})},this.unbindAll=function(){}};