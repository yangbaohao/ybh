!function(){function e(e){var t=$("#createJoutnalTable> tbody").children().eq(-1);t.find(".createJoutnalSelect").eq(-1).coaCombbox({width:"100%"});var a=i,r=e.id,n=void 0===e.creditAmt?0:parseFloat(e.creditAmt),l=void 0===e.debitAmt?0:parseFloat(e.debitAmt);u+=n,d+=l,t.find(".createJoutnalChart").val(a),t.find(".createJoutnalSelect").val(r),t.find(".createJoutnalNum").eq(0).val(0===l?"":e.debitAmt),t.find(".createJoutnalNum").eq(1).val(0===n?"":e.creditAmt),$("#createJoutnalTable> tbody").children().eq(-1).after(p()),$(".createJoutnalSelect").eq(-1).coaCombbox({width:"100%"})}function t(e,t){var a=$("#createJoutnalTable> tbody").children().eq(-1);a.find(".createJoutnalSelect").eq(-1).coaCombbox({width:"100%"});var r=i,n=0,l=0;a.find(".createJoutnalChart").val(r),"credit"!==getProductInfoById(e,"chartOfAccounts","","hardCode").debitCredit?(e=getProductInfoById(e,"chartOfAccounts","","hardCode").id,t>0?(a.find(".createJoutnalSelect").val(e),l=parseFloat(t),a.find(".createJoutnalNum").eq(1).val(money(t)),a.find(".createJoutnalNum").eq(0).val("")):t<0&&(a.find(".createJoutnalSelect").val(e),n=-parseFloat(t),a.find(".createJoutnalNum").eq(0).val(money(-t)),a.find(".createJoutnalNum").eq(1).val(""))):(e=getProductInfoById(e,"chartOfAccounts","","hardCode").id,t>0?(a.find(".createJoutnalSelect").val(e),n=parseFloat(t),a.find(".createJoutnalNum").eq(0).val(money(t)),a.find(".createJoutnalNum").eq(1).val("")):t<0&&(a.find(".createJoutnalSelect").val(e),l=-parseFloat(t),a.find(".createJoutnalNum").eq(1).val(money(-t)),a.find(".createJoutnalNum").eq(0).val(""))),u+=l,d+=n,$("#createJoutnalTable> tbody").children().eq(-1).after(p()),$(".createJoutnalSelect").eq(-1).coaCombbox({width:"100%"})}function a(){$.each($("#createJoutnalTable>tbody").find("tr"),function(){var e=$(this);""!==$(this).children().eq(3).find("input").val()&&($("#createJoutnalTable>tbody").find("tr").eq(-1).after(e.clone(!0)),$(this).remove())})}function r(){isCheckEd=!1;var e=2===arguments.length?arguments[1].value:arguments[0];return isNaN(e)?($(this).focus(),$(this).css("border","solid 2px red"),isCheckEd=!1,!1):($(this).css("border",""),isCheckEd=!0,!0)}function n(e){var t={};for(var a in e){if(t[e[a]])return!0;t[e[a]]=!0}return!1}function l(e){var t=["角","分"],a=["零","壹","贰","叁","肆","伍","陆","柒","捌","玖"],r=[["元","万","亿"],["","拾","佰","仟"]],n=e<0?"欠":"";e=Math.abs(e);for(var l="",o=0;o<t.length;o++)l+=(a[Math.floor(10*e*Math.pow(10,o))%10]+t[o]).replace(/零./,"");l=l||"整",e=Math.floor(e);for(var o=0;o<r[0].length&&e>0;o++){for(var c="",i=0;i<r[1].length&&e>0;i++)c=a[e%10]+r[1][i]+c,e=Math.floor(e/10);l=c.replace(/(零.)*零$/,"").replace(/^$/,"零")+r[0][o]+l}return n+l.replace(/(零.)*零元/,"元").replace(/(零.)+/g,"零").replace(/^整$/,"零元整")}setTimeout($.addTabCloseEvent,200);var o=_global_settings.service.url,c=$.pk.id,i=$.pk.name,u=0,d=0,s="",h=$.pk.journaldate;$("#createjournaldate").datetimeinput({formatString:"yyyy-MM-dd",width:"90%",height:33,value:new Date}),$("#createjournaldate").val(h);var v=function(e){var t=$(this),a=t.val();""!=a&&r(a)?($(this).css("border",""),t.val(money(a).replace("-",""))):t.val("")},f=function(e,t){var r=$("#createJoutnalTable> tbody");if("carryover"===$.pk.id){r.find("tr").eq(-1).children().eq(0).children().val(i);var n=getProductInfoById("4103","chartOfAccounts","","hardCode").id;r.find("tr").eq(-1).children().eq(1).children().val(n),r.find("tr").eq(-1).children().eq(e).children().val(t),setTimeout(a,0)}else r.find("tr").eq(-1).remove();r.find(".createJoutnalSelect").jqxComboBox("disabled",!0),r.find(".createJoutnalChart").attr("disabled","disabled"),r.find(".createJoutnalNum").attr("disabled","disabled"),$("#createJoutnalTable").off("click")};$(".createJoutnalSelect").eq(-1).coaCombbox({width:"100%"}),$("#createJoutnalcreateBy").val(_global_settings.owner.companyname),Core.AjaxRequest({type:"GET",showWaiting:!0,url:o+"/ac/"+(new Base64).encode("tosys/carryover/search/chartOfAccount/"+c+"/"+h+"/"+currentUserInfo.id+"/"+currentUserInfo.loginId).replace("_$_",".").replace(/\//g,"_a").replace(/\+/g,"_b").replace(/\=/g,"_c"),callback:function(a){function r(e){return e?("carryover"!==$.pk.id&&"depreciation"!==$.pk.id||f(2,money(u-d)),u):("carryover"!==$.pk.id&&"depreciation"!==$.pk.id||f(3,money(d-u)),d)}for(var n=a,o=0;o<n.length;o++)if("carryover"===c){for(var i in n[0])t(i,n[0][i]);s+=n[o].journalid+","}else e(n[o]),s+=n[o].journalid+",";if(n.length>0)var h=u>d?r("win"):r();$("#createJoutnalNumSumCn").text(l(money(h))),$("#createJoutnalNumSum1").text("￥"+money(h)),$("#createJoutnalNumSum2").text("￥"+money(h)),$("#createJoutnalTable .createJoutnalNum").moneyinput({defaultValue:""}).off("blur").on("blur",v),timeOut(function(){},200)},failure:function(e){}});var m=2,p=function(){var e;return e+='<tr data-index="'+m+'">                                                                               ',e+='\t<td style=""><input class="createJoutnalChart form-control" type="text"></td>                                                           ',e+='\t<td style=""><div class="createJoutnalSelect"></div>                                                      ',e+="\t</td>                                                                                  ",e+='\t<td style=""><input class="createJoutnalNum numBorrow3 form-control" type="text"></td>                                                           ',e+='\t<td style=""><input class="createJoutnalNum numLoad3 form-control" type="text"></td>                                                           ',e+='\t<td class="del_icon" style=""><i class="    md-cancel     createJoutnalDel"></i>',e+="\t</td>                                                                                           ",e+="</tr>           "};$("#createJoutnalTable").on("click",function(e){$(e.target).parent()[0]!==$("#createJoutnalTable> tbody").children().eq(-1)[0]&&$(e.target).parent().parent()[0]!==$("#createJoutnalTable> tbody").children().eq(-1)[0]||($("#createJoutnalTable> tbody").children().eq(-1).after(p()),$(".createJoutnalNum").eq(-1).moneyinput({defaultValue:""}),$(".createJoutnalNum").eq(-1).off("blur").on("blur",v),$(".createJoutnalNum").eq(-2).moneyinput({defaultValue:""}),$(".createJoutnalNum").eq(-2).off("blur").on("blur",v),$(".createJoutnalSelect").eq(-1).coaCombbox({width:"100%"}),m+=1),$("#createJoutnalTable tbody tr").on("dblclick",function(){$(this).find(".createJoutnalChart").val($(this).prev("tr").find(".createJoutnalChart").val())}),$(".numBorrow3").on("dblclick",function(){var e=0,t=0;$.each($(".numBorrow3"),function(){e=""==$(this).val()?parseFloat(e):parseFloat(e)+parseFloat($(this).val())}),$.each($(".numLoad3"),function(){t=""==$(this).val()?parseFloat(t):parseFloat(t)+parseFloat($(this).val())}),""==$(this).val()?""==$(this).parent().next().children().val()&&parseFloat(e)<parseFloat(t)&&$(this).val(money(parseFloat(t)-parseFloat(e))):""==$(this).parent().next().children().val()&&parseFloat(e)<parseFloat(t)&&$(this).val(money(parseFloat(t)-parseFloat(e)+parseFloat($(this).val()))),$("#createJoutnalNumSum1").text("￥"+money(e))}),$(".numLoad3").on("dblclick",function(){var e=0,t=0;$.each($(".numBorrow3"),function(){e=""==$(this).val()?parseFloat(e):parseFloat(e)+parseFloat($(this).val())}),$.each($(".numLoad3"),function(){t=""==$(this).val()?parseFloat(t):parseFloat(t)+parseFloat($(this).val())}),""==$(this).val()?""==$(this).parent().prev().children().val()&&parseFloat(e)>parseFloat(t)&&$(this).val(money(parseFloat(e)-parseFloat(t))):""==$(this).parent().prev().children().val()&&parseFloat(e)>parseFloat(t)&&$(this).val(money(parseFloat(e)-parseFloat(t)+parseFloat($(this).val()))),$("#createJoutnalNumSum2").text("￥"+money(t))})}),$("#createJoutnalTable").on("change",".createJoutnalSelect",function(e){var t=e.args;if("科目"!==$(this).val()){var a=0;$(e.target).val();$.each($(".createJoutnalSelect"),function(){$(this).val()===t.item.value&&(a+=1)}),a>1&&(Core.alert({message:"科目不能相同！"}),$(this).val(""))}}),$("#createJournalCurrency").dropDownlist({source:{unassociation:"不匹配"},selectedIndex:0}),$("#createJoutnalTable").on("keyup",".createJoutnalNum",function(){!1!==r($(this).val())?$(this).css("border",""):$(this).css("border","2px solid red"),$(this).parent().next().children().is("input")?($(this).parent().next().children().val(""),$(this).parent().next().children().css("border","")):$(this).parent().prev().children().is("input")&&($(this).parent().prev().children().val(""),$(this).parent().prev().children().css("border",""));var e=q();$("#createJoutnalNumSumCn").text(l(money(e[1]))),$("#createJoutnalNumSum1").text("￥"+money(e[1])),$("#createJoutnalNumSum2").text("￥"+money(e[0]))}),$("#createJoutnalTable").on("paste",".createJoutnalNum",function(e){e.preventDefault();var t;e.originalEvent.clipboardData&&(t=(e.originalEvent||e).clipboardData.getData("text/plain")),r(t)&&$(this).val(t)}),$("#createJoutnalTable").on("click",".createJoutnalDel",function(){if(1===$("#createJoutnalTable> tbody").children().length)return!1;var e=$(this);Core.confirm({message:"确定要删除？",confirmCallback:function(){e.parent().parent().remove()}})}),$("#createJoutnalTableAdd").on("click",function(){if(!J())return Core.alert({message:"输入行数据不完整！"}),!1;var e=[],t=0;if($.each($(".createJoutnalSelect"),function(){""!==$(this).val()&&(e[t]=$(this).val(),t+=1)}),n(e))return Core.alert({message:"科目不能相同！"}),!1;var a=$(".createJoutnalNum");if($.each(a,r),!1===isCheckEd)return Core.alert({message:"输入金额只能为数字！"}),!1;if($("#createJoutnalNumSum1").text()!==$("#createJoutnalNumSum2").text())return Core.alert({message:"保存失败，借贷不平衡！"}),!1;var l=b();if(0===l.length)return Core.alert({message:"提交失败，请输入金额！"}),!1;var o=[];$("#createJoutnalDetailattachment").find(".item").each(function(e,t){var a=$(t).attr("data-id");void 0!==a&&o.push(a)});var i={noteNumber:$("#createJournaljournalnoteNumber").val(),fileInfoIds:o.toString(),remark:$("#createJoutnalRemark").val(),currency:"RMB",journalNumber:$("#createJournalNumber").val(),remarkPrint:$("#createJoutnalRemarkPrint").val(),journalType:"input",entryDate:$("#createjournaldate").val(),journalDetails:l},u=i.journalDetails,d=["NV","AK","HI"],s=y(u,d),h="";"carryover"===c&&(i.journalType=c),h=_global_settings.service.url+"/ac/"+(new Base64).encode("tosys/carryover/create/carryover/"+c+"/"+currentUserInfo.id+"/"+currentUserInfo.loginId).replace("_$_",".").replace(/\//g,"_a").replace(/\+/g,"_b").replace(/\=/g,"_c"),s?Core.AjaxRequest({url:h,type:"POST",params:i,async:!1,dataType:"text",showMsg:!1,callback:function(e){"true"!=e?Core.alert({message:e}):(setCloseAlertTimeOneSecond(),$.closeTab())},failure:function(e){}}):Core.alert({message:"同一科目只能为借方或贷方金额！"})});var b=function(){var e=[],t=0;return $.each($("#createJoutnalTable>tbody>tr"),function(){var a=$(this).children();""===a.eq(2).children().val()&&""===a.eq(3).children().val()||(e[t]={description:a.eq(0).children().val(),chartOfAccount:{id:a.eq(1).children().val()},debitAmt:""===a.eq(2).children().val()?0:a.eq(2).children().val(),creditAmt:""===a.eq(3).children().val()?0:a.eq(3).children().val()},t+=1)}),e},J=function(){var e=$("#createJoutnalTable> tbody>tr"),t=!0;return $.each(e,function(){var e=($(this).eq(0).children().eq(0).children().val(),$(this).eq(0).children().eq(1).children().jqxComboBox("getSelectedItem")),a=$(this).eq(0).children().eq(2).children().val(),r=$(this).eq(0).children().eq(3).children().val();if(null==e||""===a&&""===r){if(null!=e||""!==a||""!==r)return t=!1,!1;t=!0}else t=!0}),t},y=function(e,t){var a=!0;return $.each(t,function(t,r){var n=[],l=[],o=[],c=0;for(var t in e)e.hasOwnProperty(t)&&e[t].chartOfAccount===r&&(n[c]=e[t].creditAmt,c+=1);c=0;for(var i in n)n.hasOwnProperty(i)&&(0===n[i].length?l[c]=n[i]:o[0]=n[i]);if(o.length*l.length!=0)return a=!1,!1}),a},q=function(){for(var e=$(".createJoutnalNum").length-1,t=0,a=0,r=0;r<e;r++){var n=1e3*$(".createJoutnalNum").eq(r).val();r%2!=1||isNaN(n)||(t+=parseInt(n)),r%2!=0||isNaN(n)||(a+=parseInt(n))}return[t/1e3,a/1e3]}}();