var CauMgt=function(){var e=this,a=_global_settings.service.url+"/common";this.id=null,this.initInput=function(){$("#cau-addCust")[0].checked=!0,e.initSearch(),e.initGrid(e.searchObj),e.addVdt(),e.editVdt(),e.typeChange()},this.typeChange=function(){$("#cau-addType").on("change",function(){"person"==$(this).val()?$("#cau-addJc").attr("readonly",!0).val(""):$("#cau-addJc").removeAttr("readonly")}),$("#cau-editType").on("change",function(){"person"==$(this).val()?$("#cau-editJc").attr("readonly",!0).val(""):$("#cau-editJc").removeAttr("readonly")})},this.addVdt=function(){$("#addWindow").jqxValidator({hintType:"label",animationDuration:1,rules:[{input:"#cau-addName",message:"不能为空",action:"keyup,blur",rule:"required"},{input:"#cau-addDate",message:"不能为空",action:"keyup,blur",rule:"required"},{input:"#cau-addDate",message:"大于或等于0的整数",action:"keyup,blur",rule:function(e,a){return!!/^([0-9]\d{0,}|0)$/.test(Number(e.val()))}}]})},this.editVdt=function(){$("#editWindow").jqxValidator({hintType:"label",animationDuration:1,rules:[{input:"#cau-editName",message:"不能为空",action:"keyup,blur",rule:"required"},{input:"#cau-editDate",message:"不能为空",action:"keyup,blur",rule:"required"},{input:"#cau-editDate",message:"大于或等于0的整数",action:"keyup,blur",rule:function(e,a){return!!/^([0-9]\d{0,}|0)$/.test(Number(e.val()))}}]})},this.clearAddWin=function(){$("#cau-addType").dropDownlist({source:{enterprise:"企业",person:"个人"},selectedIndex:0,width:"100%"}),$("#addWindow").css("display","none"),$("#cau-addSup")[0].checked=!1,$("#cau-addCust")[0].checked=!0,$("#addWindow").find("input").val("")},this.clearEditWin=function(){$("#cau-editType").dropDownlist({source:{enterprise:"企业",person:"个人"},selectedIndex:0,width:"100%"}),$("#editWindow").css("display","none"),$("#cau-editSup")[0].checked=!1,$("#cau-editCust")[0].checked=!1,$("#editWindow").find("input").val("")},this.initGrid=function(){e.settings.source.data=e.searchObj;var a=Core.AcDataAdapter("cauGrid",e.settings.source,{beforeLoadComplete:function(e){}},e.debug),i={source:a,rendergridrows:function(e){return a.recordids},columns:[{text:"客户/供应商名称",dataField:"name",width:"40%"},{text:"账期",width:"40%",cellsrenderer:function(e,a,n,t,c,i){var d='<div class="agrid">';return i.vendorType&&i.customerFlag?d+=i.vendorTermValue:(i.vendorType&&(d+=i.vendorTermValue),i.customerFlag&&(d+=i.customerTermValue)),d+"</div>"}},{text:"操作",width:"20%",cellsrenderer:function(e,a,n,t,c,i){var d='<div style="text-align: center;">';return d+='<a class="md-dns hoverspan viewCustAndSup" title="查看"></a>',d+='<a class="md-mode-edit hoverspan editCustAndSup" title="编辑"></a>',d+='<a class="md-cancel hoverspan deleteCustAndSup" title="删除"></a>',d+="</div>"}}],pagesize:20,columnsheight:45};$("#cauGrid").grid(i),$("#cauGrid").on("click",".editCustAndSup",function(){$("#editWindowY").css("top",window.scrollY+150+"px"),t()}),$("#cauGrid").on("click",".viewCustAndSup",function(){$("#viewWindowY").css("top",window.scrollY+150+"px"),c()}),$("#cauGrid").on("click",".deleteCustAndSup",function(){n()})};var n=function(){var e=$("#cauGrid").jqxGrid("getselectedrowindex");if(e>=0){var a=$("#cauGrid").jqxGrid("getrowdata",e);if(a.isBsscreate&&a.orderFlag)return Core.alert({message:"抱歉，此客户已经产生业务数据，不能删除！"}),!1;if(!a.isBsscreate)return Core.alert({message:"抱歉，此客户是秒账系统新增客户，此界面不能删除！"}),!1;Core.confirm({message:"确定要删除吗？",confirmCallback:function(){Core.AjaxRequest({url:_global_settings.service.url+"/common/clientInfo/delete/"+a.id+"/"+currentUserInfo.id,type:"DELETE",async:!1,showMsg:!1,callback:function(){setCloseAlertTimeOneSecond(),$("#cauGrid").jqxGrid("updatebounddata","cells")},failure:function(e){}})}})}},t=function(){var a=$("#cauGrid").jqxGrid("getselectedrowindex");if(a>=0){var n=$("#cauGrid").jqxGrid("getrowdata",a);if(e.id=n.id,!n.isBsscreate)return Core.alert({message:"抱歉，此客户是秒账系统新增客户，此界面不能编辑！"}),!1;$("#editWindow").css("display",""),$("#editWindow").css("height",document.body.scrollHeight+"px"),$("#cau-editType").val(n.type),n.customerFlag&&($("#cau-editCust")[0].checked=!0),n.vendorType&&($("#cau-editSup")[0].checked=!0),$("#cau-editCode").val(n.number),$("#cau-editName").val(n.name),$("#cau-editJc").val(n.shortName),void 0!=n.customerTermValue&&$("#cau-editDate").val(n.customerTermValue),void 0!=n.vendorTermValue&&$("#cau-editDate").val(n.vendorTermValue)}},c=function(){$("#viewWindow").css("display",""),$("#viewWindow").css("height",document.body.scrollHeight+"px");var e=$("#cauGrid").jqxGrid("getselectedrowindex");if(e>=0){var a=$("#cauGrid").jqxGrid("getrowdata",e);$("#cau-viewType").val("person"==a.type?"个人":"企业"),a.customerFlag&&($("#cau-viewCust")[0].checked=!0),a.vendorType&&($("#cau-viewSup")[0].checked=!0),$("#cau-viewCode").val(a.number),$("#cau-viewName").val(a.name),$("#cau-viewJc").val(a.shortName),void 0!=a.customerTermValue&&$("#cau-viewDate").val(a.customerTermValue),void 0!=a.vendorTermValue&&$("#cau-viewDate").val(a.vendorTermValue)}};this.settings={source:{url:a+"/client/"+currentUserInfo.id,data:e.searchObj},grid:{element:"cauGrid"},ajax:{url:a}},this.searchObj={},this.initSearch=function(){e.searchObj={"u.name":{value:[],action:"like"}}},this.searchDataInfo=function(){$("#cauGrid").jqxGrid("applyfilters"),$("#cauGrid").jqxGrid("refreshfilterrow"),$("#cauGrid").jqxGrid("clearselection")}},CauBindModle=function(e){var a=this,n=_global_settings.service.url+"/common";this.saveAddCustAndSup=function(){var a={};a.userInfo={},a.clientBanks=[],a.userInfo.type=$("#cau-addType").val(),a.userInfo.name=$("#cau-addName").val(),a.userInfo.shortName=$("#cau-addJc").val(),a.userInfo.address=[],a.userInfo.personInfos=[],a.customerFlag=$("#cau-addCust")[0].checked,a.vendorType=$("#cau-addSup")[0].checked,a.number=$("#cau-addCode").val(),a.customerFlag&&(a.customerTermValue=$("#cau-addDate").val()),a.vendorType&&(a.vendorTermValue=$("#cau-addDate").val()),"person"==a.userInfo.type&&(delete a.userInfo.personInfos,delete a.userInfo.shortName),$("#addWindow").jqxValidator("validate")&&Core.AjaxRequest({url:ws_url+"/CXF/rs/common/clientInfo/create/"+currentUserInfo.id+"/"+currentUserInfo.loginId,type:"POST",params:a,async:!1,showMsg:!1,callback:function(){setCloseAlertTimeOneSecond(),e.clearAddWin(),$("#cauGrid").jqxGrid("updatebounddata","cells")},failure:function(e){var a=JSON.parse(e.responseText);Core.alert({message:a.errorMsg,callback:function(){$("#addWindow").css("display","none")}})}})},this.saveEditCustAndSup=function(){var a={};a.userInfo={},a.clientBanks=[],a.userInfo.type=$("#cau-editType").val(),a.userInfo.name=$("#cau-editName").val(),a.userInfo.shortName=$("#cau-editJc").val(),a.userInfo.address=[],a.userInfo.personInfos=[],a.customerFlag=$("#cau-editCust")[0].checked,a.vendorType=$("#cau-editSup")[0].checked,a.number=$("#cau-editCode").val(),a.id=e.id,a.customerFlag&&(a.customerTermValue=$("#cau-editDate").val()),a.vendorType&&(a.vendorTermValue=$("#cau-editDate").val()),"person"==a.userInfo.type&&(delete a.userInfo.personInfos,delete a.userInfo.shortName),$("#editWindow").jqxValidator("validate")&&Core.AjaxRequest({url:ws_url+"/CXF/rs/common/clientInfo/update/"+currentUserInfo.id+"/"+currentUserInfo.loginId,type:"PUT",params:a,async:!1,showMsg:!1,callback:function(){setCloseAlertTimeOneSecond(),e.clearEditWin(),$("#cauGrid").jqxGrid("updatebounddata","cells")},failure:function(e){var a=JSON.parse(e.responseText);Core.alert({message:a.errorMsg,callback:function(){$("#editWindow").css("display","none")}})}})};var t=function(){var a=$("#cau-name").val();e.searchObj["u.name"].value=[],""!=a&&e.searchObj["u.name"].value.push(a),e.searchDataInfo()};this.bind=function(){$("#cau-searchBtn").on("click",function(){t()}),$("#cau-add").on("click",function(){$("#addWindow").css("display",""),$("#cau-addType").dropDownlist({source:{enterprise:"企业",person:"个人"},selectedIndex:0,width:"100%"}),$("#addWindow").css("height",document.body.scrollHeight+"px")}),$("#cau-addSave").on("click",function(){a.saveAddCustAndSup()}),$("#cau-addCancle").on("click",function(){e.clearAddWin()}),$("#cau-editSave").on("click",function(){a.saveEditCustAndSup()}),$("#cau-editCancle").on("click",function(){e.clearEditWin()}),$("#cau-viewCancle").on("click",function(){$("#viewWindow").css("display","none"),$("#viewWindow").find("input").val(""),$("#cau-viewCust")[0].checked=!1,$("#cau-viewSup")[0].checked=!1}),$("#cau-download").on("click",function(){window.open(_global_settings.service.url+"/common/export/clientInfo/0")}),$("#cau-import").on("click",function(){var e={url:n+"/importxlsclient/"+currentUserInfo.id};$("#cau-attachment").html(""),$("#cau-modal").modal("show"),$("#cau-attachment").fileuploader(e)})},this.unbindAll=function(){$("#cau-searchBtn").off("click"),$("#cau-add").off("click"),$("#cau-addSave").off("click"),$("#cau-addCancle").off("click"),$("#cau-editSave").off("click"),$("#cau-editCancle").off("click"),$("#cau-viewCancle").off("click"),$("#cau-download").off("click"),$("#cau-import").off("click")}};