!function(){function e(e){var r=void 0===e.description?"":e.description;c.push(e.chartOfAccount.id);var n=getProductInfoById(e.chartOfAccount.id,"chartOfAccounts").displayValue,a=e.creditAmt,t=e.debitAmt,u=null==e.category1?"":e.category1,l=null==e.category2?"":e.category2;o+=a,a=0==a?"":"￥"+money(a),t=0==t?"":"￥"+money(t);var d='<tr data-index="0"><td style="">'+r+'</td><td style="">'+n+'</td><td style="">'+t+'</td><td style="">'+a+'</td><td style="">'+u+'</td><td style="">'+l+"</td></tr>";$("#JournalViewTable"+i).append(d)}var i=(new Date).getTime(),r=["JournalViewdatepicker","JournalViewjournalNumber","JournalViewjournalnoteNumber","JournalViewTable","JournalViewNumSumcn","JournalViewNumSum1","JournalViewNumSum2","journalViewcreateBy","JournalViewremarkPrint","JournalViewPrint","JournalViewattachment","journal-btn","JournalView_jqxgridComment","JournalView_auditBtnSP","JournalView_auditBtn","JournalViewTableAddAndSubmit","JournalView-btn-print"];for(var n in r)$("#"+r[n]).attr("id",r[n]+i);var a=_global_settings.service.url+"/favourites",t=$.pk,o=($.pk.taskId,$.pk.parent,0),u=function(e){var i=ComboBoxSources.getRecords("taxerInfo");for(n=0;n<i.length;n++)if(e==i[n].username)return i[n];if(!e)return""},l=ComboBoxSources.getInfoMapByKey("chartOfAccounts","hardCode"),d=[],c=[];d.push(l[2203].id),d.push(l[1122].id),d.push(l[1123].id),d.push(l[2202].id),d.push(l[1001].id),d.push(l[1002].id),d.push(l[1012].id);var p=function(e){var i=e.journalRelationType;if("unassociation"!=i&&null!=i){if($.addHide("#JournalView_pipiView"),$.addHide(".pipiView"),$.addHide("#pipiViewclinet","#pipiViewvendor","#pipiViewcreateby","#pipiViewusers_mon","#pipiViewusers","#pipiViewtermValue"),pipiViewusers_mon=0,-1!=$.inArray(l[1221].id,c)){$.removeHide("#JournalView_pipiView"),$.removeHide("#pipiViewusers");for(var r=e.journalDetails,n=r.length,a=0;a<n;a++)if("26"==r[a].chartOfAccount.id&&0!=r[a].creditAmt){$.removeHide("#pipiViewusers_mon"),pipiViewusers_mon=r[a].creditAmt;break}}if("unassociation"!==i&&($.removeHide("#JournalView_pipiView"),$.removeHide(".pipiView"),$.removeHide("#pipiViewcreateby"),$.removeHide("#pipiViewusers"),$.removeHide("#pipiViewtermValue"),"inflow"==i&&($.removeHide("#pipiViewclinet"),$(".JournalView_returnFlag").text("供应商退款")),"outflow"==i&&($.removeHide("#pipiViewvendor"),$(".JournalView_returnFlag").text("客户退款"))),"unassociation"==i)for(var r=e.journalDetails,n=r.length,a=0;a<n;a++){var t=r[a].chartOfAccount.id;if(""!=t){if($.strInArr(getProductInfoById(t,"chartOfAccounts").hardCode,["1001","1002","1012"]))return 0!=r[a].creditAmt?($.removeHide("#pipiViewtermValue"),$.removeHide("#JournalView_pipiView"),void($("#JournalView_returnFlag").is(":checked")?$.removeHide("#pipiViewclinet"):($.removeHide("#pipiViewvendor"),$(".JournalView_returnFlag").text("客户退款")))):($.removeHide("#pipiViewtermValue"),$.removeHide("#JournalView_pipiView"),void($("#JournalView_returnFlag").is(":checked")?$.removeHide("#pipiViewvendor"):($.removeHide("#pipiViewclinet"),$(".JournalView_returnFlag").text("供应商退款"))));if(l[2203].id==t||l[1122].id==t)return $.removeHide("#pipiViewtermValue"),$.removeHide("#JournalView_pipiView"),void($("#JournalView_returnFlag").is(":checked")?$.removeHide("#pipiViewvendor"):($.removeHide("#pipiViewclinet"),$(".JournalView_returnFlag").text("供应商退款")));if(l[1123].id==t||l[2202].id==t)return $.removeHide("#pipiViewtermValue"),$.removeHide("#JournalView_pipiView"),void($("#JournalView_returnFlag").is(":checked")?$.removeHide("#pipiViewclinet"):($.removeHide("#pipiViewvendor"),$(".JournalView_returnFlag").text("客户退款")))}}"inflow"!=i&&"unassociation"!=i||$("#JournalView_returnFlag").is(":checked")&&$("#JournalView_returnFlag").is(":visible")&&($.removeHide("#pipiViewvendor"),$.addHide("#pipiViewclinet")),"outflow"==i&&$("#JournalView_returnFlag").is(":checked")&&$("#JournalView_returnFlag").is(":visible")&&($.removeHide("#pipiViewclinet"),$.addHide("#pipiViewvendor"))}};!function(r){try{$("#JournalViewdatepicker"+i).val(r.entryDate.substring(0,10))}catch(e){}$("#JournalViewjournalNumber"+i).val(r.journalNumberForShow),$("#JournalViewjournalnoteNumber"+i).val(r.noteNumber),$("#JournalViewremarkPrint"+i).val(r.remark),$("#JournalViewPrint"+i).val(r.remarkPrint);var n=null;"AdminAccount"==r.createBy?n="代理报税":void 0!=u(r.createBy)?u(r.createBy).username==r.createBy&&(n=u(r.createBy).name):n=r.createBy,$("#journalViewcreateBy"+i).val(n),$("#JournalViewattachment"+i).fileuploader({bool:!0,readonly:!0,filelist:r.fileInfoIds});var a=r.journalDetails;for(var t in a)e(a[t]);if(null!=r.clientId){var l=getProductInfoById(r.clientId,"clientInfo",null,"clientInfoid").name;$("#JournalView_clinet").val(l),$("#JournalView_vendor").val(l)}if(null!=r.personId){var d=getProductInfoById(r.personId,"users",null,"userid").name;$("#JournalViewusers").val(d)}if(null!=r.generalDocumentsCreateBy){var c=getProductInfoById(r.generalDocumentsCreateBy,"users",null,"username").name;$("#JournalView_ordercreateby").val(c)}$("#JournalView_receiptType").val(getCodeData(r.receiptInvoiceType)),null!=r.vat&&$("#JournalView_tax").val(r.vat+"%"),$("#JournalView_receiptNum").val(r.receiptNumber),$("#JournalView_termValue").val(r.termValue),$("#JournalView_returnFlag")[0].checked=r.returnFlag,timeOut(function(){$("#JournalView_type").val(getCodeData(r.journalRelationType)),p(r)},0),$("#JournalViewusers_mon").val(r.prepareAmt),null!=r.receiptInvoiceType&&""!=r.receiptInvoiceType||$(".JournalView_receiptType_show").hide(),$("#JournalViewNumSumcn"+i).text("人民币"+digitUppercase(o)),"角"==$("#JournalViewNumSumcn"+i).text().substr(-1,1)&&$("#JournalViewNumSumcn"+i).text($("#JournalViewNumSumcn"+i).text()+"整"),$("#JournalViewNumSum1"+i).text("￥"+money(o)),$("#JournalViewNumSum2"+i).text("￥"+money(o))}(t),$("#JournalViewAddBtn"+i).on("click",function(){$.addTab({title:"新增凭证",url:"page/modules/fms/JournalDetail.html",reload:!0})}),$("#journal-btn"+i).on("click",function(){var e={};e.amount=$("#JournalViewNumSum1"+i).text().substring(1),e.orderNumber=$("#JournalViewjournalNumber"+i).val(),e.clientInfoId="",e.bizId=t.id,e.favouritesType="Journal",Core.AjaxRequest({url:a,type:"POST",params:e,callback:function(e){},failure:function(e){}})}),$("#JournalView-btn-print"+i).on("click",function(){var e=(new Base64).encode("reportName=JournalPrint&journalId="+t.id+"&printType=pdf&ownerId="+currentUserInfo.id+"&username="+currentUserInfo.loginId).replace("_$_",".").replace(/\//g,"_a").replace(/\+/g,"_b").replace(/\=/g,"_c");window.open(_global_settings.service.url+"/ac/print/"+e)})}();