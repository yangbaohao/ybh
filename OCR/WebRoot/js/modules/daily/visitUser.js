var VistMgt=function(){var e=this,i=null,t=_global_settings.service.url+"/common";this.debug=!1,this.initInput=function(){i=$.pk.createDate,e.initUserPage(),e.initSearch(),e.initGrid(e.searchObj)},this.initUserPage=function(){$("#agentDailyVisit-show").css("display","");for(var e=ComboBoxSources.getRecords("userInfo"),i=["全部"],t=0;t<e.length;t++)i.push(e[t].name);$("#agentDailyVisit-com").comboBox({theme:currentTheme,source:ComboBoxSources.getRecords("userInfo"),searchMode:"contains",displayMember:"name",valueMember:"username",height:34,width:"100%"}),$("#agentDailyVisit-show").addClass("hiddendiv")},this.initGrid=function(){e.settings.source.data=e.searchObj,e.settings.source.url=t+"/owner/access/-1/-1/-1/-1/"+i+"/"+_global_settings.owner.roleName;var s=Core.AcDataAdapter("agentDailyGrid-visit",e.settings.source,{beforeLoadComplete:function(e){}},e.debug),r={columnsresize:!1,autorowheight:!0,autoheight:!0,source:s,rendergridrows:function(){return s.records},columns:[{text:"用户名",dataField:"username",width:"8%",cellsrenderer:function(e,i,t,s,r,n){return'<div class="visitAgentCode" style="position: relative; top:50%; margin-top:-6px; text-align: center; text-overflow: ellipsis;overflow: hidden;">'+n.username+"</div>"}},{text:"公司名称",dataField:"name",width:"13%",cellsrenderer:function(e,i,t,s,r,n){return'<div class="visitAgentCode" style="position: relative; top:50%; margin-top:-6px; text-align: center; text-overflow: ellipsis;overflow: hidden;">'+n.name+"</div>"}},{text:"联系电话",dataField:"telephone",width:"8%",cellsrenderer:function(e,i,t,s,r,n){return'<div class="visitAgentCode" style="position: relative; top:50%; margin-top:-6px; text-align: center;text-overflow: ellipsis;overflow: hidden;">'+n.telephone+"</div>"}},{text:"注册时间",dataField:"createDate",width:"13%",cellsrenderer:function(e,i,t,s,r,n){return'<div class="visitAgentCode" style="position: relative; top:50%; margin-top:-6px; text-align: center;text-overflow: ellipsis;overflow: hidden;">'+n.createDate+"</div>"}},{text:"最初访问时间",dataField:"minCreateDate",width:"13%",cellsrenderer:function(e,i,t,s,r,n){return'<div class="visitAgentCodeFirst" style="position: relative; top:50%; margin-top:-6px; text-align: center;text-overflow: ellipsis;overflow: hidden;">'+n.minCreateDate+"</div>"}},{text:"最后离开时间",dataField:"maxCreateDate",width:"13%",cellsrenderer:function(e,i,t,s,r,n){return'<div class="visitAgentCodeLast" style="position: relative; top:50%; margin-top:-6px; text-align: center;text-overflow: ellipsis;overflow: hidden;">'+n.maxCreateDate+"</div>"}},{text:"访问模块",dataField:"remark",width:"18%",cellsrenderer:function(e,i,t,s,r,n){if(void 0!==n.accessList){for(var a="",o="",l=0;l<n.accessList.length;l++)o=n.accessList[l].remark,a+='<div class="visitAgentCodeReMark" style="position: relative; border-top: 1px solid  #EBEFF2;text-overflow: ellipsis;overflow: hidden; height:auto; line-height:24px;" title='+o+">"+o+"</div>";return'<div style="height:auto;">'+a+"</div>"}}},{text:"访问次数",width:"6%",cellsrenderer:function(e,i,t,s,r,n){if(void 0!==n.accessList){for(var a="",o="",l=0;l<n.accessList.length;l++)o=n.accessList[l].remarkNum,a+='<div class="visitAgentCodeReMark" style="position: relative; border-top: 1px solid  #EBEFF2;text-overflow: ellipsis;overflow: hidden; height:auto; line-height:24px;" title='+o+">"+o+"</div>";return'<div style="height:auto;">'+a+"</div>"}}},{text:"停留时间(分)",width:"8%",cellsrenderer:function(e,i,t,s,r,n){if(void 0!==n.accessList){for(var a="",o="",l=0;l<n.accessList.length;l++)o=n.accessList[l].remarkSecond,a+='<div class="visitAgentCodeReMark\t" style="position: relative; border-top: 1px solid  #EBEFF2;text-overflow: ellipsis;overflow: hidden; height:auto; line-height:24px;" title='+o+">"+o+"</div>";return'<div style="height:auto;">'+a+"</div>"}}}],pagesize:e.settings.grid.pagesize,columnsheight:50};$("#agentDailyGrid-visit").grid(r)},this.settings={source:{data:e.searchObj},grid:{element:"agentDailyGrid-visit"},ajax:{url:t}},this.searchObj={},this.initSearch=function(){e.searchObj={name:{value:[],action:"like"}}},this.searchDataInfo=function(){$("#agentDailyGrid-visit").jqxGrid("applyfilters"),$("#agentDailyGrid-visit").jqxGrid("refreshfilterrow"),$("#agentDailyGrid-visit").jqxGrid("clearselection")},this.refreshDataInfo=function(){$("#agentDailyGrid-visit").jqxGrid("updatebounddata","cells"),$("#agentDailyGrid-visit").jqxGrid("clearselection"),$("#agentDailyGrid-visit").jqxGrid("refreshdata")}},VistBindModle=function(e){var i=this;this.search=function(){var i=$("#agentDailyVisit-com").find("input").val();"全部"!=i&&""!=i&&(e.searchObj.name={value:[i],action:"like"}),e.searchDataInfo()},this.bind=function(){$("#agentDailyVisit-search").on("click",function(){$("#agentDailyVisit-show").is(":hidden")?$("#agentDailyVisit-show").slideDown("slow"):i.search()}),hiddenAclick(),$("#agentDailyVisit-show").keydown(function(e){if(13==e.keyCode)return e.preventDefault(),e.keyCode=0,!1})},this.unbindAll=function(){$("#agentDailyGrid-visit").off("click")}};