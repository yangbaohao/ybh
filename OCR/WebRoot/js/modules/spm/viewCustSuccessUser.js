var ViewCustSuccessUser=function(){var e=this,t=null,s=null,r=null,a=_global_settings.service.url+"/owner/ownerdetails/",c=(_global_settings.owner.roleName,null),n=null;this.debug=!1,this.userData=null,this.initInput=function(){t=$.pk.id,s=$.pk.employeeCode,r=$.pk.agentName,c=$.pk.beginDate,n=$.pk.endDate,e.initUserPage(),e.initSearch(),e.initGrid(e.searchObj),$("#viewCustSuccessUserName").html(r)},this.initUserPage=function(){$("#viewCustSuccessUser-show").css("display",""),$("#viewCustSuccessUser-time").jqxDropDownList({source:["请选择","最近一周","最近两周","最近三周","本月","本季度","本年"],theme:"energyblue",width:"100%",height:"34px",selectedIndex:0,dropDownHeight:150}),$("#viewCustSuccessUser-sTime").datetimeinput({formatString:"yyyy-MM-dd",width:"100%",height:"34px"}),$("#viewCustSuccessUser-eTime").datetimeinput({formatString:"yyyy-MM-dd",width:"100%",height:"34px"}),$("#viewCustSuccessUser-time").on("change",function(){setValueById("viewCustSuccessUser-time","viewCustSuccessUser-sTime","viewCustSuccessUser-eTime")});for(var e=ComboBoxSources.getRecords("userInfo"),t=["全部"],s=0;s<e.length;s++)t.push(e[s].username);$("#viewCustSuccessUser-name").comboBox({theme:currentTheme,source:t,height:34,width:"100%",selectedIndex:0}),$("#viewCustSuccessUserRemarkWin").jqxWindow({theme:currentTheme,isModal:!0,autoOpen:!1,maxHeight:1e3,minHeight:420,height:"auto",minWidth:500,cancelButton:$("#custSuccessUserRemarkCancleBtn"),initContent:function(){}}).on({close:function(){setTimeout(function(){},500)}}),$("#viewCustSuccessUser-show").addClass("hiddendiv")},this.getCustService=function(e){var t=ComboBoxSources.getRecords("custService");for(i=0;i<t.length;i++)if(e==t[i].employeeCode)return t[i];if(!e)return""},this.initInformation=function(){var e={condition:[],filterscount:0,groupscount:0,pagenum:0,pagesize:20},t=[],s={};return s.key="o.createDate",s.action="between",s.value=[c,n],t.push(s),e.condition=t,""===c&&""===n&&(e.condition=[]),e=(new Base64).encode(JSON.stringify(e))},this.initGrid=function(){e.settings.source.data=e.searchObj,e.settings.source.url=a+"1/success/"+s+"/"+setUrlCondition({beginDate:c,endDate:n,key:"o.createDate"});var t=Core.AcDataAdapter("viewCustSuccessUserGrid",e.settings.source,{beforeLoadComplete:function(e){}},e.debug),i={columnsresize:!1,autorowheight:!0,source:t,rendergridrows:function(){return t.records},columns:[{text:"日期",dataField:"createDate",width:"12%"},{text:"用户名",dataField:"loginId",width:"15%"},{text:"电话号码",dataField:"regTelephone",width:"10%"},{text:"公司名称",dataField:"name",width:"18%"},{text:"累计购买金额",dataField:"totalAmt",cellsalign:"right",cellsformat:"c2",width:"10%"},{text:"客服人员(姓名/用户名)",width:"12%",cellsrenderer:function(e,t,s,i,r,a){var c='<div style="padding-top:6px">';return(c+=""==a.kf?"":void 0==getCustomerInfoByName(a.kf)?"":getCustomerInfoByName(a.kf).name+"("+getCustomerInfoByName(a.kf).username+")")+"</div>"}},{text:"标签",width:"15%",dataField:"lebal"},{text:"备注",width:"8%",cellsrenderer:function(e,t,s,i,r,a){userData=a;var c='<div style="text-align:center">';return c+='<a class="hoverspan md-note-add viewCustSuccessRemark" title="查看备注"></a>',c+="</div>"}}],pagesize:e.settings.grid.pagesize,columnsheight:50};$("#viewCustSuccessUserGrid").grid(i),$("#viewCustSuccessUserGrid").on("click",".viewCustSuccessRemark",function(){var e=$("#viewCustSuccessUserGrid").jqxGrid("getselectedrowindex"),t=$("#viewCustSuccessUserGrid").jqxGrid("getrowdata",e);$("#viewCustSuccessUserRemarkWin").jqxWindow("open",function(){var e={localdata:t.remark,datatype:"array"},s=new $.jqx.dataAdapter(e);$("#custSuccessUserRemarkTbody").jqxGrid({source:s,width:"100%",height:160,autorowheight:!0,autoheight:!0,pageable:!1,columns:[{text:"更新时间",dataField:"createDate",width:"40%",height:"auto"},{text:"备注",dataField:"remark",width:"60%",height:"auto"}]})})})},this.settings={source:{data:e.searchObj},grid:{element:"viewCustSuccessUserGrid"},ajax:{url:a}},this.searchObj={},this.initSearch=function(){e.searchObj={"o.createDate":{value:[],action:"between"},"o.loginId":{value:[],action:"like"},"o.regTelephone":{value:[],action:"like"},"ui.name":{value:[],action:"like"}}},this.searchDataInfo=function(){$("#viewCustSuccessUserGrid").jqxGrid("applyfilters"),$("#viewCustSuccessUserGrid").jqxGrid("refreshfilterrow"),$("#viewCustSuccessUserGrid").jqxGrid("clearselection")},this.refreshDataInfo=function(){$("#viewCustSuccessUserGrid").jqxGrid("updatebounddata","cells"),$("#viewCustSuccessUserGrid").jqxGrid("clearselection"),$("#viewCustSuccessUserGrid").jqxGrid("refreshdata")}},ViewCustSuccessUserBindModle=function(e){var t=this;this.search=function(t){var s=$("#viewCustSuccessUser-sTime").find("input").val(),i=$("#viewCustSuccessUser-eTime").find("input").val(),r=$("#viewCustSuccessUser-name").val(),a=$("#viewCustSuccessUser-phone").val();if(e.searchObj["o.createDate"].value=[],""!=s&&""!=i&&e.searchObj["o.createDate"].value.push(s+" 00:00:00",i+" 23:59:59"),""!=s&&""===i&&e.searchObj["o.createDate"].value.push(s+" 00:00:00"),e.searchObj["o.createDate"].action="ge",""===s&&""!=i&&e.searchObj["o.createDate"].value.push(i+" 23:59:59"),e.searchObj["o.createDate"].action="le",e.searchObj["o.loginId"].value=[],"全部"!=r&&e.searchObj["o.loginId"].value.push(r),e.searchObj["o.regTelephone"].value=[],""!=a&&e.searchObj["o.regTelephone"].value.push(a),t)return e.searchObj;e.searchDataInfo()},this.bind=function(){$("#viewCustSuccessUser-search").on("click",function(){$("#viewCustSuccessUser-show").is(":hidden")?$("#viewCustSuccessUser-show").slideDown("slow"):t.search()}),hiddenAclick()},this.unbindAll=function(){}};