var ViewCustAgent=function(){var e=this,t=null,n=null,r=_global_settings.service.url+"/salesagent/have/";_global_settings.owner.roleName;this.debug=!1,this.userData=null,this.initInput=function(){n=$.pk.id,t=$.pk.agentName,beginDate=$.pk.beginDate,endDate=$.pk.endDate,e.initUserPage(),e.initSearch(),e.initGrid(e.searchObj),$("#viewCustAgentName").html(t)},this.initUserPage=function(){$("#viewCustAgent-show").css("display",""),$("#viewCustAgent-time").jqxDropDownList({source:["请选择","最近一周","最近两周","最近三周","本月","本季度","本年"],theme:"energyblue",width:"100%",height:"34px",selectedIndex:0,dropDownHeight:150}),$("#viewCustAgent-sTime").datetimeinput({formatString:"yyyy-MM-dd",width:"100%",height:"34px"}),$("#viewCustAgent-eTime").datetimeinput({formatString:"yyyy-MM-dd",width:"100%",height:"34px"}),$("#viewCustAgent-time").on("change",function(){setValueById("viewCustAgent-time","viewCustAgent-sTime","viewCustAgent-eTime")});for(var e=ComboBoxSources.getRecords("userInfo"),t=["全部"],i=0;i<e.length;i++)t.push(e[i].username);$("#viewCustAgent-name").comboBox({theme:currentTheme,source:t,height:34,width:"100%",selectedIndex:0}),$("#viewCustAgentRemarkWin").jqxWindow({theme:currentTheme,isModal:!0,autoOpen:!1,maxHeight:1e3,minHeight:420,height:"auto",minWidth:500,cancelButton:$("#custAgentRemarkCancleBtn"),initContent:function(){}}).on({close:function(){setTimeout(function(){},500)}}),$("#viewCustAgent-show").addClass("hiddendiv")},this.getCustService=function(e){var t=ComboBoxSources.getRecords("custService");for(i=0;i<t.length;i++)if(e==t[i].employeeCode)return t[i];if(!e)return""},this.getCustomer=function(e){for(var t=ComboBoxSources.getRecords("custService"),i=0;i<t.length;i++)if(t[i].id==e)return t[i];if(!e)return""},this.initGrid=function(){e.settings.source.data=e.searchObj,e.settings.source.url=r+"1/"+n+"/"+setUrlCondition({beginDate:beginDate,endDate:endDate,key:"sa.userInfo.createDate"});var t=Core.AcDataAdapter("viewCustAgentGrid",e.settings.source,{beforeLoadComplete:function(e){}},e.debug),i={columnsresize:!1,autorowheight:!0,source:t,rendergridrows:function(){return t.recordids},columns:[{text:"日期",width:"12%",cellsrenderer:function(e,t,i,n,r,a){return'<div style="padding-top:6px">'+a.userInfo.createDate.substring(0,10)+"</div>"}},{text:"用户名",width:"14%",cellsrenderer:function(e,t,i,n,r,a){return'<div style="padding-left:2px;padding-top:6px">'+a.agentName+"</div>"}},{text:"电话号码",width:"12%",cellsrenderer:function(e,t,i,n,r,a){return'<div style="padding-left:2px;padding-top:6px">'+a.userInfo.telephone+"</div>"}},{text:"佣金系数",width:"12%",cellsrenderer:function(e,t,i,n,r,a){var s='<div style="padding-top:6px">';return(s+=100*a.rate+"%")+"</div>"}},{text:"客服人员(姓名/用户名)",width:"12%",cellsrenderer:function(t,i,n,r,a,s){var u='<div style="padding-top:6px">';return(u+=void 0==s.customer?"":void 0==e.getCustomer(s.customer.id)?"":e.getCustomer(s.customer.id).name+"("+e.getCustomer(s.customer.id).username+")")+"</div>"}},{text:"父级代理(姓名/用户名)",width:"12%",cellsrenderer:function(e,t,i,n,r,a){var s='<div style="padding-top:6px">';return(s+=void 0==a.parentAgentName?"":void 0==getAgentInfoByName(a.parentAgentName)?"":getAgentInfoByName(a.parentAgentName).name+"("+getAgentInfoByName(a.parentAgentName).agentName+")")+"</div>"}},{text:"标签",dataField:"lebal",width:"14%"},{text:"备注",width:"12%",cellsrenderer:function(t,i,n,r,a,s){e.userData=s;var u='<div style="text-align:center">';return u+='<a class="hoverspan md-note-add viewCustAgentRemark" title="查看备注"></a>',u+="</div>"}}],pagesize:e.settings.grid.pagesize,columnsheight:50};$("#viewCustAgentGrid").grid(i),$("#viewCustAgentGrid").on("click",".viewCustAgentRemark",function(){var e=$("#viewCustAgentGrid").jqxGrid("getselectedrowindex"),t=$("#viewCustAgentGrid").jqxGrid("getrowdata",e);$("#viewCustAgentRemarkWin").jqxWindow("open",function(){var e={localdata:t.remark,datatype:"array"},i=new $.jqx.dataAdapter(e);$("#custAgentRemarkTbody").jqxGrid({source:i,width:"100%",height:160,autorowheight:!0,autoheight:!0,pageable:!1,columns:[{text:"更新时间",dataField:"createDate",width:"40%"},{text:"备注",dataField:"remark",width:"60%"}]})})})},this.settings={source:{data:e.searchObj},grid:{element:"viewCustAgentGrid"},ajax:{url:r}},this.searchObj={},this.initSearch=function(){e.searchObj={"sa.userInfo.createDate":{value:[],action:"between"},agentName:{value:[],action:"like"},"userInfo.telephone":{value:[],action:"like"}}},this.searchDataInfo=function(){$("#viewCustAgentGrid").jqxGrid("applyfilters"),$("#viewCustAgentGrid").jqxGrid("refreshfilterrow"),$("#viewCustAgentGrid").jqxGrid("clearselection")},this.refreshDataInfo=function(){$("#viewCustAgentGrid").jqxGrid("updatebounddata","cells"),$("#viewCustAgentGrid").jqxGrid("clearselection"),$("#viewCustAgentGrid").jqxGrid("refreshdata")}},ViewCustAgentBindModle=function(e){var t=this;this.search=function(){var t=$("#viewCustAgent-sTime").find("input").val(),i=$("#viewCustAgent-eTime").find("input").val(),n=$("#viewCustAgent-name").find("input").val(),r=$("#viewCustAgent-phone").val();e.searchObj["sa.userInfo.createDate"].value=[],""!=t&&""!=i&&e.searchObj["sa.userInfo.createDate"].value.push(t+" 00:00:00",i+" 23:59:59"),""!=t&&""===i&&e.searchObj["sa.userInfo.createDate"].value.push(t+" 00:00:00"),e.searchObj["sa.userInfo.createDate"].action="ge",""===t&&""!=i&&e.searchObj["sa.userInfo.createDate"].value.push(i+" 23:59:59"),e.searchObj["sa.userInfo.createDate"].action="le",e.searchObj.agentName.value=[],"全部"!=n&&e.searchObj.agentName.value.push(n),e.searchObj["userInfo.telephone"].value=[],""!=r&&e.searchObj["userInfo.telephone"].value.push(r),e.searchDataInfo()},this.bind=function(){$("#viewCustAgent-search").on("click",function(){$("#viewCustAgent-show").is(":hidden")?$("#viewCustAgent-show").slideDown("slow"):t.search()}),hiddenAclick()},this.unbindAll=function(){$("#viewCustAgent-search").off("click")}};