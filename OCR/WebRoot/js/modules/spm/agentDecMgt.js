var AgentDecMgt=function(){var e=this,t=_global_settings.service.url+"/user";this.debug=!1,this.data=null,e.urls3={url:{value:[t+"/userTax/-1/-1"]}},this.setUrl=function(){var a=""==$("#agentDec-su").val()?-1:$("#agentDec-su"),n=""==$("#agentDec-eu").val()?-1:$("#agentDec-eu");e.urls3.url={value:[t+"/userTax/"+a+"/"+n]}},this.initInput=function(){e.initPage(),e.initWindows(),e.initGrid(e.searchObj)},this.searchObj={sortdatafield:"user.createDate","user.username":{value:[],action:"like"},"user.employeeCode":{value:[],action:"like"},"user.locked":{value:[],action:"eq"},"user.createDate":{value:[],action:"between"}},this.initPage=function(){$("#agentDec-show").css("display",""),$("#agentDec-time").jqxDropDownList({source:["请选择","最近一周","最近两周","最近三周","本月","本季度","本年"],width:"100%",height:34,selectedIndex:0}),$("#agentDec-sTime").datetimeinput({formatString:"yyyy-MM-dd",height:34,width:"100%"}),$("#agentDec-eTime").datetimeinput({formatString:"yyyy-MM-dd",height:34,width:"100%"}),$("#agentDec-time").on("change",function(){setValueById("agentDec-time","agentDec-sTime","agentDec-eTime")}),$("#agentDec-status").dropDownlist({source:{all:"请选择",N:"启用",Y:"禁用"},height:34,width:"100%",selectedIndex:0}),$("#agentDec-show").addClass("hiddendiv")},this.initWindows=function(){$("#agentDecLockedWin").jqxWindow({theme:currentTheme,isModal:!0,autoOpen:!1,maxHeight:1e3,minHeight:260,height:"auto",minWidth:500,cancelButton:$("#agentDecLockedCancleBtn"),initContent:function(){$("#agentDec-locked").dropDownlist({source:{false:"否",true:"是"},height:34,width:"100%",selectedIndex:0})}}).on("close",function(){setTimeout(function(){$("#agentDec-name").val(""),$("#agentDec-locked").dropDownlist({selectedIndex:0})},500)})},this.getTaxerInfo=function(e){var t=ComboBoxSources.getRecords("taxerInfo");for(i=0;i<t.length;i++)if(e==t[i].username)return t[i];if(!e)return""},this.initGrid=function(){var t={url:e.urls3.url.value[0],dataUrl:e.urls3,data:e.searchObj},a=Core.AcDataAdapter("agentDecGrid",t,{beforeLoadComplete:function(e){}},e.debug),n={source:a,rendergridrows:function(e){return a.recordids},columns:[{text:"日期",width:"10%",cellsrenderer:function(e,t,a,n,i,r){return'<div style="padding-top:6px">'+r.createDate.substring(0,10)+"</div>"}},{text:"编号",width:"10%",cellsrenderer:function(e,t,a,n,i,r){var c='<div style="padding-top:6px;padding-left:2px">';return(c+='<a class="hoverspan viewAgentDec">'+r.employeeCode+"</a>")+"</div>"}},{text:"代理报税(姓名/用户名)",width:"12%",cellsrenderer:function(t,a,n,i,r,c){var d='<div style="padding-top:6px;padding-left:2px">';return(d+=e.getTaxerInfo(c.username).name+"("+c.username+")")+"</div>"}},{text:"负责客户",dataField:"ownerNum",width:"12%"},{text:"负责人",width:"12%"},{text:"累计佣金",cellsformat:"c2",cellsalign:"right",width:"12%"},{text:"未提佣金",cellsformat:"c2",cellsalign:"right",width:"12%"},{text:"禁用",width:"10%",cellsrenderer:function(e,t,a,n,i,r){return'<div style="padding-top:6px">'+getCodeData(r.locked)+"</div>"}},{text:"操作",width:"10%",cellsrenderer:function(e,t,a,n,i,r){var c='<div style="padding-top:2px;text-align:center">';return c+='<a class="hoverspan md-format-list-bulleted fpcust" title="分配用户"></a>',(c+='<a class="hoverspan md-error notuse" title="禁用"></a>')+"</div>"}}],pagesize:20,columnsheight:45,ready:function(){}};$("#agentDecGrid").grid(n),$("#agentDecGrid").on("click",".fpcust",function(){var e=$("#agentDecGrid").jqxGrid("getselectedrowindex");if(e>=0){var t=$("#agentDecGrid").jqxGrid("getrowdata",e);$.addTab({title:"分配用户",isFrame:!1,url:"page/modules/spm/agentStnMgt.html",pk:{username:t.username},reload:!0})}}),$("#agentDecGrid").on("click",".notuse",function(){var t=$("#agentDecGrid").jqxGrid("getselectedrowindex");if(t>=0){var a=$("#agentDecGrid").jqxGrid("getrowdata",t);e.data=a,$("#agentDecLockedWin").jqxWindow("open",function(){$("#agentDec-name").val(a.username)})}}),$("#agentDecGrid").on("click",".viewAgentDec",function(){var e=$("#agentDecGrid").jqxGrid("getselectedrowindex");if(e>=0){var t=$("#agentDecGrid").jqxGrid("getrowdata",e);$.addTab({title:"详情",isFrame:!1,url:"page/modules/spm/viewAgentDec.html",pk:{username:t.username,employeeCode:t.employeeCode},reload:!0})}})},this.searchDataInfo=function(){$("#agentDecGrid").jqxGrid("applyfilters"),$("#agentDecGrid").jqxGrid("refreshfilterrow"),$("#agentDecGrid").jqxGrid("clearselection")},this.refreshDataInfo=function(){$("#agentDecGrid").jqxGrid("updatebounddata","cells"),$("#agentDecGrid").jqxGrid("clearselection"),$("#agentDecGrid").jqxGrid("refreshdata")}},AgentDecBindModle=function(e){var t=this;this.search=function(){var t=$("#agentDec-username").val(),a=$("#agentDec-code").val(),n=$("#agentDec-status").val(),i=$("#agentDec-sTime").val(),r=$("#agentDec-eTime").val();e.searchObj["user.username"].value=[],""!=t&&e.searchObj["user.username"].value.push(t),e.searchObj["user.employeeCode"].value=[],""!=a&&e.searchObj["user.employeeCode"].value.push(a),e.searchObj["user.locked"].value=[],"all"!=n&&e.searchObj["user.locked"].value.push(n),e.searchObj["user.createDate"].value=[],""!=i&&""!=r&&e.searchObj["user.createDate"].value.push(i+" 00:00:00",r+" 23:59:59"),""!=i&&""===r&&e.searchObj["user.createDate"].value.push(i+" 00:00:00",getNowFormatDate()+" 23:59:59"),""===i&&""!=r&&e.searchObj["user.createDate"].value.push("2015-01-01 00:00:00",r+" 23:59:59"),e.searchDataInfo()},this.bind=function(){$("#agentDec-search").on("click",function(){$("#agentDec-show").is(":hidden")?$("#agentDec-show").slideDown("slow"):(e.setUrl(),t.search())}),hiddenAclick(),$("#agentDecLockedSaveBtn").on("click",function(){var t=e.data.id,a=$("#agentDec-locked").val();Core.AjaxRequest({url:_global_settings.service.url+"/user/lock/"+t+"/"+a,type:"PUT",async:!1,showMsg:!1,callback:function(){setCloseAlertTimeOneSecond(),$("#agentDecLockedWin").jqxWindow("close"),$("#agentDecGrid").jqxGrid("updatebounddata","cells")},failure:function(){}})})},this.unbindAll=function(){$("#agentDec-search").off("click"),$("#agentDecLockedSaveBtn").off("click")}};