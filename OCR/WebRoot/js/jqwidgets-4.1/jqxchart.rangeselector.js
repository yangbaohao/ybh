!function(e){e.extend(e.jqx._jqxChart.prototype,{_moduleRangeSelector:!0,_renderXAxisRangeSelector:function(t,i){var s=this;s._isTouchDevice=e.jqx.mobile.isTouchDevice();var r=s.seriesGroups[t],o=s._getXAxis(t),a=o?o.rangeSelector:void 0;if(!s._isSelectorRefresh){(a&&a.renderTo?a.renderTo:s.host).find(".rangeSelector").remove()}if(!o||0==o.visible||"spider"==r.type)return!1;if(!s._isGroupVisible(t))return!1;if(!a)return!1;var n="horizontal"==r.orientation;a.renderTo&&(n=!1),s.rtl&&(o.flip=!0);var d=n?this.host.height():this.host.width();d-=4;var l=this._getXAxisStats(t,o,d),h=o.position;if(a.renderTo&&a.position&&(h=a.position),!this._isSelectorRefresh){var c=a.renderTo,g=e("<div class='rangeSelector jqx-disableselect' style='position: absolute; background-color: transparent;' onselectstart='return false;'></div>").appendTo(c||this.renderer.getContainer());if(c)g.css({width:c.width(),height:c.height()}),i.width=c.width(),i.height=c.height();else{var p=this.host.coord();p.top=0,p.left=0,selectorSize=this._selectorGetSize(o),n?(g.css("left",p.left+1+i.x+("right"!=h?-selectorSize:i.width)),g.css("top",p.top),g.css("height",d),g.css("width",selectorSize),i.height=selectorSize):(g.css("left",p.left+1),g.css("top",p.top+i.y+("top"!=h?i.height:-selectorSize)),g.css("height",selectorSize),g.css("width",d))}this._refreshSelector(t,o,l,g,i,n)}return this._isSelectorRefresh=!1,!0},_refreshSelector:function(t,i,s,r,o,a){var n={},d=i.rangeSelector;this.seriesGroups[t];for(var l in d)n[l]=d[l];delete n.padding;var h=n.minValue,c=n.maxValue;void 0==h&&(h=Math.min(s.min.valueOf(),s.dsRange.min.valueOf())),void 0==c&&(c=Math.max(s.max.valueOf(),s.dsRange.max.valueOf())),this._isDate(s.min)&&(h=new Date(h)),this._isDate(s.max)&&(c=new Date(c));var g=i.position;d.renderTo&&d.position&&(g=d.position),n.dataField=i.dataField,delete n.rangeSelector,n.type=i.type,n.baseUnit=d.baseUnit||i.baseUnit,n.minValue=h,n.maxValue=c,n.flip=i.flip,n.position=g;var p=2,u=2,f=2,_=2;d.renderTo||(p=a?0:o.x,u=a?0:this._rect.width-o.x-o.width,f=a?o.y:5,_=a?this._paddedRect.height-this._plotRect.height:5);var v=d.padding;v=void 0!=v||d.renderTo?{left:v&&v.left?v.left:p,top:v&&v.top?v.top:f,right:v&&v.right?v.right:u,bottom:v&&v.bottom?v.bottom:_}:{left:p,top:f,right:u,bottom:_};for(var m=i.rangeSelector.dataField,l=0;void 0==m&&l<this.seriesGroups.length;l++)for(var x=0;void 0==m&&x<this.seriesGroups[l].series.length;x++)m=this.seriesGroups[l].series[x].dataField;var S={padding:v,_isRangeSelectorInstance:!0,title:d.title||"",description:d.description||"",titlePadding:d.titlePadding,colorScheme:d.colorScheme||this.colorScheme,backgroundColor:d.backgroundColor||this.backgroundColor||"transparent",backgroundImage:d.backgroundImage||"",showBorderLine:d.showBorderLine||!!d.renderTo,borderLineWidth:d.borderLineWidth||this.borderLineWidth,borderLineColor:d.borderLineColor||this.borderLineColor,rtl:d.rtl||this.rtl,greyScale:d.greyScale||this.greyScale,renderEngine:this.renderEngine,showLegend:!1,enableAnimations:!1,enableEvents:!1,showToolTips:!1,source:this.source,xAxis:n,seriesGroups:[{orientation:a?"horizontal":"vertical",valueAxis:{visible:!1},type:i.rangeSelector.serieType||"area",skipOverlappingPoints:e.jqx.getByPriority([i.rangeSelector.skipOverlappingPoints,!0]),columnSeriesOverlap:e.jqx.getByPriority([i.rangeSelector.columnSeriesOverlap,!1]),columnsGapPercent:e.jqx.getByPriority([i.rangeSelector.columnsGapPercent,25]),seriesGapPercent:e.jqx.getByPriority([i.rangeSelector.seriesGapPercent,25]),series:[{dataField:m,opacity:.8,lineWidth:1}]}]};S.showBorderLine||(S.borderLineWidth=1,S.borderLineColor=e.jqx.getByPriority([this.backgroundColor,this.background,"#FFFFFF"]),S.showBorderLine=!0);var w=this;w._supressBindingRefresh=!0,r.empty(),r.jqxChart(S),w._rangeSelectorInstances[t]=r,w._supressBindingRefresh=!1,r.on(w._getEvent("mousemove"),function(){w._unselect(),w._hideToolTip()});var y=r.jqxChart("getInstance");if(y._plotRect){var b=y._paddedRect;if(b.height=y._plotRect.height,a||"top"!=g){if(a){var T=y._renderData[0].xAxis.rect.width;b.width-=T,"right"!=g&&(b.x+=T)}}else b.y+=y._renderData[0].xAxis.rect.height;w._createSliderElements(t,r,b,d),w.removeHandler(e(document),w._getEvent("mousemove")+"."+this.element.id,w._onSliderMouseMove),w.removeHandler(e(document),w._getEvent("mousedown"),w._onSliderMouseDown),w.removeHandler(e(document),w._getEvent("mouseup")+"."+this.element.id,w._onSliderMouseUp),w.addHandler(e(document),w._getEvent("mousemove")+"."+this.element.id,w._onSliderMouseMove,{self:this,groupIndex:t,renderTo:r,swapXY:a}),w.addHandler(e(r),w._getEvent("mousedown"),this._onSliderMouseDown,{self:this,groupIndex:t,renderTo:r,swapXY:a}),w.addHandler(e(document),w._getEvent("mouseup")+"."+this.element.id,w._onSliderMouseUp,{element:this.element.id,self:this,groupIndex:t,renderTo:r,swapXY:a})}},_createSliderElements:function(t,i,s,r){i.find(".slider").remove();var o=r.selectedRangeColor||"blue",a=e.jqx.getByPriority([r.selectedRangeOpacity,.1]),n=e.jqx.getByPriority([r.unselectedRangeOpacity,.5]),d=r.unselectedRangeColor||"white",l=r.rangeLineColor||"grey",h=e("<div class='slider' style='position: absolute;'></div>");for(h.css({background:o,opacity:a,left:s.x,top:s.y,width:s.width,height:s.height}),h.appendTo(i);this._sliders.length<t+1;)this._sliders.push({});var c="<div class='slider' style='position: absolute;  background: "+d+"; opacity: "+n+";'></div>",g="<div class='slider' style='position: absolute; background:"+l+"; opacity: "+n+";'></div>",p="<div class='slider jqx-rc-all' style='position: absolute; background: white; border-style: solid; border-width: 1px; border-color: "+l+";'></div>";this._sliders[t]={element:h,host:i,_sliderInitialAbsoluteRect:{x:h.coord().left,y:h.coord().top,width:s.width,height:s.height},_hostInitialAbsolutePos:{x:i.coord().left,y:i.coord().top},getRect:function(){return{x:this.host.coord().left-this._hostInitialAbsolutePos.x+this._sliderInitialAbsoluteRect.x,y:this.host.coord().top-this._hostInitialAbsolutePos.y+this._sliderInitialAbsoluteRect.y,width:this._sliderInitialAbsoluteRect.width,height:this._sliderInitialAbsoluteRect.height}},rect:s,left:e(c),right:e(c),leftTop:e(g),rightTop:e(g),leftBorder:e(g),leftBar:e(p),rightBorder:e(g),rightBar:e(p)},this._sliders[t].left.appendTo(i),this._sliders[t].right.appendTo(i),this._sliders[t].leftTop.appendTo(i),this._sliders[t].rightTop.appendTo(i),this._sliders[t].leftBorder.appendTo(i),this._sliders[t].rightBorder.appendTo(i),this._sliders[t].leftBar.appendTo(i),this._sliders[t].rightBar.appendTo(i);var u=this._renderData[t].xAxis,f=u.data.axisStats,_=f.min.valueOf(),v=f.max.valueOf(),m=this._valueToOffset(t,_),x=this._valueToOffset(t,v);if(m>x){var S=x;x=m,m=S}"horizontal"!=this.seriesGroups[t].orientation?h.css({left:Math.round(s.x+m),top:s.y,width:Math.round(x-m),height:s.height}):h.css({top:Math.round(s.y+m),left:s.x,height:Math.round(x-m),width:s.width}),this._setSliderPositions(t,m,x)},_setSliderPositions:function(e,t,i){var s=this.seriesGroups[e],r=this._getXAxis(e),o=r.rangeSelector,a="horizontal"==s.orientation;r.rangeSelector.renderTo&&(a=!1);var n=r.position;o.renderTo&&o.position&&(n=o.position);var d=this._sliders[e],l=a?"top":"left",h=a?"left":"top",c=a?"height":"width",g=a?"width":"height",p=a?"y":"x",u=a?"x":"y",f=d.rect;d.startOffset=t,d.endOffset=i,d.left.css(l,f[p]),d.left.css(h,f[u]),d.left.css(c,t),d.left.css(g,f[g]),d.right.css(l,f[p]+i),d.right.css(h,f[u]),d.right.css(c,f[c]-i+1),d.right.css(g,f[g]),d.leftTop.css(l,f[p]),d.leftTop.css(h,f[u]+(a&&"right"==n||!a&&"top"!=n?0:f[g])),d.leftTop.css(c,t),d.leftTop.css(g,1),d.rightTop.css(l,f[p]+i),d.rightTop.css(h,f[u]+(a&&"right"==n||!a&&"top"!=n?0:f[g])),d.rightTop.css(c,f[c]-i+1),d.rightTop.css(g,1),d.leftBorder.css(l,f[p]+t),d.leftBorder.css(h,f[u]),d.leftBorder.css(c,1),d.leftBorder.css(g,f[g]);var _=f[g]/4;_>20&&(_=20),_<3&&(_=3),d.leftBar.css(l,f[p]+t-3),d.leftBar.css(h,f[u]+f[g]/2-_/2),d.leftBar.css(c,5),d.leftBar.css(g,_),d.rightBorder.css(l,f[p]+i),d.rightBorder.css(h,f[u]),d.rightBorder.css(c,1),d.rightBorder.css(g,f[g]),d.rightBar.css(l,f[p]+i-3),d.rightBar.css(h,f[u]+f[g]/2-_/2),d.rightBar.css(c,5),d.rightBar.css(g,_)},_resizeState:{},_onSliderMouseDown:function(t){t.stopImmediatePropagation(),t.stopPropagation();var i=t.data.self;i._sliders[t.data.groupIndex]&&(void 0==i._resizeState.state&&i._testAndSetReadyResize(t),"ready"==i._resizeState.state&&(e.jqx._rangeSelectorTarget=i,i._resizeState.state="resizing"))},_valueToOffset:function(e,t){var i=this.seriesGroups[e],s=this._sliders[e],r=s.host.jqxChart("getInstance"),o=r._renderData[0].xAxis,a=o.data.axisStats,n=a.min.valueOf(),d=a.max.valueOf(),l=d-n;0==l&&(l=1);var h=this._getXAxis(e),c="horizontal"==i.orientation?"height":"width",g=(t.valueOf()-n)/l;return s.getRect()[c]*(h.flip?1-g:g)},_offsetToValue:function(e,t){var i=this._sliders[e],s=this.seriesGroups[e],r=this._getXAxis(e),o="horizontal"==s.orientation?"height":"width",a=i.getRect()[o];0==a&&(a=1);var n=i.host.jqxChart("getInstance"),d=n._renderData[0].xAxis,l=d.data.axisStats,h=l.min.valueOf(),c=l.max.valueOf(),g=t/a*(c-h)+h;return 1==r.flip&&(g=c-t/a*(c-h)),this._isDate(l.min)||this._isDate(l.max)?g=new Date(g):((void 0==r.dataField||l.useIndeces)&&(g=Math.round(g)),g<l.min&&(g=l.min),g>l.max&&(g=l.max)),g},_onSliderMouseUp:function(t){var i=e.jqx._rangeSelectorTarget;if(i){var s=t.data.groupIndex,r=t.data.swapXY,o=i._sliders[s];if(o&&"resizing"==i._resizeState.state){t.stopImmediatePropagation(),t.stopPropagation(),i._resizeState={},i.host.css("cursor","default");var a=r?"top":"left",n=r?"y":"x",d=o.element.coord()[a],l=d+(r?o.element.height():o.element.width()),h=o.getRect(),c=i._offsetToValue(s,d-h[n]),g=i._offsetToValue(s,l-h[n]);!o.host.jqxChart("getInstance")._renderData[0].xAxis.data.axisStats.isTimeUnit&&g.valueOf()-c.valueOf()>864e5&&(c.setHours(0,0,0,0),g.setDate(g.getDate()+1),g.setHours(0,0,0,0));var p=i._getXAxis(s);if(p.flip){var u=c;c=g,g=u}for(var f=0;f<i.seriesGroups.length;f++){i._getXAxis(f)==p&&(i._selectorRange[f]={min:c,max:g})}i._isSelectorRefresh=!0;var _=i.enableAnimations;i._raiseEvent("rangeSelectionChanging",{instance:i,minValue:c,maxValue:g}),i.enableAnimations=!1,i.update(),i.enableAnimations=_,i._raiseEvent("rangeSelectionChanged",{instance:i,minValue:c,maxValue:g})}}},_onSliderMouseMove:function(t){var i=t.data.self,s=(t.data.renderTo,t.data.groupIndex),r=i._sliders[s],o=t.data.swapXY;if(r){var a=r.getRect(),n=r.element,d=e.jqx.position(t),l=n.coord(),h=o?"top":"left",c=o?"height":"width",g=o?"y":"x";if("resizing"==i._resizeState.state){if(t.stopImmediatePropagation(),t.stopPropagation(),"left"==i._resizeState.side){var p=Math.round(d[h]-l[h]),u=a[g];if(l[h]+p>=u&&l[h]+p<=u+a[c]){var f=parseInt(n.css(h)),_=Math.max(2,(o?n.height():n.width())-p);n.css(c,_),n.css(h,f+p)}}else if("right"==i._resizeState.side){var v=o?n.height():n.width(),p=Math.round(d[h]-l[h]-v),u=a[g];if(l[h]+v+p>=u&&l[h]+p+v<=u+a[c]){var _=Math.max(2,v+p);n.css(c,_)}}else if("move"==i._resizeState.side){var v=o?n.height():n.width(),f=parseInt(n.css(h)),p=Math.round(d[h]-i._resizeState.startPos);l[h]+p>=a[g]&&l[h]+p+v<=a[g]+a[c]&&(i._resizeState.startPos=d[h],n.css(h,f+p))}var m=parseInt(n.css(h))-r.rect[g],x=m+(o?n.height():n.width());i._setSliderPositions(s,m,x)}else i._testAndSetReadyResize(t)}},_testAndSetReadyResize:function(t){var i=t.data.self,s=t.data.renderTo,r=t.data.groupIndex,o=i._sliders[r],a=t.data.swapXY,n=o.getRect(),d=o.element,l=e.jqx.position(t),h=d.coord(),c=a?"left":"top",g=a?"top":"left",p=a?"width":"height",u=i._isTouchDevice?30:5;l[c]>=h[c]&&l[c]<=h[c]+n[p]?Math.abs(l[g]-h[g])<=u?(s.css("cursor",a?"row-resize":"col-resize"),i._resizeState={state:"ready",side:"left"}):Math.abs(l[g]-h[g]-(a?d.height():d.width()))<=u?(s.css("cursor",a?"row-resize":"col-resize"),i._resizeState={state:"ready",side:"right"}):l[g]+u>h[g]&&l[g]-u<h[g]+(a?d.height():d.width())?(s.css("cursor","pointer"),i._resizeState={state:"ready",side:"move",startPos:l[g]}):(s.css("cursor","default"),i._resizeState={}):(s.css("cursor","default"),i._resizeState={})},_selectorGetSize:function(e){return e.rangeSelector.renderTo?0:e.rangeSelector.size||this._paddedRect.height/3}})}(jqxBaseFramework);