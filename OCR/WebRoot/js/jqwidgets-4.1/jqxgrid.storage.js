!function(e){e.extend(e.jqx._jqxGrid.prototype,{savestate:function(t){var i=this.getstate();return void 0===t||e.isEmptyObject(t)||(-1==t.indexOf("sort")&&(delete i.sortcolumn,delete i.sortdirection),-1==t.indexOf("pager")&&(delete i.pagenum,delete i.pagesizeoptions,delete i.pagesize),-1==t.indexOf("selection")&&(delete i.selectedcells,delete i.selectedrowindexes,delete i.selectedrowindex),-1==t.indexOf("grouping")&&delete i.groups,-1==t.indexOf("filter")&&delete i.filters,e.each(this.columns.records,function(e){var s=i.columns[this.datafield];-1==t.indexOf("hidden_columns")&&delete s.hidden,-1==t.indexOf("reorder")&&delete s.index,-1==t.indexOf("columns_width")&&delete s.width,-1==t.indexOf("columns_text")&&delete s.text,-1==t.indexOf("alignment")&&(delete s.align,delete s.cellsalign)})),window.localStorage&&(window.localStorage["jqxGrid"+this.element.id]=this._stringify(i)),this._savedstate=i,i},loadstate:function(t,i){var s="";if(void 0!=t&&void 0!=t.width)s=t;else if(window.localStorage){var r=window.localStorage["jqxGrid"+this.element.id];if(r)var s=e.parseJSON(window.localStorage["jqxGrid"+this.element.id])}else if(this._savedstate)var s=this._savedstate;if(null!=s&&""!==s){(this.virtualmode||this.source._source.url&&""!=this.source._source.url)&&this.source.beginUpdate();var o=s;if(void 0!==o.width&&(this.width=o.width),void 0!==o.height&&(this.height=o.height),this.pageable&&(void 0!=o.pagesize&&(this.pagesize=o.pagesize,this.dataview.pagesize=o.pagesize),void 0!=o.pagenum&&(this.dataview.pagenum=o.pagenum),void 0!=o.pagesizeoptions&&(this.pagesizeoptions=o.pagesizeoptions),this.pagesizeoptions)){for(var a=0,l=0;l<this.pagesizeoptions.length;l++)this.pagesize>=this.pagesizeoptions[l]&&(a=l);this.pagershowrowscombo&&this.pagershowrowscombo.jqxDropDownList({selectedIndex:a})}if(this.sortable)if(this._loading&&(this._loading=!1),o.sortdirection){if(o.sortdirection.ascending||o.sortdirection.descending){this.dataview.sortfield=o.sortcolumn;var n=o.sortdirection.ascending?"asc":"desc";this.dataview.sortfielddirection=n,this.source.sortcolumn=o.sortcolumn,this.source.sortdirection=n,this.sortby(o.sortcolumn,n)}}else null==this.dataview.sortfield||"asc"!=this.dataview.sortfielddirection&&"desc"!=this.dataview.sortfielddirection||this.sortby(this.dataview.sortfield,null);this.groupable&&o.groups&&(this.dataview.groups=o.groups,this.groups=o.groups),this.loadingstate=!0,this.virtualsizeinfo&&this._loadselectionandcolumnwidths(o),this.loadingstate=!1,(this.virtualmode||this.source._source.url&&""!=this.source._source.url)&&(1==i?this.source.endUpdate(!1):(this.source.endUpdate(!1),(this.virtualmode||this.source._source.filter||this.source._source.sort)&&this.updatebounddata("state")))}},_loadselectionandcolumnwidths:function(t){this.loadingstate=!0;var i="";if(void 0!=t&&void 0!=t.width)i=t;else if(window.localStorage){if(window.localStorage["jqxGrid"+this.element.id])var i=e.parseJSON(window.localStorage["jqxGrid"+this.element.id])}else if(this._savedstate)var i=this._savedstate;if(null!=i&&""!=i){var s=this._loading;this._loading=!1;var r=i,o=this,a=!1,l=[];l.length=0;if(e.each(this.columns.records,function(e){var t=r.columns[this.datafield];if(void 0!=t){if(this.text!=t.text&&(a=!0),this.hidden!=t.hidden&&(a=!0),void 0!==t.width&&(this.width=t.width,this._width&&(this._width=null),this._percentagewidth&&(this._percentagewidth=null)),void 0!==t.hidden&&(this.hidden=t.hidden),void 0!==t.pinned&&(this.pinned=t.pinned),void 0!==t.groupable&&(this.groupable=t.groupable),void 0!==t.resizable&&(this.resizable=t.resizable),this.draggable=t.draggable,void 0!==t.text&&(this.text=t.text),void 0!==t.align&&(this.align=t.align),void 0!==t.cellsalign&&(this.cellsalign=t.cellsalign),o._columns)for(var i=0;i<o._columns.length;i++)o._columns[i].datafield==this.datafield&&(void 0!==t.hidden&&(o._columns[i].hidden=t.hidden),void 0!==t.width&&(o._columns[i].width=t.width));void 0!==t.index&&(l[this.datafield]=t.index,l.length++)}}),l.length>0){if(this.setcolumnindex){var n=this.rowdetails?1:0;n+=this.groupable?this.groups.length:0;for(var d=new Array,h=0;h<this.columns.records.length;h++)d.push(this.columns.records[h]);for(var c=0,f=new Array,h=0;h<d.length;h++){var u=d[h],g=l[u.datafield];if(this.groupable&&u.grouped)c++;else if(0==h&&this.rowdetails)c++;else if(h!==g||this.groupable||this.rowdetails){var p=c+g;f.push({column:u,key:p})}}f.sort(function(e,t){return e.key<t.key?-1:e.key>t.key?1:0}),f.reverse(),e.each(f,function(e,t){var i=this.key;o.setcolumnindex(this.column.datafield,i,!1)})}this.prerenderrequired=!0,this.groupable&&this._refreshdataview(),this.rendergridcontent(!0),this._updatefilterrowui&&this.filterable&&this.showfilterrow&&this._updatefilterrowui(),this._renderrows(this.virtualsizeinfo)}if(this.filterable&&void 0!==r.filters){this.clearfilters&&(this._loading=!1,this.clearfilters(!1));for(var v="",w=new e.jqx.filter,h=0;h<r.filters.filterscount;h++){var m=r.filters["filtercondition"+h],x=r.filters["filterdatafield"+h],u=this.getcolumn(x);if(x!=v&&(w=new e.jqx.filter),v=x,u&&u.filterable){var _=r.filters["filtervalue"+h],b=r.filters["filteroperator"+h],y=r.filters["filtertype"+h];if("datefilter"==y)var j=w.createfilter(y,_,m,null,u.cellsformat,this.gridlocalization);else var j=w.createfilter(y,_,m);if(w.addfilter(b,j),this.showfilterrow){var q=u._filterwidget,z=u._filterwidget.parent();if(null!=q)switch(u.filtertype){case"number":if(z.find("input").val(_),this.host.jqxDropDownList){var D=w.getoperatorsbyfiltertype("numericfilter");q.find(".filter").jqxDropDownList("selectIndex",D.indexOf(m))}break;case"date":this.host.jqxDateTimeInput?e(z.children()[0]).jqxDateTimeInput("setDate",_):q.val(_);break;case"range":if(this.host.jqxDateTimeInput){var O=r.filters["filtervalue"+(h+1)],y=r.filters["filtertype"+h],j=w.createfilter(y,O,"LESS_THAN_OR_EQUAL");w.addfilter(b,j);var k=new Date(_),S=new Date(O);isNaN(k)&&(k=e.jqx.dataFormat.tryparsedate(_)),isNaN(S)&&(S=e.jqx.dataFormat.tryparsedate(_)),e(z.children()[0]).jqxDateTimeInput("setRange",k,S),h++}else q.val(_);break;case"textbox":case"default":q.val(_),o["_oldWriteText"+q[0].id]=_;break;case"list":if(this.host.jqxDropDownList){var L=e(z.children()[0]).jqxDropDownList("getItems"),g=-1;e.each(L,function(e){if(this.value==_)return g=e,!1}),e(z.children()[0]).jqxDropDownList("selectIndex",g)}else q.val(_);break;case"checkedlist":this.host.jqxDropDownList||q.val(_);break;case"bool":case"boolean":this.host.jqxCheckBox?e(z.children()[0]).jqxCheckBox({checked:_}):q.val(_)}}this.addfilter(x,w)}}r.filters&&r.filters.filterscount>0&&(this.applyfilters(),this.showfilterrow&&e.each(this.columns.records,function(){if("checkedlist"==this.filtertype&&this.filterable&&o.host.jqxDropDownList){var t=this,i=t._filterwidget,s=(i.jqxDropDownList("getItems"),i.jqxDropDownList("listBox"));if(s.checkAll(!1),t.filter){s.uncheckAll(!1);for(var r=t.filter.getfilters(),a=0;a<s.items.length;a++){var l=s.items[a].label;e.each(r,function(){if("NOT_EQUAL"==this.condition)return!0;l==this.value&&s.checkIndex(a,!1,!1)})}s._updateCheckedItems();var n=s.getCheckedItems().length;s.items.length!=n&&n>0&&s.host.jqxListBox("indeterminateIndex",0,!0,!1)}}})),this.pageable&&void 0!==r.pagenum&&(this.gotopage&&!this.virtualmode?(this.dataview.pagenum=-1,this.gotopage(r.pagenum)):this.gotopage&&this.virtualmode&&this.gotopage(r.pagenum))}if(r.selectedrowindexes&&r.selectedrowindexes&&r.selectedrowindexes.length>0&&(this.selectedrowindexes=r.selectedrowindexes,this.selectedrowindex=r.selectedrowindex,"checkbox"===this.selectionmode&&this._updatecheckboxselection()),r.selectedcells&&this._applycellselection&&e.each(r.selectedcells,function(){o._applycellselection(this.rowindex,this.datafield,!0,!1)}),this.groupable&&void 0!==r.groups)return this._refreshdataview(),this.render(),this._loading=s,void(this.loadingstate=!1);if(a){if(this.prerenderrequired=!0,this.rendergridcontent(!0),this._loading=s,this.loadingstate=!1,this.updating())return!1}else this._loading=s,this._updatecolumnwidths(),this._updatecellwidths(),this.loadingstate=!1;this.loadingstate=!1,this._loading=s,this._renderrows(this.virtualsizeinfo)}this.loadingstate=!1},getstate:function(){var t=this.getdatainformation(),i={};if(i.width=this.width,i.height=this.height,i.pagenum=t.paginginformation.pagenum,i.pagesize=t.paginginformation.pagesize,i.pagesizeoptions=this.pagesizeoptions,i.sortcolumn=t.sortinformation.sortcolumn,i.sortdirection=t.sortinformation.sortdirection,null!=this.selectionmode&&this.getselectedcells)if(-1!=this.selectionmode.toString().indexOf("cell")){var s=this.getselectedcells(),r=new Array;e.each(s,function(){r.push({datafield:this.datafield,rowindex:this.rowindex})}),i.selectedcells=r}else{var o=this.getselectedrowindexes();i.selectedrowindexes=o,i.selectedrowindex=this.selectedrowindex}var a={},l=0;if(this.dataview.filters)for(var n=0;n<this.dataview.filters.length;n++){var d=this.dataview.filters[n].datafield,h=this.dataview.filters[n].filter,c=h.getfilters();a[d+"operator"]=h.operator;for(var f=0;f<c.length;f++){if(c[f].datafield=d,"datefilter"==c[f].type)if(c[f].value&&c[f].value.toLocaleString){var u=this.getcolumn(c[f].datafield);if(u.cellsformat){var g=this.source.formatDate(c[f].value,u.cellsformat,this.gridlocalization);a["filtervalue"+l]=g||c[f].value.toLocaleString()}else a["filtervalue"+l]=c[f].value.toLocaleString()}else a["filtervalue"+l]=c[f].value;else a["filtervalue"+l]=c[f].value;a["filtercondition"+l]=c[f].condition,a["filteroperator"+l]=c[f].operator,a["filterdatafield"+l]=d,a["filtertype"+l]=c[f].type,l++}}a.filterscount=l,i.filters=a,i.groups=this.groups,i.columns={};var p=0;return this.columns.records&&e.each(this.columns.records,function(e,t){if(!this.datafield)return!0;var s={};s.width=this.width,s.hidden=this.hidden,s.pinned=this.pinned,s.groupable=this.groupable,s.resizable=this.resizable,s.draggable=this.draggable,s.text=this.text,s.align=this.align,s.cellsalign=this.cellsalign,s.index=p++,i.columns[this.datafield]=s}),i},_stringify:function(e){if(window.JSON&&"function"==typeof window.JSON.stringify){var t=this,i="";try{i=window.JSON.stringify(e)}catch(i){return t._str("",{"":e})}return i}var i=this._str("",{"":e});return i},_quote:function(e){var t=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,i={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};return'"'+e.replace(t,function(e){var t=i[e];return"string"==typeof t?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+'"'},_stringifyArray:function(e){for(var t,i=e.length,s=[],t=0;t<i;t++)s.push(this._str(t,e)||"null");return"["+s.join(",")+"]"},_stringifyObject:function(e){var t,i,s=[],r=this;for(t in e)Object.prototype.hasOwnProperty.call(e,t)&&(i=r._str(t,e))&&s.push(r._quote(t)+":"+i);return"{"+s.join(",")+"}"},_stringifyReference:function(e){switch(Object.prototype.toString.call(e)){case"[object Array]":return this._stringifyArray(e)}return this._stringifyObject(e)},_stringifyPrimitive:function(e,t){switch(t){case"string":return this._quote(e);case"number":return isFinite(e)?e:"null";case"boolean":return e}return"null"},_str:function(e,t){var i=t[e],s=typeof i;return i&&"object"==typeof i&&"function"==typeof i.toJSON&&(i=i.toJSON(e),s=typeof i),/(number|string|boolean)/.test(s)||!i&&"object"===s?this._stringifyPrimitive(i,s):this._stringifyReference(i)}})}(jqxBaseFramework);