!function(e){e.extend(e.jqx._jqxGrid.prototype,{getcolumnindex:function(e){var o=this.getcolumn(e);return this.columns.records.indexOf(o)},setcolumnindex:function(o,r,t){var n=this.getcolumn(o);if(!(n.pinned||n.hidden||n.checkboxcolumn||n.grouped)){var s=this.columns.records.indexOf(n);this.columns.records.splice(s,1),this.columns.records.splice(r,0,n);var i=0,d=this.headerZIndex;this.columnsrow.children().detach();var l=this.toThemeProperty("jqx-grid-cell");l+=" "+this.toThemeProperty("jqx-grid-cell-pinned"),this.filterrow&&(e(this.filterrow.children()[0]).children().detach(),this.filterrow[0].cells=[]);var c=this,u=null;if(void 0!=c.filterrow)var u=e(c.filterrow.children()[0]);this.columnsrow[0].cells=[];var a=!1;if(e.each(this.columns.records,function(o,r){var t=this.uielement;c.columnsrow.append(t),c.rtl?t.css("z-index",d++):t.css("z-index",d--);var n=this.width;if(t.css("left",i),c.columnsrow[0].cells[c.columnsrow[0].cells.length]=t[0],c.filterrow){var s=e('<div style="overflow: hidden; position: absolute; height: 100%;" class="'+l+'"></div>');u.append(s),s.css("left",i),s.css("z-index",d+1),s.width(this.width),s[0].left=i,s.append(this._filterwidget),c.filterrow[0].cells[c.filterrow[0].cells.length]=s[0]}this.hidden&&(a=!0),this.hidden&&this.hideable||(i+=n)}),this.groupable){var h=this.groups.length;h>0&&s-h>=0&&(s-=h,r-=h)}this.rowdetails&&s-1>=0&&(s--,r--),"checkbox"==this.selectionmode&&s-1>=0&&(s--,r--);var n=this._columns[s];this._columns.splice(s,1),this._columns.splice(r,0,n),this._raiseEvent(24,{columntext:n.text,datafield:n.datafield,oldindex:s,newindex:r}),0!=t&&(a||"checkbox"==n.columntype?(this.prerenderrequired=!0,this.rendergridcontent(!0,!1),this._updatecolumnwidths(),this._updatecellwidths()):(this._updatecolumnwidths(),this._updatecellwidths()),this._updatefilterrowui&&this.filterable&&this.showfilterrow&&this._updatefilterrowui(),this.showeverpresentrow&&this._updateaddnewrowui(),this._rendercolumngroups(),this._renderrows(this.virtualsizeinfo))}},_pinnedColumnsLength:function(){var o=0;return e.each(this.columns.records,function(){this.pinned&&o++,this.grouped&&o++}),"checkbox"==this.selectionmode&&o++,o},_handlecolumnsreorder:function(){var o=this,r=-1,t=!1;if(o.columnsreorder){var n="mousemove.reorder"+this.element.id,s="mousedown.reorder"+this.element.id,i="mouseup.reorder"+this.element.id,d=!1;this.isTouchDevice()&&!0!==this.touchmode&&(d=!0,n=e.jqx.mobile.getTouchEventName("touchmove")+".reorder"+this.element.id,s=e.jqx.mobile.getTouchEventName("touchstart")+".reorder"+this.element.id,i=e.jqx.mobile.getTouchEventName("touchend")+".reorder"+this.element.id),this.removeHandler(e(document),n),this.addHandler(e(document),n,function(e){if(o.resizing)return!0;if(null!=o.reordercolumn){var n=parseInt(e.pageX),s=parseInt(e.pageY);if(d){var i=o.getTouches(e),l=i[0];void 0!=l&&(n=parseInt(l.pageX),s=parseInt(l.pageY))}var c=o.host.coord(),u=parseInt(c.left),a=parseInt(c.top);void 0!=o.dragmousedownoffset&&null!=o.dragmousedownoffset||(o.dragmousedownoffset={left:0,top:0});var h=parseInt(n)-parseInt(o.dragmousedownoffset.left),m=parseInt(s)-parseInt(o.dragmousedownoffset.top);if(o.reordercolumn.css({left:h+"px",top:m+"px"}),t=!1,n>=u&&n<=u+o.host.width()&&s>=a&&s<=a+o.host.height()&&(t=!0),r=-1,t){o.reordercolumnicon.removeClass(o.toThemeProperty("jqx-grid-dragcancel-icon")),o.reordercolumnicon.addClass(o.toThemeProperty("jqx-grid-drag-icon"));var p=o.columnsheader.coord(),f=p.top+o.columnsheader.height();null!=o.columnsdropline&&(s>=p.top&&s<=f?r=o._handlereordercolumnsdroplines(n):o.columnsdropline.fadeOut("slow"))}else null!=o.columnsdropline&&o.columnsdropline.fadeOut("slow"),o.reordercolumnicon.removeClass(o.toThemeProperty("jqx-grid-drag-icon")),o.reordercolumnicon.addClass(o.toThemeProperty("jqx-grid-dragcancel-icon"));if(d)return e.preventDefault(),e.stopPropagation(),!1}}),this.columnsbounds=new Array,this.removeHandler(e(document),s),this.addHandler(e(document),s,function(r){if(o.resizing)return!0;o.columnsbounds=new Array;var t=o.host.coord().left,n=o.host.coord().top;o.showtoolbar&&(n+=o.toolbarheight),o.groupable&&o.showgroupsheader&&(n+=o.groupsheaderheight);var s=0;e.each(o.columns.records,function(r){var i=this;if(i.hidden)return o.columnsbounds[o.columnsbounds.length]={top:n,column:i,left:t,width:0,height:2+o.rowsheight},!0;0==s&&(t=o.rtl?"hidden"!=o.hScrollBar.css("visibility")?parseInt(o.host.coord().left)-o.hScrollInstance.max+o.hScrollInstance.value:parseInt(o.host.coord().left)+o.hScrollInstance.value:parseInt(o.host.coord().left)-o.hScrollInstance.value),s++;var d=2+o.columnsheight;o.columnshierarchy&&(n=e(i.uielement).coord().top,d=e(i.uielement).height()),o.columnsbounds[o.columnsbounds.length]={top:n,column:i,left:t,width:i.width,height:d},t+=i.width})}),this.removeHandler(e(document),i),this.addHandler(e(document),i,function(n){if(o.resizing)return!0;o.__drag=!1,e(document.body).removeClass("jqx-disableselect");parseInt(n.pageX),parseInt(n.pageY);if(d){var s=o.getTouches(n),i=s[0];parseInt(i.pageX),parseInt(i.pageY)}var l=o.host.coord(),c=(parseInt(l.left),parseInt(l.top));o.groupsheader.height();if(o.showtoolbar&&(c+=o.toolbarheight),o.columndragstarted=!1,o.dragmousedown=null,null!=o.reordercolumn){var u=e.data(o.reordercolumn[0],"reorderrecord"),a=o.columns.records.indexOf(o.getcolumn(u));o.reordercolumn.remove(),o.reordercolumn=null;var h=0;if(h+=o._pinnedColumnsLength(),null!=u){if(t&&-1!=r){var m=r.index;if(m>=h){var p=o.columns.records[m];if(void 0!=p){var f=o.columns.records.indexOf(o.getcolumn(p.datafield));if(null==p.datafield)var f=o.columns.records.indexOf(o.getcolumnbytext(p.text));if(o.columngroups){var g=p;if(a<f&&"before"==r.position&&(g=o.columns.records[f-1]),g.columngroup!=o.getcolumn(u).columngroup)return void(null!=o.columnsdropline&&(o.columnsdropline.remove(),o.columnsdropline=null))}a<f?"before"==r.position?o.setcolumnindex(u,f-1):o.setcolumnindex(u,f):a>f&&o.setcolumnindex(u,f),o.autosavestate&&o.savestate&&o.savestate()}}}null!=o.columnsdropline&&(o.columnsdropline.remove(),o.columnsdropline=null)}}})}},getcolumnbytext:function(o){var r=null;return this.columns.records&&e.each(this.columns.records,function(){if(this.text==o)return r=this,!1}),r},_handlereordercolumnsdroplines:function(o){var r=this,t=-1,n=r._pinnedColumnsLength(),s=parseInt(r.host.coord().left),i=s+r.host.width(),d="hidden"!=r.vScrollBar.css("visibility")?19:0;return r.rtl||(d=0),e.each(r.columnsbounds,function(e){if(e>=n){if(0==this.width)return!0;if(o<=this.left+this.width/2)return o>i?(r.columnsdropline.fadeOut(),!1):(r.columnsdropline.css("left",d+parseInt(this.left)+"px"),r.columnsdropline.css("top",parseInt(this.top)+"px"),r.columnsdropline.height(this.height),r.columnsdropline.fadeIn("slow"),t={index:e,position:"before"},!1);if(o>=this.left+this.width/2){if(this.left+this.width>i)return r.columnsdropline.fadeOut(),!1;r.columnsdropline.css("left",d+1+this.left+this.width),r.columnsdropline.css("top",this.top),r.columnsdropline.height(this.height),r.columnsdropline.fadeIn("slow"),t={index:e,position:"after"}}}}),t},_createreordercolumn:function(o,r,t){var n=this,s=r;n.reordercolumn&&n.reordercolumn.remove(),n.columnsdropline&&n.columnsdropline.remove(),n.reordercolumn=e("<div></div>");var i=o.clone();n.reordercolumn.css("z-index",999999),i.css("border-width","1px"),i.css("opacity","0.4");var d=e(i.find("."+n.toThemeProperty("jqx-grid-column-menubutton")));d.length>0&&d.css("display","none");var l=e(i.find(".jqx- md-cancel  "));l.length>0&&l.css("display","none"),n.reordercolumnicon=e('<div style="z-index: 9999; position: absolute; left: 100%; top: 50%; margin-left: -18px; margin-top: -7px;"></div>'),n.reordercolumnicon.addClass(n.toThemeProperty("jqx-grid-drag-icon")),n.reordercolumn.css("float","left"),n.reordercolumn.css("position","absolute");n.host.coord();i.width(o.width()+16),n.reordercolumn.append(i),n.reordercolumn.height(o.height()),n.reordercolumn.width(i.width()),n.reordercolumn.append(n.reordercolumnicon),e(document.body).append(n.reordercolumn),i.css("margin-left",0),i.css("left",0),i.css("top",0),n.reordercolumn.css("left",s.left+n.dragmousedown.left),n.reordercolumn.css("top",s.top+n.dragmousedown.top),void 0!=t&&t&&(n.columnsdropline=e('<div style="z-index: 9999; display: none; position: absolute;"></div>'),n.columnsdropline.width(2),n.columnsdropline.addClass(n.toThemeProperty("jqx-grid-group-drag-line")),e(document.body).append(n.columnsdropline))},_handlecolumnsdragreorder:function(o,r){this.reordercolumn&&this.reordercolumn.remove(),this.columnsdropline&&this.columnsdropline.remove(),this.dragmousedown=null,this.dragmousedownoffset=null,this.columndragstarted=!1,this.reordercolumn=null;var t,n=this,s=!1;this.isTouchDevice()&&!0!==this.touchmode&&(s=!0);var i="mousedown.drag",t="mousemove.drag";s?(i=e.jqx.mobile.getTouchEventName("touchstart")+".drag",t=e.jqx.mobile.getTouchEventName("touchmove")+".drag"):this.addHandler(r,"dragstart",function(e){return!1}),this.addHandler(r,i,function(r){if(0==o.draggable)return!0;if(n.resizing)return!0;n.__drag=!0;var t=r.pageX,i=r.pageY;if(s){var d=n.getTouches(r),l=d[0];t=l.pageX,i=l.pageY}n.dragmousedown={left:t,top:i};var c=e(r.target).coord();return n.dragmousedownoffset={left:parseInt(t)-parseInt(c.left),top:parseInt(i-c.top)},!0}),this.addHandler(r,t,function(i){if(!o.draggable)return!0;if(void 0==o.datafield)return!0;if(o.pinned)return!0;if(n.resizing)return!0;if(n.dragmousedown){var d=i.pageX,l=i.pageY;if(s){var c=n.getTouches(i),u=c[0];void 0!=u&&(d=u.pageX,l=u.pageY)}if(t={left:d,top:l},!n.columndragstarted&&null==n.reordercolumn){var a=Math.abs(t.left-n.dragmousedown.left),h=Math.abs(t.top-n.dragmousedown.top);(a>3||h>3)&&(n._createreordercolumn(r,t,!0),e(document.body).addClass("jqx-disableselect"),e.data(n.reordercolumn[0],"reorderrecord",o.datafield))}}})}})}(jqxBaseFramework);