<meta charset="UTF-8">
<div id="add_remark" class="modal fade in" tabindex="-1" role="dialog" aria-labelledby="full-width-modalLabel" aria-hidden="true" style="display: none;">
	<div class="modal-dialog ">
		<div class="modal-content">
			<!--模态框头部-->
			<div class="modal-header">
				<div class="quotation-nav">
					<div class="row">
						<div class="quotation-nav-left" style="">
							<b style="margin-left: 20px;">添加备注</b>
						</div>
						<div class="quotation-nav-right">
							<button type="button" class="close-modal btn-success"
								data-dismiss="modal" aria-hidden="true">
								<i class="glyphicon glyphicon-remove close-btn" style="padding: 0;"></i>
							</button>
						</div>
					</div>
				</div>
			</div>
			<!--模态框body-->
			<div class="modal-body">
				<div class="row container">
					<input type="text" class="hide" id="userId"/>
					<input type="text" class="hide" id="remark_type"/>
					<div class="col-sm-12 p-t-10">
						<div class="row">
							<div class="form-horizontal">
								<div class="form-group">
									<div class="col-sm-12">
										<div id="remarkGrid"></div>
									</div>
								</div>
							</div>
						</div>
						<div class="row">
							<div class="form-horizontal">
								<div class="form-group">
									<div class="col-sm-12">
										<label>备注</label>
										<textarea class="form-control" placeholder="最大长度100字" maxlength="100" id="user_addRemark"></textarea>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
			<!--模态框脚页-->
			<div class="modal-footer" style="padding:20px;padding-top:0px">
				<button type="button" class="btn btn-success close-btn" data-dismiss="modal">取消</button>
				<button type="button" class="btn btn-success" data-dismiss="modal"
					id='save_addRemarkBtn'>保存</button>
			</div>
		</div>
	</div>
</div>
<script>

	//保存
	$('#save_addRemarkBtn').off('click').on('click',function(){
		var _type=$('#remark_type').val();
		var _url = _global_settings.service.url+'/owner/remark'
		
		if(_type){//代理商/商机添加备注
			var obj={};
			obj.comment=$('#user_addRemark').val();
			if(_type=='potentialtrack'){ //商机添加备注
				_url=_global_settings.service.url+'/potentialtrack';	
				obj.potential={id:$('#userId').val()};
			}else{
				_url=_global_settings.service.url +'/salesagent/comment'
				obj.salesAgent={id:$('#userId').val()};
			}
			Core.AjaxRequest({
				params:obj,
				type:'POST',
				url:_url,
				async:false,
				callback:function(res){
					try{
						$('#agentGrid').jqxGrid('updatebounddata', 'cells');	
					}catch(e){}
					try{
						$('#busoGrid').jqxGrid('updatebounddata', 'cells');	
					}catch(e){}
				},
				failure:function(res){
					
				}
			});
		}else{
			Core.AjaxRequest({
				url:_url,
				type:'PUT',
				params:{id:$('#userId').val(),remark:[{remark:$('#user_addRemark').val()}]},
				async:false,
				callback:function(){
					try{
						$('#userMgtGrid').jqxGrid('updatebounddata','cells');	
					}catch(e){}
				},
				failure:function(){
					
				}
			});
		}
	});
</script>