<meta charset="UTF-8">
<div id="segment-updatePassword" class="modal " tabindex="-1"
	role="dialog" aria-labelledby="full-width-modalLabel"
	aria-hidden="true" style="display: none;">
	<div class="modal-dialog wd700">
		<div class="modal-content">
			<!--模态框头部-->
			<div class="modal-header">
				<div class="quotation-nav">
					<div class="row">
						<div class="quotation-nav-left" style="">
							<span style="margin-left: 20px;">修改密码</span>
						</div>
						<div class="quotation-nav-right">
							<button type="button" class="close-modal btn-r"
								data-dismiss="modal" aria-hidden="true">
								×
							</button>
						</div>
					</div>
				</div>
			</div>
			<!--模态框body-->
			<div class="modal-body">
				<div class="row container">
					<div class="col-sm-12">
						<div class="fixed-table-container " style="padding-bottom: 0px;">
							<div class="row card-box nopadding">
								<div class="col-md-12 p-t-20">
									<div class="row">


										<form action="#" class="form-horizontal">
											<div class="form-group">
												<label class="control-label col-sm-3">原密码</label>
												<div class="col-sm-5">
													<input id="segment-updatePassword-old"
														type="password" value="" class="form-control">
												</div>
												<label class="mustword">*</label>
											</div>
										</form>

									</div>
									<div class="row">


										<form action="#" class="form-horizontal">
											<div class="form-group">
												<label class="control-label col-sm-3">新密码</label>
												<div class="col-sm-5">
													<input id="segment-updatePassword-new1"
														type="password" value="" class="form-control">
												</div>
												<label class="mustword">*</label>
											</div>
										</form>

									</div>
									<div class="row">


										<form action="#" class="form-horizontal">
											<div class="form-group">
												<label class="control-label col-sm-3">确认新密码</label>
												<div class="col-sm-5">
													<input id="segment-updatePassword-new2"
														type="password" value="" class="form-control">
												</div>
												<label class="mustword">*</label>
											</div>
										</form>

									</div>


								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
			<!--模态框脚页-->
			<div class="modal-footer" style="padding: 20px;">
				<button type="button" class="btn btn-success" data-dismiss="modal">取消</button>
				<button type="button" class="btn btn-success" id="updatePasswordBtn"
					data-dismiss="modal">保存</button>
			</div>
		</div>
	</div>
	<!-- /.modal-dialog -->
</div>

<script>
$("#segment-updatePassword").jqxValidator({
	hintType: 'label',
	animationDuration: 1
   ,rules: [
		{ input: '#segment-updatePassword-old', message: "不能为空", action: 'keyup, blur', rule: 'required' },
		{ input: '#segment-updatePassword-new1', message: "不能为空", action: 'keyup, blur', rule: 'required' },
		{ input: '#segment-updatePassword-new1', message: "密码长度应为6-20位", action: 'keyup, blur',
			rule: function(input,commit){
				var val = input.val();
				if(val.length<6||val.length>20)
					return false;
				return true;
			}
		},
		{ input: '#segment-updatePassword-new2', message: "两次密码不一致", action: 'keyup, blur',
			rule: function(input,commit){
				var val = input.val();
				var p=$('#segment-updatePassword-new1').val();
				if(val!==p) 
					return false;
				return true;
			}
		}
	]
});
$('#main-updatePassword').on('click',function(){
	
})

$('#updatePasswordBtn').on('click',function(){
	if($("#segment-updatePassword").jqxValidator('validate')){
		var json={
			oldPassword:$('#segment-updatePassword-old').val(),
			newPassword:$('#segment-updatePassword-new1').val()
		}
		Core.AjaxRequest({
            url :  _global_settings.service.url+'/user/password/',
            type: "PUT",
            params:json,
            async:false,
            showMsg:true,
            callback: function(res) {
            	Core.alert({
            		message:'密码修改成功，请使用新密码重新登录！',
            		hide:3000,
            		callback:function(){
            			timeOut(function(){
            				window.onbeforeunload = function(event){
                			}
                			window.location.href='logout';
            			},2000)
            		}
            	})
            },
            failure:function(res){
            	Core.alert({message:res});
            }
        });
	}
	return false;
})
</script>